import{cH as z,cI as L,cJ as I,cK as x,cL as ee,ae as Y,cM as te,cN as re,cO as ae,cP as ne,cQ as oe,cR as se,br as D,s as ie,ca as ce,a as S,cS as de,cT as le,cU as ue,cV as me,a6 as $,aY as U,cz as he,a_ as B,R as M,a5 as q,v as fe,l as ge,cW as pe,cX as ye,cY as we,a4 as A,bg as ve,cZ as K,a9 as be,c_ as O,aj as Q,f as Pe,c$ as Ee,d0 as Ce,bk as ke,ac as Se,au as E,cF as Ie,G as xe,d1 as We,d2 as _e,o as b,d3 as V,d4 as k,cr as T,co as Me}from"./index-B1yGdhtz.js";import{r as d}from"./index-TjLUG_Bo.js";import{j as w}from"./jsx-runtime-DF5SV9au.js";function De(t,e,a){const r=z(t,a),n=z(e,a);return+r==+n}const Ne={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},Le=(t,e,a)=>{let r;const n=Ne[t];return typeof n=="string"?r=n:e===1?r=n.one:r=n.other.replace("{{count}}",String(e)),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?r+"内":r+"前":r},Ae={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Oe={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Te={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Re={date:L({formats:Ae,defaultWidth:"full"}),time:L({formats:Oe,defaultWidth:"full"}),dateTime:L({formats:Te,defaultWidth:"full"})};function H(t,e,a){const r="eeee p";return De(t,e,a)?r:t.getTime()>e.getTime()?"'下个'"+r:"'上个'"+r}const $e={lastWeek:H,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:H,other:"PP p"},qe=(t,e,a,r)=>{const n=$e[t];return typeof n=="function"?n(e,a,r):n},je={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},Fe={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},ze={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},Ue={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},Ke={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},Qe={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},Ve=(t,e)=>{const a=Number(t);switch(e==null?void 0:e.unit){case"date":return a.toString()+"日";case"hour":return a.toString()+"时";case"minute":return a.toString()+"分";case"second":return a.toString()+"秒";default:return"第 "+a.toString()}},He={ordinalNumber:Ve,era:I({values:je,defaultWidth:"wide"}),quarter:I({values:Fe,defaultWidth:"wide",argumentCallback:t=>t-1}),month:I({values:ze,defaultWidth:"wide"}),day:I({values:Ue,defaultWidth:"wide"}),dayPeriod:I({values:Ke,defaultWidth:"wide",formattingValues:Qe,defaultFormattingWidth:"wide"})},Xe=/^(第\s*)?\d+(日|时|分|秒)?/i,Je=/\d+/i,Ye={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},Be={any:[/^(前)/i,/^(公元)/i]},Ge={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},Ze={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},et={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},tt={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},rt={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},at={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},nt={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},ot={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},st={ordinalNumber:ee({matchPattern:Xe,parsePattern:Je,valueCallback:t=>parseInt(t,10)}),era:x({matchPatterns:Ye,defaultMatchWidth:"wide",parsePatterns:Be,defaultParseWidth:"any"}),quarter:x({matchPatterns:Ge,defaultMatchWidth:"wide",parsePatterns:Ze,defaultParseWidth:"any",valueCallback:t=>t+1}),month:x({matchPatterns:et,defaultMatchWidth:"wide",parsePatterns:tt,defaultParseWidth:"any"}),day:x({matchPatterns:rt,defaultMatchWidth:"wide",parsePatterns:at,defaultParseWidth:"any"}),dayPeriod:x({matchPatterns:nt,defaultMatchWidth:"any",parsePatterns:ot,defaultParseWidth:"any"})},it={code:"zh-CN",formatDistance:Le,formatLong:Re,formatRelative:qe,localize:He,match:st,options:{weekStartsOn:1,firstWeekContainsDate:4}};var ct=()=>{d.useEffect(()=>{let t=new URLSearchParams(window.location.search).get("ref");t&&localStorage.setItem("referral_code",t)},[])};function dt(t){return t==="BUY"?b.t("common.buy"):t==="SELL"?b.t("common.sell"):T(t)}function lt(t,e){let{symbol:a,side:r,quantity:n,client_order_id:o}=t,c="total_executed_quantity"in t?t.total_executed_quantity:0,s="status"in t?t.status:t.algo_status,l=e[a],p=l("base_dp"),i=dt(r),u=We(a),m="algo_type"in t&&t.algo_type===_e.POSITIONAL_TP_SL?b.t("tpsl.entirePosition"):p===void 0?n:V(n,{dp:p}),h="",y="";switch(s){case k.NEW:o!=null&&o.startsWith("scaled_")?(h=b.t("orders.status.scaledSubOrderOpened.toast.title"),y=`${i} ${u} ${m}`):(h=b.t("orders.status.opened.toast.title"),y=`${i} ${u} ${m}`);break;case k.FILLED:case k.PARTIAL_FILLED:let P=p===void 0?c:V(c,{dp:p});h=b.t("orders.status.filled.toast.title"),y=`${i} ${u} ${P} / ${m}`;break;case k.CANCELLED:h=b.t("orders.status.canceled.toast.title"),y=`${i} ${u} ${m}`;break;case k.REJECTED:h=b.t("orders.status.rejected.toast.title"),y=`${i} ${u} ${m}`;break;case k.REPLACED:h=b.t("orders.status.replaced.toast.title"),y=`${r} ${u} ${c} / ${m}`;break}return{title:h,msg:y}}function ut(){let t=D(),e=ie(),a=d.useRef({});d.useEffect(()=>{a.current=e},[e]);let r=ce(n=>{(o=>{let{title:c,msg:s}=lt(o,a.current),l=o.algo_type||o.type;c&&s&&E.success(w.jsxs("div",{children:[c,w.jsx("br",{}),w.jsx("div",{className:"orderly-text-white/[0.54] orderly-text-xs",children:s})]}),{id:l})})(n)},100);d.useEffect(()=>(t.on("orders:changed",r),()=>{t.off("orders:changed",r)}),[])}function mt(){let{t}=S(),e=de();return d.useMemo(()=>{let a={[U.en]:le,[U.zh]:it};return{locale:e,dialog:{ok:t("common.ok"),cancel:t("common.cancel")},modal:{confirm:t("common.confirm"),cancel:t("common.cancel")},pagination:{morePages:t("ui.pagination.morePages"),rowsPerPage:t("ui.pagination.rowsPerPage")},picker:{selectDate:t("ui.picker.selectDate"),dayPicker:a[e]},empty:{description:t("ui.empty.description")}}},[t,e])}var ht=()=>{let t=ke(),{t:e}=S();d.useEffect(()=>{let a=t.privateSubscribe({id:"assetconvert",event:"subscribe",topic:"assetconvert",ts:Se()},{onMessage(r){r.convertId&&E.success(e("transfer.convert.completed"))}});return()=>a()},[])};function ft(t){let{storageChain:e,setStorageChain:a}=he(),[r,n]=d.useState(),[o]=B(),c=M("networkId"),{connectedChain:s}=q();return d.useEffect(()=>{var l,p,i;if(s)n==null||n(typeof s.id=="number"?s.id:parseInt(s.id));else{if(r)return;let u,m=c==="mainnet"?(l=o.mainnet)==null?void 0:l[0]:(p=o.testnet)==null?void 0:p[0];typeof t=="function"?u=t(c,o):typeof t=="object"&&(u=c==="mainnet"?t==null?void 0:t.mainnet:t==null?void 0:t.testnet);let h=(u==null?void 0:u.id)||((i=m==null?void 0:m.network_infos)==null?void 0:i.chain_id);if(!h)return;e?n==null||n(e.chainId):(a(h),n==null||n(h))}},[s,o,r,c,n,t]),[r,n]}var X="orderly:wallet-info";function gt(){let{connectedChain:t,disconnect:e}=q(),[a,r]=fe("orderly_link_device",{}),{account:n}=$(),{isMobile:o}=ge(),c=M(),s=async i=>{localStorage.removeItem(X),await n.disconnect(),await e({label:i})};d.useEffect(()=>{let i=R(),u=JSON.parse(localStorage.getItem(X)??"{}");i&&u&&s(u.label)},[]);let l=async()=>{let i=R();if(!i)return;let{address:u,secretKey:m,chainId:h,chainNamespace:y}=i;if(!await n.importOrderlyKey({address:u,secretKey:m,chainNamespace:y}))return;r({chainId:h,chainNamespace:y});let P=new URL(window.location.href);P.searchParams.delete("link"),P.searchParams.append("utm_medium","qrcode");let N=decodeURIComponent(P.toString());history.replaceState(null,"",N)};d.useEffect(()=>{o&&!t&&l()},[n,t,o]);let p=async()=>{let{chainId:i,chainNamespace:u}=pt()||{};if(o&&!t&&i&&u){let m=n.keyStore.getAddress(),h=n.keyStore.getOrderlyKey(),y=n.keyStore.getAccountId(m);await n.checkOrderlyKey(m,h,y)&&c.set("chainNamespace",u)}};return d.useEffect(()=>{p()},[n,o,t]),{linkDevice:l}}function pt(){try{let t=localStorage.getItem("orderly_link_device");return t?Me(t):null}catch{}}function R(){let t=new URL(window.location.href).searchParams.get("link");if(!t)return;let{a:e,k:a,i:r,n}=yt(t)||{};if(e&&a&&r&&n)return{address:e,secretKey:a,chainId:r,chainNamespace:n}}function yt(t){try{let e=JSON.parse(window.atob(t)),a=Math.floor(Date.now()/1e3),r=e.t;return!r||a>r?void 0:e}catch{}}function wt(){let{t}=S();Ce({onMessage:e=>{let{status:a}=e;switch(a){case"COMPLETED":E.success(t("settle.settlement.completed"));break;case"FAILED":E.error(t("settle.settlement.failed"));break}}})}function vt(){let{t}=S(),e=D(),{setLedgerAddress:a}=Ie();return d.useEffect(()=>{e.on("wallet:connect-error",r=>{E.error(r.message)}),e.on("wallet:sign-message-with-ledger-error",r=>{window.setTimeout(()=>{xe.confirm({title:t("connector.ledger.signMessageFailed"),content:t("connector.ledger.signMessageFailed.description"),size:"sm",onOk:async()=>(a(r.userAddress),Promise.resolve()),okLabel:t("common.ok"),onCancel:async()=>(E.error(r.message),Promise.resolve()),cancelLabel:t("common.no")}).then(n=>{})})})},[e,t]),{}}function bt(){let{t}=S(),e=D(),a=d.useRef({}),[r,n]=Pe("orderly_wallet_change_id",{});a.current=r,Ee({onMessage:o=>{let{id:c,side:s,transStatus:l}=o,p=!0;if(["DEPOSIT","WITHDRAW"].includes(s)&&["COMPLETED","FAILED"].includes(l)){let i=a.current[c];n({...r,[c]:i?void 0:!0}),p=!i}if(l==="COMPLETED"&&p){let i=`${T(s)} completed`;s==="DEPOSIT"?i=t("transfer.deposit.completed"):s==="WITHDRAW"&&(i=t("transfer.withdraw.completed")),E.success(i)}else if(l==="FAILED"&&p){let i=`${T(s)} failed`;s==="DEPOSIT"?i=t("transfer.deposit.failed"):s==="WITHDRAW"&&(i=t("transfer.withdraw.failed")),E.error(i)}e.emit("wallet:changed",o)}})}var J="orderly:wallet-info",Pt=t=>{let{wallet:e,connect:a,connectedChain:r,disconnect:n,namespace:o}=q();if(typeof a!="function")throw new pe("Please provide a wallet connector provider");D();let c=d.useRef(!1);M("brokerId");let{account:s,state:l}=$(),p=ye(),i=M("networkId"),[u,{checkChainSupport:m}]=B(),[h,y]=d.useState(!1),{track:P,setTrackUserId:N}=Y(),W=d.useMemo(()=>{var f,g;return(g=(f=e==null?void 0:e.accounts)==null?void 0:f[0])==null?void 0:g.address},[e]),v=d.useMemo(()=>{var C,_,j,F;let f=(_=(C=e==null?void 0:e.chains)==null?void 0:C[0])==null?void 0:_.id,g=(F=(j=e==null?void 0:e.chains)==null?void 0:j[0])==null?void 0:F.namespace;if(!(typeof f>"u"))return{id:we(f),namespace:g}},[e]);return d.useEffect(()=>{l.status>=A.EnableTrading&&s.accountId&&N(s.accountId)},[s,l]),d.useEffect(()=>{if(!r){y(!1);return}let f=m(r.id,i);ve.has(parseInt(r.id))&&(e==null?void 0:e.label)!=="AGW"&&(f=!1),y(!f)},[r,u,m,i,e]),d.useEffect(()=>{K(()=>{let f=p.getAddress(),g=JSON.parse(localStorage.getItem(J)??"{}");(r==null?void 0:r.namespace)!==be.solana&&f&&s.address!==f&&g.label&&a({autoSelect:{label:g.label,disableModals:!0}}).then(C=>{},C=>{})})},[e,s.address]),d.useEffect(()=>{if(e===null&&l.status>A.NotConnected&&!l.validating){s.disconnect();return}if(h||!r||c.current)return;let f=R();W&&W!==s.address&&!f&&(s.setAddress(W,{provider:e==null?void 0:e.provider,chain:{id:O(v.id),namespace:v.namespace.toUpperCase()},wallet:{name:(e==null?void 0:e.label)??""},additionalInfo:(e==null?void 0:e.additionalInfo)??{}},{validateOrderlyKeyScope:g=>g.includes("asset")}),P(Q.walletConnect,{wallet:(e==null?void 0:e.label)??"",network:v.namespace.toUpperCase()}),K(()=>{localStorage.setItem(J,JSON.stringify({label:(e==null?void 0:e.label)??""}))})),(v==null?void 0:v.id)!==s.chainId&&s.switchChainId(v==null?void 0:v.id)},[e,r,W,v,s.address,l,s.chainId,h]),{connectWallet:async()=>(c.current=!0,a({chainId:t.currentChainId}).then(async f=>{if(Array.isArray(f)&&f.length>0&&f[0]&&f[0].accounts.length>0){let g=f[0],C=O(g.chains[0].id);if(!m(C,i))return{wrongNetwork:!0};if(!s)throw new Error("account is not initialized");l.status===A.EnableTradingWithoutConnected&&(localStorage.removeItem("orderly_link_device"),await s.disconnect());let _=await s.setAddress(g.accounts[0].address,{provider:g.provider,chain:{id:O(g.chains[0].id),namespace:g.chains[0].namespace.toUpperCase()},wallet:{name:g.label}});return P(Q.walletConnect,{wallet:g.label,network:g.chains[0].namespace.toUpperCase()}),{wallet:g,status:_,wrongNetwork:!1}}return null}).finally(()=>{c.current=!1})),wrongNetwork:h}},G=d.createContext({setCurrentChainId:t=>{},restrictedInfo:{},setShowAnnouncement:t=>{}}),Et=()=>d.useContext(G),Ct=t=>{let[e,a]=d.useState(!1),[r,n]=ft(t.defaultChain);gt(),ue();let{connectWallet:o,wrongNetwork:c}=Pt({currentChainId:r});bt(),wt(),ht(),vt();let s=me(t.restrictedInfo),l=s.restrictedOpen,p=d.useMemo(()=>({connectWallet:o,wrongNetwork:c,currentChainId:r,setCurrentChainId:n,onChainChanged:t.onChainChanged,disabledConnect:l,restrictedInfo:s,showAnnouncement:e,setShowAnnouncement:a,onRouteChange:t.onRouteChange}),[o,r,l,t.onChainChanged,s,n,e,c,t.onRouteChange]);return w.jsx(G.Provider,{value:p,children:t.children})},Z=d.createContext({}),_t=()=>d.useContext(Z),kt=t=>w.jsx(Z.Provider,{value:t,children:t.children}),St=t=>{let{components:e,appIcons:a,onChainChanged:r,defaultChain:n,...o}=t;Y(),ct(),ut();let c=mt();return w.jsx(kt,{appIcons:a,brokerName:t.brokerName,children:w.jsx(te,{components:e,overrides:t.overrides,children:w.jsxs(re,{...o,children:[w.jsx(Ct,{onChainChanged:r,defaultChain:n,restrictedInfo:t.restrictedInfo,onRouteChange:t.onRouteChange,children:w.jsx(ae,{locale:c,children:w.jsx(ne,{delayDuration:300,children:w.jsx(oe,{children:t.children})})})}),w.jsx(se,{})]})})})};St.displayName="OrderlyAppProvider";var Mt=(t,e)=>{let{wrongNetwork:a,disabledConnect:r}=Et(),{state:n}=$();return e!=null&&e.skip?t:a||r||typeof(e==null?void 0:e.accountStatus)<"u"&&n.status<e.accountStatus?typeof(e==null?void 0:e.fallbackData)<"u"?e.fallbackData:null:t};function Dt(t){let{t:e}=S(),a=(r,n,o)=>{var c;return((c={quantity:{required:e("orderEntry.orderQuantity.error.required"),min:e("orderEntry.orderQuantity.error.min",{value:o}),max:e("orderEntry.orderQuantity.error.max",{value:o})},order_quantity:{required:e("orderEntry.orderQuantity.error.required"),min:e("orderEntry.orderQuantity.error.min",{value:o}),max:e("orderEntry.orderQuantity.error.max",{value:o})},order_price:{required:e("orderEntry.orderPrice.error.required"),min:e("orderEntry.orderPrice.error.min",{value:o}),max:e("orderEntry.orderPrice.error.max",{value:o})},trigger_price:{required:e("orderEntry.triggerPrice.error.required"),min:e("orderEntry.triggerPrice.error.min",{value:o}),max:e("orderEntry.triggerPrice.error.max",{value:o})},tp_trigger_price:{min:e("orderEntry.tpTriggerPrice.error.min",{value:o}),max:e("orderEntry.tpTriggerPrice.error.max",{value:o})},sl_trigger_price:{min:e("orderEntry.slTriggerPrice.error.min",{value:o}),max:e("orderEntry.slTriggerPrice.error.max",{value:o})},total:{min:e("orderEntry.total.error.min",{value:o})},max_price:{required:e("orderEntry.upperPrice.error.required"),min:e("orderEntry.upperPrice.error.min",{value:o}),max:e("orderEntry.upperPrice.error.max",{value:o})},min_price:{required:e("orderEntry.lowerPrice.error.required"),min:e("orderEntry.lowerPrice.error.min",{value:o}),max:e("orderEntry.lowerPrice.error.max")},total_orders:{required:e("orderEntry.totalOrders.error.required"),range:e("orderEntry.totalOrders.error.range")},skew:{required:e("orderEntry.skew.error.required"),min:e("orderEntry.skew.error.min",{value:o}),max:e("orderEntry.skew.error.max",{value:o})}}[r])==null?void 0:c[n])||""};return{parseErrorMsg:r=>{let{type:n,value:o}=(t==null?void 0:t[r])||{};return n?a(r,n,o):""}}}export{Et as D,Dt as M,Mt as _,St as i,_t as w};
