import{cA as jt,o as q,cB as Ut,a as S,bz as To,L as g,K as te,au as U,q as h,at as J,M as E,dX as Po,H as fe,h as ko,W,dh as wt,dP as $i,dQ as Oo,aZ as Do,a6 as Fe,a4 as Me,bU as js,bV as Io,ca as ws,dY as _s,dZ as Lo,bR as Ve,an as Eo,e as T,ai as Bt,F as vs,G as he,l as _t,ap as pn,bq as ai,ar as vt,cl as mn,bX as Gn,x as li,b as Ue,b_ as Ao,bZ as qo,N as Ft,V as ee,br as at,d_ as yt,R as Ne,a5 as hn,d$ as Ro,e0 as Mo,v as De,e1 as Fo,e2 as $o,e3 as Cs,da as on,di as bt,dn as Ct,dz as fn,e4 as nt,cm as Ns,t as ye,e5 as zo,a_ as ui,d as di,c_ as Ss,e6 as Uo,e7 as Ts,e8 as Ps,bS as ks,e9 as Os,ea as Bo,eb as Wo,c7 as Vo,ec as Ho,bx as ci,ed as Qo,bP as Ds,ee as Ko,ef as Is,eg as Ls,a9 as Go,bf as Xo,bg as Jo,bs as Xn,C as pi,D as mi,E as Es,P as hi,bv as fi,O as Le,dj as Yo,i as xi,cG as Zo,eh as ea,ei as ta,s as Ee,dK as gi,d2 as Z,bh as xn,dk as gn,bj as yn,d1 as na,d6 as ke,ba as As,cW as ia,ej as sa,ek as je,dl as ue,b2 as Oe,dd as Nt,el as ra,d8 as oa,dq as Rn,dr as aa,ds as qs,j as Wt,ah as Vt,a8 as Ht,ag as Rs,ak as ge,em as Ms,a3 as re,d5 as ie,en as la,eo as ua,bQ as Fs,ep as yi,c9 as da,eq as $s,aI as se,bH as ca,bJ as pa,er as We,k as ma,a7 as zs,T as Us,bm as ha,bu as Bs,es as fa,et as xa,ac as ga,d4 as X,al as Ws,dv as ya,eu as ba,$ as ja,ev as wa,aq as Jn,ew as _a,ex as va,bA as bi,ey as Ca,ez as Vs,eA as Na,eB as Sa,eC as Ta}from"./index-B1yGdhtz.js";import{r as p,W as ce}from"./index-TjLUG_Bo.js";import{j as n}from"./jsx-runtime-DF5SV9au.js";import{T as Qe,A as bn,F as Hs,y as Qt}from"./index-7JkPJWjm.js";import{D as jn,w as Pa,M as wn,_ as Kt}from"./index-BHYcTakE.js";import{d as ji}from"./differenceInDays-f7lEgFzC.js";import{u as Qs}from"./embla-carousel-react.esm-KU9cekPH.js";var zi=e=>{let{Icon:t,onClick:i,disabled:s}=e;return n.jsx(t,{onClick:s?void 0:i,className:E("oui-m-2 oui-text-white oui-transition-all",s?"oui-cursor-not-allowed oui-opacity-20":"oui-cursor-pointer oui-opacity-100")})},ka=e=>{let t=ce.useMemo(()=>[J.numberFormatter,J.dpFormatter(0)],[]),i=p.useId();return n.jsxs("label",{htmlFor:i,className:E("oui-w-full","oui-rounded","oui-bg-base-6","oui-flex","oui-items-center","oui-justify-between","oui-outline","oui-outline-offset-0","oui-outline-1","oui-outline-transparent","focus-within:oui-outline-primary-light","oui-input-root"),children:[n.jsx(zi,{Icon:Po,onClick:e.onLeverageReduce,disabled:e.isReduceDisabled}),n.jsxs(g,{itemAlign:"center",justify:"center",children:[n.jsx(fe,{value:e.value,id:i,autoComplete:"off",classNames:{input:E("oui-text-center"),root:E("oui-text-center","oui-w-7","oui-px-0","oui-outline","oui-outline-offset-0","oui-outline-1","oui-outline-transparent","focus-within:oui-outline-primary-none")},formatters:t,onChange:e.onInputChange}),n.jsx("div",{className:"oui-select-none",children:"x"})]}),n.jsx(zi,{Icon:ko,onClick:e.onLeverageIncrease,disabled:e.isIncreaseDisabled})]})},Oa=e=>{let{currentLeverage:t}=e,{t:i}=S();return n.jsxs(g,{itemAlign:"start",direction:"column",mb:0,children:[n.jsx(Da,{currentLeverage:t}),n.jsx(ka,{...e}),n.jsx(Ia,{...e}),n.jsx(La,{...e}),n.jsxs(g,{direction:"row",gap:2,width:"100%",mt:0,pt:5,children:[n.jsx(te,{variant:"contained",color:"gray",fullWidth:!0,onClick:e.onCancel,"data-testid":"oui-testid-leverage-cancel-btn",children:i("common.cancel")}),n.jsx(te,{fullWidth:!0,loading:e.isLoading,onClick:e.onSave,"data-testid":"oui-testid-leverage-save-btn",disabled:e.disabled,children:i("common.save")})]})]})},Da=e=>{let{t}=S(),{currentLeverage:i}=e;return n.jsx(g,{justify:"center",width:"100%",mb:2,children:n.jsxs(g,{gap:1,children:[`${t("common.current")}:`,n.jsx(h.numeral,{unit:"x",size:"sm",intensity:80,dp:0,children:i??"--"})]})})},Ia=e=>{let{value:t,onLeverageChange:i}=e;return n.jsx(g,{itemAlign:"center",justify:"between",width:"100%",mt:2,children:e.toggles.map(s=>n.jsx(g,{itemAlign:"center",justify:"center",className:E("oui-box-border oui-cursor-pointer oui-rounded-md oui-border oui-border-solid oui-bg-clip-padding oui-px-3 oui-py-2.5 oui-transition-all",t===s?"oui-border-primary oui-bg-base-6":"oui-border-line-12"),onClick:()=>i==null?void 0:i(s),children:n.jsxs(g,{itemAlign:"center",justify:"center",className:E("oui-h-3 oui-w-9 oui-select-none"),children:[s,"x"]})},s))})},La=e=>{let{leverageLevers:t,maxLeverage:i,className:s,value:r,showSliderTip:o}=e;return n.jsxs(W,{pt:4,width:"100%",className:s,children:[n.jsx(wt,{max:i,min:1,markCount:5,value:[r],onValueChange:a=>{e.onLeverageChange(a[0]),e.setShowSliderTip(!0)},color:"primary",onValueCommit:a=>{var l;(l=e.onValueCommit)==null||l.call(e,a),e.setShowSliderTip(!1)},showTip:o,tipFormatter:a=>`${a}x`}),n.jsx(g,{justify:"between",width:"100%",pt:3,children:t==null?void 0:t.map((a,l)=>n.jsx("button",{onClick:()=>{var u;e.onLeverageChange(a),(u=e.onValueCommit)==null||u.call(e,[a])},className:E("oui-pb-3 oui-text-2xs",l===0?"oui-pr-2":l===5?"oui-pl-0":"oui-ml-2 oui-px-0",e.value>=a&&"oui-text-primary-light"),"data-testid":`oui-testid-leverage-${a}-btn`,children:`${a}x`},a))})]})},Ea=e=>{let[t,i]=p.useState(!1),{t:s}=S(),{curLeverage:r,maxLeverage:o,isLoading:a,leverageLevers:l,update:u}=To(),d=p.useMemo(()=>l.map(O=>({label:`${O}x`,value:O})),[l]),[c,m]=p.useState(r??0),y=100/(((d==null?void 0:d.length)||0)-1),j=O=>{m(O)},f=()=>{m(O=>O+1)},b=()=>{m(O=>O-1)},x=p.useCallback(O=>{let A=Number.parseInt(O.target.value),k=Number.isNaN(A)?"":A;m(k)},[o]),C=async()=>{try{u({leverage:c}).then(()=>{var O;(O=e==null?void 0:e.close)==null||O.call(e),U.success(s("leverage.updated"))},O=>{U.error(O.message)})}catch{}},w=c<=1,v=c>=o,N=!c||c<1||c>o,I=p.useMemo(()=>[5,10,20,50,100],[l,o]);return{leverageLevers:l,currentLeverage:r,value:c,marks:d,onLeverageChange:j,onLeverageIncrease:f,onLeverageReduce:b,onInputChange:x,isReduceDisabled:w,isIncreaseDisabled:v,disabled:N,step:y,onCancel:e==null?void 0:e.close,onSave:C,isLoading:a,showSliderTip:t,setShowSliderTip:i,maxLeverage:o,toggles:I}},Ks=e=>{let t=Ea({close:e.close});return n.jsx(Oa,{...t})},Aa="LeverageWidgetWithDialog",qa="LeverageWidgetWithSheet";jt(Aa,Ks,{title:()=>q.t("leverage.maxAccountLeverage"),size:"md"});Ut(qa,Ks,{title:()=>q.t("leverage.maxAccountLeverage")});function Gs(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ra}=Object.prototype,{getPrototypeOf:wi}=Object,{iterator:_n,toStringTag:Xs}=Symbol,vn=(e=>t=>{const i=Ra.call(t);return e[i]||(e[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),$e=e=>(e=e.toLowerCase(),t=>vn(t)===e),Cn=e=>t=>typeof t===e,{isArray:St}=Array,$t=Cn("undefined");function Ma(e){return e!==null&&!$t(e)&&e.constructor!==null&&!$t(e.constructor)&&ve(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Js=$e("ArrayBuffer");function Fa(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Js(e.buffer),t}const $a=Cn("string"),ve=Cn("function"),Ys=Cn("number"),Nn=e=>e!==null&&typeof e=="object",za=e=>e===!0||e===!1,nn=e=>{if(vn(e)!=="object")return!1;const t=wi(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Xs in e)&&!(_n in e)},Ua=$e("Date"),Ba=$e("File"),Wa=$e("Blob"),Va=$e("FileList"),Ha=e=>Nn(e)&&ve(e.pipe),Qa=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ve(e.append)&&((t=vn(e))==="formdata"||t==="object"&&ve(e.toString)&&e.toString()==="[object FormData]"))},Ka=$e("URLSearchParams"),[Ga,Xa,Ja,Ya]=["ReadableStream","Request","Response","Headers"].map($e),Za=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gt(e,t,{allOwnKeys:i=!1}={}){if(e===null||typeof e>"u")return;let s,r;if(typeof e!="object"&&(e=[e]),St(e))for(s=0,r=e.length;s<r;s++)t.call(null,e[s],s,e);else{const o=i?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length;let l;for(s=0;s<a;s++)l=o[s],t.call(null,e[l],l,e)}}function Zs(e,t){t=t.toLowerCase();const i=Object.keys(e);let s=i.length,r;for(;s-- >0;)if(r=i[s],t===r.toLowerCase())return r;return null}const tt=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Oo,er=e=>!$t(e)&&e!==tt;function Yn(){const{caseless:e}=er(this)&&this||{},t={},i=(s,r)=>{const o=e&&Zs(t,r)||r;nn(t[o])&&nn(s)?t[o]=Yn(t[o],s):nn(s)?t[o]=Yn({},s):St(s)?t[o]=s.slice():t[o]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&Gt(arguments[s],i);return t}const el=(e,t,i,{allOwnKeys:s}={})=>(Gt(t,(r,o)=>{i&&ve(r)?e[o]=Gs(r,i):e[o]=r},{allOwnKeys:s}),e),tl=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),nl=(e,t,i,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},il=(e,t,i,s)=>{let r,o,a;const l={};if(t=t||{},e==null)return t;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)a=r[o],(!s||s(a,e,t))&&!l[a]&&(t[a]=e[a],l[a]=!0);e=i!==!1&&wi(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},sl=(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;const s=e.indexOf(t,i);return s!==-1&&s===i},rl=e=>{if(!e)return null;if(St(e))return e;let t=e.length;if(!Ys(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},ol=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&wi(Uint8Array)),al=(e,t)=>{const s=(e&&e[_n]).call(e);let r;for(;(r=s.next())&&!r.done;){const o=r.value;t.call(e,o[0],o[1])}},ll=(e,t)=>{let i;const s=[];for(;(i=e.exec(t))!==null;)s.push(i);return s},ul=$e("HTMLFormElement"),dl=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,s,r){return s.toUpperCase()+r}),Ui=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),cl=$e("RegExp"),tr=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),s={};Gt(i,(r,o)=>{let a;(a=t(r,o,e))!==!1&&(s[o]=a||r)}),Object.defineProperties(e,s)},pl=e=>{tr(e,(t,i)=>{if(ve(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const s=e[i];if(ve(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},ml=(e,t)=>{const i={},s=r=>{r.forEach(o=>{i[o]=!0})};return St(e)?s(e):s(String(e).split(t)),i},hl=()=>{},fl=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function xl(e){return!!(e&&ve(e.append)&&e[Xs]==="FormData"&&e[_n])}const gl=e=>{const t=new Array(10),i=(s,r)=>{if(Nn(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[r]=s;const o=St(s)?[]:{};return Gt(s,(a,l)=>{const u=i(a,r+1);!$t(u)&&(o[l]=u)}),t[r]=void 0,o}}return s};return i(e,0)},yl=$e("AsyncFunction"),bl=e=>e&&(Nn(e)||ve(e))&&ve(e.then)&&ve(e.catch),nr=((e,t)=>e?setImmediate:t?((i,s)=>(tt.addEventListener("message",({source:r,data:o})=>{r===tt&&o===i&&s.length&&s.shift()()},!1),r=>{s.push(r),tt.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",ve(tt.postMessage)),jl=typeof queueMicrotask<"u"?queueMicrotask.bind(tt):typeof $i<"u"&&$i.nextTick||nr,wl=e=>e!=null&&ve(e[_n]),P={isArray:St,isArrayBuffer:Js,isBuffer:Ma,isFormData:Qa,isArrayBufferView:Fa,isString:$a,isNumber:Ys,isBoolean:za,isObject:Nn,isPlainObject:nn,isReadableStream:Ga,isRequest:Xa,isResponse:Ja,isHeaders:Ya,isUndefined:$t,isDate:Ua,isFile:Ba,isBlob:Wa,isRegExp:cl,isFunction:ve,isStream:Ha,isURLSearchParams:Ka,isTypedArray:ol,isFileList:Va,forEach:Gt,merge:Yn,extend:el,trim:Za,stripBOM:tl,inherits:nl,toFlatObject:il,kindOf:vn,kindOfTest:$e,endsWith:sl,toArray:rl,forEachEntry:al,matchAll:ll,isHTMLForm:ul,hasOwnProperty:Ui,hasOwnProp:Ui,reduceDescriptors:tr,freezeMethods:pl,toObjectSet:ml,toCamelCase:dl,noop:hl,toFiniteNumber:fl,findKey:Zs,global:tt,isContextDefined:er,isSpecCompliantForm:xl,toJSONObject:gl,isAsyncFn:yl,isThenable:bl,setImmediate:nr,asap:jl,isIterable:wl};function G(e,t,i,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}P.inherits(G,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:P.toJSONObject(this.config),code:this.code,status:this.status}}});const ir=G.prototype,sr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{sr[e]={value:e}});Object.defineProperties(G,sr);Object.defineProperty(ir,"isAxiosError",{value:!0});G.from=(e,t,i,s,r,o)=>{const a=Object.create(ir);return P.toFlatObject(e,a,function(u){return u!==Error.prototype},l=>l!=="isAxiosError"),G.call(a,e.message,t,i,s,r),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};const _l=null;function Zn(e){return P.isPlainObject(e)||P.isArray(e)}function rr(e){return P.endsWith(e,"[]")?e.slice(0,-2):e}function Bi(e,t,i){return e?e.concat(t).map(function(r,o){return r=rr(r),!i&&o?"["+r+"]":r}).join(i?".":""):t}function vl(e){return P.isArray(e)&&!e.some(Zn)}const Cl=P.toFlatObject(P,{},null,function(t){return/^is[A-Z]/.test(t)});function Sn(e,t,i){if(!P.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,i=P.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,x){return!P.isUndefined(x[b])});const s=i.metaTokens,r=i.visitor||c,o=i.dots,a=i.indexes,u=(i.Blob||typeof Blob<"u"&&Blob)&&P.isSpecCompliantForm(t);if(!P.isFunction(r))throw new TypeError("visitor must be a function");function d(f){if(f===null)return"";if(P.isDate(f))return f.toISOString();if(P.isBoolean(f))return f.toString();if(!u&&P.isBlob(f))throw new G("Blob is not supported. Use a Buffer instead.");return P.isArrayBuffer(f)||P.isTypedArray(f)?u&&typeof Blob=="function"?new Blob([f]):Do.from(f):f}function c(f,b,x){let C=f;if(f&&!x&&typeof f=="object"){if(P.endsWith(b,"{}"))b=s?b:b.slice(0,-2),f=JSON.stringify(f);else if(P.isArray(f)&&vl(f)||(P.isFileList(f)||P.endsWith(b,"[]"))&&(C=P.toArray(f)))return b=rr(b),C.forEach(function(v,N){!(P.isUndefined(v)||v===null)&&t.append(a===!0?Bi([b],N,o):a===null?b:b+"[]",d(v))}),!1}return Zn(f)?!0:(t.append(Bi(x,b,o),d(f)),!1)}const m=[],y=Object.assign(Cl,{defaultVisitor:c,convertValue:d,isVisitable:Zn});function j(f,b){if(!P.isUndefined(f)){if(m.indexOf(f)!==-1)throw Error("Circular reference detected in "+b.join("."));m.push(f),P.forEach(f,function(C,w){(!(P.isUndefined(C)||C===null)&&r.call(t,C,P.isString(w)?w.trim():w,b,y))===!0&&j(C,b?b.concat(w):[w])}),m.pop()}}if(!P.isObject(e))throw new TypeError("data must be an object");return j(e),t}function Wi(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function _i(e,t){this._pairs=[],e&&Sn(e,this,t)}const or=_i.prototype;or.append=function(t,i){this._pairs.push([t,i])};or.toString=function(t){const i=t?function(s){return t.call(this,s,Wi)}:Wi;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function Nl(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ar(e,t,i){if(!t)return e;const s=i&&i.encode||Nl;P.isFunction(i)&&(i={serialize:i});const r=i&&i.serialize;let o;if(r?o=r(t,i):o=P.isURLSearchParams(t)?t.toString():new _i(t,i).toString(s),o){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}class Vi{constructor(){this.handlers=[]}use(t,i,s){return this.handlers.push({fulfilled:t,rejected:i,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){P.forEach(this.handlers,function(s){s!==null&&t(s)})}}const lr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Sl=typeof URLSearchParams<"u"?URLSearchParams:_i,Tl=typeof FormData<"u"?FormData:null,Pl=typeof Blob<"u"?Blob:null,kl={isBrowser:!0,classes:{URLSearchParams:Sl,FormData:Tl,Blob:Pl},protocols:["http","https","file","blob","url","data"]},vi=typeof window<"u"&&typeof document<"u",ei=typeof navigator=="object"&&navigator||void 0,Ol=vi&&(!ei||["ReactNative","NativeScript","NS"].indexOf(ei.product)<0),Dl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Il=vi&&window.location.href||"http://localhost",Ll=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:vi,hasStandardBrowserEnv:Ol,hasStandardBrowserWebWorkerEnv:Dl,navigator:ei,origin:Il},Symbol.toStringTag,{value:"Module"})),be={...Ll,...kl};function El(e,t){return Sn(e,new be.classes.URLSearchParams,Object.assign({visitor:function(i,s,r,o){return be.isNode&&P.isBuffer(i)?(this.append(s,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function Al(e){return P.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ql(e){const t={},i=Object.keys(e);let s;const r=i.length;let o;for(s=0;s<r;s++)o=i[s],t[o]=e[o];return t}function ur(e){function t(i,s,r,o){let a=i[o++];if(a==="__proto__")return!0;const l=Number.isFinite(+a),u=o>=i.length;return a=!a&&P.isArray(r)?r.length:a,u?(P.hasOwnProp(r,a)?r[a]=[r[a],s]:r[a]=s,!l):((!r[a]||!P.isObject(r[a]))&&(r[a]=[]),t(i,s,r[a],o)&&P.isArray(r[a])&&(r[a]=ql(r[a])),!l)}if(P.isFormData(e)&&P.isFunction(e.entries)){const i={};return P.forEachEntry(e,(s,r)=>{t(Al(s),r,i,0)}),i}return null}function Rl(e,t,i){if(P.isString(e))try{return(t||JSON.parse)(e),P.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(i||JSON.stringify)(e)}const Xt={transitional:lr,adapter:["xhr","http","fetch"],transformRequest:[function(t,i){const s=i.getContentType()||"",r=s.indexOf("application/json")>-1,o=P.isObject(t);if(o&&P.isHTMLForm(t)&&(t=new FormData(t)),P.isFormData(t))return r?JSON.stringify(ur(t)):t;if(P.isArrayBuffer(t)||P.isBuffer(t)||P.isStream(t)||P.isFile(t)||P.isBlob(t)||P.isReadableStream(t))return t;if(P.isArrayBufferView(t))return t.buffer;if(P.isURLSearchParams(t))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let l;if(o){if(s.indexOf("application/x-www-form-urlencoded")>-1)return El(t,this.formSerializer).toString();if((l=P.isFileList(t))||s.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Sn(l?{"files[]":t}:t,u&&new u,this.formSerializer)}}return o||r?(i.setContentType("application/json",!1),Rl(t)):t}],transformResponse:[function(t){const i=this.transitional||Xt.transitional,s=i&&i.forcedJSONParsing,r=this.responseType==="json";if(P.isResponse(t)||P.isReadableStream(t))return t;if(t&&P.isString(t)&&(s&&!this.responseType||r)){const a=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(l){if(a)throw l.name==="SyntaxError"?G.from(l,G.ERR_BAD_RESPONSE,this,null,this.response):l}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:be.classes.FormData,Blob:be.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};P.forEach(["delete","get","head","post","put","patch"],e=>{Xt.headers[e]={}});const Ml=P.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Fl=e=>{const t={};let i,s,r;return e&&e.split(`
`).forEach(function(a){r=a.indexOf(":"),i=a.substring(0,r).trim().toLowerCase(),s=a.substring(r+1).trim(),!(!i||t[i]&&Ml[i])&&(i==="set-cookie"?t[i]?t[i].push(s):t[i]=[s]:t[i]=t[i]?t[i]+", "+s:s)}),t},Hi=Symbol("internals");function Et(e){return e&&String(e).trim().toLowerCase()}function sn(e){return e===!1||e==null?e:P.isArray(e)?e.map(sn):String(e)}function $l(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=i.exec(e);)t[s[1]]=s[2];return t}const zl=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Mn(e,t,i,s,r){if(P.isFunction(s))return s.call(this,t,i);if(r&&(t=i),!!P.isString(t)){if(P.isString(s))return t.indexOf(s)!==-1;if(P.isRegExp(s))return s.test(t)}}function Ul(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,i,s)=>i.toUpperCase()+s)}function Bl(e,t){const i=P.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+i,{value:function(r,o,a){return this[s].call(this,t,r,o,a)},configurable:!0})})}let Ce=class{constructor(t){t&&this.set(t)}set(t,i,s){const r=this;function o(l,u,d){const c=Et(u);if(!c)throw new Error("header name must be a non-empty string");const m=P.findKey(r,c);(!m||r[m]===void 0||d===!0||d===void 0&&r[m]!==!1)&&(r[m||u]=sn(l))}const a=(l,u)=>P.forEach(l,(d,c)=>o(d,c,u));if(P.isPlainObject(t)||t instanceof this.constructor)a(t,i);else if(P.isString(t)&&(t=t.trim())&&!zl(t))a(Fl(t),i);else if(P.isObject(t)&&P.isIterable(t)){let l={},u,d;for(const c of t){if(!P.isArray(c))throw TypeError("Object iterator must return a key-value pair");l[d=c[0]]=(u=l[d])?P.isArray(u)?[...u,c[1]]:[u,c[1]]:c[1]}a(l,i)}else t!=null&&o(i,t,s);return this}get(t,i){if(t=Et(t),t){const s=P.findKey(this,t);if(s){const r=this[s];if(!i)return r;if(i===!0)return $l(r);if(P.isFunction(i))return i.call(this,r,s);if(P.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=Et(t),t){const s=P.findKey(this,t);return!!(s&&this[s]!==void 0&&(!i||Mn(this,this[s],s,i)))}return!1}delete(t,i){const s=this;let r=!1;function o(a){if(a=Et(a),a){const l=P.findKey(s,a);l&&(!i||Mn(s,s[l],l,i))&&(delete s[l],r=!0)}}return P.isArray(t)?t.forEach(o):o(t),r}clear(t){const i=Object.keys(this);let s=i.length,r=!1;for(;s--;){const o=i[s];(!t||Mn(this,this[o],o,t,!0))&&(delete this[o],r=!0)}return r}normalize(t){const i=this,s={};return P.forEach(this,(r,o)=>{const a=P.findKey(s,o);if(a){i[a]=sn(r),delete i[o];return}const l=t?Ul(o):String(o).trim();l!==o&&delete i[o],i[l]=sn(r),s[l]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const i=Object.create(null);return P.forEach(this,(s,r)=>{s!=null&&s!==!1&&(i[r]=t&&P.isArray(s)?s.join(", "):s)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,i])=>t+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...i){const s=new this(t);return i.forEach(r=>s.set(r)),s}static accessor(t){const s=(this[Hi]=this[Hi]={accessors:{}}).accessors,r=this.prototype;function o(a){const l=Et(a);s[l]||(Bl(r,a),s[l]=!0)}return P.isArray(t)?t.forEach(o):o(t),this}};Ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);P.reduceDescriptors(Ce.prototype,({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(s){this[i]=s}}});P.freezeMethods(Ce);function Fn(e,t){const i=this||Xt,s=t||i,r=Ce.from(s.headers);let o=s.data;return P.forEach(e,function(l){o=l.call(i,o,r.normalize(),t?t.status:void 0)}),r.normalize(),o}function dr(e){return!!(e&&e.__CANCEL__)}function Tt(e,t,i){G.call(this,e??"canceled",G.ERR_CANCELED,t,i),this.name="CanceledError"}P.inherits(Tt,G,{__CANCEL__:!0});function cr(e,t,i){const s=i.config.validateStatus;!i.status||!s||s(i.status)?e(i):t(new G("Request failed with status code "+i.status,[G.ERR_BAD_REQUEST,G.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function Wl(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Vl(e,t){e=e||10;const i=new Array(e),s=new Array(e);let r=0,o=0,a;return t=t!==void 0?t:1e3,function(u){const d=Date.now(),c=s[o];a||(a=d),i[r]=u,s[r]=d;let m=o,y=0;for(;m!==r;)y+=i[m++],m=m%e;if(r=(r+1)%e,r===o&&(o=(o+1)%e),d-a<t)return;const j=c&&d-c;return j?Math.round(y*1e3/j):void 0}}function Hl(e,t){let i=0,s=1e3/t,r,o;const a=(d,c=Date.now())=>{i=c,r=null,o&&(clearTimeout(o),o=null),e.apply(null,d)};return[(...d)=>{const c=Date.now(),m=c-i;m>=s?a(d,c):(r=d,o||(o=setTimeout(()=>{o=null,a(r)},s-m)))},()=>r&&a(r)]}const an=(e,t,i=3)=>{let s=0;const r=Vl(50,250);return Hl(o=>{const a=o.loaded,l=o.lengthComputable?o.total:void 0,u=a-s,d=r(u),c=a<=l;s=a;const m={loaded:a,total:l,progress:l?a/l:void 0,bytes:u,rate:d||void 0,estimated:d&&l&&c?(l-a)/d:void 0,event:o,lengthComputable:l!=null,[t?"download":"upload"]:!0};e(m)},i)},Qi=(e,t)=>{const i=e!=null;return[s=>t[0]({lengthComputable:i,total:e,loaded:s}),t[1]]},Ki=e=>(...t)=>P.asap(()=>e(...t)),Ql=be.hasStandardBrowserEnv?((e,t)=>i=>(i=new URL(i,be.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new URL(be.origin),be.navigator&&/(msie|trident)/i.test(be.navigator.userAgent)):()=>!0,Kl=be.hasStandardBrowserEnv?{write(e,t,i,s,r,o){const a=[e+"="+encodeURIComponent(t)];P.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),P.isString(s)&&a.push("path="+s),P.isString(r)&&a.push("domain="+r),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Gl(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Xl(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function pr(e,t,i){let s=!Gl(t);return e&&(s||i==!1)?Xl(e,t):t}const Gi=e=>e instanceof Ce?{...e}:e;function st(e,t){t=t||{};const i={};function s(d,c,m,y){return P.isPlainObject(d)&&P.isPlainObject(c)?P.merge.call({caseless:y},d,c):P.isPlainObject(c)?P.merge({},c):P.isArray(c)?c.slice():c}function r(d,c,m,y){if(P.isUndefined(c)){if(!P.isUndefined(d))return s(void 0,d,m,y)}else return s(d,c,m,y)}function o(d,c){if(!P.isUndefined(c))return s(void 0,c)}function a(d,c){if(P.isUndefined(c)){if(!P.isUndefined(d))return s(void 0,d)}else return s(void 0,c)}function l(d,c,m){if(m in t)return s(d,c);if(m in e)return s(void 0,d)}const u={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l,headers:(d,c,m)=>r(Gi(d),Gi(c),m,!0)};return P.forEach(Object.keys(Object.assign({},e,t)),function(c){const m=u[c]||r,y=m(e[c],t[c],c);P.isUndefined(y)&&m!==l||(i[c]=y)}),i}const mr=e=>{const t=st({},e);let{data:i,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:o,headers:a,auth:l}=t;t.headers=a=Ce.from(a),t.url=ar(pr(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let u;if(P.isFormData(i)){if(be.hasStandardBrowserEnv||be.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((u=a.getContentType())!==!1){const[d,...c]=u?u.split(";").map(m=>m.trim()).filter(Boolean):[];a.setContentType([d||"multipart/form-data",...c].join("; "))}}if(be.hasStandardBrowserEnv&&(s&&P.isFunction(s)&&(s=s(t)),s||s!==!1&&Ql(t.url))){const d=r&&o&&Kl.read(o);d&&a.set(r,d)}return t},Jl=typeof XMLHttpRequest<"u",Yl=Jl&&function(e){return new Promise(function(i,s){const r=mr(e);let o=r.data;const a=Ce.from(r.headers).normalize();let{responseType:l,onUploadProgress:u,onDownloadProgress:d}=r,c,m,y,j,f;function b(){j&&j(),f&&f(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let x=new XMLHttpRequest;x.open(r.method.toUpperCase(),r.url,!0),x.timeout=r.timeout;function C(){if(!x)return;const v=Ce.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),I={data:!l||l==="text"||l==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:v,config:e,request:x};cr(function(A){i(A),b()},function(A){s(A),b()},I),x=null}"onloadend"in x?x.onloadend=C:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(C)},x.onabort=function(){x&&(s(new G("Request aborted",G.ECONNABORTED,e,x)),x=null)},x.onerror=function(){s(new G("Network Error",G.ERR_NETWORK,e,x)),x=null},x.ontimeout=function(){let N=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const I=r.transitional||lr;r.timeoutErrorMessage&&(N=r.timeoutErrorMessage),s(new G(N,I.clarifyTimeoutError?G.ETIMEDOUT:G.ECONNABORTED,e,x)),x=null},o===void 0&&a.setContentType(null),"setRequestHeader"in x&&P.forEach(a.toJSON(),function(N,I){x.setRequestHeader(I,N)}),P.isUndefined(r.withCredentials)||(x.withCredentials=!!r.withCredentials),l&&l!=="json"&&(x.responseType=r.responseType),d&&([y,f]=an(d,!0),x.addEventListener("progress",y)),u&&x.upload&&([m,j]=an(u),x.upload.addEventListener("progress",m),x.upload.addEventListener("loadend",j)),(r.cancelToken||r.signal)&&(c=v=>{x&&(s(!v||v.type?new Tt(null,e,x):v),x.abort(),x=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));const w=Wl(r.url);if(w&&be.protocols.indexOf(w)===-1){s(new G("Unsupported protocol "+w+":",G.ERR_BAD_REQUEST,e));return}x.send(o||null)})},Zl=(e,t)=>{const{length:i}=e=e?e.filter(Boolean):[];if(t||i){let s=new AbortController,r;const o=function(d){if(!r){r=!0,l();const c=d instanceof Error?d:this.reason;s.abort(c instanceof G?c:new Tt(c instanceof Error?c.message:c))}};let a=t&&setTimeout(()=>{a=null,o(new G(`timeout ${t} of ms exceeded`,G.ETIMEDOUT))},t);const l=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(o):d.removeEventListener("abort",o)}),e=null)};e.forEach(d=>d.addEventListener("abort",o));const{signal:u}=s;return u.unsubscribe=()=>P.asap(l),u}},eu=function*(e,t){let i=e.byteLength;if(i<t){yield e;return}let s=0,r;for(;s<i;)r=s+t,yield e.slice(s,r),s=r},tu=async function*(e,t){for await(const i of nu(e))yield*eu(i,t)},nu=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:i,value:s}=await t.read();if(i)break;yield s}}finally{await t.cancel()}},Xi=(e,t,i,s)=>{const r=tu(e,t);let o=0,a,l=u=>{a||(a=!0,s&&s(u))};return new ReadableStream({async pull(u){try{const{done:d,value:c}=await r.next();if(d){l(),u.close();return}let m=c.byteLength;if(i){let y=o+=m;i(y)}u.enqueue(new Uint8Array(c))}catch(d){throw l(d),d}},cancel(u){return l(u),r.return()}},{highWaterMark:2})},Tn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",hr=Tn&&typeof ReadableStream=="function",iu=Tn&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),fr=(e,...t)=>{try{return!!e(...t)}catch{return!1}},su=hr&&fr(()=>{let e=!1;const t=new Request(be.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Ji=64*1024,ti=hr&&fr(()=>P.isReadableStream(new Response("").body)),ln={stream:ti&&(e=>e.body)};Tn&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!ln[t]&&(ln[t]=P.isFunction(e[t])?i=>i[t]():(i,s)=>{throw new G(`Response type '${t}' is not supported`,G.ERR_NOT_SUPPORT,s)})})})(new Response);const ru=async e=>{if(e==null)return 0;if(P.isBlob(e))return e.size;if(P.isSpecCompliantForm(e))return(await new Request(be.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(P.isArrayBufferView(e)||P.isArrayBuffer(e))return e.byteLength;if(P.isURLSearchParams(e)&&(e=e+""),P.isString(e))return(await iu(e)).byteLength},ou=async(e,t)=>{const i=P.toFiniteNumber(e.getContentLength());return i??ru(t)},au=Tn&&(async e=>{let{url:t,method:i,data:s,signal:r,cancelToken:o,timeout:a,onDownloadProgress:l,onUploadProgress:u,responseType:d,headers:c,withCredentials:m="same-origin",fetchOptions:y}=mr(e);d=d?(d+"").toLowerCase():"text";let j=Zl([r,o&&o.toAbortSignal()],a),f;const b=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let x;try{if(u&&su&&i!=="get"&&i!=="head"&&(x=await ou(c,s))!==0){let I=new Request(t,{method:"POST",body:s,duplex:"half"}),O;if(P.isFormData(s)&&(O=I.headers.get("content-type"))&&c.setContentType(O),I.body){const[A,k]=Qi(x,an(Ki(u)));s=Xi(I.body,Ji,A,k)}}P.isString(m)||(m=m?"include":"omit");const C="credentials"in Request.prototype;f=new Request(t,{...y,signal:j,method:i.toUpperCase(),headers:c.normalize().toJSON(),body:s,duplex:"half",credentials:C?m:void 0});let w=await fetch(f,y);const v=ti&&(d==="stream"||d==="response");if(ti&&(l||v&&b)){const I={};["status","statusText","headers"].forEach(_=>{I[_]=w[_]});const O=P.toFiniteNumber(w.headers.get("content-length")),[A,k]=l&&Qi(O,an(Ki(l),!0))||[];w=new Response(Xi(w.body,Ji,A,()=>{k&&k(),b&&b()}),I)}d=d||"text";let N=await ln[P.findKey(ln,d)||"text"](w,e);return!v&&b&&b(),await new Promise((I,O)=>{cr(I,O,{data:N,headers:Ce.from(w.headers),status:w.status,statusText:w.statusText,config:e,request:f})})}catch(C){throw b&&b(),C&&C.name==="TypeError"&&/Load failed|fetch/i.test(C.message)?Object.assign(new G("Network Error",G.ERR_NETWORK,e,f),{cause:C.cause||C}):G.from(C,C&&C.code,e,f)}}),ni={http:_l,xhr:Yl,fetch:au};P.forEach(ni,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Yi=e=>`- ${e}`,lu=e=>P.isFunction(e)||e===null||e===!1,xr={getAdapter:e=>{e=P.isArray(e)?e:[e];const{length:t}=e;let i,s;const r={};for(let o=0;o<t;o++){i=e[o];let a;if(s=i,!lu(i)&&(s=ni[(a=String(i)).toLowerCase()],s===void 0))throw new G(`Unknown adapter '${a}'`);if(s)break;r[a||"#"+o]=s}if(!s){const o=Object.entries(r).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=t?o.length>1?`since :
`+o.map(Yi).join(`
`):" "+Yi(o[0]):"as no adapter specified";throw new G("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:ni};function $n(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Tt(null,e)}function Zi(e){return $n(e),e.headers=Ce.from(e.headers),e.data=Fn.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),xr.getAdapter(e.adapter||Xt.adapter)(e).then(function(s){return $n(e),s.data=Fn.call(e,e.transformResponse,s),s.headers=Ce.from(s.headers),s},function(s){return dr(s)||($n(e),s&&s.response&&(s.response.data=Fn.call(e,e.transformResponse,s.response),s.response.headers=Ce.from(s.response.headers))),Promise.reject(s)})}const gr="1.10.0",Pn={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Pn[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const es={};Pn.transitional=function(t,i,s){function r(o,a){return"[Axios v"+gr+"] Transitional option '"+o+"'"+a+(s?". "+s:"")}return(o,a,l)=>{if(t===!1)throw new G(r(a," has been removed"+(i?" in "+i:"")),G.ERR_DEPRECATED);return i&&!es[a]&&(es[a]=!0,console.warn(r(a," has been deprecated since v"+i+" and will be removed in the near future"))),t?t(o,a,l):!0}};Pn.spelling=function(t){return(i,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function uu(e,t,i){if(typeof e!="object")throw new G("options must be an object",G.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let r=s.length;for(;r-- >0;){const o=s[r],a=t[o];if(a){const l=e[o],u=l===void 0||a(l,o,e);if(u!==!0)throw new G("option "+o+" must be "+u,G.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new G("Unknown option "+o,G.ERR_BAD_OPTION)}}const rn={assertOptions:uu,validators:Pn},ze=rn.validators;let it=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Vi,response:new Vi}}async request(t,i){try{return await this._request(t,i)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?o&&!String(s.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+o):s.stack=o}catch{}}throw s}}_request(t,i){typeof t=="string"?(i=i||{},i.url=t):i=t||{},i=st(this.defaults,i);const{transitional:s,paramsSerializer:r,headers:o}=i;s!==void 0&&rn.assertOptions(s,{silentJSONParsing:ze.transitional(ze.boolean),forcedJSONParsing:ze.transitional(ze.boolean),clarifyTimeoutError:ze.transitional(ze.boolean)},!1),r!=null&&(P.isFunction(r)?i.paramsSerializer={serialize:r}:rn.assertOptions(r,{encode:ze.function,serialize:ze.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),rn.assertOptions(i,{baseUrl:ze.spelling("baseURL"),withXsrfToken:ze.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let a=o&&P.merge(o.common,o[i.method]);o&&P.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),i.headers=Ce.concat(a,o);const l=[];let u=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(i)===!1||(u=u&&b.synchronous,l.unshift(b.fulfilled,b.rejected))});const d=[];this.interceptors.response.forEach(function(b){d.push(b.fulfilled,b.rejected)});let c,m=0,y;if(!u){const f=[Zi.bind(this),void 0];for(f.unshift.apply(f,l),f.push.apply(f,d),y=f.length,c=Promise.resolve(i);m<y;)c=c.then(f[m++],f[m++]);return c}y=l.length;let j=i;for(m=0;m<y;){const f=l[m++],b=l[m++];try{j=f(j)}catch(x){b.call(this,x);break}}try{c=Zi.call(this,j)}catch(f){return Promise.reject(f)}for(m=0,y=d.length;m<y;)c=c.then(d[m++],d[m++]);return c}getUri(t){t=st(this.defaults,t);const i=pr(t.baseURL,t.url,t.allowAbsoluteUrls);return ar(i,t.params,t.paramsSerializer)}};P.forEach(["delete","get","head","options"],function(t){it.prototype[t]=function(i,s){return this.request(st(s||{},{method:t,url:i,data:(s||{}).data}))}});P.forEach(["post","put","patch"],function(t){function i(s){return function(o,a,l){return this.request(st(l||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}it.prototype[t]=i(),it.prototype[t+"Form"]=i(!0)});let du=class yr{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});const s=this;this.promise.then(r=>{if(!s._listeners)return;let o=s._listeners.length;for(;o-- >0;)s._listeners[o](r);s._listeners=null}),this.promise.then=r=>{let o;const a=new Promise(l=>{s.subscribe(l),o=l}).then(r);return a.cancel=function(){s.unsubscribe(o)},a},t(function(o,a,l){s.reason||(s.reason=new Tt(o,a,l),i(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const t=new AbortController,i=s=>{t.abort(s)};return this.subscribe(i),t.signal.unsubscribe=()=>this.unsubscribe(i),t.signal}static source(){let t;return{token:new yr(function(r){t=r}),cancel:t}}};function cu(e){return function(i){return e.apply(null,i)}}function pu(e){return P.isObject(e)&&e.isAxiosError===!0}const ii={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ii).forEach(([e,t])=>{ii[t]=e});function br(e){const t=new it(e),i=Gs(it.prototype.request,t);return P.extend(i,it.prototype,t,{allOwnKeys:!0}),P.extend(i,t,null,{allOwnKeys:!0}),i.create=function(r){return br(st(e,r))},i}const pe=br(Xt);pe.Axios=it;pe.CanceledError=Tt;pe.CancelToken=du;pe.isCancel=dr;pe.VERSION=gr;pe.toFormData=Sn;pe.AxiosError=G;pe.Cancel=pe.CanceledError;pe.all=function(t){return Promise.all(t)};pe.spread=cu;pe.isAxiosError=pu;pe.mergeConfig=st;pe.AxiosHeaders=Ce;pe.formToJSON=e=>ur(P.isHTMLForm(e)?new FormData(e):e);pe.getAdapter=xr.getAdapter;pe.HttpStatusCode=ii;pe.default=pe;const{Axios:$h,AxiosError:zh,CanceledError:Uh,isCancel:Bh,CancelToken:Wh,VERSION:Vh,all:Hh,Cancel:Qh,isAxiosError:Kh,spread:Gh,toFormData:Xh,AxiosHeaders:Jh,HttpStatusCode:Yh,formToJSON:Zh,getAdapter:ef,mergeConfig:tf}=pe;var mu={testnet:"https://api-testnet.layerzero-scan.com",mainnet:"https://api-mainnet.layerzero-scan.com",sandbox:"https://api-sandbox.layerzero-scan.com"},hu=(e,t)=>{const i=mu[e];if(!i)throw new Error(`No endpoint for env ${e}`);const s=pe.create({baseURL:i});return{async getMessagesBySrcTxHash(r){if(!r)throw new Error("srcTxHash must be provided");const{data:o}=await s.get(`/tx/${r}`);return o}}},fu=()=>{let{data:e,error:t,isLoading:i}=di("/v1/public/auto_convert_threshold",{errorRetryCount:3});return{ltv_threshold:p.useMemo(()=>!e||i?"-":`${new T(e.ltv_threshold).mul(100).toNumber()}%`,[]),negative_usdc_threshold:e==null?void 0:e.negative_usdc_threshold,isLoading:i,error:t}},xu=ce.forwardRef((e,t)=>n.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",focusable:!1,ref:t,...e,children:n.jsx("path",{d:"M5.999 1.007a5 5 0 1 0 0 10 5 5 0 0 0 0-10m0 2.5a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1m0 1.5a.5.5 0 0 1 .5.5v2.5a.5.5 0 0 1-1 0v-2.5a.5.5 0 0 1 .5-.5"})})),zn=e=>e>=0&&e<50?"oui-text-success":e>=50&&e<80?"oui-text-warning":e>=80?"oui-text-danger":"",gu=e=>{let{isLoading:t,ltv_threshold:i}=e,{t:s}=S();return n.jsxs(W,{className:"oui-w-72 oui-max-w-72",children:[n.jsx(h,{size:"2xs",intensity:80,children:s("transfer.LTV.description",{threshold:t?"-":i})})," ",n.jsx("a",{href:"https://orderly.network/docs/introduction/trade-on-orderly/multi-collateral",target:"_blank",rel:"noreferrer",className:"oui-border-b oui-border-dashed oui-border-line-12 oui-text-2xs oui-text-primary",children:s("tradingLeaderboard.learnMore")})]})},yu=e=>{let{t}=S(),{currentLtv:i,nextLTV:s,showDiff:r,ltv_threshold:o,isLoading:a}=e;return n.jsxs(g,{width:"100%",itemAlign:"center",justify:"between",children:[n.jsxs(g,{justify:"start",itemAlign:"center",children:[n.jsx(h,{size:"2xs",intensity:36,children:t("transfer.LTV")}),n.jsx(Le,{className:"oui-p-2",content:n.jsx(gu,{isLoading:a,ltv_threshold:o}),children:n.jsx(xu,{className:"oui-ml-[2px] oui-cursor-pointer oui-text-base-contrast-36"})})]}),r?n.jsxs(g,{itemAlign:"center",justify:"between",gap:1,children:[n.jsxs(h,{size:"2xs",className:E("oui-font-semibold",zn(i)),children:[i,"%"]}),"→",n.jsxs(h,{size:"2xs",className:E("oui-font-semibold",zn(s)),children:[s,"%"]})]}):n.jsxs(h,{size:"2xs",className:E("oui-font-semibold",zn(i)),children:[i,"%"]})]})},jr=e=>{let t=fu();return n.jsx(yu,{...e,...t})},bu=(e=>(e[e.Deposit=0]="Deposit",e[e.Approve=1]="Approve",e[e.Increase=2]="Increase",e))(bu||{}),ju=(e=>(e.Wallet="wallet",e.Account="accountId",e))(ju||{}),wu=e=>{let{disabled:t,loading:i,actionType:s,symbol:r="USDC",onDeposit:o,onApprove:a,networkId:l}=e,{t:u}=S(),d=p.useMemo(()=>({1:{children:u("transfer.deposit.approve.symbol",{symbol:r}),onClick:a,disabled:!1,"data-testid":"oui-testid-deposit-dialog-approve-btn"},2:{children:u("transfer.deposit.increase.symbol",{symbol:r}),onClick:a,"data-testid":"oui-testid-deposit-dialog-increase-btn"},0:{children:u("common.deposit"),onClick:o,"data-testid":"oui-testid-deposit-dialog-deposit-btn"}})[s],[a,o,s,r,u]),c={initial:"md",lg:"lg"};return n.jsx(W,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:n.jsx(bn,{status:Me.EnableTrading,networkId:l,buttonProps:{fullWidth:!0,size:c},children:n.jsx(te,{fullWidth:!0,disabled:t,loading:i,size:c,...d})})})},kn=e=>{let{amount:t,maxQuantity:i,token:s,loading:r}=e,{t:o}=S(),a=(s==null?void 0:s.display_name)||(s==null?void 0:s.symbol)||"",l=(s==null?void 0:s.precision)??(s==null?void 0:s.decimals)??2;return n.jsxs(g,{justify:"between",px:2,children:[n.jsxs(h,{size:"2xs",intensity:36,children:["$",n.jsx(h.numeral,{dp:2,padding:!1,rm:T.ROUND_DOWN,children:t})]}),n.jsxs(g,{gapX:2,itemAlign:"center",children:[n.jsxs(g,{gapX:1,itemAlign:"center",children:[n.jsx(h,{size:"2xs",intensity:36,children:`${o("common.available")}: `}),r?n.jsx(Bt,{size:"sm"}):n.jsx(h.numeral,{size:"2xs",intensity:36,rm:T.ROUND_DOWN,dp:l,padding:!1,"data-testid":"oui-testid-withdraw_deposit-dialog-available-value",children:i}),n.jsx(h,{size:"2xs",intensity:36,children:` ${a}`})]}),n.jsx(h,{size:"2xs",color:"primary",className:"oui-cursor-pointer oui-select-none",onClick:e.onClick,children:o("common.max")})]})]})},wr=()=>{let{t:e}=S(),{appIcons:t}=Pa(),i=Ne("brokerName"),s=p.useMemo(()=>{let{secondary:r}=t||{};if(!(r!=null&&r.img)&&(r!=null&&r.component))return null;if(r!=null&&r.img)return n.jsx("img",{src:r==null?void 0:r.img,className:"oui-w-5 oui-h-5"});if(r!=null&&r.component)return n.jsx(n.Fragment,{children:r.component})},[t]);return n.jsxs(g,{justify:"between",children:[n.jsx(h,{size:"sm",intensity:98,children:e("transfer.brokerAccount",{brokerName:i})}),s]})},_r=e=>n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{d:"M10.997 8.004a.5.5 0 0 0-.14-.36l-1.86-1.843-.703.703.984 1h-7.28a.5.5 0 0 0 0 1h7.28l-.984 1 .703.703 1.86-1.844a.5.5 0 0 0 .14-.36m-.5-4a.5.5 0 0 0-.5-.5H2.716l.984-1-.703-.703-1.859 1.843a.515.515 0 0 0 0 .719l1.86 1.844.702-.703-.984-1h7.281a.5.5 0 0 0 .5-.5"})}),_u=e=>n.jsx("svg",{width:"20",height:"21",viewBox:"0 0 20 21",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{d:"M9.994 5.51a.83.83 0 0 0-.832.833v6.295l-2.498-2.471-1.17 1.17 3.902 3.929a.84.84 0 0 0 .599.244.84.84 0 0 0 .597-.244l3.903-3.928-1.171-1.171-2.498 2.471V6.343a.83.83 0 0 0-.832-.833"})}),vu=e=>n.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{d:"M6.00342 1.49561C4.97642 1.49561 3.99542 1.84011 3.20642 2.46461C2.98992 2.63561 2.95692 2.9511 3.12842 3.1676C3.29992 3.3841 3.61492 3.4171 3.83142 3.2456C4.44492 2.7601 5.20392 2.4956 6.00342 2.4956C7.93642 2.4956 9.50342 4.0626 9.50342 5.9956H8.50342L10.0034 7.9956L11.5034 5.9956H10.5034C10.5034 3.5101 8.48892 1.49561 6.00342 1.49561ZM2.00342 3.9956L0.503418 5.9956H1.50342C1.50342 8.4811 3.51792 10.4956 6.00342 10.4956C7.03092 10.4956 8.01142 10.1516 8.80042 9.52659C9.01692 9.35559 9.04992 9.0401 8.87842 8.8236C8.70692 8.6071 8.39191 8.5741 8.17542 8.7456C7.56142 9.2316 6.80342 9.4956 6.00342 9.4956C4.07042 9.4956 2.50342 7.9286 2.50342 5.9956H3.50342L2.00342 3.9956Z"})}),Cu=e=>n.jsx("svg",{width:"20",height:"21",viewBox:"0 0 20 21",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{d:"M12.385 4.565a.6.6 0 0 0-.427.167L9.764 6.944l.837.837 1.19-1.17v8.66a.595.595 0 0 0 1.19 0v-8.66l1.189 1.17.836-.837-2.193-2.212a.6.6 0 0 0-.428-.167m-4.758.595a.595.595 0 0 0-.595.595v8.661l-1.19-1.17-.836.836L7.2 16.294a.61.61 0 0 0 .855 0l2.194-2.212-.837-.836-1.19 1.17V5.755a.595.595 0 0 0-.594-.595"})}),vr=e=>{var f,b;let{chains:t,value:i,wrongNetwork:s,loading:r}=e,[o,a]=p.useState(!1),{t:l}=S(),u=s||(t==null?void 0:t.length)>1,d=s?n.jsx(g,{width:18,height:18,intensity:100,r:"full",justify:"center",itemAlign:"center",children:n.jsx(h,{size:"2xs",intensity:80,children:"U"})}):n.jsx(Xn,{className:"oui-size-[18px]",chainId:i==null?void 0:i.id}),c=s?"Unknown":(b=(f=i==null?void 0:i.info)==null?void 0:f.network_infos)==null?void 0:b.name,m=()=>{if(r)return n.jsx(Bt,{size:"sm"});if(u)return n.jsx(_r,{className:"oui-text-base-contrast-54"})},y=n.jsxs(g,{intensity:500,className:E("oui-rounded-t-xl oui-rounded-b-sm oui-border oui-border-line",u?"oui-cursor-pointer":"oui-cursor-auto"),height:54,px:3,justify:"between",itemAlign:"center",children:[n.jsxs("div",{children:[n.jsx(g,{children:n.jsx(h,{size:"2xs",intensity:54,children:l("transfer.network")})}),n.jsxs(g,{gapX:1,children:[d,n.jsx(h,{size:"sm",intensity:80,children:c})]})]}),m()]}),j=t.map((x,C)=>{let w=x.chain_id===(i==null?void 0:i.id);return n.jsxs(g,{px:2,r:"base",justify:"between",className:E("oui-deposit-network-select-item","hover:oui-bg-base-5 oui-h-[30px] oui-cursor-pointer",w&&"oui-bg-base-5",C!==0&&"oui-mt-[2px]"),onClick:async()=>{a(!1),await e.onValueChange(x)},children:[n.jsxs(g,{gapX:1,itemAlign:"center",children:[n.jsx(Xn,{className:"oui-size-[18px]",chainId:x.chain_id}),n.jsx(h,{size:"2xs",intensity:54,children:x.name})]}),w&&n.jsx(W,{width:4,height:4,r:"full",className:"oui-deposit-network-select-active-dot oui-bg-[linear-gradient(270deg,#59B0FE_0%,#26FEFE_100%)]"})]},x.chain_id)});return n.jsxs(pi,{open:u?o:!1,onOpenChange:a,children:[n.jsx(mi,{asChild:!0,children:y}),n.jsx(Es,{children:n.jsx(hi,{onCloseAutoFocus:x=>x.preventDefault(),align:"start",sideOffset:2,className:E("oui-deposit-token-select-dropdown-menu-content","oui-bg-base-8 oui-p-1","oui-w-[var(--radix-dropdown-menu-trigger-width)]","oui-rounded-md oui-select-none"),children:n.jsx(fi,{children:n.jsx("div",{className:"oui-max-h-[254px]",children:j})})})})]})},Nu=e=>{let{t}=S(),{value:i,precision:s}=e;return n.jsxs(g,{width:"100%",itemAlign:"center",justify:"between",children:[n.jsx(g,{itemAlign:"center",justify:"start",children:n.jsx(h,{size:"2xs",intensity:36,children:t("transfer.deposit.collateralContribution")})}),n.jsxs(g,{itemAlign:"center",justify:"end",gap:1,children:[n.jsx(h.numeral,{dp:s,size:"2xs",rm:T.ROUND_DOWN,className:E("oui-font-semibold"),padding:!1,children:i}),n.jsx(h,{size:"2xs",intensity:36,className:"oui-select-none",children:"USDC"})]})]})},Su=ce.forwardRef((e,t)=>n.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",focusable:!1,ref:t,...e,children:n.jsx("path",{d:"M5.999 1.007a5 5 0 1 0 0 10 5 5 0 0 0 0-10m0 2.5a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1m0 1.5a.5.5 0 0 1 .5.5v2.5a.5.5 0 0 1-1 0v-2.5a.5.5 0 0 1 .5-.5"})})),Tu=()=>{let{t:e}=S();return n.jsxs(W,{className:"oui-w-72 oui-max-w-72",children:[n.jsx(h,{size:"2xs",intensity:80,children:e("portfolio.overview.column.collateralRatio.explain")})," ",n.jsx("a",{href:"https://orderly.network/docs/introduction/trade-on-orderly/multi-collateral",target:"_blank",rel:"noreferrer",className:"oui-border-b oui-border-dashed oui-border-line-12 oui-text-2xs oui-text-primary",children:e("tradingLeaderboard.learnMore")})]})},Pu=e=>{let{t}=S(),{value:i}=e;return n.jsxs(g,{width:"100%",itemAlign:"center",justify:"between",children:[n.jsxs(g,{justify:"start",itemAlign:"center",children:[n.jsx(h,{size:"2xs",intensity:36,children:t("portfolio.overview.column.collateralRatio")}),n.jsx(Le,{className:"oui-p-2",content:n.jsx(Tu,{}),children:n.jsx(Su,{className:"oui-ml-[2px] oui-cursor-pointer oui-text-base-contrast-36"})})]}),n.jsx(h.numeral,{dp:2,rm:T.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",rule:"percentages",children:i})]})},ku=e=>n.jsx(Pu,{...e}),On=({icon:e})=>n.jsxs(g,{height:40,gapX:3,children:[n.jsx(g,{height:1,className:"oui-flex-1 oui-bg-base-contrast-12"}),e||n.jsx(_u,{className:"oui-text-primary-light"}),n.jsx(g,{height:1,className:"oui-flex-1 oui-bg-base-contrast-12"})]}),Cr=e=>{let{dstGasFee:t,feeQty:i,feeAmount:s,dp:r,nativeSymbol:o}=e,{t:a}=S(),l=()=>{let d=n.jsxs("div",{className:"oui-text-2xs",children:[n.jsxs(g,{gapX:1,children:[n.jsx(h,{size:"2xs",intensity:54,children:`${a("transfer.deposit.destinationGasFee")}: `}),n.jsx(h.numeral,{intensity:80,dp:r,rm:T.ROUND_UP,padding:!1,children:i}),n.jsx(h,{intensity:54,children:o})]}),n.jsx(W,{mt:2,children:n.jsx(h,{intensity:36,children:a("transfer.deposit.destinationGasFee.description")})})]});he.alert({title:a("common.fee"),message:d})},u=!!t&&t!=="0";return n.jsxs(h,{size:"2xs",intensity:36,className:"oui-border-dashed oui-border-b oui-border-line-12 oui-cursor-pointer",onClick:l,children:[`${a("common.fee")} ≈ `,n.jsxs(h,{size:"2xs",intensity:80,children:["$",n.jsx(h.numeral,{dp:2,padding:!1,rm:T.ROUND_UP,children:s})," "]}),u&&n.jsxs("span",{children:["(",n.jsxs(h,{intensity:54,children:[n.jsx(h.numeral,{dp:r,padding:!1,rm:T.ROUND_UP,children:i}),o]}),")"]})]})},Nr=e=>{let{t}=S(),{value:i,symbol:s,precision:r=6}=e;return n.jsxs(g,{width:"100%",itemAlign:"center",justify:"between",children:[n.jsx(g,{itemAlign:"center",justify:"start",children:n.jsx(h,{size:"2xs",intensity:36,children:t("transfer.swapDeposit.minimumReceived")})}),n.jsxs(g,{itemAlign:"center",justify:"end",gap:1,children:[n.jsx(h.numeral,{dp:r,size:"2xs",className:"oui-select-none",intensity:80,children:i}),n.jsx(h,{size:"2xs",className:"oui-select-none",intensity:36,children:s})]})]})},Ou=1e3;function Du(e,t,i){let[s,r]=p.useState(""),o=p.useRef(""),[a,l]=p.useState(!1),u=p.useRef(),d=async(c=0)=>{a||typeof t!="function"||!e.address||(u.current&&clearTimeout(u.current),o.current===""&&l(!0),u.current=setTimeout(async()=>{try{let m=await t(e.address,e.decimals);r(m),o.current=m,console.log("balance",e.symbol,e.address,m)}catch(m){console.error("get balance error",e.symbol,e.address,m),d(Ou)}finally{o.current!==""&&l(!1)}},c))};return p.useEffect(()=>(i&&d(0),()=>{u.current&&clearTimeout(u.current)}),[e,i]),{balance:s,loading:a}}var Iu=e=>{let{token:t,isActive:i,displayType:s,onTokenChange:r,fetchBalance:o,open:a}=e,{symbol:l,precision:u,insufficientBalance:d}=t,{balance:c,loading:m}=Du(t,o,a),y=typeof o=="function",{t:j}=S();if(s==="vaultBalance"&&d)return n.jsx(g,{itemAlign:"center",justify:"between",px:2,r:"base",className:E("group","oui-h-[30px]","oui-text-2xs oui-font-semibold",i&&"oui-bg-base-5",e.index!==0&&"oui-mt-[2px]","oui-cursor-not-allowed"),children:n.jsxs(g,{itemAlign:"center",gapX:1,children:[n.jsx(Ft,{name:l,className:"oui-size-[16px] oui-opacity-50"}),n.jsx(h,{intensity:36,children:t.label}),n.jsx(ee,{color:"neutral",size:"xs",children:j("transfer.withdraw.InsufficientVaultBalance")})]})},l);let f=()=>y?m?n.jsx(Bt,{size:"sm"}):n.jsx(h.numeral,{rule:"price",dp:u??2,rm:T.ROUND_DOWN,className:E("oui-text-base-contrast-80 group-hover:oui-text-base-contrast-54",i&&"oui-text-base-contrast-54"),children:c}):null;return n.jsxs(g,{justify:"between",px:2,r:"base",className:E("group","oui-h-[30px] hover:oui-bg-base-5","oui-text-2xs oui-font-semibold","oui-cursor-pointer",i&&"oui-bg-base-5",e.index!==0&&"oui-mt-[2px]"),onClick:()=>{r==null||r(t)},children:[n.jsxs(g,{gapX:1,children:[n.jsx(Ft,{name:l,className:"oui-size-[16px]"}),n.jsx(h,{className:E("oui-text-base-contrast-54 group-hover:oui-text-base-contrast-80",i&&"oui-text-base-contrast-80"),children:t.label})]}),f()]},l)},rt=p.forwardRef(e=>{let{token:t,tokens:i=[],classNames:s,label:r,status:o,hintMessage:a,value:l,onValueChange:u,fetchBalance:d,onTokenChange:c,loading:m,placeholder:y,formatters:j,vaultBalanceList:f,displayType:b,...x}=e,{t:C}=S(),w=p.useRef(null),[v,N]=p.useState(!1),[I,O]=p.useState(0),A=p.useMemo(()=>i.map(z=>{let R=f==null?void 0:f.find(ne=>ne.token===z.symbol),H=new T((R==null?void 0:R.balance)??0).lt(l?Number(l):0);return{...z,name:z.display_name||z.symbol,insufficientBalance:H}}),[i,l,f]);p.useEffect(()=>{var R;let z=(R=w==null?void 0:w.current)==null?void 0:R.getBoundingClientRect();O((z==null?void 0:z.width)||0)},[w]);let k=z=>{let R=i.find(H=>H.symbol===z);R&&(c==null||c(R))},_=i.length>1?v:!1,D=z=>{let R=z.symbol===(t==null?void 0:t.symbol);return n.jsx(Iu,{token:z,isActive:R,fetchBalance:d,displayType:b,onTokenChange:H=>{c==null||c(H),N(!1)},open:_})},M=n.jsxs(W,{children:[n.jsx(W,{className:"oui-absolute oui-top-0",children:n.jsx(h,{size:"2xs",intensity:36,children:r||C("common.quantity")})}),m&&n.jsx(W,{className:"oui-absolute oui-bottom-1",children:n.jsx(Bt,{size:"sm"})})]}),L=n.jsx("div",{className:"oui-absolute oui-right-0",children:n.jsx(vs.tokens,{open:_,onOpenChange:N,disabled:x.disabled,variant:"text",tokens:A,value:(t==null?void 0:t.display_name)||(t==null?void 0:t.symbol),size:x.size,onValueChange:k,showIcon:!0,optionRenderer:D,contentProps:{onCloseAutoFocus:z=>{var R;z.preventDefault(),(R=w.current)==null||R.focus()},onClick:z=>{var R;z.preventDefault(),(R=w.current)==null||R.focus()},style:{width:I},align:"end",sideOffset:5,className:"oui-border oui-border-line-6"}})}),F=n.jsxs(g,{mt:1,gapX:1,px:1,children:[n.jsx(W,{width:4,height:4,r:"full",className:E(o==="error"&&"oui-bg-danger-light",o==="warning"&&"oui-bg-warning-light")}),n.jsx(h,{size:"2xs",className:E(o==="error"&&"oui-text-danger-light",o==="warning"&&"oui-text-warning-light"),children:a})]});return n.jsxs(n.Fragment,{children:[n.jsx(fe,{ref:w,autoComplete:"off",placeholder:y??(m?"":"0"),prefix:M,suffix:L,value:l,onValueChange:z=>{u==null||u(z)},formatters:j||[J.numberFormatter,J.dpFormatter((t==null?void 0:t.precision)??2),J.currencyFormatter],...x,classNames:{...s,root:E("oui-relative oui-h-[54px] oui-px-3","oui-rounded-lg oui-border oui-border-line",o==="error"&&"oui-outline-danger-light focus-within:oui-outline-danger-light",o==="warning"&&"oui-outline-warning-light focus-within:oui-outline-warning-light",e.readOnly?"oui-border-none oui-bg-base-6 focus-within:oui-outline-0":"oui-bg-base-5",s==null?void 0:s.root),input:E("oui-absolute oui-bottom-0",s==null?void 0:s.input)}}),a&&F]})}),Un=[.5,1,2],Sr=e=>{let{min:t=.2,max:i=10}=e,[s,r]=p.useState(),[o,a]=p.useState(""),[l,u]=p.useState(!1),{t:d}=S();p.useEffect(()=>{e.value&&!Un.includes(e.value)?a(e.value.toString()):r(e.value)},[e.value,l]);let c=()=>{u(!0)},m=()=>{u(!1)},y=w=>{r(w),a("")},j=w=>{if(!w||Number(w)===0){a(w);return}let v=new T(w);r(void 0),v.lt(t)?a(t.toString()):v.gt(i)?a(i.toString()):a(w)},f=()=>{var w;return o?(w=new T(o))==null?void 0:w.toNumber():s},b=()=>{var v;let w=f();return w&&((v=e.onValueChange)==null||v.call(e,w),m(),Un.includes(w)&&a("")),Promise.resolve(!0)},x=!f(),C=n.jsxs("div",{className:"oui-text-2xs",children:[n.jsxs(g,{gapX:2,children:[Un.map(w=>n.jsx(Lu,{value:w,isActive:s===w,onClick:()=>{y(w)}},w)),n.jsx(fe,{suffix:"%",formatters:[J.numberFormatter,J.dpFormatter(2)],value:o,onValueChange:j,classNames:{root:E("oui-rounded-md oui-bg-base-6","oui-h-[40px] oui-w-[74px]"),input:"oui-text-base-contrast",additional:"oui-pl-1"}})]}),n.jsx(W,{mt:5,children:n.jsx(h,{intensity:54,children:d("transfer.slippage.slippageTolerance.description")})})]});return n.jsxs(n.Fragment,{children:[n.jsx(Qo,{open:l,onOpenChange:u,title:d("transfer.slippage.slippageTolerance"),okLabel:d("common.confirm"),message:C,onOk:b,actions:{primary:{disabled:x}}}),n.jsxs(g,{width:"100%",justify:"between",className:"oui-cursor-pointer oui-select-none",onClick:c,children:[n.jsx(h,{intensity:36,size:"2xs",children:d("transfer.slippage")}),n.jsxs(g,{gapX:1,children:[n.jsxs(h,{size:"2xs",color:"primaryLight",children:[e.value,"%"]}),n.jsx(Ds,{className:"oui-size-3 oui-text-primary-light"})]})]})]})},Lu=({value:e,isActive:t,onClick:i})=>n.jsx(g,{intensity:600,justify:"center",itemAlign:"center",r:"md",width:74,height:40,className:E("oui-cursor-pointer oui-select-none",t&&"oui-bg-primary-light"),onClick:i,children:n.jsxs(h,{size:"sm",intensity:80,children:[e,"%"]})}),Eu=e=>{let{message:t,needSwap:i,needCrossSwap:s,wrongNetwork:r,networkId:o}=e,{t:a}=S(),l=()=>{he.show(Hs,{networkId:o})},u=p.useMemo(()=>{if(r)return a("connector.wrongNetwork.tooltip");if(t)return t;if(s)return n.jsx(h,{children:n.jsx(Qe,{i18nKey:"transfer.swapDeposit.crossSwap.notice",components:[n.jsx(h,{className:"oui-cursor-pointer",color:"primaryLight",onClick:l},"0")]})});if(i)return a("transfer.swapDeposit.swap.notice")},[t,i,s,r,a]);return u?n.jsx(W,{mb:3,className:"oui-text-center oui-text-xs oui-text-warning-darken",children:u}):null},Au=e=>{let{feeQtys:t,feeAmount:i,feeDetails:s,nativeSymbol:r}=e,{t:o}=S(),a=()=>{let u=n.jsx(W,{className:"oui-text-2xs",children:s==null?void 0:s.map((d,c)=>{let m=c===(s==null?void 0:s.length)-1;return n.jsxs(W,{children:[n.jsxs(g,{gapX:1,children:[n.jsxs(h,{intensity:54,children:[d.title,":"]}),n.jsx(h,{intensity:80,children:d.value}),n.jsx(h,{intensity:54,children:d.symbol})]}),n.jsx(W,{mt:2,children:n.jsx(h,{intensity:36,children:d.description})}),!m&&n.jsx(W,{my:3,children:n.jsx(ye,{intensity:8})})]},c)})});he.alert({title:o("common.fee"),message:u})},l=()=>{let u=t==null?void 0:t.length;if(!u)return;let d=t.map((c,m)=>n.jsxs(h,{intensity:54,children:[n.jsx(h.numeral,{dp:c.dp,padding:!1,rm:T.ROUND_UP,children:c.value}),` ${c.symbol||r}`]},m));if(u===1)return n.jsxs("span",{children:["(",d,")"]});if(u===2)return n.jsxs("span",{children:["(",d[0]," + ",d[1],")"]})};return n.jsxs(h,{size:"xs",intensity:36,className:"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",onClick:a,children:[`${o("common.fee")} ≈ `,n.jsxs(h,{size:"xs",intensity:80,children:["$",n.jsx(h.numeral,{dp:2,padding:!1,rm:T.ROUND_UP,children:i})," "]}),l()]})},Tr=e=>{let{sourceSymbol:t,targetSymbol:i,indexPrice:s,precision:r=6}=e;return n.jsxs(g,{itemAlign:"center",gap:1,className:E(e.className,"oui-text-2xs"),children:[n.jsx(h,{size:"2xs",intensity:80,children:"1"}),n.jsx(h,{size:"2xs",intensity:36,children:t}),"=",n.jsx(h.numeral,{size:"2xs",intensity:80,dp:r,padding:!1,children:s}),n.jsx(h,{size:"2xs",intensity:36,children:i})]})},Pr=e=>n.jsx("svg",{width:"24",height:"25",viewBox:"0 0 24 25",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{d:"M6.012 12.493a1 1 0 0 1 .999-1h7.555L11.6 8.498l1.405-1.405 4.714 4.683c.196.195.293.457.293.719 0 .26-.098.522-.293.717l-4.714 4.683L11.6 16.49l2.966-2.997H7.011a1 1 0 0 1-.999-1"})}),qu=e=>n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 2.67v10.663h4.667V2.667H4zm6-.003v2.666h1c.218 0 .53.06.806.26.31.223.527.59.527 1.074V12h1V6.667c0-.045 0-.154-.027-.277a.5.5 0 0 0-.11-.252l-1.668-1.667a.667.667 0 0 1 .943-.942l1.667 1.666c.294.294.417.658.472.915.057.264.057.486.057.555V12c0 .484-.217.85-.527 1.074-.277.2-.589.26-.807.26h-1c-.484 0-.85-.217-1.074-.528a1.4 1.4 0 0 1-.26-.806V6.667H10v6.666h.667a.667.667 0 0 1 0 1.334H2a.667.667 0 0 1 0-1.334h.667V2.667c0-.218.06-.53.259-.807.223-.31.59-.527 1.074-.527h4.667c.217 0 .53.06.806.26.31.223.527.59.527 1.074m-4.667 2a.667.667 0 0 0 0 1.333h2a.667.667 0 0 0 0-1.333z"})}),Ru=e=>n.jsx("svg",{width:"13",height:"12",viewBox:"0 0 13 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:n.jsx("path",{d:"M8.996 10.496a2 2 0 0 0 2-2v-5a2 2 0 0 0-2-2h-5a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2zm-4-2.5a.5.5 0 0 1-.36-.14.515.515 0 0 1 0-.72l2-2-1.14-1.14h3v3l-1.14-1.14-2 2a.5.5 0 0 1-.36.14"})}),Mu=e=>n.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[n.jsx("rect",{width:"24",height:"24",rx:"12",fill:"#07080A"}),n.jsx("path",{d:"M5.077 7.385h2.269l1.604 5.28c.106.348.196.73.196.73s.138-.413.28-.742l.885-2.052a1.8 1.8 0 0 1 .66-.782 1.81 1.81 0 0 1 1.974 0c.293.191.523.463.662.782l2.143 4.91v1.095h-1.402c-.235 0-.464-.07-.66-.2a1.17 1.17 0 0 1-.434-.53l-1.303-3.16-1.243 3.152a1.19 1.19 0 0 1-1.105.747h-.848c-.235 0-.465-.075-.654-.214a1.1 1.1 0 0 1-.4-.556z",fill:"#FEFEFE"}),n.jsx("path",{d:"m18.146 10.846 1.066-3.461h-2.396l-1.066 3.461z",fill:"url(#a)"}),n.jsx("path",{d:"m15.371 12-1.208 3.865v.009c-.073.216-.194.529-.514.51a.33.33 0 0 1-.207-.058c.211.186.482.29.763.29h1.428a1.065 1.065 0 0 0 .928-.75L17.769 12z",fill:"url(#b)"}),n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"a",x1:"14.618",y1:"16.592",x2:"17.597",y2:"7.455",gradientUnits:"userSpaceOnUse",children:[n.jsx("stop",{stopColor:"#59B0FE"}),n.jsx("stop",{offset:"1",stopColor:"#26FEFE"})]}),n.jsxs("linearGradient",{id:"b",x1:"16.192",y1:"16.587",x2:"18.206",y2:"7.458",gradientUnits:"userSpaceOnUse",children:[n.jsx("stop",{stopColor:"#59B0FE"}),n.jsx("stop",{offset:"1",stopColor:"#26FEFE"})]})]})]}),Fu=e=>{let{sourceToken:t,targetToken:i,className:s}=e;return t===i?null:n.jsx(g,{width:"100%",itemAlign:"center",justify:"center",className:s,children:n.jsxs(g,{itemAlign:"center",justify:"center",gap:1,children:[n.jsxs(g,{itemAlign:"center",justify:"center",gap:1,children:[n.jsx(Ft,{className:"oui-size-[18px]",name:t}),n.jsx(h,{weight:"semibold",intensity:80,size:"sm",children:t})]}),n.jsx(Pr,{className:"oui-size-4"}),n.jsxs(g,{itemAlign:"center",justify:"center",gap:1,children:[n.jsx(Ft,{className:"oui-size-[18px]",name:i}),n.jsx(h,{weight:"semibold",intensity:80,size:"sm",children:i})]})]})})},$u=()=>{let{t:e}=S(),{wallet:t,connectedChain:i}=hn(),{state:s,account:r}=Fe(),o=p.useMemo(()=>{var l;let a=s.address;return i!=null&&i.id&&Jo.has(parseInt(i==null?void 0:i.id))&&(a=(l=r.getAdditionalInfo())==null?void 0:l.AGWAddress),a},[t,s,r,i]);return n.jsxs(g,{justify:"between",children:[n.jsx(h,{size:"sm",intensity:98,children:e("transfer.web3Wallet.your")}),n.jsxs(g,{gapX:1,children:[n.jsx(Ps,{size:"xs",name:(t==null?void 0:t.label)??""}),n.jsx(h.formatted,{size:"sm",intensity:54,rule:"address",children:o})]})]})};function zu(e){let{srcToken:t,dstToken:i,srcChainId:s,dstChainId:r}=e,[o,a]=p.useState(!1),[l,u]=p.useState(!1);return p.useEffect(()=>{if(!s||!r||!t||!i)return;let d=s!==r;if((t==null?void 0:t.symbol)==="USDC"&&!d||t.is_collateral&&t.symbol===(i==null?void 0:i.symbol)){a(!1),u(!1);return}a((t==null?void 0:t.symbol)!=="USDC"),d?(u(!0),a(!0)):u(!1)},[t,i,s,r]),{needSwap:o,needCrossSwap:l}}var si=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint8",name:"version",type:"uint8"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Paused",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Unpaused",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint16",name:"srcChainId",type:"uint16"},{indexed:!0,internalType:"uint256",name:"nonce",type:"uint256"},{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"address",name:"bridgedToken",type:"address"},{indexed:!1,internalType:"uint256",name:"bridgedAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"toToken",type:"address"},{indexed:!1,internalType:"uint256",name:"minToAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"realToToken",type:"address"},{indexed:!1,internalType:"uint256",name:"realToAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"orderlyNativeFees",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"accountId",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"brokerHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"tokenHash",type:"bytes32"},{indexed:!1,internalType:"uint128",name:"tokenAmount",type:"uint128"}],name:"WOOFiDexCrossSwapOnDstChain",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint16",name:"dstChainId",type:"uint16"},{indexed:!0,internalType:"uint256",name:"nonce",type:"uint256"},{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"address",name:"fromToken",type:"address"},{indexed:!1,internalType:"uint256",name:"fromAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"bridgeToken",type:"address"},{indexed:!1,internalType:"uint256",name:"minBridgeAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"bridgeAmount",type:"uint256"}],name:"WOOFiDexCrossSwapOnSrcChain",type:"event"},{inputs:[],name:"MAX_BRIDGE_SLIPPAGE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"NATIVE_PLACEHOLDER",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"addDirectBridgeToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"allDirectBridgeTokens",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"allDirectBridgeTokensLength",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"bridgeSlippage",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address payable",name:"to",type:"address"},{components:[{internalType:"address",name:"fromToken",type:"address"},{internalType:"uint256",name:"fromAmount",type:"uint256"},{internalType:"address",name:"bridgeToken",type:"address"},{internalType:"uint256",name:"minBridgeAmount",type:"uint256"}],internalType:"struct IWOOFiDexCrossChainRouter.SrcInfos",name:"srcInfos",type:"tuple"},{components:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"address",name:"bridgedToken",type:"address"},{internalType:"address",name:"toToken",type:"address"},{internalType:"uint256",name:"minToAmount",type:"uint256"},{internalType:"uint256",name:"orderlyNativeFees",type:"uint256"}],internalType:"struct IWOOFiDexCrossChainRouter.DstInfos",name:"dstInfos",type:"tuple"},{components:[{internalType:"bytes32",name:"accountId",type:"bytes32"},{internalType:"bytes32",name:"brokerHash",type:"bytes32"},{internalType:"bytes32",name:"tokenHash",type:"bytes32"}],internalType:"struct IWOOFiDexCrossChainRouter.DstVaultDeposit",name:"dstVaultDeposit",type:"tuple"}],name:"crossSwap",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"dstGasForNoSwapCall",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"dstGasForSwapCall",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"stuckToken",type:"address"}],name:"inCaseTokenGotStuck",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_weth",type:"address"},{internalType:"address",name:"_nonceCounter",type:"address"},{internalType:"address",name:"_wooRouter",type:"address"},{internalType:"address",name:"_sgRouter",type:"address"},{internalType:"uint16",name:"_sgChainIdLocal",type:"uint16"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"nonceCounter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"orderlyFeeToggle",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{components:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"address",name:"bridgedToken",type:"address"},{internalType:"address",name:"toToken",type:"address"},{internalType:"uint256",name:"minToAmount",type:"uint256"},{internalType:"uint256",name:"orderlyNativeFees",type:"uint256"}],internalType:"struct IWOOFiDexCrossChainRouter.DstInfos",name:"dstInfos",type:"tuple"},{components:[{internalType:"bytes32",name:"accountId",type:"bytes32"},{internalType:"bytes32",name:"brokerHash",type:"bytes32"},{internalType:"bytes32",name:"tokenHash",type:"bytes32"}],internalType:"struct IWOOFiDexCrossChainRouter.DstVaultDeposit",name:"dstVaultDeposit",type:"tuple"}],name:"quoteLayerZeroFee",outputs:[{internalType:"uint256",name:"nativeAmount",type:"uint256"},{internalType:"uint256",name:"zroAmount",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"removeDirectBridgeToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_bridgeSlippage",type:"uint256"}],name:"setBridgeSlippage",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_dstGasForNoSwapCall",type:"uint256"}],name:"setDstGasForNoSwapCall",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_dstGasForSwapCall",type:"uint256"}],name:"setDstGasForSwapCall",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_nonceCounter",type:"address"}],name:"setNonceCounter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_orderlyFeeToggle",type:"bool"}],name:"setOrderlyFeeToggle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"_sgChainIdLocal",type:"uint16"}],name:"setSgChainIdLocal",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"address",name:"token",type:"address"}],name:"setSgETH",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"poolId",type:"uint256"}],name:"setSgPoolId",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_sgRouter",type:"address"}],name:"setSgRouter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"address",name:"woofiDexCrossChainRouter",type:"address"}],name:"setWOOFiDexCrossChainRouter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"address",name:"token",type:"address"},{internalType:"address",name:"woofiDexVault",type:"address"}],name:"setWOOFiDexVault",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wooRouter",type:"address"}],name:"setWooRouter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"sgChainIdLocal",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"}],name:"sgETHs",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"},{internalType:"address",name:"",type:"address"}],name:"sgPoolIds",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes",name:"",type:"bytes"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"bridgedToken",type:"address"},{internalType:"uint256",name:"bridgedAmount",type:"uint256"},{internalType:"bytes",name:"payload",type:"bytes"}],name:"sgReceive",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"sgRouter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"weth",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"wooRouter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"}],name:"woofiDexCrossChainRouters",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"},{internalType:"address",name:"",type:"address"}],name:"woofiDexVaults",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],Uu=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint8",name:"version",type:"uint8"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Paused",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"account",type:"address"}],name:"Unpaused",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"address",name:"fromToken",type:"address"},{indexed:!1,internalType:"uint256",name:"fromAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"toToken",type:"address"},{indexed:!1,internalType:"uint256",name:"minToAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"toAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"orderlyNativeFees",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"accountId",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"brokerHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"tokenHash",type:"bytes32"},{indexed:!1,internalType:"uint128",name:"tokenAmount",type:"uint128"}],name:"WOOFiDexSwap",type:"event"},{inputs:[],name:"NATIVE_PLACEHOLDER",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"stuckToken",type:"address"}],name:"inCaseTokenGotStuck",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wooRouter",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"orderlyFeeToggle",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_orderlyFeeToggle",type:"bool"}],name:"setOrderlyFeeToggle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"address",name:"woofiDexVault",type:"address"}],name:"setWOOFiDexVault",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wooRouter",type:"address"}],name:"setWooRouter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address payable",name:"to",type:"address"},{components:[{internalType:"address",name:"fromToken",type:"address"},{internalType:"uint256",name:"fromAmount",type:"uint256"},{internalType:"address",name:"toToken",type:"address"},{internalType:"uint256",name:"minToAmount",type:"uint256"},{internalType:"uint256",name:"orderlyNativeFees",type:"uint256"}],internalType:"struct IWOOFiDexDepositor.Infos",name:"infos",type:"tuple"},{components:[{internalType:"bytes32",name:"accountId",type:"bytes32"},{internalType:"bytes32",name:"brokerHash",type:"bytes32"},{internalType:"bytes32",name:"tokenHash",type:"bytes32"}],internalType:"struct IWOOFiDexDepositor.VaultDeposit",name:"vaultDeposit",type:"tuple"}],name:"swap",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wooRouter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"woofiDexVaults",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],Bu="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",kr=e=>e===Bu,Or="https://fi-api.woo.org",Wu=()=>{let[e,{setTrue:t,setFalse:i}]=Ct(!1),[s,r]=p.useState("WAITTING"),o=at(),[a,l]=p.useState(),[u,d]=p.useState(yt.NO),c=p.useRef(),m=p.useRef(),y=fn(),j=Ne(),f=j.get("brokerId"),b=j.get("networkId"),x=p.useRef(hu(b)).current,C=p.useRef();p.useEffect(()=>{let N=I=>{let{side:O,transStatus:A,trxId:k}=I;O==="DEPOSIT"&&k===c.current&&d(A)};return o.on("wallet:changed",N),()=>{o.off("wallet:changed",N)}},[c.current]);let w=p.useCallback(N=>{m.current&&clearTimeout(m.current),m.current=setTimeout(async()=>{try{let{messages:I}=await x.getMessagesBySrcTxHash(N);if(I.length>0){let{status:O}=I[0];r(O),O==="DELIVERED"?(l(I[0]),c.current=I[0].dstTxHash):O==="FAILED"?l(I[0]):w(N)}else w(N)}catch{w(N)}},1e3)},[]);p.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]);let v=p.useCallback(()=>({accountId:y.accountIdHashStr,brokerHash:nt.parseBrokerHash(f),tokenHash:nt.parseTokenHash("USDC")}),[y,f]);return{swap:async N=>{if(!y.walletAdapter)throw new Error("walletAdapter is undefined");if(!y.address)throw new Error("account.address is undefined");if(!N.crossChainRouteAddress)throw new Error("crossChainRouteAddress is undefined");let{address:I,src:O,dst:A,crossChainRouteAddress:k}=N;if(!e){t();try{let _=await y.walletAdapter.call(k,"quoteLayerZeroFee",[y.address,A,v()],{abi:si}),D=await y.walletAdapter.sendTransaction(k,"crossSwap",{from:y.address,to:k,data:[y.address,O,A,v()],value:kr(N.src.fromToken)?BigInt(N.src.fromAmount)+_[0]:_[0]},{abi:si});return i(),w(D.hash),o.emit("deposit:requested"),Ns(["from","to","hash","value"],D)}catch(_){throw console.error("crossSwap error",_),i(),new Error(_.errorCode)}}},loading:e,bridgeStatus:s,status:u,message:a}},Dr=e=>{let{status:t,mode:i,statusUrl:s,brokerName:r}=e,{t:o}=S(),a=p.useMemo(()=>{let m=Qu(t),y=Ku(t),j=[{title:o(m==="pending"?"transfer.swapDeposit.bridging":"transfer.swapDeposit.bridge"),description:o("transfer.swapDeposit.bridge.description"),state:m},{title:o(y==="pending"?"transfer.swapDeposit.depositing":"transfer.swapDeposit.deposit"),description:o("transfer.swapDeposit.deposit.description",{brokerName:r}),state:y}];return i===0?j.slice(1,2):j},[i,r,t,o]),l=()=>{var m;(m=e.onComplete)==null||m.call(e,t===4)},u=t===3||t===1,d=t===0||t===2,c=a.length>1;return n.jsxs("div",{className:"oui-font-semibold",children:[n.jsxs(W,{intensity:600,p:4,r:"lg",children:[n.jsxs(g,{direction:"column",itemAlign:"start",gapY:4,className:"oui-relative",children:[a.map(m=>p.createElement(Vu,{...m,key:m.title})),c&&n.jsx("div",{className:E("oui-absolute oui-left-[10px] oui-top-[20px] oui-bottom-[38px]","oui-w-[1px] oui-h-[34px]","oui-border-r oui-border-dashed oui-border-r-line-16")})]}),n.jsx(W,{my:3,children:n.jsx(ye,{intensity:8})}),n.jsxs(g,{gapX:1,justify:"center",itemAlign:"center",className:E(s?"oui-text-primary-light":"oui-text-base-contrast-20",s?"oui-cursor-pointer":"oui-cursor-not-allowed"),onClick:()=>{s&&window.open(s)},children:[n.jsx(h,{size:"2xs",children:o("transfer.swapDeposit.viewStatus")}),n.jsx(Ru,{})]})]}),n.jsxs(g,{direction:"column",justify:"center",itemAlign:"center",mt:8,gapY:3,children:[u&&n.jsx(h,{size:"xs",className:"oui-text-danger-light",children:o("transfer.swapDeposit.depositFailed")}),n.jsx(te,{className:"oui-w-full lg:oui-w-[184px]",disabled:d,onClick:l,children:o("common.ok")})]})]})},Vu=({title:e,description:t,state:i})=>n.jsxs(g,{itemAlign:"start",gapX:2,children:[n.jsx(g,{width:20,height:20,justify:"center",children:n.jsx(Hu,{state:i})}),n.jsxs(g,{direction:"column",itemAlign:"start",children:[n.jsx(h,{size:"sm",className:E(i==="pending"||i==="failed"?"oui-text-base-contrast":"oui-text-base-contrast-54"),children:e}),n.jsx(h,{size:"2xs",className:E(i==="pending"?"oui-text-base-contrast-54":"oui-text-base-contrast-20"),children:t})]})]},e),Hu=({state:e})=>e==="pending"?n.jsx(Bt,{size:"sm"}):e==="failed"?n.jsx(xi,{size:20,opacity:1,className:"oui-text-danger-light"}):e==="success"?n.jsx(Zo,{size:20,opacity:1,className:"oui-text-primary-light"}):n.jsx(W,{r:"full",width:10,height:10,intensity:200});function Qu(e){if(e===0)return"pending";if(e===1)return"failed";if(e===4||e===2)return"success"}function Ku(e){if(e===2)return"pending";if(e===3)return"failed";if(e===4)return"success"}var Gu=(e=[])=>{let t=e.reduce((i,s)=>(i[s.symbol]=s,i),{});return t.USDC||t.USDbC||e[0]},Mt=e=>(e??2)+3;function Xu(e){return/^0x[a-fA-F0-9]{64}$/.test(e)}function Ir(e){return e===34?q.t("transfer.internalTransfer.error.transferInProgress"):e===17?q.t("transfer.internalTransfer.error.withdrawalInProgress"):e===35?q.t("transfer.internalTransfer.error.accountIdNotExist"):e===37?q.t("transfer.internalTransfer.error.transferToSelf"):e===46?q.t("transfer.internalTransfer.error.transferToSubAccount"):q.t("transfer.internalTransfer.error.default")}var Lr=e=>{var b;let{info:t,mode:i,nativePrice:s,markPrice:r,src:o,dst:a,nativeToken:l,viewMode:u}=e,{t:d}=S(),c=n.jsxs(g,{justify:"between",children:[n.jsx(ts,{primary:o==null?void 0:o.token,chainId:o.chain,amount:o==null?void 0:o.amount,dp:o==null?void 0:o.displayDecimals,symbol:o==null?void 0:o.token}),n.jsx(Pr,{className:"oui-text-primary-light"}),n.jsx(ts,{primary:a==null?void 0:a.token,component:n.jsx(Mu,{className:"oui-size-4"}),amount:a==null?void 0:a.amount,dp:a==null?void 0:a.displayDecimals,symbol:a==null?void 0:a.token,reverse:!0})]}),m=n.jsx(W,{my:5,children:n.jsx(ye,{intensity:12})}),y=[{label:d("transfer.deposit.destinationGasFee"),value:n.jsxs(g,{gapX:1,children:[n.jsx(qu,{className:"oui-text-primary-light"}),n.jsx(h.numeral,{color:"primaryLight",padding:!1,rm:T.ROUND_UP,dp:Mt(l==null?void 0:l.precision),children:t.dstGasFee}),n.jsx(h,{color:"primaryLight",children:l==null?void 0:l.symbol}),n.jsxs(h,{className:"oui-text-primary-light/60",children:["($",n.jsx(h.numeral,{color:"primaryLight",padding:!1,rm:T.ROUND_UP,dp:2,children:new T((b=t.dstGasFee)==null?void 0:b.toString()).mul(s||0).toString()}),")"]})]})},{label:d("transfer.swapDeposit.swapFee"),value:n.jsxs(n.Fragment,{children:[n.jsx(h.numeral,{intensity:80,dp:Mt(o==null?void 0:o.displayDecimals),rm:T.ROUND_UP,padding:!1,children:t.swapFee}),` ${o==null?void 0:o.token} `,n.jsxs(h,{className:"oui-text-[#63666D]",children:["($",n.jsx(h.numeral,{padding:!1,rm:T.ROUND_UP,dp:2,children:new T(t.swapFee).mul(r||0).toString()}),")"]})]})},{label:d("transfer.swapDeposit.bridgeFee"),value:i===1&&n.jsxs(n.Fragment,{children:[n.jsx(h.numeral,{intensity:80,dp:Mt(o==null?void 0:o.displayDecimals),rm:T.ROUND_UP,padding:!1,children:t.bridgeFee}),` ${o==null?void 0:o.token} `,n.jsxs(h,{className:"oui-text-[#63666D]",children:["($",n.jsx(h.numeral,{padding:!1,rm:T.ROUND_UP,dp:2,children:new T(t.bridgeFee).mul(r||0).toString()}),")"]})]})},{label:d("transfer.swapDeposit.minimumReceived"),value:n.jsxs(n.Fragment,{children:[n.jsx(h.numeral,{dp:a==null?void 0:a.displayDecimals,rm:T.ROUND_DOWN,padding:!1,children:t.received}),` ${a==null?void 0:a.token}`]})},{label:d("common.price"),value:n.jsxs(n.Fragment,{children:[`1 ${o==null?void 0:o.token} = `,n.jsx(h.numeral,{dp:3,padding:!1,children:t.price}),` ${a==null?void 0:a.token}`]})},{label:d("transfer.slippage"),value:`${t.slippage}%`}],j=n.jsx(g,{direction:"column",itemAlign:"start",gapY:3,children:y==null?void 0:y.map(x=>{if(x.value)return p.createElement(Ju,{...x,key:x.label})})}),f=n.jsx(g,{justify:"center",mt:8,children:n.jsx(te,{className:"oui-w-full lg:oui-w-[184px]",onClick:e.onConfirm,children:d("transfer.swapDeposit.confirmSwap")})});return n.jsxs(W,{intensity:800,children:[c,n.jsx(Yu,{time:t.time??0}),m,u==="details"&&n.jsxs(n.Fragment,{children:[j,f]})]})},Ju=e=>n.jsxs(g,{gapX:2,justify:"between",width:"100%",children:[n.jsx(h,{size:"sm",intensity:54,children:e.label}),n.jsx(h,{size:"sm",intensity:98,as:"div",children:e.value})]}),ts=e=>n.jsxs(g,{gapX:2,direction:e.reverse?"rowReverse":"row",children:[n.jsx(Ko.combine,{secondary:{chainId:e.chainId,component:e.component,className:"oui-w-4 oui-h-4 oui-outline-base-8 oui-rounded-full"},children:n.jsx(Ft,{name:e.primary,size:"md"})}),n.jsxs(g,{direction:"column",itemAlign:e.reverse?"end":"start",children:[n.jsx(h.numeral,{intensity:98,size:"lg",dp:e.dp,children:e.amount}),n.jsx(h,{intensity:54,size:"xs",children:e.symbol})]})]}),Yu=e=>n.jsx(g,{justify:"center",children:n.jsx(g,{intensity:600,r:"full",gapX:2,justify:"center",py:1,mt:2,width:210,children:n.jsx(h,{size:"sm",intensity:54,children:n.jsx(Qe,{i18nKey:"transfer.swapDeposit.averageSwapTime",values:{time:e.time},components:[n.jsx(h,{color:"primaryLight"},"0")]})})})}),Er=()=>n.jsx(g,{justify:"center",gapX:1,mt:3,children:n.jsx(Qe,{i18nKey:"transfer.swapDeposit.viewFAQs",components:[n.jsx(h,{size:"xs",color:"primaryLight",onClick:()=>{window.open("https://learn.woo.org/woofi/faqs/woofi-pro")},className:"oui-cursor-pointer"},"0")]})}),Zu=e=>{var k;let{transactionData:t,slippage:i,mode:s,dst:r,src:o,chain:a,nativeToken:l,depositFee:u}=e,{t:d}=S(),[c,m]=p.useState(-1),[y,j]=p.useState("details"),[f,b]=p.useState(),x=at(),{swap:C,bridgeStatus:w,message:v,status:N}=Wu(),I=p.useMemo(()=>({price:t.price,slippage:i,time:a==null?void 0:a.est_txn_mins,received:r.amount,bridgeFee:t.fees_from.stargate,swapFee:t.fees_from.woofi,dstGasFee:t.dst_infos.gas_fee}),[t,a==null?void 0:a.est_txn_mins,s,r]);p.useEffect(()=>{w==="DELIVERED"&&m(2),w==="FAILED"&&m(1),N===yt.COMPLETED&&m(4),N===yt.FAILED&&m(3)},[w,N]);let O=p.useCallback(()=>(j("processing"),t?(m(0),C({address:"",crossChainRouteAddress:a==null?void 0:a.cross_chain_router,src:{fromToken:t.src_infos.from_token,fromAmount:BigInt(t.src_infos.from_amount),bridgeToken:t.src_infos.bridge_token,minBridgeAmount:BigInt(t.src_infos.min_bridge_amount)},dst:{chainId:t.dst_infos.chain_id,bridgedToken:t.dst_infos.bridged_token,toToken:t.dst_infos.to_token,minToAmount:BigInt(t.dst_infos.min_to_amount),orderlyNativeFees:u}}).then(_=>{b(_),U.success(d("transfer.deposit.requested")),x.emit("deposit:requested")}).catch(_=>{m(1),U.error((_==null?void 0:_.message)||"Error")})):Promise.reject("No transaction data")),[t,s,r,o,x]),A=p.useMemo(()=>{if(!(c<2||!v))return`https://layerzeroscan.com/tx/${v.srcTxHash}`},[c,v]);return n.jsxs(W,{intensity:800,children:[n.jsx(Lr,{viewMode:y,onConfirm:O,info:I,src:e.src,dst:e.dst,mode:s,markPrice:((k=t.mark_prices)==null?void 0:k.from_token)??1,nativePrice:t.mark_prices.native_token,nativeToken:l}),y==="processing"&&n.jsx(Dr,{mode:1,status:c,statusUrl:A,onComplete:e.onComplete,brokerName:e.brokerName}),n.jsx(Er,{})]})},ed=()=>{let[e,{setTrue:t,setFalse:i}]=Ct(!1),s=fn(),r=Ne("brokerId"),[o,a]=p.useState(yt.NO),l=p.useRef(),u=at();p.useEffect(()=>{let c=m=>{let{side:y,transStatus:j,trxId:f}=m;y==="DEPOSIT"&&f===l.current&&a(j)};return u.on("wallet:changed",c),()=>{u.off("wallet:changed",c)}},[l.current]);let d=p.useCallback(()=>({accountId:s.accountIdHashStr,brokerHash:nt.parseBrokerHash(r),tokenHash:nt.parseTokenHash("USDC")}),[s,r]);return{swap:p.useCallback(async(c,m,y)=>{if(!s.walletAdapter)throw new Error("walletAdapter is undefined");if(!s.address)throw new Error("account.address is undefined");if(e)return;t();let j={from:s.address,to:c,data:[s.address,m,d()],value:kr(m.fromToken)?BigInt(m.fromAmount)+m.orderlyNativeFees:m.orderlyNativeFees};try{let f=await s.walletAdapter.sendTransaction(c,"swap",j,{abi:Uu});return i(),l.current=f.hash,u.emit("deposit:requested"),Ns(["from","to","hash","value"],f)}catch(f){throw new Error(f.errorCode)}},[e,s]),loading:e,status:o}},td=e=>{var O;let{transactionData:t,slippage:i,mode:s,dst:r,src:o,chain:a,nativeToken:l,depositFee:u}=e,{t:d}=S(),[c,m]=p.useState(-1),[y,j]=p.useState("details"),[f,b]=p.useState(),x=at(),{swap:C,status:w}=ed(),v=p.useMemo(()=>{var A,k;return{price:t.price,slippage:i,time:a==null?void 0:a.est_txn_mins,received:r.amount,dstGasFee:(k=(A=new T(u.toString()))==null?void 0:A.div(new T(10).pow(18)))==null?void 0:k.toString(),swapFee:t.fees_from}},[t,a==null?void 0:a.est_txn_mins,s,r,u]);p.useEffect(()=>{w===yt.COMPLETED&&m(4),w===yt.FAILED&&m(3)},[w]);let N=p.useCallback(()=>(j("processing"),t?!a||!a.depositor?Promise.reject("No chain data"):(m(2),C(a.depositor,{fromToken:t.infos.from_token,fromAmount:t.infos.from_amount,toToken:t.infos.to_token,minToAmount:t.infos.min_to_amount,orderlyNativeFees:u},{dst:r,src:o}).then(A=>{b(A),U.success(d("transfer.deposit.requested")),x.emit("deposit:requested")}).catch(A=>{m(3),U.error((A==null?void 0:A.message)||"Error")})):Promise.reject("No transaction data")),[t,s,r,o,x]),I=p.useMemo(()=>{if(!(c<2||!f))return`${a==null?void 0:a.explorer_base_url}/tx/${f.hash}`},[c,f,a]);return n.jsxs(W,{intensity:800,children:[n.jsx(Lr,{viewMode:y,onConfirm:N,info:v,src:e.src,dst:e.dst,mode:s,markPrice:((O=t.mark_prices)==null?void 0:O.from_token)??1,nativePrice:t.mark_prices.native_token,nativeToken:l}),y==="processing"&&n.jsx(Dr,{mode:0,status:c,statusUrl:I,onComplete:e.onComplete,brokerName:e.brokerName}),n.jsx(Er,{})]})},nd=e=>{let{mode:t}=e;return t===1?n.jsx(Zu,{...e}):n.jsx(td,{...e})},id=he.create(e=>{let{isMobile:t}=_t(),{t:i}=S(),{visible:s,hide:r,resolve:o,reject:a,onOpenChange:l}=pn(),u=m=>{o(m),r()},d=()=>{a(),r()},c={title:i("transfer.swapDeposit.swapDialog.title"),open:s,onOpenChange:l,classNames:{content:"oui-font-semibold"},children:n.jsx(nd,{...e,onComplete:u,onCancel:d})};return t?n.jsx(ai,{...c}):n.jsx(vt,{...c,size:"md"})}),sd=()=>{let[e,{setTrue:t,setFalse:i}]=Ct(!1),s=Ne("brokerId"),r=fn(),o=p.useCallback(()=>({accountId:r.accountIdHashStr,brokerHash:nt.parseBrokerHash(s),tokenHash:nt.parseTokenHash("USDC")}),[r,s]),a=p.useCallback(async(l,u)=>{if(!r.walletAdapter)throw new Error("walletAdapter is not ready");let d=await r.walletAdapter.call(l,"quoteLayerZeroFee",[r.address,u,o()],{abi:si});return nt.formatByUnits(d[0])},[]);return{query:p.useCallback(l=>{if(e)return Promise.resolve();t();let u={src_network:l.srcNetwork,dst_network:"arbitrum",src_token:l.srcToken,dst_token:l.dstToken,src_amount:l.amount,slippage:l.slippage||1},d=Object.entries(u).map(([c,m])=>`${c}=${encodeURIComponent(m)}`).join("&");return fetch(`${Or}/woofi_dex/cross_chain_swap?${d}`).then(c=>c.ok?c.json():c.json().then(m=>{throw new Error(m.error.message)})).then(c=>{if(c.status==="ok")return c.data;throw new Error(c.message)}).then(c=>a(l.crossChainRouteAddress,{chainId:c.dst_infos.chain_id,bridgedToken:c.dst_infos.bridged_token,toToken:c.dst_infos.to_token,minToAmount:BigInt(c.dst_infos.min_to_amount),orderlyNativeFees:0n}).then(m=>({...c,dst_infos:{...c.dst_infos,gas_fee:m}})).catch(m=>{console.error("queryDestinationFee error",m)})).finally(()=>i())},[e,r]),loading:e}},rd=()=>{let e=fn(),[t,{setTrue:i,setFalse:s}]=Ct(!1);return{query:p.useCallback(r=>{if(t)return Promise.resolve();i();let o={network:r.srcNetwork,from_token:r.srcToken,to_token:r.dstToken,from_amount:r.amount,slippage:r.slippage||1},a=Object.entries(o).map(([l,u])=>`${l}=${encodeURIComponent(u)}`).join("&");return fetch(`${Or}/woofi_dex/swap?${a}`).then(l=>l.ok?l.json():l.json().then(u=>{throw new Error(u.error.message)})).then(l=>{if(l.status==="ok")return l.data;throw new Error(l.message)}).finally(()=>s())},[e]),loading:t}};function od(e){let{quantity:t,dst:i,queryParams:s,needSwap:r,needCrossSwap:o}=e,{t:a}=S(),{query:l}=rd(),{query:u}=sd(),d=p.useRef(s);d.current=s;let[c,m]=p.useState(""),[y,j]=p.useState(""),[f,{setTrue:b,setFalse:x}]=Ct(!1),[C,w]=p.useState({price:0,markPrices:{from_token:0,native_token:0},fee:""}),v=p.useCallback(()=>o?u(d.current):r?l(d.current):Promise.reject("no need to enquiry"),[r,o]),N=k=>{if(k.mark_prices){let _=o?k.dst_infos.gas_fee:"0",D=o?k.fees_from.woofi:k.fees_from,M=o?k.fees_from.stargate:void 0,L=o?k.fees_from.total:k.fees_from;w({price:k.price,markPrices:k.mark_prices,dstGasFee:_,swapFee:D,bridgeFee:M,fee:L})}if(k.route_infos){let _=o?k.route_infos.dst.amounts[1]:k.route_infos.amounts[1];m(new T(_).div(Math.pow(10,i.decimals)).toString())}return j(""),k},I=k=>{w({fee:"0",markPrices:{from_token:0,native_token:0},price:0,swapFee:"0",bridgeFee:"0",dstGasFee:"0",...k}),m("")},O=k=>{k.message==="contract call failed"?(j(a("transfer.swapDeposit.notEnoughLiquidity")),I()):(j(""),k!=null&&k.message&&U.error(k.message))},A=ws(()=>(b(),v().then(N,O).finally(()=>{x()})),300);return p.useEffect(()=>{if(!r&&!o){I({price:1}),m(t);return}let k=Number(t);if(isNaN(k)||k<=0){I();return}A()},[r,o,t]),{enquiry:v,querying:f,warningMessage:y,transactionInfo:C,amount:c,cleanTransactionInfo:I}}function ad(e){let{nativeToken:t,isNativeToken:i,src:s,depositFee:r=0,transactionInfo:o,needSwap:a,needCrossSwap:l}=e,u=t==null?void 0:t.symbol,d=s==null?void 0:s.symbol,{fee:c="0",swapFee:m="0",bridgeFee:y="0",dstGasFee:j="0",markPrices:f}=o,{from_token:b,native_token:x}=f,{data:C}=Ls(`SPOT_${u}_USDC`),{t:w}=S();return{...p.useMemo(()=>{let v="",N=[],I=Mt(t==null?void 0:t.precision),O=Mt(s==null?void 0:s.precision),A=l?j:new T(r.toString()).div(new T(10).pow(18)).toString();if(!a&&!l&&(N=[{value:A,dp:I}],v=new T(A).mul(C||0).toString()),a||l)if(i){let _=new T(A).plus(c);N=[{value:_.toString(),dp:I}],v=_.mul(x??1).toString()}else N=[{value:A,dp:I,symbol:u},{value:c,dp:O,symbol:d}],v=new T(A).mul(x??1).plus(new T(c).mul(b??1)).toString();N=N.filter(_=>!!_.value&&Number(_.value)!==0);let k=[{title:w("transfer.deposit.destinationGasFee"),description:w("transfer.deposit.destinationGasFee.description"),value:A,dp:I,symbol:u},{title:w("transfer.swapDeposit.swapFee"),description:w("transfer.swapDeposit.swapFee.description"),value:m,dp:O,symbol:d},{title:w("transfer.swapDeposit.bridgeFee"),description:w("transfer.swapDeposit.bridgeFee.description"),value:y,dp:O,symbol:d}].filter((_,D)=>D===0||!!_.value&&Number(_.value)!==0).map(_=>{let D=new T(_.value||0).todp(_.dp).toNumber();return{..._,value:ea(D)}});return{feeAmount:v,feeQtys:N,feeDetails:k}},[r,C,u,d,o,a,l]),nativeSymbol:u}}var ld="orderly_swap_deposit_slippage",ud=e=>{var _,D,M,L,F;let{srcToken:t,currentChain:i,dst:s,quantity:r,isNativeToken:o,depositFee:a,setQuantity:l,needSwap:u,needCrossSwap:d}=e,[c,m]=De(ld,1),y=Ne().get("brokerName")||"",{enquiry:j,transactionInfo:f,amount:b,querying:x,warningMessage:C,cleanTransactionInfo:w}=od({quantity:r,dst:s,queryParams:{network:s.network,srcNetwork:(D=(_=i==null?void 0:i.info)==null?void 0:_.network_infos)==null?void 0:D.shortName,srcToken:t==null?void 0:t.address,dstToken:s.address,crossChainRouteAddress:(L=(M=i==null?void 0:i.info)==null?void 0:M.network_infos)==null?void 0:L.cross_chain_router,amount:new T(r||0).mul(10**((t==null?void 0:t.decimals)||0)).toString(),slippage:c},needSwap:u,needCrossSwap:d}),v=p.useCallback(()=>{l(""),w()},[l]),N=p.useCallback(async()=>j().then(z=>{var ne,B,$,Y;let R=d?(ne=z.route_infos)==null?void 0:ne.dst.amounts[1]:(B=z.route_infos)==null?void 0:B.amounts[1],H={mode:d?1:0,src:{chain:i==null?void 0:i.id,token:t.symbol,displayDecimals:t==null?void 0:t.precision,amount:r,decimals:t.decimals},dst:{chain:s.chainId,token:s.symbol,displayDecimals:2,amount:new T(R).div(Math.pow(10,s.decimals)).toString(),decimals:s.decimals},chain:($=i==null?void 0:i.info)==null?void 0:$.network_infos,nativeToken:(Y=i==null?void 0:i.info)==null?void 0:Y.nativeToken,depositFee:a,transactionData:z,slippage:c,brokerName:y};return he.show(id,H)}).then(z=>{z&&v()}).catch(z=>{}),[r,d,s,i,c,a]),I=p.useMemo(()=>d||u?f.price:1,[f]),O=p.useMemo(()=>d||u?o?f.markPrices.native_token:f.markPrices.from_token:1,[u,d,o,f]),A=u||d?b:r,k=ad({nativeToken:(F=i==null?void 0:i.info)==null?void 0:F.nativeToken,isNativeToken:o,src:t,depositFee:a,transactionInfo:f,needSwap:u,needCrossSwap:d});return{cleanTransactionInfo:w,onSwapDeposit:N,swapPrice:I,markPrice:O,swapQuantity:A,swapFee:k,swapRevalidating:x,warningMessage:C,needSwap:u,needCrossSwap:d,slippage:c,onSlippageChange:m}};function dd(e){let{isNativeToken:t,allowance:i,quantity:s,maxQuantity:r}=e;return p.useMemo(()=>{let o=t?Number.MAX_VALUE:Number(i);if(o<=0)return 1;let a=Number(s),l=Number(r);return o<a&&a<=l?2:0},[t,i,s,r])}function cd(){let{t:e}=S(),t=Ne("networkId"),[i]=De("orderly_link_device",{}),{connectedChain:s,settingChain:r,setChain:o}=hn(),[a,{findByChainId:l}]=ui(t,{pick:"network_infos",filter:c=>{var m,y;return((m=c.network_infos)==null?void 0:m.bridge_enable)||((y=c.network_infos)==null?void 0:y.bridgeless)}}),u=p.useMemo(()=>{let c=s?Ss(s.id):parseInt(i==null?void 0:i.chainId);if(!c)return null;let m=l(c);return{...s,id:c,info:m}},[l,s,i]),d=p.useCallback(async c=>{var y,j;let m=l(c.chain_id);if(s)return!m||((y=m.network_infos)==null?void 0:y.chain_id)===(u==null?void 0:u.id)?Promise.resolve():o({chainId:Ts(Number((j=m.network_infos)==null?void 0:j.chain_id))}).then(f=>{f?U.success(e("connector.networkSwitched")):U.error(e("connector.switchChain.failed"))}).catch(f=>{f&&f.message&&U.error(`${e("connector.switchChain.failed")}: ${f.message}`)})},[u,o,l]);return{chains:a,currentChain:u,settingChain:r,onChainChange:d}}function pd(e){let{quantity:t,allowance:i,approve:s,deposit:r,enableCustomDeposit:o,customDeposit:a,onSuccess:l}=e,[u,d]=p.useState(!1),c=at(),{t:m}=S(),y=p.useCallback(async()=>{if(!u)return d(!0),s(t).then(b=>{U.success(m("transfer.deposit.approve.success"))}).catch(b=>{console.error("approve error",b),U.error(b.message||b.errorCode||m("transfer.deposit.approve.failed"))}).finally(()=>{d(!1)})},[s,u,t,i,m]),j=p.useCallback(async()=>r().then(b=>{U.success(m("transfer.deposit.requested")),c.emit("deposit:requested"),l==null||l()}).catch(b=>{console.error("deposit error",b),U.error(b.message||m("transfer.deposit.failed"))}),[r,l,m]),f=p.useCallback(()=>{var x,C;let b=Number(t);if(isNaN(b)||b<=0){U.error(m("transfer.quantity.invalid"));return}u||(d(!0),(C=(x=o?a:j)==null?void 0:x())==null||C.finally(()=>{d(!1)}))},[t,u,j,o,a,m]);return{submitting:u,onApprove:y,onDeposit:f}}function md(e){let{quantity:t,maxQuantity:i}=e,{t:s}=S(),[r,o]=p.useState("default"),[a,l]=p.useState();return p.useEffect(()=>{if(!t){o("default"),l("");return}new T(t).gt(i)?(o("error"),l(s("transfer.insufficientBalance"))):(o("default"),l(""))},[t,i]),{inputStatus:r,hintMessage:a}}var Ar=(e,t=()=>!0)=>{let[i,s]=p.useState(),[r,o]=p.useState(),[a,l]=p.useState([]),[u,d]=p.useState([]),c=Ne("networkId"),m=p.useCallback(y=>{var j,f;if(y&&((j=y==null?void 0:y.token_infos)==null?void 0:j.length)>0){let b=(f=y.token_infos)==null?void 0:f.filter(t);b!=null&&b.length&&b.sort((C,w)=>C.symbol==="USDC"?-1:w.symbol==="USDC"?1:0);let x=Gu(b);if(!x)return;s(x),o(x),l(b),d([x])}},[]);return p.useEffect(()=>{m(e==null?void 0:e.info)},[e,m]),p.useEffect(()=>{if(!i||!a.length)return;if(i.symbol==="USDC"){o(i),d([i]);return}let y=a.find(j=>j.symbol==="USDC");if(i.is_collateral){c==="mainnet"&&i.swap_enable?(o(i),d([i,y])):(o(i),d([i]));return}o(y),d([y])},[c,i,a]),{sourceToken:i,targetToken:r,sourceTokens:a,targetTokens:u,onSourceTokenChange:s,onTargetTokenChange:o}},{collateralRatio:hd,collateralContribution:fd,calcMinimumReceived:xd}=mn,ri=3,gd=e=>{var Ai,qi,Ri,Mi,Fi;let{wrongNetwork:t}=jn(),{t:i}=S(),s=Ne("networkId"),{chains:r,currentChain:o,settingChain:a,onChainChange:l}=cd(),{sourceToken:u,targetToken:d,sourceTokens:c,targetTokens:m,onSourceTokenChange:y,onTargetTokenChange:j}=Ar(o),f=p.useMemo(()=>c==null?void 0:c.find(Xe=>Xe.symbol==="USDC"),[c]),{dst:b,balance:x,allowance:C,depositFeeRevalidating:w,depositFee:v,quantity:N,setQuantity:I,approve:O,deposit:A,isNativeToken:k,balanceRevalidating:_,fetchBalance:D}=zo({address:u==null?void 0:u.address,decimals:u==null?void 0:u.decimals,srcChainId:o==null?void 0:o.id,srcToken:u==null?void 0:u.symbol,dstToken:d==null?void 0:d.symbol,crossChainRouteAddress:(qi=(Ai=o==null?void 0:o.info)==null?void 0:Ai.network_infos)==null?void 0:qi.cross_chain_router,depositorAddress:(Mi=(Ri=o==null?void 0:o.info)==null?void 0:Ri.network_infos)==null?void 0:Mi.depositor}),M=p.useMemo(()=>new T(x||0).todp((u==null?void 0:u.precision)??2,T.ROUND_DOWN).toString(),[x,u==null?void 0:u.precision]),{inputStatus:L,hintMessage:F}=md({quantity:N,maxQuantity:M}),{needSwap:z,needCrossSwap:R}=zu({srcToken:u,dstToken:d,srcChainId:o==null?void 0:o.id,dstChainId:b==null?void 0:b.chainId}),{cleanTransactionInfo:H,onSwapDeposit:ne,swapRevalidating:B,swapPrice:$,markPrice:Y,swapQuantity:V,swapFee:le,warningMessage:xe,slippage:Se,onSlippageChange:Ae}=ud({srcToken:u,currentChain:o,dst:b,quantity:N,isNativeToken:k,depositFee:v,setQuantity:I,needSwap:z,needCrossSwap:R}),Te=p.useCallback(()=>{I(""),H()},[I]),qe=p.useCallback(()=>{var Xe;Te(),(Xe=e.onClose)==null||Xe.call(e)},[Te,e.onClose]),{submitting:Be,onApprove:ae,onDeposit:de}=pd({quantity:N,allowance:C,approve:O,deposit:A,enableCustomDeposit:z||R,customDeposit:ne,onSuccess:qe}),Ie=p.useMemo(()=>(u==null?void 0:u.symbol)==="USDC"||(u==null?void 0:u.symbol)!==(d==null?void 0:d.symbol)||!(u!=null&&u.is_collateral)||!N||isNaN(Number(N))?"":new T(N).gt(u==null?void 0:u.user_max_qty)?i("transfer.deposit.userMaxQty.error",{maxQty:u==null?void 0:u.user_max_qty,token:u==null?void 0:u.symbol}):"",[u,d,N,i]),It=Be||w,Q=!N||Number(N)===0||!u||L==="error"||w||B||!!Ie,oe=p.useMemo(()=>new T(N||0).mul(1).toNumber(),[N]),Pe=dd({isNativeToken:k,allowance:C,quantity:N,maxQuantity:M}),Lt=yd({nativeToken:(Fi=o==null?void 0:o.info)==null?void 0:Fi.nativeToken,depositFee:v}),{collateralRatio:An,collateralContributionQuantity:qn,currentLTV:K,nextLTV:me,indexPrice:Re}=bd({sourceToken:u,targetToken:d,qty:N}),{ltv_threshold:dt,negative_usdc_threshold:He,isLoading:_o}=jd();p.useEffect(()=>{Te()},[u,o==null?void 0:o.id]);let vo=p.useMemo(()=>{if(k&&M===N)return i("transfer.deposit.gasFee.error",{token:u==null?void 0:u.symbol})},[M,N,u==null?void 0:u.symbol,i]),Co=xe||Ie||vo,No=p.useMemo(()=>{var Xe;return z?V&&((Xe=new T(V))==null?void 0:Xe.todp(ri,T.ROUND_DOWN).toString()):N},[z,V,N]),So=p.useMemo(()=>V?xd({amount:Number(V),slippage:Se}):"-",[V,Se]);return{sourceToken:u,targetToken:d,sourceTokens:c,targetTokens:m,onSourceTokenChange:y,onTargetTokenChange:j,amount:oe,isNativeToken:k,quantity:N,collateralContributionQuantity:qn,maxQuantity:M,indexPrice:Re,onQuantityChange:I,hintMessage:F,inputStatus:L,chains:r,currentChain:o,settingChain:a,onChainChange:l,actionType:Pe,onDeposit:de,onApprove:ae,fetchBalance:D,dst:b,wrongNetwork:t,balanceRevalidating:_,loading:It,disabled:Q,networkId:s,fee:Lt,collateralRatio:An,currentLTV:K,nextLTV:me,ltv_threshold:dt,negative_usdc_threshold:He,isConvertThresholdLoading:_o,slippage:Se,onSlippageChange:Ae,minimumReceived:So,usdcToken:f,needSwap:z,needCrossSwap:R,swapPrice:$,markPrice:Y,swapFee:le,warningMessage:Co,targetQuantity:No,targetQuantityLoading:B}};function yd(e){let{nativeToken:t,depositFee:i=0}=e,{account:s}=Fe(),r=t==null?void 0:t.symbol,o=Is(r),{data:a}=Ls(`SPOT_${r}_USDC`);return{...p.useMemo(()=>{var d;let l=new T(i.toString()).div(new T(10).pow(((d=s.walletAdapter)==null?void 0:d.chainNamespace)===Go.solana?9:18)).toString(),u=new T(l).mul(a||0).toString();return{dstGasFee:l,feeQty:l,feeAmount:u,dp:(o==null?void 0:o.decimals)||8}},[i,a]),nativeSymbol:r}}var bd=e=>{let{sourceToken:t,targetToken:i}=e,s=Number(e.qty),{data:r}=Xo(),o=p.useMemo(()=>{if((t==null?void 0:t.symbol)==="USDC")return 1;let c=`PERP_${t==null?void 0:t.symbol}_USDC`;return r[c]??0},[t==null?void 0:t.symbol,r]),a=p.useMemo(()=>hd({baseWeight:(i==null?void 0:i.base_weight)??0,discountFactor:(i==null?void 0:i.discount_factor)??0,collateralQty:s,collateralCap:(t==null?void 0:t.user_max_qty)??s,indexPrice:o}),[i,s,t==null?void 0:t.user_max_qty,o]),l=fd({collateralQty:s,collateralCap:(t==null?void 0:t.user_max_qty)??s,collateralRatio:a.toNumber(),indexPrice:o}),u=on(),d=on({input:s,token:t==null?void 0:t.symbol});return{collateralRatio:a.toNumber(),collateralContributionQuantity:l,currentLTV:u,nextLTV:d,indexPrice:o}},jd=()=>{let{data:e,error:t,isLoading:i}=di("/v1/public/auto_convert_threshold",{errorRetryCount:3});return{ltv_threshold:e==null?void 0:e.ltv_threshold,negative_usdc_threshold:e==null?void 0:e.negative_usdc_threshold,isLoading:i,error:t}},wd=e=>{let{sourceToken:t,targetToken:i,sourceTokens:s,targetTokens:r,onSourceTokenChange:o,onTargetTokenChange:a,amount:l,quantity:u,collateralContributionQuantity:d,maxQuantity:c,onQuantityChange:m,hintMessage:y,inputStatus:j,chains:f,currentChain:b,settingChain:x,onChainChange:C,actionType:w,onDeposit:v,onApprove:N,fetchBalance:I,wrongNetwork:O,balanceRevalidating:A,loading:k,disabled:_,networkId:D,fee:M,collateralRatio:L,currentLTV:F,nextLTV:z,slippage:R,onSlippageChange:H,minimumReceived:ne,needSwap:B,needCrossSwap:$,swapPrice:Y,swapFee:V,warningMessage:le,usdcToken:xe,targetQuantity:Se,targetQuantityLoading:Ae}=e,{t:Te}=S(),qe=()=>B||$?n.jsxs(g,{direction:"column",itemAlign:"start",mt:1,gapY:1,children:[n.jsxs(g,{width:"100%",itemAlign:"center",justify:"between",children:[n.jsx(h,{size:"2xs",intensity:36,children:Te("transfer.deposit.convertRate")}),n.jsx(Tr,{sourceSymbol:(t==null?void 0:t.display_name)||(t==null?void 0:t.symbol),targetSymbol:(i==null?void 0:i.display_name)||(i==null?void 0:i.symbol),precision:ri,indexPrice:Y})]}),n.jsx(Sr,{value:R,onValueChange:H}),n.jsx(Nr,{value:ne,symbol:(i==null?void 0:i.symbol)??"",precision:ri}),n.jsx(Au,{...V})]}):n.jsxs(g,{direction:"column",itemAlign:"start",mt:2,gap:1,children:[n.jsx(ku,{value:L}),n.jsx(Nu,{precision:(xe==null?void 0:xe.precision)??6,value:d}),n.jsx(jr,{showDiff:typeof u<"u"&&Number(u)>0,currentLtv:F,nextLTV:z}),n.jsx(Cr,{...M})]});return n.jsxs(W,{id:"oui-deposit-form",className:bt({weight:"semibold"}),children:[n.jsxs(W,{className:"oui-mb-6 lg:oui-mb-8",children:[n.jsx($u,{}),n.jsxs(W,{mt:3,mb:1,children:[n.jsx(vr,{chains:f,value:b,onValueChange:C,wrongNetwork:O,loading:x}),n.jsx(rt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},value:u,onValueChange:m,token:t,tokens:s,onTokenChange:o,status:j,hintMessage:y,fetchBalance:I,"data-testId":"oui-testid-deposit-dialog-quantity-input"})]}),n.jsx(kn,{token:t,amount:l,maxQuantity:c,loading:A,onClick:()=>{m(c)}}),n.jsx(On,{}),n.jsx(wr,{}),n.jsx(rt,{readOnly:!0,token:i,tokens:r,onTokenChange:a,value:Se,loading:Ae,classNames:{root:"oui-mt-3 oui-border-transparent focus-within:oui-outline-transparent"}}),qe()]}),n.jsx(Fu,{sourceToken:t==null?void 0:t.symbol,targetToken:i==null?void 0:i.symbol,className:"oui-mb-3"}),n.jsx(Eu,{message:le,needSwap:B,needCrossSwap:$,wrongNetwork:O,networkId:D}),n.jsx(g,{justify:"center",children:n.jsx(wu,{actionType:w,symbol:t==null?void 0:t.symbol,disabled:_,loading:k,onDeposit:v,onApprove:N,networkId:D})})]})},_d=e=>{let t=gd(e);return n.jsx(wd,{...t})},vd=e=>{let{value:t,onChange:i,status:s,hintMessage:r,placeholder:o,label:a}=e,l=p.useRef(null),u=m=>{i==null||i(m.target.value);let y=l.current;y&&(y.style.height="auto",y.style.height=`${y.scrollHeight}px`)};p.useEffect(()=>{let m=l.current;m&&(m.style.height="auto",m.style.height=`${m.scrollHeight}px`)},[t]);let d=n.jsx("div",{className:"oui-absolute oui-left-3 oui-top-0.5 oui-z-[1]",children:n.jsx(h,{size:"2xs",intensity:36,children:a})}),c=n.jsxs(g,{mt:1,gapX:1,px:1,children:[n.jsx(W,{width:4,height:4,r:"full",className:E(s==="error"&&"oui-bg-danger-light",s==="warning"&&"oui-bg-warning-light")}),n.jsx(h,{size:"2xs",className:E(s==="error"&&"oui-text-danger-light",s==="warning"&&"oui-text-warning-light"),children:r})]});return n.jsxs("div",{className:"oui-relative",children:[d,n.jsx("textarea",{ref:l,placeholder:o,className:E("oui-resize-none oui-overflow-y-hidden","oui-relative oui-min-h-[54px] oui-px-3 oui-pb-2 oui-pt-5","oui-w-full oui-bg-base-5 oui-text-sm oui-text-base-contrast","oui-rounded-lg oui-outline-none","oui-border oui-border-line focus:oui-border-primary-light",s==="error"&&"oui-border-danger-light focus-within:oui-border-danger-light focus:oui-border-danger-light",s==="warning"&&"oui-border-warning-light focus-within:oui-border-warning-light focus:oui-border-warning-light",e.className),rows:1,value:t,onChange:u}),r&&c]})},qr=e=>{let{hasPositions:t,unsettledPnl:i,onSettlePnl:s,tooltipContent:r,dialogContent:o}=e,{t:a}=S();if(i===0&&!t)return n.jsx(n.Fragment,{});let l=()=>{he.confirm({title:a("settle.settlePnl"),content:o,onOk:()=>s()})};return n.jsxs(g,{justify:"between",className:"oui-text-2xs oui-text-base-contrast-36",children:[n.jsxs(g,{itemAlign:"center",justify:"start",gap:1,children:[n.jsx(Le,{className:"oui-max-w-[274px] oui-font-semibold",content:r,children:n.jsxs(g,{itemAlign:"center",justify:"start",gap:1,children:[n.jsx(Yo,{size:14,className:"oui-text-warning-darken"}),n.jsx(h,{className:"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:`${a("settle.unsettled")}:`})]})}),n.jsx(h.numeral,{showIdentifier:!0,coloring:!0,weight:"semibold",dp:6,"data-testid":"oui-testid-withdraw-dialog-unsettledPnl-value",children:i}),n.jsx(h,{children:"USDC"})]}),n.jsxs(g,{itemAlign:"center",gap:1,className:"oui-cursor-pointer",children:[n.jsx(vu,{className:"oui-text-primary"}),n.jsx(h,{"data-testid":"oui-testid-withdraw-dialog-settle-text",size:"2xs",color:"primary",className:" oui-select-none",onClick:l,children:a("common.settle")})]})]})},Cd=({address:e,amount:t,currentChain:i})=>{let{t:s}=S(),r=p.useMemo(()=>{if(i&&i.info&&i.info.network_infos)return i.info.network_infos.name},[i]);return n.jsxs(g,{direction:"column",itemAlign:"start",justify:"start",className:"oui-gap-1 lg:oui-gap-3",children:[n.jsxs(g,{direction:"column",itemAlign:"start",mb:5,className:"oui-gap-3 lg:oui-gap-4",children:[n.jsxs(g,{direction:"column",justify:"start",itemAlign:"start",children:[n.jsx(h,{size:"2xs",intensity:36,children:s("transfer.withdraw.crossChain.recipientAddress")}),n.jsx(h,{size:"sm",intensity:98,className:"oui-break-all",children:e})]}),n.jsxs(g,{direction:"column",justify:"start",itemAlign:"start",children:[n.jsx(h,{size:"2xs",intensity:36,children:s("transfer.withdraw.crossChain.recipientNetwork")}),n.jsxs(g,{gap:1,children:[n.jsx(Xn,{className:"oui-h-[18px] oui-w-[18px]",size:"sm",chainId:i.id}),n.jsx(h,{size:"sm",intensity:98,children:r})]})]}),n.jsxs(g,{direction:"column",justify:"start",itemAlign:"start",children:[n.jsx(h,{size:"2xs",intensity:36,children:`${s("transfer.withdraw.crossChain.withdrawAmount")} (USDC)`}),n.jsx(h.numeral,{size:"sm",intensity:98,dp:2,children:t})]})]}),n.jsx(g,{justify:"center",className:"oui-text-warning-darken oui-text-2xs lg:oui-text-xs oui-text-center",mb:3,children:s("transfer.withdraw.crossChain.warning")})]})};function Nd(e){let{t}=S(),i=()=>{he.show(Hs,{networkId:e.networkId,bridgeLessOnly:!0}).then(s=>{U.success(t("connector.networkSwitched"))},s=>console.log("[switchChain error]",s))};return n.jsx(g,{direction:"column",children:n.jsx(te,{color:"warning",size:e.size,fullWidth:!0,onClick:()=>{i()},children:t("connector.switchNetwork")})})}var Sd=e=>{let{disabled:t,loading:i,onWithdraw:s,networkId:r,crossChainWithdraw:o,address:a,currentChain:l,quantity:u,fee:d,checkIsBridgeless:c,onTransfer:m}=e,{t:y}=S(),j=p.useMemo(()=>u?new T(u).minus(d??0).toNumber():0,[u,d]),f=()=>{if(o){he.confirm({title:y("transfer.withdraw.crossChain.confirmWithdraw"),content:n.jsx(Cd,{address:a,amount:j,currentChain:l}),classNames:{content:"oui-font-semibold",body:"!oui-pb-0",footer:"!oui-pt-0"},onOk:async()=>{s()}});return}s()},b={initial:"md",lg:"lg"},x=()=>e.withdrawTo==="accountId"?n.jsx(te,{fullWidth:!0,disabled:t,loading:i,onClick:m,size:b,children:y("common.withdraw")}):c?n.jsx(te,{"data-testid":"oui-testid-withdraw-dialog-withdraw-btn",fullWidth:!0,disabled:t,loading:i,onClick:f,size:b,children:y("common.withdraw")}):n.jsx(Nd,{networkId:r,size:b});return n.jsx(W,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:n.jsx(bn,{status:Me.EnableTrading,networkId:r,bridgeLessOnly:!0,buttonProps:{fullWidth:!0,size:b},children:x()})})},Td=({checkIsBridgeless:e,quantity:t,chainVaultBalance:i,currentChain:s,maxAmount:r,crossChainTrans:o})=>{let{t:a}=S(),{wrongNetwork:l}=jn(),{state:u}=Fe(),d=p.useMemo(()=>{if(s&&s.info&&s.info.network_infos)return s.info.network_infos.name},[s]),c=p.useMemo(()=>!i||!r||!t||new T(t).gt(r)?!1:!!new T(t).gt(i),[t,i]),m=(()=>{if(u.status!==Me.NotConnected){if(o)return a("transfer.withdraw.crossChain.process");if(c)return a("transfer.withdraw.crossChain.vaultWarning",{networkName:d,chainVaultBalance:i})}})();return m?n.jsx(g,{className:"oui-text-warning-darken oui-text-xs oui-justify-center oui-text-center",mb:3,children:m}):null},Pd=e=>{let{address:t,loading:i,disabled:s,quantity:r,onQuantityChange:o,sourceToken:a,amount:l,maxQuantity:u,tokenChains:d,currentChain:c,fee:m,settingChain:y,chainVaultBalance:j,crossChainTrans:f,checkIsBridgeless:b,withdrawTo:x,sourceTokens:C,onSourceTokenChange:w,vaultBalanceList:v}=e,{t:N}=S();return n.jsxs(W,{id:"oui-withdraw-form",className:bt({weight:"semibold"}),children:[n.jsxs(W,{className:"oui-mb-6 lg:oui-mb-8",children:[n.jsx(wr,{}),n.jsx(W,{mt:3,mb:1,children:n.jsx(rt,{value:r,onValueChange:o,token:a,tokens:C,onTokenChange:w,status:e.inputStatus,hintMessage:e.hintMessage,vaultBalanceList:v,testId:"oui-testid-withdraw-dialog-quantity-input",displayType:"vaultBalance"})}),n.jsx(kn,{token:a,amount:l,maxQuantity:u.toString(),loading:e.balanceRevalidating,onClick:()=>{o(u.toString())}}),n.jsx(W,{mx:2,mt:1,children:n.jsx(qr,{unsettledPnl:e.unsettledPnL,hasPositions:e.hasPositions,onSettlePnl:e.onSettlePnl,tooltipContent:N("settle.unsettled.tooltip"),dialogContent:n.jsx(Qe,{i18nKey:"settle.settlePnl.description"})})}),n.jsx(On,{}),n.jsxs(li,{value:x,onValueChange:e.setWithdrawTo,variant:"contained",size:"lg",classNames:{tabsList:"oui-px-0",tabsContent:"oui-pt-3"},children:[n.jsxs(Ue,{title:N("transfer.web3Wallet.my"),icon:n.jsx(Ps,{size:"xs",name:e.walletName??""}),value:"wallet",children:[n.jsx(vr,{chains:d,value:c,onValueChange:e.onChainChange,wrongNetwork:e.wrongNetwork,loading:y}),n.jsx(rt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},token:a,value:e.showQty,readOnly:!0})]}),n.jsxs(Ue,{title:N("transfer.withdraw.otherAccount",{brokerName:e.brokerName}),value:"accountId",children:[n.jsx(vd,{label:N("common.accountId"),value:e.toAccountId,onChange:e.setToAccountId,status:e.toAccountIdInputStatus,hintMessage:e.toAccountIdHintMessage}),n.jsx(W,{my:2,children:n.jsx(h,{size:"xs",intensity:54,children:N("transfer.withdraw.accountId.tips")})})]})]}),n.jsx(g,{direction:"column",mt:1,gapY:1,itemAlign:"start",children:n.jsxs(h,{size:"xs",intensity:36,children:[N("common.fee"),x==="wallet"?n.jsxs(n.Fragment,{children:[" ≈ ",n.jsx(h,{size:"xs",intensity:80,children:m})]}):n.jsxs(n.Fragment,{children:[" = ",n.jsx(h,{size:"xs",intensity:80,children:"0"})]})]})})]}),n.jsx(Td,{checkIsBridgeless:b,chainVaultBalance:j,currentChain:c,quantity:r,maxAmount:u,crossChainTrans:f}),n.jsx(g,{justify:"center",children:n.jsx(Sd,{checkIsBridgeless:b,networkId:e.networkId,disabled:s,loading:i,onWithdraw:e.onWithdraw,crossChainWithdraw:e.crossChainWithdraw,currentChain:c,address:t,quantity:r,fee:m,withdrawTo:x,onTransfer:e.onTransfer})})]})},Ci=e=>{let{accountId:t}=e||{},{t:i}=S(),s=at(),{account:r,state:o}=Fe(),[a]=ci();return{hasPositions:p.useMemo(()=>{var l;return!!((l=a==null?void 0:a.rows)!=null&&l.length)},[a]),onSettlePnl:async()=>(t&&o.mainAccountId!==t?r.settleSubAccount({subAccountId:t}):r.settle({accountId:t})).then(l=>(U.success(i("settle.settlement.requested")),Promise.resolve(l))).catch(l=>{if(l.code==-1104)U.error(i("settle.settlement.error"));else if(l.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1)s.emit("wallet:sign-message-with-ledger-error",{message:l.message,userAddress:r.address});else if(l.message.indexOf("user rejected")!==-1)U.error(i("transfer.rejectTransaction"));else return U.error(l.message),Promise.reject(l)})}},ns=1,kd=e=>{let{t}=S(),[i,s]=p.useState(!1),[r,o]=p.useState(!1),[a]=js({page:1,pageSize:1,side:Gn.WITHDRAW,status:Ve.PENDING_REBALANCE},{shouldUpdateOnWalletChanged:K=>K.side===Gn.WITHDRAW}),l=Ne(),u=l.get("brokerName"),d=l.get("networkId"),c=at(),[m,y]=p.useState(""),[j,f]=p.useState("default"),[b,x]=p.useState(),{wrongNetwork:C}=jn(),{account:w}=Fe(),[v,{findByChainId:N}]=ui(d,{filter:K=>{var me,Re;return((me=K.network_infos)==null?void 0:me.bridge_enable)||((Re=K.network_infos)==null?void 0:Re.bridgeless)}}),[I]=De("orderly_link_device",{}),{data:O}=di("/v1/public/vault_balance",{revalidateOnMount:!0,errorRetryCount:3}),{connectedChain:A,wallet:k,setChain:_,settingChain:D}=hn(),M=p.useMemo(()=>{let K=A?Ss(A.id):Number.parseInt(I==null?void 0:I.chainId);if(!K)return null;let me=N(K);return{...A,id:K,info:me}},[N,A,I]),{sourceToken:L,onSourceTokenChange:F,sourceTokens:z}=Ar(M,K=>K.symbol==="USDC"||K.is_collateral),R=p.useMemo(()=>v.filter(K=>{var me;return(me=K.token_infos)==null?void 0:me.some(Re=>Re.symbol===(L==null?void 0:L.symbol))}).map(K=>K.network_infos),[v,d,L]),{walletName:H,address:ne}=p.useMemo(()=>{var K;return{walletName:k==null?void 0:k.label,address:(K=k==null?void 0:k.accounts)==null?void 0:K[0].address}},[k]),B=K=>{y(K)},$=p.useMemo(()=>new T(m||0).mul(ns).toNumber(),[m,ns]),{withdraw:Y,maxAmount:V,unsettledPnL:le}=Uo({token:L==null?void 0:L.symbol,decimals:L==null?void 0:L.token_decimal}),xe=Od({token:L==null?void 0:L.symbol,quantity:m,setQuantity:y,close:e.onClose,setLoading:o}),{withdrawTo:Se,toAccountId:Ae}=xe,Te=p.useMemo(()=>C||!M?!1:d==="testnet"?!0:!(!M.info||!M.info.network_infos||!M.info.network_infos.bridgeless),[M,C]),qe=()=>{y("")},Be=p.useCallback(async K=>{var Re,dt;let me=N(K.chain_id);return!me||((Re=me.network_infos)==null?void 0:Re.chain_id)===(M==null?void 0:M.id)?Promise.resolve():_==null?void 0:_({chainId:Ts(Number((dt=me.network_infos)==null?void 0:dt.chain_id))}).then(He=>{He?(U.success(t("connector.networkSwitched")),qe()):U.error(t("connector.switchChain.failed"))}).catch(He=>{U.error(`${t("connector.switchChain.failed")}: ${He.message}`)})},[M,_,N,t]),ae=p.useMemo(()=>{if(!Array.isArray(O)||!M)return null;let K=O.find(me=>Number.parseInt(me.chain_id)===(M==null?void 0:M.id));return K?K.balance:null},[v,M,O]),de=p.useMemo(()=>{if(ae!==null){let K=Number.parseFloat(m);return K>ae&&K<=V}return!1},[m,V,ae]),Ie=p.useMemo(()=>(L==null?void 0:L.minimum_withdraw_amount)??0,[L]),It=async()=>{if(!r&&j==="default"){if(new T(m).lt(Ie)){U.error(t("transfer.withdraw.minAmount.error",{minAmount:Ie}));return}return o(!0),Y({amount:m,token:L==null?void 0:L.symbol,chainId:M==null?void 0:M.id,allowCrossChainWithdraw:de}).then(K=>{var me;U.success(t("transfer.withdraw.requested")),c.emit("withdraw:requested"),(me=e.onClose)==null||me.call(e),y("")}).catch(K=>{if(K.message.indexOf("user rejected")!==-1){U.error(t("transfer.rejectTransaction"));return}if(K.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1){c.emit("wallet:sign-message-with-ledger-error",{message:K.message,userAddress:w.address});return}U.error(K.message)}).finally(()=>{o(!1)})}},Q=Dd({crossChainWithdraw:de,currentChain:M,token:L==null?void 0:L.symbol}),oe=p.useMemo(()=>{if(!m)return"";let K=new T(m).sub(Q??0);return K.isNegative()?"":K.toNumber()},[Q,m]);p.useEffect(()=>{if(!m){f("default"),x("");return}let K=new T(m??0);le<0&&(K.gt(V)?(f("error"),x(t("transfer.insufficientBalance"))):(f("default"),x("")))},[m,V,le,i]);let Pe=i||!m||Number(m)===0||["error","warning"].includes(j)||Se==="accountId"&&!Ae;p.useEffect(()=>{s(!!(a!=null&&a.length))},[a]);let Lt=Cs(K=>{var He;if(!i)return;let me=(He=a==null?void 0:a[0])==null?void 0:He.tx_id,{trxId:Re,transStatus:dt}=K;Re===me&&dt==="COMPLETED"&&s(!1)});_s({onMessage:Lt});let{hasPositions:An,onSettlePnl:qn}=Ci();return{walletName:H,address:ne,quantity:m,onQuantityChange:B,sourceToken:L,onSourceTokenChange:F,sourceTokens:z,inputStatus:j,hintMessage:b,amount:$,balanceRevalidating:!1,maxQuantity:V,disabled:Pe,loading:r,unsettledPnL:le,wrongNetwork:C,settingChain:D,tokenChains:R,currentChain:M,onChainChange:Be,onWithdraw:It,chainVaultBalance:ae,fee:Q,crossChainWithdraw:de,crossChainTrans:i,showQty:oe,networkId:d,checkIsBridgeless:Te,hasPositions:An,onSettlePnl:qn,brokerName:u,vaultBalanceList:O==null?void 0:O.filter(K=>Number.parseInt(K.chain_id)===(M==null?void 0:M.id)),...xe}};function Od(e){let{token:t,quantity:i,setQuantity:s,close:r,setLoading:o}=e,{t:a}=S(),[l,u]=p.useState("wallet"),[d,c]=p.useState(""),[m,y]=p.useState("default"),[j,f]=p.useState(),{transfer:b,submitting:x}=Os(),C=p.useCallback(()=>{let w=Number(i);if(isNaN(w)||w<=0){U.error(a("transfer.quantity.invalid"));return}x||!d||(o(!0),b(t,{account_id:d,amount:new T(i).toNumber()}).then(()=>{U.success(a("transfer.internalTransfer.success")),s(""),r==null||r()}).catch(v=>{console.error("transfer error: ",v,v.code);let N=Ir(v.code);U.error(N)}).finally(()=>{o(!1)}))},[a,i,t,x,d,b]);return p.useEffect(()=>{if(!d){y("default"),f("");return}Xu(d)?(y("default"),f("")):(y("error"),f(a("transfer.withdraw.accountId.invalid")))},[d]),{withdrawTo:l,setWithdrawTo:u,toAccountId:d,setToAccountId:c,onTransfer:C,internalWithdrawSubmitting:x,toAccountIdInputStatus:m,toAccountIdHintMessage:j}}function Dd(e){let{crossChainWithdraw:t,currentChain:i,token:s}=e,r=Is(s);return p.useMemo(()=>{var a;if(!i)return 0;let o=(a=r==null?void 0:r.chain_details)==null?void 0:a.find(l=>Number.parseInt(l.chain_id)===i.id);return o?t?(o.withdrawal_fee||0)+(o.cross_chain_withdrawal_fee||0):o.withdrawal_fee||0:0},[r,s,i,t])}var Id=e=>{let t=kd({onClose:e.close});return n.jsx(Pd,{...t})},Ld="DepositAndWithdrawWithDialogId",Ed="DepositAndWithdrawWithSheetId",Rr=e=>{let[t,i]=p.useState(e.activeTab||"deposit"),{t:s}=S();return n.jsxs(li,{value:t,onValueChange:i,variant:"contained",size:"lg",classNames:{tabsList:"oui-px-0",tabsContent:"oui-pt-5"},children:[n.jsx(Ue,{title:s("common.deposit"),icon:n.jsx(Ao,{}),value:"deposit",children:n.jsx(_d,{onClose:e.close})}),n.jsx(Ue,{title:s("common.withdraw"),icon:n.jsx(qo,{}),value:"withdraw",children:n.jsx(Id,{...e})})]})};jt(Ld,Rr,{size:"md",classNames:{content:"oui-border oui-border-line-6"}});Ut(Ed,Rr);var is=e=>{let{subAccounts:t=[],value:i}=e,[s,r]=p.useState(!1),o=t.length>1,a=n.jsxs(g,{intensity:500,className:E("oui-rounded-b-sm oui-rounded-t-xl oui-border oui-border-line",o?"oui-cursor-pointer":"oui-cursor-auto oui-bg-base-6"),height:54,px:3,justify:"between",itemAlign:"center",children:[n.jsxs(g,{direction:"column",itemAlign:"start",children:[n.jsx(h.formatted,{size:"xs",intensity:80,rule:i!=null&&i.description?void 0:"address",children:(i==null?void 0:i.description)||(i==null?void 0:i.id)}),n.jsxs(h,{intensity:36,size:"2xs",children:["ID: ",n.jsx(h.formatted,{rule:"address",children:i==null?void 0:i.id})]})]}),o&&n.jsx(_r,{className:"oui-text-base-contrast-54"})]}),l=t.map((u,d)=>{var y,j;let c=u.id===(i==null?void 0:i.id),m=(j=(y=u==null?void 0:u.holding)==null?void 0:y.find(f=>f.token==="USDC"))==null?void 0:j.holding;return n.jsxs(g,{px:2,r:"base",justify:"between",className:E("oui-transfer-form-account-select-item","oui-cursor-pointer oui-py-[6px] hover:oui-bg-base-5",c&&"oui-bg-base-5",d!==0&&"oui-mt-[2px]"),onClick:async()=>{var f;r(!1),(f=e.onValueChange)==null||f.call(e,u)},children:[n.jsx(g,{gapX:1,itemAlign:"center",children:n.jsxs(g,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[n.jsx(h.formatted,{rule:u!=null&&u.description?void 0:"address",intensity:80,children:(u==null?void 0:u.description)||(u==null?void 0:u.id)}),n.jsxs(h,{intensity:36,size:"2xs",children:["ID: ",n.jsx(h.formatted,{rule:"address",children:u==null?void 0:u.id})]})]})}),n.jsxs(g,{gapX:3,children:[n.jsx(h.numeral,{size:"2xs",intensity:54,unit:" USDC",children:m||0}),c&&n.jsx(W,{width:4,height:4,r:"full",className:"oui-transfer-form-account-select-active-dot oui-bg-[linear-gradient(270deg,#59B0FE_0%,#26FEFE_100%)]"})]})]},u.id)});return n.jsxs(pi,{open:o?s:!1,onOpenChange:r,children:[n.jsx(mi,{asChild:!0,children:a}),n.jsx(Es,{children:n.jsx(hi,{onCloseAutoFocus:u=>u.preventDefault(),align:"start",sideOffset:2,className:E("oui-transfer-form-account-select-dropdown-menu-content","oui-font-semibold","oui-bg-base-8 oui-p-1","oui-w-[var(--radix-dropdown-menu-trigger-width)]","oui-select-none oui-rounded-md"),children:n.jsx(fi,{children:n.jsxs("div",{className:"oui-max-h-[254px]",children:[l," "]})})})})]})},Ad=e=>{let{networkId:t,disabled:i,onTransfer:s,quantity:r,onQuantityChange:o,amount:a,tokens:l,token:u,onTokenChange:d,maxQuantity:c,submitting:m,hintMessage:y,inputStatus:j,hasPositions:f,onSettlePnl:b,unsettledPnL:x,toAccountAsset:C,fromAccounts:w,toAccounts:v,fromAccount:N,onFromAccountChange:I,toAccount:O,onToAccountChange:A,onExchange:k}=e,{t:_}=S(),D={initial:"md",lg:"lg"};return n.jsxs(W,{id:"oui-deposit-form",className:bt({weight:"semibold"}),children:[n.jsxs(W,{className:"oui-mb-6 lg:oui-mb-8",children:[n.jsx(h,{size:"sm",intensity:98,children:_("transfer.internalTransfer.from")}),n.jsxs(W,{mt:1,mb:1,children:[n.jsx(is,{subAccounts:w,value:N,onValueChange:I}),n.jsx(rt,{classNames:{root:"oui-mt-[2px] oui-rounded-t-sm oui-rounded-b-xl"},value:r,onValueChange:o,tokens:l,token:u,onTokenChange:d,hintMessage:y,status:j})]}),n.jsx(kn,{token:u,amount:a,maxQuantity:c,onClick:()=>{o(c.toString())}}),n.jsx(W,{mx:2,mt:1,children:n.jsx(qr,{unsettledPnl:x,hasPositions:f,onSettlePnl:b,tooltipContent:_("transfer.internalTransfer.unsettled.tooltip"),dialogContent:n.jsx(Qe,{i18nKey:"transfer.internalTransfer.settlePnl.description"})})}),n.jsx(On,{icon:n.jsx(Cu,{className:"oui-cursor-pointer oui-text-primary",onClick:k})}),n.jsx(h,{size:"sm",intensity:98,children:_("transfer.internalTransfer.to")}),n.jsxs(W,{mt:1,children:[n.jsx(is,{subAccounts:v,value:O,onValueChange:A}),n.jsxs(g,{className:E("oui-mt-[2px] oui-h-[31px] oui-text-base-contrast-54","oui-rounded-b-xl oui-rounded-t-sm"),justify:"between",itemAlign:"center",px:3,intensity:600,children:[n.jsx(h,{size:"2xs",children:_("transfer.internalTransfer.currentAssetValue")}),n.jsx(h.numeral,{size:"2xs",intensity:54,unit:` ${u.symbol}`,dp:u==null?void 0:u.precision,padding:!1,children:C})]})]})]}),n.jsx(g,{justify:"center",children:n.jsx(W,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:n.jsx(bn,{networkId:t,buttonProps:{fullWidth:!0,size:D},children:n.jsx(te,{fullWidth:!0,disabled:i,loading:m,size:D,onClick:s,children:_("common.transfer")})})})})]})},Bn={symbol:"USDC"},qd=e=>{let{t}=S(),[i,s]=p.useState(""),[r,o]=p.useState(),[a,l]=p.useState(),[u,d]=p.useState(),[c,m]=p.useState([Bn]),[y,j]=p.useState(Bn),[f,b]=p.useState({}),x=Ne("networkId"),{state:C,isMainAccount:w,subAccount:v}=Fe(),N=ks(),{transfer:I,submitting:O,maxAmount:A,unsettledPnL:k}=Os({fromAccountId:r==null?void 0:r.id,token:y.symbol}),_=C.subAccounts,D=C.mainAccountId,M=C.accountId,L=w?(r==null?void 0:r.id)!==D?r==null?void 0:r.id:void 0:r==null?void 0:r.id,{hasPositions:F,onSettlePnl:z}=Ci({accountId:r==null?void 0:r.id}),{portfolio:R,positions:H}=Bo(L),ne=Wo({token:y.symbol,unsettledPnL:R==null?void 0:R.unsettledPnL,freeCollateral:(R==null?void 0:R.freeCollateral)??Vo,holdings:R==null?void 0:R.holding}),B=p.useMemo(()=>{var Q;return!!((Q=H==null?void 0:H.rows)!=null&&Q.length)},[H]),$=p.useMemo(()=>L?B:F,[L,B,F]),{unsettledPnL:Y,maxQuantity:V}=p.useMemo(()=>L?{unsettledPnL:R==null?void 0:R.unsettledPnL,maxQuantity:ne}:{unsettledPnL:k,maxQuantity:A},[L,k,A,R==null?void 0:R.unsettledPnL,ne]),{inputStatus:le,hintMessage:xe}=Rd({quantity:i,maxQuantity:V,unsettledPnL:Y}),Se=p.useCallback(()=>{let Q=Number(i);if(isNaN(Q)||Q<=0){U.error(t("transfer.quantity.invalid"));return}O||!a||I(y.symbol,{account_id:a.id,amount:new T(i).toNumber()}).then(()=>{var oe;U.success(t("transfer.internalTransfer.success")),s(""),(oe=e.close)==null||oe.call(e)}).catch(oe=>{console.error("transfer error: ",oe);let Pe=Ir(oe.code);U.error(Pe)})},[t,y,i,O,I,a]),Ae=O||!i||le==="error",Te=p.useMemo(()=>new T(i||0).mul(1).toNumber(),[i]),qe=p.useMemo(()=>{var Q,oe;return(a==null?void 0:a.id)&&((oe=(Q=f[a.id])==null?void 0:Q.find(Pe=>Pe.token===y.symbol))==null?void 0:oe.holding)||0},[a,y,f]),{fromAccounts:Be,toAccounts:ae}=p.useMemo(()=>w?{fromAccounts:u?[u,..._||[]]:[],toAccounts:(r==null?void 0:r.id)===D?_:[]}:{fromAccounts:[],toAccounts:[]},[w,D,u,_,r]);p.useEffect(()=>{if(!D)return;let Q={id:D,description:t("common.mainAccount"),holding:[]};d(Q),v.refresh().then(oe=>{b(oe),d({...Q,holding:oe[D]})})},[t,D]),p.useEffect(()=>{o(w?u:_==null?void 0:_.find(Q=>Q.id===M))},[w,u,_,M]),p.useEffect(()=>{if(w){let Q=_==null?void 0:_[0],oe=e.toAccountId&&(_==null?void 0:_.find(Pe=>Pe.id===e.toAccountId))||Q;oe&&l(oe)}else l(u)},[e==null?void 0:e.toAccountId,w,u,_]),p.useEffect(()=>{let Q=N==null?void 0:N.map(oe=>({symbol:oe.token,precision:oe.decimals}));if(Q!=null&&Q.length){Q.sort((Pe,Lt)=>Pe.symbol==="USDC"?-1:Lt.symbol==="USDC"?1:0);let oe=Q==null?void 0:Q.find(Pe=>Pe.symbol===e.token);m(Q),j(oe||(Q==null?void 0:Q[0])||Bn)}},[N,e.token]);let de=p.useCallback(Q=>{o(Q);let oe=_==null?void 0:_[0];if((Q==null?void 0:Q.id)===D){l(oe);return}if(Q!=null&&Q.id&&(Q==null?void 0:Q.id)!==D){l(u);return}},[D,u,_]),Ie=p.useCallback(Q=>{l(Q)},[]),It=p.useCallback(()=>{o(a),l(r)},[r,a]);return{networkId:x,onTransfer:Se,quantity:i,amount:Te,onQuantityChange:s,maxQuantity:V,tokens:c,token:y,onTokenChange:j,disabled:Ae,submitting:O,hintMessage:xe,inputStatus:le,hasPositions:$,onSettlePnl:z,unsettledPnL:Y,toAccountAsset:qe,fromAccount:r,toAccount:a,fromAccounts:Be,onFromAccountChange:de,toAccounts:ae,onToAccountChange:Ie,onExchange:It,isMainAccount:w}};function Rd(e){let{quantity:t,maxQuantity:i,unsettledPnL:s=0}=e,{t:r}=S(),[o,a]=p.useState("default"),[l,u]=p.useState();return p.useEffect(()=>{if(!t){a("default"),u("");return}let d=new T(t);s<0?d.gt(i)?(a("error"),u(r("transfer.insufficientBalance"))):(a("default"),u("")):d.gt(i)?(a("error"),u(r("transfer.insufficientBalance"))):d.gt(new T(i).minus(s))&&d.lessThanOrEqualTo(i)?(a("warning"),u(r("settle.settlePnl.warning"))):(a("default"),u(""))},[t,i]),{inputStatus:o,hintMessage:l}}var Md="TransferDialogId",Fd="TransferSheetId",$d=e=>{let t=qd({toAccountId:e.toAccountId,token:e.token,close:e.close});return n.jsx(Ad,{...t})},Mr=e=>n.jsx($d,{close:e.close,toAccountId:e.toAccountId,token:e.token});jt(Md,Mr,{size:"md",classNames:{content:"oui-border oui-border-line-6"},title:()=>q.t("common.transfer")});Ut(Fd,Mr,{title:()=>q.t("common.transfer")});var zd=e=>{let{disabled:t,loading:i,networkId:s,onConvert:r}=e,{t:o}=S();return n.jsx(W,{className:"oui-w-full lg:oui-w-auto lg:oui-min-w-[184px]",children:n.jsx(bn,{status:Me.EnableTrading,networkId:s,buttonProps:{fullWidth:!0,size:{initial:"md",lg:"lg"}},children:n.jsx(te,{fullWidth:!0,disabled:t,loading:i,size:{initial:"md",lg:"lg"},onClick:r,children:o("transfer.convert")})})})},Ud=e=>e.reduce((t,i)=>{var s;return((s=i.token)==null?void 0:s.toUpperCase())==="USDC"?t.usdc.push(i):t.others.push(i),t},{usdc:[],others:[]}),Bd=e=>{var f;let{defaultValue:t}=e,i=Ne().get("networkId"),[,{findByChainId:s}]=ui(i,{pick:"network_infos",filter:b=>{var x,C;return((x=b.network_infos)==null?void 0:x.bridge_enable)||((C=b.network_infos)==null?void 0:C.bridgeless)}}),[r,o]=p.useState(),[a,l]=p.useState(),[u,d]=p.useState([]),c=ks(),m=s(Ho.id),y=(f=m==null?void 0:m.network_infos)==null?void 0:f.chain_id,j=p.useMemo(()=>c.map(b=>{var C,w;let x=(C=m==null?void 0:m.token_infos)==null?void 0:C.find(({symbol:v})=>v===b.token);return{...b,symbol:b.token,address:x==null?void 0:x.address,decimals:(w=b.chain_details[0])==null?void 0:w.decimals,precision:b.decimals}}),[m==null?void 0:m.token_infos,c]);return p.useEffect(()=>{let{usdc:b,others:x}=Ud(j);o(()=>t&&x.find(({token:w})=>w===t)||x[0]),d(x),l(b[0])},[t,j]),{chainId:y,sourceToken:r,sourceTokens:u,onSourceTokenChange:o,targetToken:a}},{calcMinimumReceived:Wd}=mn,Vd="orderly_convert_slippage",Hd=(e,t)=>new T(e).mul(new T(10).pow(t)).toFixed(0),un=(e,t)=>new T(e).div(new T(10).pow(t)).toString(),Qd=e=>{let{token:t,close:i}=e,{t:s}=S(),[r,o]=p.useState(!1),a=Ne().get("networkId"),[l,u]=p.useState(""),{wrongNetwork:d}=jn(),{wallet:c}=hn(),{sourceToken:m,sourceTokens:y,onSourceTokenChange:j,targetToken:f,chainId:b}=Bd({defaultValue:t}),x=p.useMemo(()=>{let V={...m,precision:(m==null?void 0:m.decimals)??6};return V.token==="ETH"&&(!V.address||V.address===Ro)&&(V.address=Mo),V},[m]),{walletName:C,address:w}=p.useMemo(()=>{var V;return{walletName:c==null?void 0:c.label,address:(V=c==null?void 0:c.accounts)==null?void 0:V[0].address}},[c]),v=V=>{u(V)},[N,I]=De(Vd,1),{maxAmount:O,convert:A}=Fo({token:x.token}),k=async()=>{if(!r)return o(!0),A({amount:Number(l),slippage:new T(N).div(100).toNumber()}).then(()=>{U.success(s("transfer.convert.completed")),i==null||i(),u("")}).catch(V=>{var le;U.error((le=V.message)!=null&&le.includes("user rejected")?s("transfer.convert.failed"):V.message)}).finally(()=>{o(!1)})},[_,{data:D,isMutating:M}]=$o(),L=Cs(_);p.useEffect(()=>{l&&b&&x.address&&(f!=null&&f.address)&&L({chainId:b,inputTokens:[{amount:Hd(l,x.decimals),tokenAddress:x.address}],outputTokens:[{proportion:1,tokenAddress:f.address}]})},[l,x,f,b,L]);let F=p.useMemo(()=>!D||M?"-":D==null?void 0:D.outAmounts[0],[D,M]),z=p.useMemo(()=>!D||M?"-":new T(un(D.outAmounts[0],(f==null?void 0:f.decimals)??6)).div(un(D.inAmounts[0],x.decimals)).toString(),[M,D,f==null?void 0:f.decimals,x==null?void 0:x.decimals]),R=p.useMemo(()=>!D||M?0:Wd({amount:D==null?void 0:D.outAmounts[0],slippage:Number(N)}),[D,M,N]),H=on(),ne=on({input:Number(l),token:m==null?void 0:m.token}),B=!l||Number(l)===0,{hasPositions:$,onSettlePnl:Y}=Ci();return{walletName:C,address:w,quantity:l,onQuantityChange:v,token:x,sourceTokens:y,onSourceTokenChange:j,targetToken:f,balanceRevalidating:!1,maxQuantity:O,disabled:B,loading:r,wrongNetwork:d,onConvert:k,hasPositions:$,onSettlePnl:Y,networkId:a,slippage:N,onSlippageChange:I,convertRate:z,minimumReceived:R,outAmounts:F,isQuoteLoading:M,currentLTV:H,nextLTV:ne}},Kd=e=>{let{loading:t,disabled:i,quantity:s,onQuantityChange:r,maxQuantity:o,token:a,targetToken:l,sourceTokens:u,onSourceTokenChange:d,onConvert:c,slippage:m,onSlippageChange:y,convertRate:j,outAmounts:f,minimumReceived:b,isQuoteLoading:x,currentLTV:C,nextLTV:w,networkId:v,balanceRevalidating:N}=e;return n.jsxs(W,{className:bt({weight:"semibold"}),children:[n.jsxs(W,{className:"oui-mb-6 lg:oui-mb-8",children:[n.jsx(W,{mt:3,mb:1,children:n.jsx(rt,{value:s,onValueChange:r,token:a,tokens:u,onTokenChange:d})}),n.jsx(kn,{token:a,amount:s,maxQuantity:o.toString(),loading:N,onClick:()=>{r(o.toString())}}),n.jsx(On,{}),n.jsx(rt,{readOnly:!0,loading:x,token:l,value:x||!s||Number.isNaN(Number(f))?"":un(f,(l==null?void 0:l.decimals)??6)}),n.jsxs(g,{direction:"column",itemAlign:"start",mt:2,gap:1,children:[n.jsx(Tr,{indexPrice:x||!s||Number.isNaN(Number(j))?"-":j,sourceSymbol:a==null?void 0:a.token,targetSymbol:l==null?void 0:l.token}),n.jsx(Sr,{value:m,onValueChange:y}),n.jsx(Nr,{symbol:(l==null?void 0:l.token)||"",precision:(l==null?void 0:l.decimals)??6,value:x||!s||Number.isNaN(Number(b))?"-":un(b.toString(),(l==null?void 0:l.decimals)??6)}),n.jsx(jr,{showDiff:typeof s<"u"&&Number(s)>0,currentLtv:C,nextLTV:w}),n.jsx(Cr,{dstGasFee:"0"})]})]}),n.jsx(g,{itemAlign:"center",justify:"center",children:n.jsx(zd,{networkId:v,disabled:i,loading:t,onConvert:c})})]})},Gd="ConvertDialogId",Xd="ConverSheetId",Fr=e=>{let t=Qd(e);return n.jsx(Kd,{...t})};jt(Gd,Fr,{size:"md",classNames:{content:"oui-border oui-border-line-6"},title:()=>q.t("transfer.convert")});Ut(Xd,Fr,{title:()=>q.t("transfer.convert")});var Jd=e=>{let{isSignIn:t,classNames:i}=e;return t?n.jsxs(g,{direction:"column",gapY:1,width:"100%",className:E(e.className,i==null?void 0:i.root),children:[n.jsx(ss,{count:e.pendingCount,status:Ve.PENDING,onClick:e.onClick,className:i==null?void 0:i.items}),n.jsx(ss,{count:e.completedCount,status:Ve.COMPLETED,onClick:e.onClick,className:i==null?void 0:i.items})]}):null},ss=e=>{let{t}=S(),{count:i,status:s}=e,r=p.useMemo(()=>s===Ve.PENDING?i>1?t("transfer.deposit.status.pending.multiple"):t("transfer.deposit.status.pending.one"):i>1?t("transfer.deposit.status.completed.multiple"):t("transfer.deposit.status.completed.one"),[t,s,i]);if(i===0)return null;let o=typeof e.onClick=="function";return n.jsxs(g,{justify:"between",itemAlign:"center",intensity:900,className:E("oui-font-normal","oui-px-3 lg:oui-px-0","oui-py-2 lg:oui-py-0",o&&"oui-cursor-pointer",e.className),width:"100%",r:"full",onClick:e.onClick,children:[n.jsxs(g,{gapX:1,width:"100%",children:[n.jsx(Zd,{className:s===Ve.COMPLETED?"oui-bg-success":"oui-bg-primary"}),n.jsx(h,{size:"2xs",intensity:80,children:r})]}),n.jsxs(g,{gapX:1,children:[n.jsx(Yd,{children:e.count}),o&&n.jsx(Eo,{size:14,opacity:1,className:"oui-text-base-contrast-54"})]})]})},Yd=e=>n.jsx(g,{justify:"center",itemAlign:"center",r:"full",width:18,height:18,className:E("oui-bg-line-12",e.className),children:n.jsx(h,{size:"3xs",intensity:80,children:e.children})}),Zd=e=>n.jsx("div",{className:E("oui-mx-[5px] oui-size-2 oui-shrink-0 oui-rounded-full",e.className)});function Zt(){let e=Date.now();return[e-1e3*60*60,e]}function ec(){let[e,t]=p.useState(Zt()),[i,s]=p.useState(Zt()),[r,o]=p.useState(0),[a,l]=p.useState(0),[u,d]=p.useState(0),{state:c}=Fe(),m=c.status===Me.EnableTrading||c.status===Me.EnableTradingWithoutConnected,[y,{isLoading:j}]=js({startTime:e[0],endTime:e[1],page:1,pageSize:200,side:"DEPOSIT"},{shouldUpdateOnWalletChanged:()=>!1}),[f,{meta:b}]=Io({dataRange:i,side:"IN",size:100,page:1,main_sub_only:!1}),x=ws(()=>{t(Zt())},300);_s({onMessage(w){let{side:v,transStatus:N}=w;v===Gn.DEPOSIT&&(N===Ve.PENDING||N===Ve.COMPLETED)&&(console.log("deposit status updated",w),x())}}),Lo({onMessage(w){console.log("balance updated",w),s(Zt())}}),p.useEffect(()=>{if(!y||j)return;let w=y==null?void 0:y.filter(N=>N.trans_status===Ve.PENDING),v=y==null?void 0:y.filter(N=>N.trans_status===Ve.COMPLETED);o((w==null?void 0:w.length)||0),l((v==null?void 0:v.length)||0)},[y,j]),p.useEffect(()=>{b&&d(b.total||0)},[b]);let C=p.useMemo(()=>a+u,[a,u]);return{pendingCount:r,completedCount:C,isSignIn:m}}var nf=e=>{let t=ec();return n.jsx(Jd,{...t,...e})},$r=e=>{let{pnl:t,hide:i}=e,s=t==null?void 0:t.entity,r=Ee(),{getFirstRefCode:o}=gi(),a=p.useMemo(()=>{var c;let d=(c=o())==null?void 0:c.code;return{code:(t==null?void 0:t.refCode)??d,slogan:t==null?void 0:t.refSlogan,link:t==null?void 0:t.refLink}},[o,t]),l=p.useMemo(()=>{if(s)return r[s==null?void 0:s.symbol]("base_dp")},[s,r]),u=p.useMemo(()=>{if(s)return r[s==null?void 0:s.symbol]("quote_dp")},[s,r]);return{entity:s,leverage:t==null?void 0:t.leverage,baseDp:l,quoteDp:u,referralInfo:a,shareOptions:t,hide:i}},zr=p.forwardRef((e,t)=>{let{width:i,height:s,className:r,data:o,style:a}=e,{ref:l,download:u,toDataURL:d,copy:c,toBlob:m}=ta(o,{ratio:e.ratio});return p.useImperativeHandle(t,()=>({download:u,toDataURL:d,toBlob:m,copy:c})),n.jsx("canvas",{ref:l,width:i,height:s,className:r,style:a})});function Ur(e,t,i,s,r,o,a,l,u){let{t:d}=S(),{symbol:c,currency:m}=tc(e.symbol),y={symbol:c,currency:m,side:e.side};switch(r){case"pnl":{e.pnl!=null&&(y.pnl=new T(e.pnl).toFixed(2,T.ROUND_DOWN));break}case"roi":{e.roi!=null&&(y.ROI=new T(e.roi).toFixed(2,T.ROUND_DOWN));break}case"roi_pnl":{e.pnl!=null&&(y.pnl=new T(e.pnl).toFixed(2,T.ROUND_DOWN)),e.roi!=null&&(y.ROI=new T(e.roi).toFixed(2,T.ROUND_DOWN));break}}let j=[];o.has("leverage")&&(y.leverage=t),["openPrice","closePrice","openTime","closeTime","markPrice","quantity"].forEach(b=>{if(o.has(b))switch(b){case"leverage":break;case"openPrice":{e.openPrice!=null&&j.push({title:d("share.pnl.optionalInfo.openPrice"),value:en(e.openPrice,l||2)});break}case"closePrice":{e.closePrice!=null&&j.push({title:d("share.pnl.optionalInfo.closePrice"),value:en(e.closePrice,l||2)});break}case"openTime":{e.openTime!=null&&j.push({title:d("share.pnl.optionalInfo.openTime"),value:rs(e.openTime)});break}case"closeTime":{e.closeTime!=null&&j.push({title:d("share.pnl.optionalInfo.closeTime"),value:rs(e.closeTime)});break}case"markPrice":{e.markPrice!=null&&j.push({title:d("common.markPrice"),value:en(e.markPrice,l||2)});break}case"quantity":e.quantity!=null&&j.push({title:d("common.quantity"),value:en(e.quantity,a||2)})}}),y.informations=j;let f={position:y,updateTime:nc(new Date),domain:s};return i.length>0&&(f.message=i),typeof u<"u"&&u.code!==void 0&&(f.referral=u),f}function tc(e){let t=e.split("_");if(t.length!==3)return{symbol:e,currency:"USDC"};let[i,s,r]=t;return{symbol:`${s}-${i}`,currency:r||"USDC"}}function nc(e){var d,c,m,y,j;let t=e instanceof Date?e:new Date(e),i={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},s=new Intl.DateTimeFormat("en-US",i).formatToParts(t),r=(d=s.find(f=>f.type==="year"?f.value:""))==null?void 0:d.value,o=(c=s.find(f=>f.type==="month"?f.value:""))==null?void 0:c.value,a=(m=s.find(f=>f.type==="day"?f.value:""))==null?void 0:m.value,l=(y=s.find(f=>f.type==="hour"?f.value:""))==null?void 0:y.value,u=(j=s.find(f=>f.type==="minute"?f.value:""))==null?void 0:j.value;return`${r}-${o}-${a} ${l}:${u}`}function rs(e){var u,d,c,m;let t=e instanceof Date?e:new Date(e),i={year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},s=new Intl.DateTimeFormat("en-US",i).formatToParts(t),r=(u=s.find(y=>y.type==="month"?y.value:""))==null?void 0:u.value,o=(d=s.find(y=>y.type==="day"?y.value:""))==null?void 0:d.value,a=(c=s.find(y=>y.type==="hour"?y.value:""))==null?void 0:c.value,l=(m=s.find(y=>y.type==="minute"?y.value:""))==null?void 0:m.value;return`${r}-${o} ${a}:${l}`}function en(e,t){return new T(e).toFixed(t,T.ROUND_DOWN)}function Br(e,t,i,s){localStorage.setItem("pnl_config_key",JSON.stringify({bgIndex:i,pnlFormat:e,options:Array.from(t),message:s}))}function Wr(){let e=localStorage.getItem("pnl_config_key");if(e&&e.length>0)try{return JSON.parse(e)}catch{}return{bgIndex:0,pnlFormat:"roi_pnl",options:["openPrice","closePrice","openTime","closeTime","markPrice","quantity","leverage"],message:""}}var ic=e=>{let{onClickDownload:t,onClickCopy:i}=e,{t:s}=S();return n.jsxs(g,{px:8,gap:3,mt:3,itemAlign:"center",children:[n.jsxs(te,{color:"secondary",className:"oui-flex-1 oui-flex oui-gap-1",onClick:t,children:[n.jsx("span",{children:n.jsx(sc,{})}),s("common.download")]}),n.jsxs(te,{className:"oui-flex-1 oui-flex oui-gap-1",onClick:i,children:[n.jsx("span",{children:n.jsx(rc,{})}),s("common.copy")]})]})},sc=()=>n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4.66 1.994A2.667 2.667 0 0 0 1.995 4.66v6.666a2.667 2.667 0 0 0 2.667 2.667h6.666a2.667 2.667 0 0 0 2.667-2.667V4.661a2.667 2.667 0 0 0-2.667-2.667zM7.995 4.66c.368 0 .667.298.667.666V8.66h2l-2.667 2.666L5.328 8.66h2V5.327c0-.368.299-.667.667-.667",fill:"#fff",fillOpacity:".98"})}),rc=()=>n.jsx("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M5.166 1.994A2.667 2.667 0 0 0 2.499 4.66v4a2.667 2.667 0 0 0 2.667 2.667 2.667 2.667 0 0 0 2.666 2.667h4a2.667 2.667 0 0 0 2.667-2.667v-4a2.667 2.667 0 0 0-2.667-2.667 2.667 2.667 0 0 0-2.666-2.666zm6.666 4c.737 0 1.334.596 1.334 1.333v4c0 .737-.597 1.334-1.334 1.334h-4A1.333 1.333 0 0 1 6.5 11.327h2.667a2.667 2.667 0 0 0 2.666-2.667z",fill:"#fff",fillOpacity:".98"})}),oc=e=>{let{children:t,...i}=e;return n.jsx("button",{...i,children:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),n.jsx("path",{d:"M11.186 5.348a.67.67 0 0 0-.436.27l-2.657 4a.69.69 0 0 0 0 .75l2.657 4a.68.68 0 0 0 .934.188.685.685 0 0 0 .187-.937L9.463 9.993 11.87 6.37a.685.685 0 0 0-.187-.938.65.65 0 0 0-.498-.083",fill:"#fff",fillOpacity:".54"})]})})},ac=e=>{let{children:t,...i}=e;return n.jsx("button",{...i,children:n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[n.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#333948"}),n.jsx("path",{d:"M8.777 5.348a.65.65 0 0 0-.498.083.685.685 0 0 0-.187.938L10.5 9.993 8.092 13.62a.685.685 0 0 0 .187.937.68.68 0 0 0 .934-.187l2.657-4a.69.69 0 0 0 0-.75l-2.657-4a.67.67 0 0 0-.436-.271",fill:"#fff",fillOpacity:".54"})]})})},lc=e=>{let{backgroundImages:t,selectedSnap:i,setSelectedSnap:s}=e,[r,o]=Qs({containScroll:"keepSnaps",dragFree:!0}),a=p.useCallback(()=>{o&&(o!=null&&o.canScrollPrev()?o.scrollPrev():i-1>=0&&s(i-1))},[o,i]),l=p.useCallback(()=>{o&&(o!=null&&o.canScrollNext()?o.scrollNext():i+1<t.length&&s(i+1))},[o,i]),u=p.useCallback(d=>{s(d.selectedScrollSnap())},[]);return p.useEffect(()=>{o&&(u(o),o.on("reInit",u),o.on("select",u),o==null||o.scrollTo(i))},[o,u]),n.jsxs(g,{mt:4,px:2,children:[n.jsx(oc,{onClick:a}),n.jsx("div",{ref:r,className:"oui-w-full oui-overflow oui-overflow-x-auto oui-scrollbar-hidden oui-hide-scrollbar oui-mx-0",children:n.jsx(g,{children:t.map((d,c)=>n.jsx(W,{onClick:()=>{o!=null&&o.canScrollPrev()||o!=null&&o.canScrollNext()?o==null||o.scrollTo(c):s(c)},mx:2,my:1,mr:6,r:"base",className:E("oui-shrink-0 oui-w-[162px]",i===c&&"oui-outline oui-outline-1 oui-outline-primary-darken"),children:n.jsx("img",{src:d,className:"oui-rounded-sm"})},d))})}),n.jsx(ac,{onClick:l})]})},Vr=e=>{let{size:t=16,className:i}=e;return n.jsx("button",{type:"button",onClick:s=>{e.onCheckedChange(!e.checked)},className:i,children:e.checked?n.jsx("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm6.664 2.922a.8.8 0 0 1 .557-.208c.2 0 .406.063.558.208a.734.734 0 0 1 0 1.063l-5.434 5.179a.826.826 0 0 1-1.115 0l-2.33-2.22a.736.736 0 0 1 0-1.063.827.827 0 0 1 1.117 0l1.77 1.687z",fill:"#fff",fillOpacity:".8"})}):n.jsx("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M4.66 1.953A2.667 2.667 0 0 0 1.995 4.62v6.667a2.667 2.667 0 0 0 2.667 2.666h6.666a2.667 2.667 0 0 0 2.667-2.666V4.62a2.667 2.667 0 0 0-2.667-2.667zm0 1.334h6.667c.737 0 1.334.596 1.334 1.333v6.667c0 .736-.597 1.333-1.334 1.333H4.661a1.333 1.333 0 0 1-1.334-1.333V4.62c0-.737.597-1.333 1.334-1.333",fill:"#fff",fillOpacity:".8"})})})},uc=e=>{let{message:t,setMessage:i,check:s,setCheck:r}=e,[o,a]=p.useState(!1),l=p.useRef(null),{t:u}=S();return n.jsxs("div",{className:"oui-mt-3 oui-mb-6 oui-flex oui-items-center",children:[n.jsx(Vr,{className:"oui-mt-[2px]",checked:s,onCheckedChange:d=>{r(d)}}),n.jsx("div",{className:"oui-text-xs oui-text-base-contrast-54 oui-ml-1 hover:oui-cursor-pointer",onClick:()=>{r(!e.check)},children:u("share.pnl.optionalInfo.message")}),n.jsx("div",{className:"oui-bg-base-900 oui-mx-2 oui-rounded-sm",children:n.jsx(fe,{ref:l,placeholder:u("share.pnl.optionalInfo.message.placeholder"),classNames:{root:"oui-w-[320px]"},size:"sm",value:t,autoFocus:!1,suffix:o&&n.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:d=>{i(""),setTimeout(()=>{var c;(c=l.current)==null||c.focus()},50),d.stopPropagation()},children:n.jsx(xi,{size:18,color:"white"})}),onFocus:()=>a(!0),onBlur:()=>a(!1),onChange:d=>{if(d.target.value.length>25){U.error(u("share.pnl.optionalInfo.message.maxLength"));return}r(d.target.value.length>0),i(d.target.value)}})})]})},dc=e=>{let{type:t,curType:i,setShareOption:s}=e,{t:r}=S(),o=p.useMemo(()=>{switch(t){case"openPrice":return r("share.pnl.optionalInfo.openPrice");case"closePrice":return r("share.pnl.optionalInfo.closePrice");case"openTime":return r("share.pnl.optionalInfo.openTime");case"closeTime":return r("share.pnl.optionalInfo.closeTime");case"markPrice":return r("common.markPrice");case"quantity":return r("common.quantity");case"leverage":return r("common.leverage")}},[t,r]),a=i.has(t);return n.jsxs(g,{itemAlign:"center",gap:1,className:E("hover:oui-cursor-pointer"),onClick:()=>{s(l=>{let u=new Set(l);return a?u.delete(t):u.add(t),u})},children:[n.jsx(Vr,{size:16,checked:a,className:"oui-pt-[2px]",onCheckedChange:l=>{s(u=>{let d=new Set(u);return a?d.delete(t):d.add(t),d})}}),n.jsx(h,{size:"xs",intensity:54,children:o})]})},cc=e=>{let{type:t,curType:i,setPnlFormat:s}=e,{t:r}=S(),o=p.useMemo(()=>{switch(t){case"roi_pnl":return r("share.pnl.displayFormat.roi&Pnl");case"roi":return r("share.pnl.displayFormat.roi");case"pnl":return r("share.pnl.displayFormat.pnl")}},[t,r]),a=t===i,l="oui-flex oui-items-center oui-gap-1 oui-cursor-pointer";return a?l+=" oui-text-base-contrast":l+="",n.jsxs("div",{className:l,onClick:()=>{s(t)},children:[n.jsx(pc,{sel:a}),n.jsx(h,{size:"xs",intensity:54,className:E("oui-ml-2 "),children:o})]})},pc=e=>n.jsx("button",{type:"button",children:e.sel===!0?n.jsx(mc,{}):n.jsx(hc,{})}),mc=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-primary-darken",children:[n.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),n.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),hc=()=>n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),fc=e=>{let{shareOptions:t}=e,{t:i}=S(),s=Wr(),r=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[o,a]=p.useState(r.length==1?r[0]:s.pnlFormat),[l,u]=p.useState(new Set(s.options)),[d,c]=p.useState(s.bgIndex),[m,y]=p.useState(s.message),[j,f]=p.useState(!1),{backgroundImages:b,...x}=t??{backgroundImages:[]},[C,w]=p.useState(""),v=p.useRef(null);p.useEffect(()=>{let _=window.location.hostname;w(_)},[]);let N=p.useMemo(()=>{var _;return(_=t==null?void 0:t.backgroundImages)==null?void 0:_[d]},[t==null?void 0:t.backgroundImages,d]),I=Ur(e.entity,e.leverage,j?m:"",C,o,l,e.baseDp,e.quoteDp,e.referral),O=()=>{var _;(_=v.current)==null||_.copy().then(()=>{var D;(D=e.hide)==null||D.call(e),U.success(i("share.pnl.image.copied"))}).catch(D=>{U.error(()=>n.jsxs("div",{children:[n.jsx("div",{children:i("common.copy.failed")}),n.jsx("div",{className:"oui-mt-2 oui-max-w-[396px] oui-text-2xs oui-text-base-contrast-54",children:i("share.pnl.copy.failed.description")})]}))})},A=()=>{var _,D;(_=v.current)==null||_.download("Poster.png"),(D=e.hide)==null||D.call(e)},k=[...e.entity.openPrice?["openPrice"]:[],...e.entity.closePrice?["closePrice"]:[],...e.entity.markPrice?["markPrice"]:[],...e.entity.openTime?["openTime"]:[],...e.entity.closeTime?["closeTime"]:[],...e.leverage?["leverage"]:[],...e.entity.quantity?["quantity"]:[]];return Br(o,l,d,m),n.jsxs("div",{className:"oui-relative oui-flex oui-size-full oui-flex-col",children:[n.jsxs("div",{className:"oui-h-full oui-flex-1 oui-overflow-y-auto",children:[n.jsxs(W,{mt:9,height:422,children:[n.jsx(g,{itemAlign:"center",justify:"center",children:n.jsx(zr,{width:552,height:310,data:{backgroundImg:N,...x,data:I},ratio:3,ref:v})}),n.jsx(lc,{backgroundImages:(t==null?void 0:t.backgroundImages)??[],selectedSnap:d,setSelectedSnap:c})]}),n.jsxs(g,{direction:"column",px:10,mt:6,justify:"start",itemAlign:"start",width:"100%",children:[n.jsx(h,{size:"sm",intensity:80,children:i("share.pnl.displayFormat")}),n.jsx(g,{pt:3,gap:3,itemAlign:"center",children:r.map((_,D)=>n.jsx(cc,{setPnlFormat:a,type:_,curType:o},D))}),n.jsx(ye,{className:"oui-w-full oui-border-white/10 oui-pt-6"}),n.jsxs(g,{mt:6,direction:"column",justify:"start",itemAlign:"start",children:[n.jsx(h,{size:"sm",intensity:80,children:i("share.pnl.optionalInfo")}),n.jsx(g,{mt:3,gap:4,className:"oui-flex-wrap",children:k.map((_,D)=>n.jsx(dc,{setShareOption:u,type:_,curType:l},D))})]}),n.jsx(uc,{message:m,setMessage:y,check:j,setCheck:f})]})]}),n.jsx(ic,{onClickCopy:O,onClickDownload:A})]})},Hr=ce.createContext(null);function Pt(){let e=ce.useContext(Hr);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}var Qr=ce.forwardRef(({orientation:e="horizontal",opts:t,setApi:i,plugins:s,className:r,children:o,...a},l)=>{let[u,d]=Qs({...t,axis:e==="horizontal"?"x":"y"},s),[c,m]=ce.useState(!1),[y,j]=ce.useState(!1),[f,b]=ce.useState(a.initIndex||0),[x,C]=ce.useState([]),w=ce.useCallback(O=>{O&&(x.length===0&&C(O.scrollSnapList()),b(O.selectedScrollSnap()),m(O.canScrollPrev()),j(O.canScrollNext()))},[x]),v=ce.useCallback(()=>{d==null||d.scrollPrev()},[d]),N=ce.useCallback(()=>{d==null||d.scrollNext()},[d]),I=ce.useCallback(O=>{O.key==="ArrowLeft"?(O.preventDefault(),v()):O.key==="ArrowRight"&&(O.preventDefault(),N())},[v,N]);return ce.useEffect(()=>{!d||!i||i(d)},[d,i]),ce.useEffect(()=>{if(d)return w(d),d.on("reInit",w),d.on("select",w),a.initIndex&&d.scrollTo(a.initIndex),()=>{d==null||d.off("select",w)}},[d,w]),n.jsx(Hr.Provider,{value:{carouselRef:u,api:d,opts:t,orientation:e||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:v,scrollNext:N,canScrollPrev:c,canScrollNext:y,selectedIndex:f,scrollSnaps:x},children:n.jsx("div",{ref:l,onKeyDownCapture:I,className:E("oui-relative",r),role:"region","aria-roledescription":"carousel",...a,children:o})})});Qr.displayName="Carousel";var Ni=ce.forwardRef(({className:e,...t},i)=>{let{carouselRef:s,orientation:r}=Pt();return n.jsx("div",{ref:s,className:"oui-overflow-hidden",children:n.jsx("div",{ref:i,className:E("oui-flex",r==="horizontal"?"oui--ml-4":"oui--mt-4 oui-flex-col",e),...t})})});Ni.displayName="CarouselContent";var Si=ce.forwardRef(({className:e,...t},i)=>{let{orientation:s}=Pt();return n.jsx("div",{ref:i,role:"group","aria-roledescription":"slide",className:E("oui-min-w-0 oui-shrink-0 oui-grow-0 oui-basis-full",s==="horizontal"?"oui-pl-4":"oui-pt-4",e),...t})});Si.displayName="CarouselItem";var Kr=ce.forwardRef(({className:e,variant:t="contained",size:i="icon",...s},r)=>{let{orientation:o,scrollPrev:a,canScrollPrev:l}=Pt();return n.jsxs(te,{ref:r,variant:t,className:E("oui-absolute  oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--left-12 oui-top-1/2 oui--translate-y-1/2":"oui--top-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...s,children:[n.jsx(ChevronLeft,{size:20}),n.jsx("span",{className:"oui-sr-only",children:"Previous slide"})]})});Kr.displayName="CarouselPrevious";var Gr=ce.forwardRef(({className:e,variant:t="contained",size:i="icon",...s},r)=>{let{orientation:o,scrollNext:a,canScrollNext:l}=Pt();return n.jsxs(te,{ref:r,variant:t,className:E("oui-absolute oui-h-8 oui-w-8 oui-rounded-full",o==="horizontal"?"oui--right-12 oui-top-1/2 oui--translate-y-1/2":"oui--bottom-12 oui-left-1/2 oui--translate-x-1/2 oui-rotate-90",e),disabled:!l,onClick:a,...s,children:[n.jsx(ChevronRight,{size:20}),n.jsx("span",{className:"oui-sr-only",children:"Next slide"})]})});Gr.displayName="CarouselNext";var Xr=e=>{let{scrollSnaps:t,selectedIndex:i}=Pt();return n.jsx("div",{className:E("oui-flex oui-gap-1",e.className),children:t.map((s,r)=>n.jsx(Jr,{index:r,active:r===i,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},r))})};Xr.displayName="CarouselIdentifier";var Jr=({index:e,active:t,onClick:i,className:s,activeClassName:r})=>n.jsx("button",{onClick:()=>i==null?void 0:i(e),className:E("oui-w-2 oui-h-2 oui-rounded-full oui-bg-white/30",s,t&&`active ${r||"oui-bg-primary-darken"}`)}),kt=Qr;kt.Content=Ni;kt.Item=Si;kt.Next=Gr;kt.Previous=Kr;kt.indentify=Xr;var xc=e=>{var F,z;let{shareOptions:t}=e,{t:i}=S(),s=Wr(),r=e.entity.roi!=null&&e.entity.pnl!=null?["roi_pnl","roi","pnl"]:e.entity.roi!=null?["roi"]:e.entity.pnl!=null?["pnl"]:[],[o,a]=p.useState(r.length==1?r[0]:s.pnlFormat),[l,u]=p.useState(new Set(s.options)),[d,c]=p.useState(s.message),[m,y]=p.useState(s.bgIndex),{backgroundImages:j,...f}=t??{backgroundImages:[]},[b,x]=p.useState(""),C=(F=t==null?void 0:t.backgroundImages)==null?void 0:F.map(()=>p.useRef(null));p.useEffect(()=>{let R=window.location.hostname;x(R)},[]);let w=Ur(e.entity,e.leverage,d,b,o,l,e.baseDp,e.quoteDp,e.referral),v=p.useRef(),N=552/310,[I,O]=p.useState(1),[A,k]=p.useState(0),[_,D]=p.useState(!1),M=p.useRef(null);p.useEffect(()=>{if(v.current){let R=v.current.offsetWidth,H=R/N;k(H),O(R/552)}},[v,b]);let L=async R=>{var B,$;if(!R.current)return;let H=(B=R.current)==null?void 0:B.toDataURL(),ne=yc(H);try{navigator.share&&await navigator.share({text:d,files:[new File([ne],"image.png",{type:"image/png"})]}),($=e.hide)==null||$.call(e)}catch{}};return Br(o,l,m,d),n.jsxs("div",{className:"oui-w-full",children:[n.jsx("div",{ref:v,className:"oui-mt-4 oui-w-full oui-overflow-hidden",style:{height:`${A+20}px`},children:n.jsxs(kt,{className:"oui-w-full oui-overflow-hidden",opts:{align:"start"},initIndex:m,children:[n.jsx(Ni,{style:{height:`${A}px`},children:(z=t==null?void 0:t.backgroundImages)==null?void 0:z.map((R,H)=>n.jsx(Si,{children:n.jsx(zr,{className:"oui-origin-top-left oui-transform",style:{scale:`${I}`},width:552,height:310,data:{backgroundImg:R,...f,data:w},ratio:3,ref:C==null?void 0:C[H]})},H))}),n.jsx("div",{className:"oui-mb-1 oui-mt-2 oui-flex oui-justify-center",children:n.jsx(bc,{dotClassName:"oui-w-[16px] oui-h-[4px] oui-bg-base-300",dotActiveClassName:"!oui-bg-primary-darken oui-w-[20px]",setSelectIndex:y})})]})}),n.jsxs(fi,{className:"oui-custom-scrollbar oui-max-h-[200px] oui-overflow-y-auto",children:[n.jsxs("div",{className:"oui-mt-4",children:[n.jsx("div",{className:"oui-text-3xs oui-text-base-contrast-54",children:i("share.pnl.displayFormat")}),n.jsx("div",{className:"oui-row-span-1 oui-grid oui-grid-cols-3 oui-justify-between oui-gap-3 oui-px-1 oui-pt-3",children:r.map((R,H)=>n.jsx(gc,{setPnlFormat:a,type:R,curType:o},H))})]}),n.jsxs("div",{className:"oui-mt-3",children:[n.jsx("div",{className:"oui-h-[18px] oui-text-3xs oui-text-base-contrast-54",children:i("share.pnl.optionalInfo")}),n.jsxs("div",{className:"oui-mt-3 oui-flex oui-flex-wrap oui-gap-3",children:[e.entity.openPrice&&n.jsx(Je,{setShareOption:u,type:"openPrice",curType:l}),e.entity.closePrice&&n.jsx(Je,{setShareOption:u,type:"closePrice",curType:l}),e.entity.openTime&&n.jsx(Je,{setShareOption:u,type:"openTime",curType:l}),e.entity.closeTime&&n.jsx(Je,{setShareOption:u,type:"closeTime",curType:l}),e.leverage&&n.jsx(Je,{setShareOption:u,type:"leverage",curType:l}),e.entity.markPrice&&n.jsx(Je,{setShareOption:u,type:"markPrice",curType:l}),e.entity.quantity&&n.jsx(Je,{setShareOption:u,type:"quantity",curType:l})]})]}),n.jsxs("div",{className:"oui-mb-8 oui-mt-3",children:[n.jsx("div",{className:"oui-h-[18px] oui-text-3xs oui-text-base-contrast-54",children:i("share.pnl.optionalInfo.message")}),n.jsx("div",{className:"oui-bg-base-600 oui-mx-1 oui-mt-3 oui-h-[48px]",children:n.jsx(fe,{placeholder:i("share.pnl.optionalInfo.message.placeholder"),containerClassName:"oui-bg-transparent oui-h-[48px]",value:d,autoFocus:!1,onChange:R=>{if(R.target.value.length>25){U.error(i("share.pnl.optionalInfo.message.maxLength"));return}c(R.target.value)},ref:M,onFocus:()=>D(!0),onBlur:()=>D(!1),suffix:_&&n.jsx("button",{className:"oui-mr-3 oui-cursor-pointer",onMouseDown:R=>{c(""),setTimeout(()=>{var H;(H=M.current)==null||H.focus()},50),R.stopPropagation()},children:n.jsx(xi,{size:18,color:"white"})})})})]})]}),n.jsx("div",{className:"oui-pt-2",children:n.jsx(te,{fullWidth:!0,className:"oui-h-[40px] oui-text-[16px]",onClick:()=>{let R=C==null?void 0:C[m];R&&L(R)},children:i("common.share")})})]})},gc=e=>{let{type:t,curType:i,setPnlFormat:s}=e,{t:r}=S(),o=p.useMemo(()=>{switch(t){case"roi_pnl":return r("share.pnl.displayFormat.roi&Pnl");case"roi":return r("share.pnl.displayFormat.roi");case"pnl":return r("share.pnl.displayFormat.pnl")}},[t]);return n.jsx("div",{className:E("oui-referral-shadow oui-flex oui-h-[46px] oui-flex-1 oui-items-center oui-rounded-lg oui-bg-base-4 oui-px-3 oui-shadow-lg hover:oui-cursor-pointer",t===i&&"oui-dot-sel oui-bg-primary-darken"),onClick:()=>{s(t)},children:n.jsx("div",{className:"oui-text-sm oui-text-base-contrast",children:o})})},Je=e=>{let{type:t,curType:i,setShareOption:s}=e,{t:r}=S(),o=p.useMemo(()=>{switch(t){case"openPrice":return r("share.pnl.optionalInfo.openPrice");case"closePrice":return r("share.pnl.optionalInfo.closePrice");case"openTime":return r("share.pnl.optionalInfo.openTime");case"closeTime":return r("share.pnl.optionalInfo.closeTime");case"markPrice":return r("common.markPrice");case"quantity":return r("common.quantity");case"leverage":return r("common.leverage")}},[t,r]),a=i.has(t);return n.jsxs("div",{className:E("oui-referral-shadow oui-mt-0 oui-flex oui-h-[46px] oui-w-[calc(50%-6px)] oui-items-center oui-rounded-lg oui-bg-base-4 oui-p-3 oui-shadow-lg hover:oui-cursor-pointer"),onClick:()=>{s(l=>{let u=new Set(l);return a?u.delete(t):u.add(t),u})},children:[n.jsx("div",{className:"oui-flex-1 oui-text-sm oui-text-base-contrast",children:o}),a&&n.jsx(jc,{})]})};function yc(e){let t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(t.length),r=new Uint8Array(s);for(let o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return new Blob([s],{type:i})}var bc=e=>{let{scrollSnaps:t,selectedIndex:i}=Pt();return p.useEffect(()=>{e.setSelectIndex(i)},[i]),n.jsx("div",{className:E("oui-flex oui-gap-1"),children:t.map((s,r)=>n.jsx(Jr,{index:r,active:r===i,onClick:e.onClick,className:e.dotClassName,activeClassName:e.dotActiveClassName},r))})},jc=()=>n.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.01416 11.9989C2.01416 6.47589 6.49136 1.9989 12.0142 1.9989C17.5372 1.9989 22.0142 6.47589 22.0142 11.9989C22.0142 17.5219 17.5372 21.9989 12.0142 21.9989C6.49136 21.9989 2.01416 17.5219 2.01416 11.9989ZM16.9853 7.31211C17.2125 7.09537 17.5236 7 17.8218 7C18.1201 7 18.4312 7.09537 18.6583 7.31211C19.1139 7.74546 19.1139 8.47384 18.6583 8.9072L10.5077 16.675C10.0534 17.1083 9.28909 17.1083 8.83472 16.675L5.34077 13.3459C4.88641 12.9126 4.88641 12.1841 5.34077 11.7508C5.79631 11.3175 6.56057 11.3175 7.01493 11.7508L9.67122 14.2822L16.9853 7.31211Z",fill:"white",fillOpacity:"1"})}),wc=e=>{let{leverage:t,entity:i,baseDp:s,quoteDp:r,referralInfo:o,shareOptions:a,hide:l}=e,[u,d]=p.useState(window.innerHeight<900?660:807);return p.useEffect(()=>{let c=()=>{d(window.innerHeight<900?660:807)};return window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[]),a==null||i==null?n.jsx(n.Fragment,{}):n.jsx(fc,{entity:i,leverage:t,hide:l,baseDp:s,quoteDp:r,referral:o,shareOptions:a})},_c=e=>{let{leverage:t,entity:i,baseDp:s,quoteDp:r,referralInfo:o,shareOptions:a,hide:l}=e;return a==null||i==null?n.jsx(n.Fragment,{}):n.jsx(xc,{entity:i,leverage:t,hide:l,baseDp:s,quoteDp:r,referral:o,shareOptions:a})},vc=e=>{let t=$r({hide:e.hide,pnl:e.pnl});return n.jsx(_c,{...t})},Cc=e=>{let t=$r({hide:e.hide,pnl:e.pnl});return n.jsx(wc,{...t})},Dn="sharePnLDialog",In="sharePnLBottomSheet";jt(Dn,Cc,{classNames:{content:"!oui-max-w-[624px] oui-p-0"}});Ut(In,vc,{title:q.t("share.pnl.sharePnl"),classNames:{body:"oui-pb-4 oui-pt-0"}});var Nc=e=>{let{type:t,values:i}=e,[s,r]=De("TP/SL_Mode","Offset%"),[o,a]=p.useState(!0),{t:l}=S(),u=p.useMemo(()=>{switch(s){case"Offset":return`${t.toLowerCase()}_offset`;case"Offset%":return`${t.toLowerCase()}_offset_percentage`;default:return`${t.toLowerCase()}_pnl`}},[s]),d=p.useMemo(()=>i[s],[i,s]),c=p.useMemo(()=>[{label:l("tpsl.pnl"),value:"PnL",testId:"PnL_menu_item"},{label:l("tpsl.offset"),value:"Offset",testId:"Offset_mneu_item"},{label:`${l("tpsl.offset")}%`,value:"Offset%",testId:"Offset%_menu_item"}],[l]),m=p.useRef(""),y=f=>{e.onChange(u,f)},j=f=>{let{dp:b=2}=f;return{onRenderBefore:(x,C)=>(x=`${x}`,o&&t==="SL"&&s==="PnL"&&(x=x.startsWith("-")?x:"-"+x),x===""||x==="-"?"":s==="Offset%"?`${new T(x.replace(new RegExp(m.current.replace(".","\\.")+"$"),"")).mul(100).todp(2,4).toString()}${m.current}`:(s==="Offset"&&(x=Rn(x,b)),`${x}`)),onSendBefore:x=>{if(/^\-?0{2,}$/.test(x))return"0";if(s==="Offset%"){if(x!==""){x=Rn(x,2);let C=x.match(/\.0{0,2}$/);C?m.current=C[0]:m.current="",x=new T(x).div(100).toString(),x=`${x}${m.current}`}}else s==="PnL"&&t==="SL"&&o?x=x.startsWith("-")?x:"-"+x:x=Rn(x,b);return x===""||x==="-"?"":x}}};return{mode:s,modes:c,type:e.type,formatter:j,onModeChange:f=>{r(f)},value:d,pnl:i.PnL,onValueChange:y,quote_dp:e.quote_dp,setFocus:a}},Sc=e=>{let{mode:t,modes:i,onModeChange:s,onValueChange:r,quote:o,quote_dp:a,value:l,pnl:u}=e,{t:d}=S(),[c,m]=p.useState(t),[y,j]=p.useState(t==="Offset%"?"%":o),f=p.useMemo(()=>{let b=Number(u);if(isNaN(b)||b===0)return"";if(b>0)return"oui-text-trade-profit";if(b<0)return"oui-text-trade-loss"},[u]);return p.useEffect(()=>{var x;let b=(x=i.find(C=>C.value===t))==null?void 0:x.label;m(b),j(t==="Offset%"?"%":o)},[t,i]),n.jsx(fe,{prefix:c,size:{initial:"lg",lg:"md"},placeholder:y,align:"right",value:l,"data-testid":e.testId,autoComplete:"off",onValueChange:r,formatters:[e.formatter({dp:a,mode:t}),J.currencyFormatter,J.decimalPointFormatter],classNames:{input:f,prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onFocus:()=>{j(""),e.setFocus(!0)},onBlur:()=>{j(t==="Offset%"?"%":o),e.setFocus(!1)},suffix:n.jsxs(n.Fragment,{children:[t==="Offset%"&&!!l&&n.jsx(h,{size:"2xs",color:"inherit",className:E("oui-ml-[2px]",f),children:"%"}),n.jsx(Tc,{mode:t,modes:i,onModeChange:b=>s(b.value)})]})})},Tc=e=>n.jsx(aa,{currentValue:e.mode,menu:e.modes,align:"end",size:"xs",className:"oui-min-w-[80px]",onSelect:t=>e.onModeChange(t),children:n.jsx("button",{className:"oui-p-2",children:n.jsx(qs,{size:12,color:"white"})})}),os=e=>{let{testId:t,quote:i,...s}=e,r=Nc(s);return n.jsx(Sc,{...r,testId:t,quote:i})},Pc=e=>{let{TPSL_OrderEntity:t,symbolInfo:i,onCancel:s,onComplete:r,status:o,errors:a,isPosition:l}=e,{t:u}=S(),{parseErrorMsg:d}=wn(a);return n.jsxs("div",{id:"orderly-tp_sl-order-edit-content",children:[(!e.isEditing||e.isEditing&&!e.isPosition)&&n.jsxs(n.Fragment,{children:[n.jsx(kc,{maxQty:e.maxQty,quantity:e.orderQuantity??e.maxQty,baseTick:i("base_tick"),dp:i("base_dp"),onQuantityChange:e.setQuantity,quote:i("base"),isEditing:e.isEditing,isPosition:l,errorMsg:d("quantity")}),n.jsx(ye,{my:4,intensity:8})]}),n.jsx(Oc,{sl_pnl:t.sl_pnl,tp_pnl:t.tp_pnl,quote:i("quote"),quote_dp:i("quote_dp"),onPriceChange:e.setOrderPrice,onPnLChange:e.setPnL,errors:a,tp_values:{PnL:`${t.tp_pnl??""}`,Offset:`${t.tp_offset??""}`,"Offset%":`${t.tp_offset_percentage??""}`},sl_values:{PnL:`${t.sl_pnl??""}`,Offset:`${t.sl_offset??""}`,"Offset%":`${t.sl_offset_percentage??""}`},tp_trigger_price:t.tp_trigger_price??"",sl_trigger_price:t.sl_trigger_price??""}),n.jsxs(Oe,{cols:2,gap:3,mt:4,children:[n.jsx(te,{size:"md",color:"secondary","data-testid":"tpsl-cancel",onClick:()=>{s==null||s()},children:u("common.cancel")}),n.jsx(Nt,{size:"md","data-testid":"tpsl-confirm",disabled:!e.valid||o.isCreateMutating,loading:o.isCreateMutating||o.isUpdateMutating,onClick:()=>{e.onSubmit().then(()=>{r==null||r()}).catch(c=>{})},children:u("common.confirm")})]})]})},kc=e=>{let{isPosition:t}=e,i=p.useRef(null),s=oa(e.quantity,0,e.maxQty)/100,{t:r}=S(),o=()=>{var u,d;(u=e.onQuantityChange)==null||u.call(e,0),(d=i.current)==null||d.focus(),setTimeout(()=>{var c;(c=i.current)==null||c.setSelectionRange(0,1)},0)},a=u=>{var d;e.baseTick>0&&((d=e.onQuantityChange)==null||d.call(e,ue.formatNumber(u,e.baseTick)??u))},l=(t?"":e.quantity).toString().length>0?e.errorMsg:void 0;return n.jsxs(n.Fragment,{children:[n.jsxs(g,{gap:2,children:[n.jsx("div",{className:"oui-flex-1",children:n.jsx(fe.tooltip,{"data-testid":"oui-testid-tpsl-popUp-quantity-input",ref:i,prefix:r("common.quantity"),size:{initial:"lg",lg:"md"},align:"right",value:t?"":e.quantity,autoComplete:"off",classNames:{prefix:"oui-text-base-contrast-54",root:E("oui-bg-base-5 oui-outline-line-12",l&&"oui-outline-danger")},tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},tooltip:l,color:l?"danger":void 0,formatters:[J.dpFormatter(e.dp),J.numberFormatter,J.currencyFormatter,J.decimalPointFormatter],onValueChange:u=>{var c,m,y;(c=e.onQuantityChange)==null||c.call(e,u);let d=Number(u);if(d&&d>e.maxQty){let j=t?0:e.maxQty;(m=e.onQuantityChange)==null||m.call(e,j),(y=i.current)==null||y.blur()}},onBlur:u=>a(u.target.value),suffix:t?n.jsx("button",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",onClick:()=>{o()},children:r("tpsl.entirePosition")}):n.jsx("span",{className:"oui-text-2xs oui-text-base-contrast-54 oui-px-3",children:e.quote})})}),!e.isEditing&&n.jsx(te,{onClick:()=>{var d;let u=t?0:e.maxQty;(d=e.onQuantityChange)==null||d.call(e,u),u===0&&o()},variant:"outlined",className:E("oui-text-2xs oui-w-[68px] oui-h-[40px] xl:oui-h-[32px]",t?"oui-border-primary-light oui-text-primary-light hover:oui-bg-primary-light/20":"oui-bg-base-6 oui-border-line-12 oui-text-base-contrast-54 hover:oui-bg-base-5"),children:r("common.position")})]}),n.jsx(g,{mt:2,itemAlign:"center",height:"15px",children:n.jsx(wt.single,{markCount:5,color:"primary",max:e.maxQty,min:0,showTip:!0,step:e.baseTick,value:e.quantity,onValueCommit:u=>{a(`${u}`)},onValueChange:u=>{var d;(d=e.onQuantityChange)==null||d.call(e,u)}})}),n.jsxs(g,{justify:"between",children:[n.jsx(h.numeral,{rule:"percentages",color:"primary",size:"2xs",children:s}),n.jsxs(g,{itemAlign:"center",gap:1,children:[n.jsx("button",{className:"oui-leading-none",style:{lineHeight:0},onClick:()=>{var u;(u=e.onQuantityChange)==null||u.call(e,e.maxQty)},children:n.jsx(h,{color:"primary",size:"2xs",children:r("common.max")})}),n.jsx(h.numeral,{rule:"price",size:"2xs",intensity:54,tick:e.baseTick,children:e.maxQty})]})]})]})},Oc=e=>{var r,o;let{t}=S(),{parseErrorMsg:i}=wn(e.errors),s=(a,l)=>{e.onPnLChange(a,l)};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsxs(g,{justify:"between",children:[n.jsxs(g,{gap:1,children:[n.jsx(h,{size:"2xs",intensity:80,children:t("tpsl.takeProfit")}),n.jsx(h,{size:"2xs",intensity:36,children:`(${(r=t("orderEntry.orderType.marketOrder"))==null?void 0:r.toLowerCase()})`})]}),n.jsxs(g,{children:[n.jsx(h,{size:"2xs",intensity:36,children:`${t("tpsl.estPnl")}:`}),n.jsx(h.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.tp_pnl??"-"})]})]}),n.jsxs(Oe,{cols:2,gap:2,pt:2,pb:4,children:[n.jsx(as,{type:"TP",value:e.tp_trigger_price,error:i("tp_trigger_price"),onValueChange:a=>{e.onPriceChange("tp_trigger_price",a)},quote_dp:e.quote_dp??2}),n.jsx(os,{type:"TP",onChange:s,quote:e.quote,quote_dp:e.quote_dp,values:e.tp_values})]})]}),n.jsxs("div",{children:[n.jsxs(g,{justify:"between",children:[n.jsxs(g,{gap:1,children:[n.jsx(h,{size:"2xs",intensity:80,children:t("tpsl.stopLoss")}),n.jsx(h,{size:"2xs",intensity:36,children:`(${(o=t("orderEntry.orderType.marketOrder"))==null?void 0:o.toLowerCase()})`})]}),n.jsxs(g,{children:[n.jsx(h,{size:"2xs",intensity:36,children:`${t("tpsl.estPnl")}:`}),n.jsx(h.numeral,{size:"2xs",coloring:!0,showIdentifier:!0,className:"oui-ml-1",children:e.sl_pnl??"-"})]})]}),n.jsxs(Oe,{cols:2,gap:2,pt:2,pb:4,children:[n.jsx(as,{type:"SL",value:e.sl_trigger_price,error:i("sl_trigger_price"),onValueChange:a=>{e.onPriceChange("sl_trigger_price",a)},quote_dp:e.quote_dp??2}),n.jsx(os,{type:"SL",onChange:s,quote:e.quote,quote_dp:e.quote_dp,values:e.sl_values})]})]})]})},as=e=>{let[t,i]=p.useState("USDC"),{t:s}=S();return n.jsx(fe.tooltip,{"data-testid":`oui-testid-tpsl-popUp-${e.type.toLowerCase()}-input`,prefix:s("common.markPrice"),size:{initial:"lg",lg:"md"},tooltip:e.error,placeholder:t,align:"right",autoComplete:"off",value:e.value,color:e.error?"danger":void 0,classNames:{prefix:"oui-text-base-contrast-54",root:"oui-outline-line-12 focus-within:oui-outline-primary-light"},onValueChange:e.onValueChange,onFocus:()=>{i("")},onBlur:()=>{i("USDC")},formatters:[J.numberFormatter,J.dpFormatter(e.quote_dp),J.currencyFormatter,J.decimalPointFormatter]})},Yr=e=>{let{symbol:t,tpPrice:i,slPrice:s,qty:r,maxQty:o,side:a,quoteDP:l,baseDP:u,isEditing:d,isPositionTPSL:c}=e,{t:m}=S(),[y,j]=De("orderly_order_confirm",!0),f=bt({size:"xs",intensity:54}),b=c??r>=o;return n.jsxs(n.Fragment,{children:[d&&n.jsx(h,{as:"div",size:"2xs",intensity:80,className:"oui-mb-3",children:`You agree to edit your ${na(t)} order.`}),n.jsxs(g,{pb:4,children:[n.jsx(W,{grow:!0,children:n.jsx(h.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,as:"div",intensity:80,children:t})}),n.jsxs(g,{gap:1,children:[b&&n.jsx(ee,{size:"xs",color:"primary",children:m("common.position")}),n.jsx(Dc,{tpPrice:i,slPrice:s}),a===ke.SELL?n.jsx(ee,{size:"xs",color:"success",children:m("common.buy")}):n.jsx(ee,{size:"xs",color:"danger",children:m("common.sell")})]})]}),n.jsx(ye,{}),n.jsxs(g,{direction:"column",itemAlign:"stretch",gapY:1,pt:4,className:E(f,"oui-pb-4 xl:oui-pb-5"),children:[n.jsxs(g,{children:[n.jsx(W,{grow:!0,children:m("common.qty")}),n.jsx("div",{children:b?n.jsx("span",{className:"oui-text-base-contrast",children:m("tpsl.entirePosition")}):n.jsx(h.numeral,{intensity:98,dp:u,padding:!1,children:r})})]}),typeof i=="number"&&i>0?n.jsxs(g,{children:[n.jsx(W,{grow:!0,children:m("tpsl.tpPrice")}),n.jsx(h.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:i})]}):null,typeof s=="number"&&s>0?n.jsxs(g,{children:[n.jsx(W,{grow:!0,children:m("tpsl.slPrice")}),n.jsx(h.numeral,{as:"div",coloring:!0,unit:"USDC",size:"sm",dp:l,className:"oui-text-trade-loss",unitClassName:"oui-text-base-contrast-54 oui-ml-1",children:s})]}):null,n.jsxs(g,{children:[n.jsx(W,{grow:!0,children:m("common.price")}),n.jsx("div",{className:"oui-text-base-contrast",children:m("common.marketPrice")})]})]}),n.jsx(W,{pt:2,children:n.jsxs(g,{gap:1,children:[n.jsx(As,{id:"disabledConfirm",color:"white",checked:!y,onCheckedChange:x=>{j(!x)}}),n.jsx("label",{htmlFor:"disabledConfirm",className:bt({size:"xs",intensity:54,className:"oui-ml-1"}),children:m("orderEntry.disableOrderConfirm")})]})})]})},Dc=e=>{let{tpPrice:t,slPrice:i}=e,{t:s}=S();return t&&i?n.jsx(ee,{size:"xs",color:"neutral",children:s("common.tpsl")}):t?n.jsx(ee,{size:"xs",color:"neutral",children:s("tpsl.tp")}):i?n.jsx(ee,{size:"xs",color:"neutral",children:s("tpsl.sl")}):null},Ic=e=>{let{position:t,order:i,isEditing:s}=e;if(s&&!i)throw new ia("order is required when isEditing is true");let r=s?i.symbol:t.symbol,o=Ee(),a=p.useRef(Z.TP_SL),[l]=De("orderly_order_confirm",!0),[u,{submit:d,deleteOrder:c,setValue:m,validate:y,errors:j,isCreateMutating:f,isUpdateMutating:b}]=sa({symbol:r,position_qty:t.position_qty,average_open_price:t.average_open_price},{defaultOrder:i,isEditing:s}),x=_=>{m("quantity",_)},C=(_,D)=>{m(_,D)},w=(_,D)=>{m(_,D)},v=p.useMemo(()=>Math.abs(Number(t.position_qty)),[t.position_qty]),N=p.useMemo(()=>{let _=(i==null?void 0:i.algo_type)===Z.POSITIONAL_TP_SL?v:i==null?void 0:i.quantity,D=0;if((Number(u.quantity)!==_||!s&&u.quantity)&&(D=1),i&&s){let M=i.child_orders.find(F=>F.algo_type===je.TAKE_PROFIT),L=i.child_orders.find(F=>F.algo_type===je.STOP_LOSS);(M==null?void 0:M.trigger_price)!==Number(u.tp_trigger_price)&&typeof typeof u.tp_trigger_price<"u"&&(D=2),(L==null?void 0:L.trigger_price)!==Number(u.sl_trigger_price)&&typeof u.sl_trigger_price<"u"&&(D=3)}return D===1&&!u.tp_trigger_price&&!u.sl_trigger_price&&(D=-1),D},[u.tp_trigger_price,u.sl_trigger_price,u.quantity,i,s]),I=p.useMemo(()=>(i==null?void 0:i.algo_type)===Z.POSITIONAL_TP_SL&&Number(u.quantity)<v&&!u.tp_trigger_price&&!u.sl_trigger_price?!1:N>0&&!!u.quantity&&!j,[u.quantity,v,N,j]),O=p.useMemo(()=>s?i&&i.algo_type!==Z.POSITIONAL_TP_SL?!1:u.algo_order_id&&u.quantity==0?!0:Number(u.quantity)>=v:Number(u.quantity)>=v,[u.quantity,v,i==null?void 0:i.algo_type,s]);p.useEffect(()=>{if(!s&&O){let _=ue.findTPSLFromOrder(i);!u.tp_trigger_price&&_.tp_trigger_price&&C("tp_trigger_price",_.tp_trigger_price),!u.sl_trigger_price&&_.sl_trigger_price&&C("sl_trigger_price",_.sl_trigger_price)}},[s,O,u]),p.useEffect(()=>{let _=Number(u.quantity)<v?Z.TP_SL:Z.POSITIONAL_TP_SL;typeof e.onTPSLTypeChange=="function"&&a.current!==_&&e.onTPSLTypeChange(_),a.current=_},[u.quantity,v]);let A=()=>i!=null&&i.algo_order_id&&(i!=null&&i.symbol)?c(i==null?void 0:i.algo_order_id,i==null?void 0:i.symbol):Promise.reject("order id or symbol is invalid"),k=async()=>typeof e.onConfirm!="function"||!l?d({accountId:t.account_id}).then(()=>!0).catch(_=>{throw _!=null&&_.message&&U.error(_.message),!1}):e.onConfirm(u,{position:t,submit:d,cancel:A});return{isEditing:s,symbolInfo:o[r],maxQty:v,setQuantity:x,orderQuantity:u.quantity,isPosition:O,TPSL_OrderEntity:u,setOrderValue:m,setPnL:w,setOrderPrice:C,onSubmit:k,valid:I,errors:j,status:{isCreateMutating:f,isUpdateMutating:b}}},Zr=e=>{let{onCancel:t,onComplete:i,...s}=e,r=Ic(s);return n.jsx(Pc,{...r,onCancel:t,onComplete:i})},Ti=e=>{let{position:t,order:i,baseDP:s,quoteDP:r,buttonProps:o,isEditing:a}=e,[l,u]=p.useState(!1),[d,c]=p.useState(!0),[m]=De("orderly_order_confirm",!0),{t:y}=S(),j=a?(i==null?void 0:i.algo_type)===Z.POSITIONAL_TP_SL:void 0;return n.jsxs(xn,{onOpenChange:f=>{d&&u(f)},open:l,children:[n.jsx(gn,{asChild:!0,onClick:()=>{u(!0)},children:e.children||n.jsx(te,{variant:"outlined",size:"sm",color:"secondary",...o,children:e.label})}),n.jsx(yn,{className:E("oui-w-[360px]",d?"oui-visible":"oui-invisible"),align:"end",side:"top",children:n.jsx(Zr,{position:t,order:i,isEditing:a,onComplete:()=>{u(!1)},onCancel:()=>{u(!1)},onConfirm:(f,b)=>{if(!m)return Promise.resolve(!0);c(!1);let x=Math.abs(Number(t.position_qty));if(`${f.tp_trigger_price??""}`.length===0&&`${f.sl_trigger_price??""}`.length===0)return he.confirm({title:y("orders.cancelOrder"),content:y("tpsl.cancelOrder.description"),onOk:()=>b.cancel()}).then(()=>(u(!1),c(!0),!0),()=>(c(!0),Promise.reject(!1)));let C=a||!!f&&f.algo_type===Z.POSITIONAL_TP_SL&&f.quantity===x;return he.confirm({title:y(C?"orders.editOrder":"tpsl.confirmOrder"),onOk:async()=>{try{let w=await b.submit({accountId:t.account_id});return w.success?w:(w.message&&U.error(w.message),!1)}catch(w){return w!=null&&w.message&&U.error(w.message),!1}},classNames:{body:"!oui-pb-0"},content:n.jsx(Yr,{isPositionTPSL:j,isEditing:C,symbol:f.symbol,qty:Number(f.quantity),maxQty:x,tpPrice:Number(f.tp_trigger_price),slPrice:Number(f.sl_trigger_price),side:f.side,quoteDP:r??2,baseDP:s??2})}).then(()=>(u(!1),c(!0),!0),()=>(c(!0),Promise.reject(!1)))}})})]})},eo=e=>{let{position:t,order:i,symbolInfo:s,isEditing:r}=e,{resolve:o,hide:a,updateArgs:l}=pn(),[u]=De("orderly_order_confirm",!0),{t:d}=S(),c=r?(i==null?void 0:i.algo_type)===Z.POSITIONAL_TP_SL:void 0,m=b=>{r||l({title:b})},y=()=>{o(),a()},{quote_dp:j,base_dp:f}=s;return n.jsxs(n.Fragment,{children:[n.jsx(Lc,{position:t,symbolInfo:s}),n.jsx(Zr,{...e,onTPSLTypeChange:b=>{m(b===Z.TP_SL?d("common.tpsl"):d("tpsl.positionTpsl"))},onComplete:y,onConfirm:(b,x)=>{if(!u)return Promise.resolve(!0);let C=Math.abs(Number(t.position_qty)),w=r||!!b&&b.algo_type===Z.POSITIONAL_TP_SL&&b.quantity===C;return he.confirm({title:d(w?"orders.editOrder":"tpsl.confirmOrder"),bodyClassName:"oui-pb-0 lg:oui-pb-0",onOk:async()=>{try{let v=await x.submit({accountId:t.account_id});return v.success?v:(v.message&&U.error(v.message),!1)}catch(v){return v!=null&&v.message&&U.error(v.message),!1}},content:n.jsx(Yr,{isPositionTPSL:c,isEditing:r,symbol:b.symbol,qty:Number(b.quantity),maxQty:C,tpPrice:Number(b.tp_trigger_price),slPrice:Number(b.sl_trigger_price),side:b.side,quoteDP:j??2,baseDP:f??2})}).then(()=>!0,v=>(v!=null&&v.message&&U.error(v.message),Promise.reject(!1)))},onCancel:()=>{a()}})]})},Lc=e=>{var l;let{position:t,symbolInfo:i}=e,{data:s}=ra(t.symbol),r=pn(),{t:o}=S(),a=p.useMemo(()=>{var u;return((u=r.args)==null?void 0:u.title)===o("tpsl.positionTpsl")},[(l=r.args)==null?void 0:l.title,o]);return n.jsxs(n.Fragment,{children:[n.jsxs(g,{justify:"between",pb:3,itemAlign:"center",children:[n.jsx(h.formatted,{rule:"symbol",className:"oui-text-xs",showIcon:!0,children:t.symbol}),n.jsxs(g,{gapX:1,children:[a&&n.jsx(ee,{size:"xs",color:"primary",children:o("common.position")}),n.jsx(ee,{size:"xs",color:"neutral",children:o("common.tpsl")}),t.position_qty<0?n.jsx(ee,{size:"xs",color:"buy",children:o("common.buy")}):n.jsx(ee,{size:"xs",color:"sell",children:o("common.sell")})]})]}),n.jsx(ye,{intensity:8}),n.jsxs(W,{py:3,className:"oui-space-y-1",children:[n.jsxs(g,{justify:"between",children:[n.jsx(h,{size:"sm",intensity:54,children:o("common.avgOpen")}),n.jsx(h.numeral,{className:"oui-text-xs",unit:i.quote,dp:i.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:t.average_open_price})]}),n.jsxs(g,{justify:"between",children:[n.jsx(h,{size:"sm",intensity:54,children:o("common.markPrice")}),n.jsx(h.numeral,{className:"oui-text-xs",unit:i.quote,dp:i.quote_dp,unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:s})]})]})]})},to=e=>{let{hideCloseIcon:t=!1}=e;return n.jsxs("div",{className:"oui-relative oui-w-full oui-border-b oui-border-line-4 oui-pb-3",children:[n.jsx(h,{size:"base",children:e.title}),!t&&n.jsx("button",{onClick:e.onClose,className:"oui-absolute oui-right-0 oui-top-0 oui-p-2 oui-text-base-contrast-54 hover:oui-text-base-contrast-80",children:n.jsx(Us,{size:18,color:"white"})})]})},Pi=e=>{let{t}=S();return n.jsxs(g,{id:"oui-positions-confirm-footer",gap:2,width:"100%",className:"oui-mt-3 oui-pb-1",children:[n.jsx(te,{id:"oui-positions-confirm-footer-cancel-button",color:"secondary",fullWidth:!0,onClick:e.onCancel,size:"md",children:t("common.cancel")}),n.jsx(Nt,{id:"oui-positions-confirm-footer-confirm-button",onClick:e.onConfirm,fullWidth:!0,loading:e.submitting,disabled:e.disabled,size:"md",children:t("common.confirm")})]})},Ec=e=>{let{quantity:t,price:i,quoteDp:s,side:r}=e,{t:o}=S(),a=p.useMemo(()=>i&&t?new T(i).mul(t).toFixed(s,T.ROUND_DOWN):"--",[i,t]);return n.jsxs(g,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:5,children:[n.jsxs(g,{justify:"between",width:"100%",gap:1,children:[n.jsx(h,{children:o("common.qty")}),n.jsx(h,{color:r===ke.BUY?"success":"danger",children:t})]}),n.jsxs(g,{justify:"between",width:"100%",gap:1,children:[n.jsx(h,{children:o("common.price")}),n.jsx(h.formatted,{intensity:98,suffix:n.jsx(h,{intensity:54,children:"USDC"}),children:i})]}),n.jsxs(g,{justify:"between",width:"100%",gap:1,children:[n.jsx(h,{children:o("common.notional")}),n.jsx(h.formatted,{intensity:98,suffix:n.jsx(h,{intensity:54,children:"USDC"}),children:a})]})]})},ki=e=>{var s;let{t}=S(),i=()=>{var r;(r=(e==null?void 0:e.onClose)??e.close)==null||r()};return n.jsxs(g,{direction:"column",className:(s=e.classNames)==null?void 0:s.root,children:[n.jsx(to,{onClose:i,title:t("positions.marketClose"),hideCloseIcon:e.hideCloseIcon}),n.jsx(h,{intensity:54,size:"sm",className:"oui-my-5",children:t("positions.marketClose.description",{quantity:re(e.quantity),base:e.base})}),n.jsx(Pi,{onCancel:i,onConfirm:async()=>{var r;await((r=e.onConfirm)==null?void 0:r.call(e)),i()},submitting:e.submitting})]})},no=e=>{let{order:t,quoteDp:i,quantity:s,price:r}=e,{side:o}=t,{t:a}=S(),l=()=>{var u;(u=e.onClose)==null||u.call(e)};return n.jsxs(n.Fragment,{children:[n.jsx(to,{onClose:l,title:a("positions.limitClose"),hideCloseIcon:e.hideCloseIcon}),n.jsx(W,{mt:5,children:n.jsx(h,{intensity:54,size:"sm",children:a("positions.limitClose.description",{quantity:zs(e.quantity),base:e.base})})}),n.jsxs(g,{gap:2,mb:4,mt:5,justify:"between",children:[n.jsx(h.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:t.symbol}),n.jsxs(g,{gap:1,children:[n.jsx(ee,{color:"neutral",size:"xs",children:a("orderEntry.orderType.limit")}),n.jsx(ee,{color:o===ke.BUY?"success":"danger",size:"xs",children:o===ke.BUY?a("common.buy"):a("common.sell")})]})]}),n.jsx(ye,{className:"oui-w-full"}),n.jsx(Ec,{className:"oui-text-sm",price:r,quantity:s,side:t.side,quoteDp:i??2}),n.jsx(Pi,{onCancel:l,onConfirm:e.onConfirm,submitting:e.submitting})]})};function Ac(e,t){let i=p.useRef(),s=p.useRef(t);s.current=t,p.useEffect(()=>{let r={root:null,rootMargin:"0px",threshold:0},o=a=>{a.forEach(l=>{var u;l.isIntersecting&&((u=s.current)==null||u.call(s))})};return i.current=new IntersectionObserver(o,r),()=>{var a;(a=i.current)==null||a.disconnect()}},[]),p.useEffect(()=>{var r;(r=i.current)==null||r.observe(e.current)},[])}var qc=e=>{let t=p.useRef(null),{onEndReached:i}=e;return Ac(t,()=>{i==null||i()}),n.jsxs(n.Fragment,{children:[e.children,n.jsx("div",{ref:t,className:"oui-relative oui-invisible oui-h-[25px] oui-bg-red-400 oui-top-[-300px]"})]})},ls=({total:e,symbol:t,start_t:i,end_t:s})=>{let{t:r}=S(),{isMobile:o}=_t(),{isLoading:a,data:l,setSize:u}=Ms((y,j)=>j&&!j.length?null:`/v1/funding_fee/history?page=${y}&symbol=${t}&start_t=${i}&end_t=${s}`,{revalidateFirstPage:!1}),d=p.useCallback(()=>{u(y=>y+1)},[u]),c=p.useMemo(()=>Array.isArray(l)?l.flat().map(y=>({...y,funding_fee:-y.funding_fee})):[],[l]),m=p.useMemo(()=>o?n.jsx(Mc,{data:c??[],isLoading:a,loadMore:d}):n.jsx(Rc,{data:c??[],isLoading:a,loadMore:d}),[o,c,a]);return n.jsxs("div",{children:[n.jsxs(Oe,{cols:2,gapX:3,className:"oui-sticky oui-top-0 oui-z-10 oui-bg-base-8 oui-py-4",children:[n.jsx("div",{className:"oui-rounded-lg oui-border oui-border-line-6 oui-bg-base-9 oui-p-3",children:n.jsxs(g,{direction:"column",gap:1,itemAlign:"start",children:[n.jsx("span",{className:"oui-text-2xs oui-text-base-contrast-36",children:r("common.symbol")}),n.jsx(h.formatted,{rule:"symbol",className:"oui-font-semibold",intensity:98,children:t})]})}),n.jsx("div",{className:"oui-rounded-lg oui-border oui-border-line-6 oui-bg-base-9 oui-p-3",children:n.jsx(se,{label:`${r("funding.fundingFee")} (USDC)`,valueProps:{ignoreDP:!0,coloring:!0,showIdentifier:!0},children:e})})]}),m]})},Rc=({isLoading:e,data:t,loadMore:i})=>{let{t:s}=S(),r=p.useMemo(()=>[{title:s("common.time"),dataIndex:"created_time",width:120,render:o=>n.jsx(h.formatted,{rule:"date",children:o})},{title:s("funding.fundingRate"),dataIndex:"funding_rate",formatter:o=>new T(o).mul(100).toString(),render:o=>n.jsx("span",{children:`${o}%`})},{title:s("funding.paymentType"),dataIndex:"payment_type",formatter:o=>s(o==="Pay"?"funding.paymentType.paid":"funding.paymentType.received"),render:o=>n.jsx("span",{children:o})},{title:`${s("funding.fundingFee")} (USDC)`,dataIndex:"funding_fee",render:o=>n.jsx(h.numeral,{rule:"price",coloring:!0,showIdentifier:!0,ignoreDP:!0,children:o})}],[s]);return n.jsx("div",{className:"oui-h-[calc(80vh_-_132px_-_8px)] oui-overflow-y-auto",children:n.jsx(qc,{onEndReached:i,children:n.jsx(ma,{classNames:{root:E("oui-h-auto oui-bg-base-8 oui-text-sm")},columns:r,dataSource:t??[],loading:e})})})},Mc=({data:e,isLoading:t,loadMore:i})=>{let s=p.useCallback(r=>n.jsx(Fc,{item:r}),[]);return n.jsx("div",{className:"oui-h-[calc(80vh_-_104px)] oui-overflow-y-auto",children:n.jsx(Ht,{dataSource:e,renderItem:s,isLoading:t,contentClassName:"oui-space-y-0",loadMore:i})})},Fc=({item:e})=>{let{t}=S();return n.jsxs("div",{className:"oui-flex oui-flex-col oui-space-y-2 oui-border-t oui-border-line-6 oui-py-2",children:[n.jsxs(g,{justify:"between",children:[n.jsx(se,{label:t("funding.fundingRate"),classNames:{label:"oui-text-2xs"},valueProps:{ignoreDP:!0,rule:"percentages",className:"oui-text-xs"},children:e.funding_rate}),n.jsx(se,{label:t("common.amount"),className:"oui-items-end",classNames:{label:"oui-text-2xs"},valueProps:{ignoreDP:!0,coloring:!0,as:"div",className:"oui-text-xs",showIdentifier:!0},children:e.funding_fee})]}),n.jsxs(g,{justify:"between",children:[n.jsx(h.formatted,{rule:"date",className:"oui-text-base-contrast-36",size:"2xs",children:e.created_time}),n.jsx(h,{size:"sm",intensity:80,children:e.payment_type==="Pay"?t("funding.paymentType.paid"):t("funding.paymentType.received")})]})]})},Ln=({fee:e,symbol:t,start_t:i,end_t:s})=>{let{t:r}=S(),[o,{setTrue:a,setFalse:l}]=Ct(!1),{isMobile:u}=_t();return n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:a,children:n.jsx(h.numeral,{rule:"price",coloring:!0,showIdentifier:!0,ignoreDP:!0,className:"oui-border-b oui-border-line-16 oui-border-dashed oui-py-0.5",children:e})}),u?n.jsx(ai,{open:o,onOpenChange:l,title:r("funding.fundingFee"),classNames:{body:"oui-max-h-[80vh] oui-py-0"},children:n.jsx(ls,{total:e,symbol:t,start_t:i,end_t:s})}):n.jsx(vt,{open:o,onOpenChange:l,title:r("funding.fundingFee"),classNames:{content:"lg:oui-max-w-[640px]",body:"oui-max-h-[80vh] oui-bg-base-8 lg:oui-py-0"},children:n.jsx(ls,{total:e,symbol:t,start_t:i,end_t:s})})]})},$c=(e,t)=>{let i=Ne("apiBaseUrl");return s=>(r,o,a)=>{try{return s(r,async l=>{let u=Array.isArray(l)?l[0]:l,d=`${i}${u}`,c=e.signer,m={method:"GET",url:u},y=await c.sign(m,ga()),j=Array.isArray(t)?t:[t];return Promise.all(j.map(f=>o(d,{headers:{...y,"orderly-account-id":f}})))},a)}catch(l){throw l}}},zc=(e,t)=>{let{formatter:i,accountId:s,...r}=t||{},{state:o,account:a}=Fe(),l=Array.isArray(t==null?void 0:t.use)?(t==null?void 0:t.use)??[]:[],u=Array.isArray(s)?s:[s],d=u.filter(Boolean).length&&(o.status>=Me.EnableTrading||o.status===Me.EnableTradingWithoutConnected);return fa(()=>d?[e,u]:null,(c,m)=>xa(c,m,{formatter:i}),{...r,use:[...l,$c(a,u)],onError:()=>{}})},Uc=e=>{let{symbol:t,calcMode:i,includedPendingOrder:s,pnlNotionalDecimalPrecision:r,sharePnLConfig:o,onSymbolChange:a,selectedAccount:l}=e,{pagination:u,setPage:d}=Wt({pageSize:50});p.useEffect(()=>{d(1)},[t]);let c=Ee(),{state:m}=Fe(),[y,,{isLoading:j}]=ci(t,{calcMode:i,includedPendingOrder:s}),{data:f=[],isLoading:b,mutate:x}=Rs("/v1/client/aggregate/positions",{errorRetryCount:3}),{data:C=[],isLoading:w}=zc("/v1/client/info",{accountId:f.map(k=>k.account_id),revalidateOnFocus:!1}),v=ha(f.filter(k=>k.account_id!==m.mainAccountId),k=>{for(let _ of k){let D=c[_.symbol],M=We.notional(_.position_qty,_.mark_price),L=C.find(Y=>Y.account_id===_.account_id),F=We.MMR({baseMMR:D==null?void 0:D("base_mmr"),baseIMR:D==null?void 0:D("base_imr"),IMRFactor:(L==null?void 0:L.imr_factor[_.symbol])??0,positionNotional:M,IMR_factor_power:4/5}),z=We.maintenanceMargin({positionQty:_.position_qty,markPrice:_.mark_price,MMR:F}),R=We.unrealizedPnL({qty:_.position_qty,openPrice:_==null?void 0:_.average_open_price,markPrice:_.mark_price}),H=mn.IMR({maxLeverage:(L==null?void 0:L.max_leverage)??1,baseIMR:D==null?void 0:D("base_imr"),IMR_Factor:(L==null?void 0:L.imr_factor[_.symbol])??0,positionNotional:M,ordersNotional:0,IMR_factor_power:4/5}),ne=We.unrealizedPnLROI({positionQty:_.position_qty,openPrice:_.average_open_price,IMR:H,unrealizedPnL:R}),B=0,$=0;_.index_price&&(B=We.unrealizedPnL({qty:_.position_qty,openPrice:_==null?void 0:_.average_open_price,markPrice:_.index_price}),$=We.unrealizedPnLROI({positionQty:_.position_qty,openPrice:_.average_open_price,IMR:H,unrealizedPnL:B})),_.mmr=F,_.mm=z,_.notional=M,_.unrealized_pnl=R,_.unrealized_pnl_ROI=ne,_.unrealized_pnl_ROI_index=$}}),N=Kt([...y==null?void 0:y.rows,...v].filter(k=>k.position_qty!==0))??[],I=p.useMemo(()=>!l||l==="All accounts"?N:N.filter(k=>l==="Main accounts"?k.account_id===m.mainAccountId||!k.account_id:k.account_id===l),[N,l,m.mainAccountId]),O=p.useMemo(()=>Bc(I,{mainAccountId:m.mainAccountId,subAccounts:m.subAccounts}),[I,m.mainAccountId,m.subAccounts]),A=p.useMemo(()=>j||b||w,[j,b,w]);return{tableData:O,isLoading:A,pnlNotionalDecimalPrecision:r,sharePnLConfig:o,symbol:t,onSymbolChange:a,pagination:u,mutatePositions:x}},Bc=(e,t)=>{var o,a;let{mainAccountId:i="",subAccounts:s=[]}=t,r=new Map;for(let l of e){let u=l.account_id||i,d=s.find(c=>c.id===u);r.has(u)?(a=(o=r.get(u))==null?void 0:o.children)==null||a.push(l):r.set(u,{id:u,description:u===i?q.t("common.mainAccount"):(d==null?void 0:d.description)||Bs((d==null?void 0:d.id)||""),children:[l]})}return{expanded:Array.from(r.keys()),dataSource:Array.from(r.values())}},io=e=>{let{symbol:t,calcMode:i,includedPendingOrder:s,pnlNotionalDecimalPrecision:r,sharePnLConfig:o,onSymbolChange:a}=e,{pagination:l,setPage:u}=Wt({pageSize:50});ce.useEffect(()=>{u(1)},[t]);let[d,,{isLoading:c}]=ci(t,{calcMode:i,includedPendingOrder:s});return{dataSource:Kt(d==null?void 0:d.rows,{fallbackData:[]})??void 0,isLoading:c,pnlNotionalDecimalPrecision:r,sharePnLConfig:o,symbol:t,onSymbolChange:a,pagination:l}},so=p.createContext({}),Ke=()=>p.useContext(so),Jt=e=>{let t=Ee()[e.symbol];return n.jsx(so.Provider,{value:{symbol:e.symbol,base_dp:t("base_dp"),quote_dp:t("quote_dp"),base_tick:t("base_tick"),quote_tick:t("quote_tick"),base:t("base"),quote:t("quote"),origin:t(),quote_max:t("quote_max"),quote_min:t("quote_min")},children:e.children})},ro=e=>{let{t}=S();return n.jsxs(n.Fragment,{children:[n.jsx(wt,{showTip:!0,markCount:4,value:[e.value],color:"primary",onValueChange:i=>{e.onValueChange(i[0])}}),n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h,{color:"primary",size:"2xs",children:`${e.value}%`}),n.jsxs(g,{gap:1,onClick:e.onMax,className:"oui-cursor-pointer",children:[n.jsx(h,{size:"2xs",color:"primary",children:t("common.max")}),n.jsx(h.numeral,{intensity:54,size:"2xs",dp:e.base_dp,padding:!1,children:e.max})]})]})]})},Wc=e=>{let{base:t,base_dp:i,quote:s,quote_dp:r,sheetOpen:o,setSheetOpen:a,dialogOpen:l,setDialogOpen:u,quantity:d,price:c,submitting:m,priceErrorMsg:y,quantityErrorMsg:j,disabled:f,isMarketClose:b,position:x,maxQty:C,isBuy:w}=e,{t:v}=S(),N=v(b?"positions.marketClose":"positions.limitClose"),I=v(b?"orderEntry.orderType.market":"orderEntry.orderType.limit"),O=w?n.jsx(ee,{color:"success",size:"xs",children:v("common.buy")}):n.jsx(ee,{color:"danger",size:"xs",children:v("common.sell")}),A=n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h.formatted,{rule:"symbol",showIcon:!0,children:x.symbol}),n.jsxs(g,{gap:1,children:[n.jsx(ee,{color:"neutral",size:"xs",children:I}),O]})]}),k=n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h,{intensity:54,children:v("common.lastPrice")}),n.jsx(h.numeral,{dp:r,suffix:n.jsxs(h,{intensity:36,children:[" ",s]}),children:x.mark_price})]}),_=!b&&n.jsx(n.Fragment,{children:n.jsxs(g,{width:"100%",direction:"column",gap:2,children:[n.jsx(fe.tooltip,{prefix:v("common.price"),suffix:s,align:"right",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(r)],triggerClassName:"oui-w-full",tooltip:y,color:y?"danger":void 0,value:c,onValueChange:e.updatePriceChange,classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:E("oui-w-full oui-outline-line-12",y?"oui-outline-danger":void 0)}}),n.jsx(fe.tooltip,{prefix:v("common.quantity"),suffix:t,align:"right",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(i)],triggerClassName:"oui-w-full",tooltip:j,color:j?"danger":void 0,value:d,onBlur:()=>e.formatQuantityToBaseTick(d),onValueChange:e.updateQuantity,classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:E("oui-w-full oui-outline-line-12",j?"oui-outline-danger":void 0)}})]})}),D=n.jsx(ro,{value:e.sliderValue,onValueChange:e.onSliderValueChange,base_dp:i,max:C,onMax:e.onMax}),M=n.jsxs(g,{width:"100%",gap:3,mt:2,children:[n.jsx(te,{fullWidth:!0,color:"secondary",onClick:e.onCloseSheet,children:v("common.cancel")}),n.jsx(Nt,{fullWidth:!0,disabled:m||f,loading:m,onClick:L=>{L.stopPropagation(),L.preventDefault(),e.onDoubleConfirm()},children:v("common.confirm")})]});return n.jsxs(n.Fragment,{children:[n.jsx(te,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:L=>{L.stopPropagation(),L.preventDefault(),a(!0)},children:N}),n.jsx(ai,{title:N,open:o,onOpenChange:a,children:n.jsxs(g,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[A,n.jsx(ye,{className:"oui-w-full"}),k,_,D,M]})}),n.jsx(vt,{open:l,onOpenChange:u,size:"xs",children:b?n.jsx(ki,{base:t,quantity:d,submitting:m,onClose:e.onCloseDialog,onConfirm:e.onConfirm,hideCloseIcon:!0}):n.jsx(no,{base:t,quoteDp:r,quantity:d,price:c,submitting:m,order:e.closeOrderData,onClose:e.onCloseDialog,onConfirm:e.onConfirm,hideCloseIcon:!0})})]})},Vc=e=>{let{position:t,base:i,base_dp:s,quote_dp:r,price:o,quantity:a,submitting:l,dialogOpen:u,setDialogOpen:d,isMarketClose:c,popoverOpen:m,setPopoverOpen:y,maxQty:j,quantityErrorMsg:f,priceErrorMsg:b,isEntirePosition:x}=e,{t:C}=S(),w=n.jsxs(g,{width:"100%",gap:2,mb:1,children:[n.jsx(fe.tooltip,{ref:e.quantityInputRef,prefix:C("common.quantity"),suffix:x?n.jsx(h,{size:"2xs",intensity:54,className:"oui-cursor-pointer oui-px-3",onClick:e.onEntirePosition,children:C("tpsl.entirePosition")}):i,align:"right",size:"md",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(s)],triggerClassName:"oui-w-full",tooltip:f,color:f?"danger":void 0,value:x?"":a,onBlur:()=>e.formatQuantityToBaseTick(a),onValueChange:e.updateQuantity,classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:E("oui-w-full oui-outline-line-12",f?"oui-outline-danger":void 0)}}),n.jsx(te,{onClick:e.onMax,size:"md",variant:"outlined",className:E("oui-text-2xs",x?"oui-border-primary-light oui-text-primary-light hover:oui-bg-primary-light/20":"oui-border-line-12 oui-bg-base-6 oui-text-base-contrast-54 hover:oui-bg-base-5"),children:C("common.position")})]}),v=n.jsx(vs.options,{variant:"text",size:"md",options:[{label:C("orderEntry.orderType.limit"),value:ie.LIMIT},{label:C("orderEntry.orderType.market"),value:ie.MARKET}],classNames:{trigger:"oui-w-[--radix-select-content-available-width]"},value:e.type,onValueChange:O=>{e.updateOrderType(O)},contentProps:{align:"end",className:"oui-border oui-border-line-6"}}),N=c,I=n.jsx(fe.tooltip,{suffix:v,size:"md",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(r)],triggerClassName:"oui-w-full",tooltip:b,color:b?"danger":void 0,value:o,onValueChange:e.updatePriceChange,placeholder:N?"--":"",disabled:N,classNames:{prefix:"oui-text-base-contrast-54",suffix:"oui-text-base-contrast-54",root:E("oui-w-full oui-outline-line-12",b?"oui-outline-danger":void 0,N?"focus-within:oui-outline-line-12":void 0)}});return n.jsxs(n.Fragment,{children:[n.jsxs(xn,{open:m,onOpenChange:y,children:[n.jsx(gn,{asChild:!0,onClick:()=>{y(!0)},children:n.jsx(te,{variant:"outlined",size:"sm",color:"secondary",children:C("positions.column.close")})}),n.jsx(yn,{className:E("oui-w-[360px] oui-p-5",m?"oui-visible":"oui-invisible"),align:"end",side:"top",onOpenAutoFocus:O=>O.preventDefault(),children:n.jsxs(g,{gapY:2,direction:"column",children:[w,n.jsx(ro,{value:e.sliderValue,onValueChange:e.onSliderValueChange,base_dp:s,max:j,onMax:e.onMax}),n.jsx(ye,{my:2,intensity:8,className:"oui-w-full"}),I,n.jsx(Pi,{onConfirm:e.onDoubleConfirm,onCancel:e.onClosePopover,submitting:l,disabled:e.disabled})]})})]}),n.jsx(vt,{open:u,onOpenChange:d,size:"sm",children:c?n.jsx(ki,{base:i,quantity:a,submitting:l,onClose:e.onCloseDialog,onConfirm:e.onConfirm,classNames:{root:"oui-items-start"},hideCloseIcon:!0}):n.jsx(no,{base:i,quoteDp:r,quantity:a,price:o,submitting:l,order:e.closeOrderData,onClose:e.onCloseDialog,onConfirm:e.onConfirm,hideCloseIcon:!0})})]})},oo=p.createContext({}),lt=()=>p.useContext(oo),Hc=e=>{let[t,i]=p.useState(!1),[s,r]=p.useState(!1),[o,a]=p.useState(!1),[l,u]=p.useState(100),d=p.useRef(null),[c]=De("orderly_order_confirm",!0),{position:m,onSubmit:y,price:j,quantity:f,closeOrderData:b,submitting:x,updatePriceChange:C,updateOrderType:w,updateQuantity:v,errors:N,baseTick:I,type:O}=lt(),{quote_dp:A,base_dp:k,base:_,quote:D}=Ke(),{parseErrorMsg:M}=wn(N),L=m.position_qty>0,F=Math.abs(m.position_qty),z=e.type||O,R=z===ie.MARKET,H=(F==null?void 0:F.toString())===f.toString();p.useEffect(()=>{t&&w(e.type)},[e.type,t]);let{priceErrorMsg:ne,quantityErrorMsg:B}=p.useMemo(()=>({priceErrorMsg:M("order_price"),quantityErrorMsg:M("order_quantity")}),[N]),$=!!(ne||B),Y=p.useCallback(ae=>{if(I&&I>0){let de=ue.formatNumber(ae,I)??ae;v(de)}},[I,v]),V=p.useCallback(ae=>{u(ae);let de=new T(ae).div(100).mul(F).toFixed(k,T.ROUND_DOWN);Y(de)},[F,k,Y]);p.useEffect(()=>{let ae=Math.min(Number(f||0),F),de=new T(ae).div(F).mul(100).toDecimalPlaces(2,T.ROUND_DOWN).toNumber();u(de)},[f]);let le=p.useCallback(()=>{v(F==null?void 0:F.toString())},[F,v]),xe=p.useCallback(()=>y().then(ae=>{i(!1),r(!1),a(!1)}),[y]),Se=p.useCallback(()=>c?(r(!0),Promise.resolve()):xe(),[xe,c]),Ae=p.useCallback(()=>{i(!1)},[]),Te=p.useCallback(()=>{r(!1)},[]),qe=p.useCallback(()=>{a(!1)},[]),Be=p.useCallback(()=>{var ae;v("0"),(ae=d.current)==null||ae.focus(),setTimeout(()=>{var de;(de=d.current)==null||de.setSelectionRange(0,1)},0)},[v]);return{position:m,closeOrderData:b,quote_dp:A,base_dp:k,base:_,quote:D,price:j,quantity:f,submitting:x,onConfirm:xe,onDoubleConfirm:Se,updatePriceChange:C,updateQuantity:v,formatQuantityToBaseTick:Y,updateOrderType:w,sliderValue:l,onSliderValueChange:V,priceErrorMsg:ne,quantityErrorMsg:B,disabled:$,isMarketClose:R,maxQty:F,onMax:le,isBuy:L,isEntirePosition:H,type:z,quantityInputRef:d,onEntirePosition:Be,sheetOpen:t,onCloseSheet:Ae,setSheetOpen:i,dialogOpen:s,setDialogOpen:r,onCloseDialog:Te,popoverOpen:o,setPopoverOpen:a,onClosePopover:qe}},oi=e=>{let t=Hc(e),{isMobile:i}=_t();return i?n.jsx(Wc,{...t}):n.jsx(Vc,{...t})},Qc=()=>{let{position:e,baseDp:t,quoteDp:i,tpslOrder:s}=lt(),{t:r}=S();return n.jsx(Ti,{position:e,order:s,label:r("common.tpsl"),baseDP:t,quoteDP:i,isEditing:!1})},Kc=()=>{let{position:e,baseDp:t,quoteDp:i,tpslOrder:s}=lt();return n.jsx(Ti,{position:e,order:s,baseDP:t,quoteDP:i,isEditing:!0,children:n.jsx(Ds,{opacity:1,className:"oui-cursor-pointer oui-text-base-contrast-54",size:16})})},ao=({symbol:e})=>e?n.jsxs("div",{className:"oui-flex oui-h-[18px] oui-items-center oui-gap-1 oui-rounded oui-bg-white/[0.06] oui-px-2 oui-text-2xs oui-font-semibold oui-text-base-contrast-36",children:[n.jsx(h,{children:"Cross"}),n.jsx(Gc,{symbol:e})]}):null,Gc=({symbol:e})=>{let t=yi(e);return n.jsx(h.numeral,{dp:0,size:"2xs",unit:"X",children:t!=="-"?t:"--"})},Xc=()=>{let{type:e,quoteDp:t,price:i,updatePriceChange:s,updateOrderType:r}=lt(),{t:o}=S();return n.jsxs(pi,{children:[n.jsx(fe,{size:"sm",value:e===ie.LIMIT?i:o("orderEntry.orderType.market"),onValueChange:a=>s(a),formatters:[J.numberFormatter,...t?[J.dpFormatter(t)]:[]],onFocus:()=>{e===ie.MARKET&&r(ie.LIMIT)},suffix:n.jsx(mi,{asChild:!0,children:n.jsx("button",{className:"oui-h-full oui-px-1",children:n.jsx(qs,{size:12,color:"white"})})}),classNames:{root:E("oui-border oui-border-solid oui-border-white/[0.12] oui-outline-none focus-within:oui-outline-primary-light")}}),n.jsx(hi,{align:"end",className:"oui-w-[96px] oui-min-w-[96px]",onCloseAutoFocus:a=>a.preventDefault(),children:n.jsx(ca,{children:n.jsx(pa,{size:"xs",onSelect:()=>{r(ie.MARKET)},children:n.jsx("span",{children:o("common.marketPrice")})})})})]})},Jc=e=>{let[t,i]=p.useState(100),{baseDp:s,updateQuantity:r,quantity:o,baseTick:a}=lt(),l=d=>{u(`${e.value*d}`)},u=d=>{if(a&&a>0){let c=ue.formatNumber(d,a)??d;r(c)}};return p.useEffect(()=>{let d=Math.abs(e.value),c=Math.min(Number(o||0),d),m=new T(c).div(d).mul(100).todp(2,T.ROUND_DOWN).toNumber();i(m)},[o,e.value]),n.jsxs(xn,{children:[n.jsx(gn,{children:n.jsx(fe,{size:"sm",classNames:{root:"oui-outline-none oui-border oui-border-solid oui-border-white/[0.12] focus-within:oui-outline-primary-light"},formatters:[J.numberFormatter,...s?[J.dpFormatter(s)]:[]],value:o,onBlur:d=>u(d.target.value),onValueChange:r})}),n.jsx(yn,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:d=>{d.preventDefault()},children:n.jsxs(g,{p:1,gap:2,width:"100%",itemAlign:"start",children:[n.jsx(h,{size:"xs",intensity:98,className:"oui-min-w-[40px]",children:`${t}%`}),n.jsxs(g,{direction:"column",width:"100%",gap:2,children:[n.jsx(wt,{markCount:4,value:[t],onValueChange:d=>{l(d[0]/100)}}),n.jsx(Yc,{onClick:l})]})]})})]})},Yc=e=>{let{t}=S(),i=[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:t("common.max"),value:1}];return n.jsx(g,{gap:2,width:"100%",children:i.map((s,r)=>n.jsx(te,{variant:"outlined",color:"secondary",size:"xs",onClick:o=>{o.stopPropagation(),e.onClick(s.value)},className:"oui-w-1/5",children:s.label},r))})},Zc=e=>{let t=Ke();return n.jsx(h.numeral,{dp:t.base_dp,rm:T.ROUND_DOWN,padding:!1,coloring:!0,children:e})},ep=(e,t)=>n.jsx(Jc,{value:t.position_qty}),tp=e=>n.jsx(Xc,{}),Wn=e=>{let{tick:t="quote_dp",children:i,...s}=e,r=Ke();if(!r)throw new Error("NumeralWithCtx must be used inside SymbolProvider");return n.jsx(h.numeral,{as:"span",dp:r[t],...s,children:i})},np=e=>{if(e.sharePnLConfig==null)return n.jsx(n.Fragment,{});let{position:t}=e,i=Ee(),{data:s}=da(),r=()=>{let o=e.isPositionHistory?(()=>{let a=t.netPnL||0,l=Math.abs(t.avg_open_price),u=Math.abs(t.closed_position_qty),d;if(a!==0&&u!==0&&l!==0&&s&&typeof e.leverage=="number"){let c=i[t.symbol],m=c("base_imr"),y=s.imr_factor[t.symbol]||1;if(m){let j=We.notional(u,l),f=mn.IMR({maxLeverage:s.max_leverage,baseIMR:m,IMR_Factor:y,positionNotional:j,ordersNotional:0,IMR_factor_power:4/5}),b=We.unrealizedPnLROI({positionQty:u,openPrice:l,IMR:f,unrealizedPnL:a});d=new T(b*100).toFixed(2,T.ROUND_DOWN)}}return{side:t.side,pnl:a,roi:d,openPrice:l,closePrice:Math.abs(t.avg_close_price),openTime:t.open_timestamp,closeTime:t.close_timestamp,quantity:t.closed_position_qty}})():{side:t.position_qty>0?"LONG":"SHORT",pnl:t.unrealized_pnl,roi:new T(t.unrealized_pnl_ROI*100).toFixed(2,T.ROUND_DOWN),openPrice:Math.abs(t.average_open_price),markPrice:t.mark_price,openTime:t.timestamp,quantity:t.position_qty};he.show(e.modalId,{pnl:{entity:{symbol:t.symbol,...o},refCode:e.refCode,...e.sharePnLConfig}})};return n.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),r()},children:n.jsx($s,{color:"white",opacity:.54,size:e.iconSize??16})})},ip=e=>{let{sharePnLConfig:t,position:i,modalId:s,iconSize:r,isPositionHistory:o}=e,{getFirstRefCode:a}=gi(),l=p.useMemo(()=>{var d;return(d=a())==null?void 0:d.code},[a]),u=yi(e.position.symbol);return{iconSize:r,position:i,refCode:l,leverage:u,sharePnLConfig:t,modalId:s,isPositionHistory:o}},En=e=>{let t=ip(e);return n.jsx(np,{...t})},sp=e=>{let{stopLossPrice:t,takeProfitPrice:i}=e,{tpslOrder:s,position:r}=lt();return n.jsx(rp,{stopLossPrice:t,takeProfitPrice:i,direction:"column",order:s,position:r,tooltip:!0})},us=e=>{let{qty:t,price:i,entryPrice:s,orderSide:r,orderType:o,symbolInfo:a}=e,l=ue.priceToPnl({qty:t,price:i,entryPrice:s,orderSide:r,orderType:o},{symbol:a}),u=o===je.TAKE_PROFIT?"TP":"SL";return n.jsxs(g,{children:[n.jsx(h,{intensity:54,className:"oui-mr-1",children:`${u} PnL:`}),n.jsx(h.formatted,{rule:"price",className:l===0?"oui-text-base-contrast-36":l>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:n.jsx(h,{children:l===0?"":l>0?"+":"-"}),suffix:n.jsx(h,{intensity:36,className:"oui-ml-1",children:"USDC"}),children:`${Math.abs(l)}`})]})},rp=e=>{let{direction:t="row",order:i,position:s}=e,r=Ee(),{t:o}=S(),a=p.useMemo(()=>{let c=[];if(!e.tooltip||!i||!s)return;let m=i.quantity;return m===0&&i.child_orders[0].type==="CLOSE_POSITION"&&(m=s.position_qty),e.takeProfitPrice&&c.push(n.jsx(us,{qty:m,price:e.takeProfitPrice,entryPrice:s.average_open_price,orderSide:i.side,orderType:je.TAKE_PROFIT,symbolInfo:r[i.symbol]()},"tp")),e.stopLossPrice&&c.push(n.jsx(us,{qty:m,price:e.stopLossPrice,entryPrice:s.average_open_price,orderSide:i.side,orderType:je.STOP_LOSS,symbolInfo:r[i.symbol]()},"sl")),n.jsx("div",{children:c})},[e.takeProfitPrice,e.stopLossPrice,s==null?void 0:s.average_open_price,i==null?void 0:i.side,i==null?void 0:i.quantity,i==null?void 0:i.algo_type]),l=p.useMemo(()=>{let c=[];return i!=null&&i.symbol?(e.takeProfitPrice&&c.push(n.jsx(h.formatted,{className:E("oui-text-trade-profit oui-gap-0 oui-decoration-white/20"),rule:"price",dp:r[i.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||t==="column"?n.jsx(h,{intensity:54,children:`${o("tpsl.tp")} - `}):""},"tp")),e.stopLossPrice&&c.push(n.jsx(h.formatted,{className:E("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 "),rule:"price",dp:r[i.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||t==="column"?n.jsx(h,{intensity:54,children:`${o("tpsl.sl")} - `}):""},"sl")),c.length===0?n.jsx(h,{children:"-"}):(c.length===2&&t==="row"&&c.splice(1,0,n.jsx(h,{children:"/"},"split")),c)):n.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,i==null?void 0:i.symbol,o]),u=n.jsx("div",{className:E("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:l}),d=Array.isArray(l)?!!l.length:!l;return e.tooltip?n.jsxs(g,{gapX:2,children:[n.jsx(Le,{content:a,children:u}),d&&n.jsx(Kc,{})]}):u},op=e=>{let[t,i]=De("unPnlPriceBasis","markPrice"),{t:s}=S();return n.jsxs(g,{direction:"column",gap:3,className:"oui-text-base-contrast-54 oui-items-start",children:[n.jsx(h,{children:s("positions.column.unrealPnl.tooltip")}),n.jsx(ye,{className:"oui-w-full"}),n.jsx("div",{className:"oui-mb-0",children:s("positions.column.unrealPnl.priceBasis")}),n.jsx(ap,{value:t,onValueChange:i})]})},ap=e=>{let{value:t,onValueChange:i}=e,{t:s}=S();return n.jsxs(g,{gap:2,children:[n.jsx(ds,{sel:t==="markPrice",label:s("common.markPrice"),value:"markPrice",onCheckChange:i}),n.jsx(ds,{sel:t==="lastPrice",label:s("common.lastPrice"),value:"lastPrice",onCheckChange:i})]})},ds=e=>{let{sel:t,label:i,value:s,onCheckChange:r}=e;return n.jsxs(g,{onClick:o=>{r(s),o.stopPropagation()},gap:1,className:"oui-cursor-pointer",children:[t?n.jsx(lp,{}):n.jsx(up,{}),n.jsx(h,{size:"xs",intensity:t?98:54,children:i})]})},lp=()=>n.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-white",children:[n.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),n.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),up=()=>n.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:n.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),lo=e=>{let{pnlNotionalDecimalPrecision:t,sharePnLConfig:i,onSymbolChange:s}=e,{t:r}=S(),o=p.useRef(Date.now().toString());return p.useMemo(()=>[{title:r("common.symbol"),dataIndex:"symbol",fixed:"left",width:140,onSort:(a,l)=>a.symbol.localeCompare(l.symbol),render:(a,l)=>n.jsxs(g,{gap:2,children:[n.jsx(W,{width:4,height:20,className:E("oui-h-[38px] oui-rounded-[1px]",l.position_qty>0?"oui-bg-trade-profit":"oui-bg-trade-loss")}),n.jsxs(g,{direction:"column",itemAlign:"start",children:[n.jsx(h.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:u=>{s==null||s({symbol:a}),u.stopPropagation(),u.preventDefault()},children:`${a.split("_")[1]}-PERP`}),n.jsx(ao,{symbol:a})]})]})},{title:r("common.quantity"),dataIndex:"position_qty",onSort:(a,l)=>a.position_qty-l.position_qty,width:120,className:"oui-pl-6",render:Zc},{title:r("common.avgOpen"),className:"oui-h-[48px]",width:120,onSort:!0,dataIndex:"average_open_price",render:a=>n.jsx(Wn,{rm:T.ROUND_DOWN,children:a})},{title:r("common.markPrice"),dataIndex:"mark_price",width:120,onSort:!0,className:"oui-h-[48px]",render:a=>n.jsx(Wn,{rm:T.ROUND_DOWN,children:a})},{title:n.jsx(Le,{className:"oui-max-w-[280px] oui-bg-base-8 oui-p-3 oui-text-2xs oui-text-base-contrast-54",content:r("positions.column.liqPrice.tooltip"),children:n.jsx(h,{children:r("positions.column.liqPrice")})}),width:100,onSort:!0,dataIndex:"est_liq_price",render:a=>Number(a)===0?"--":n.jsx(Wn,{rm:T.ROUND_DOWN,className:Number(a)>0?"oui-text-warning-light":"",children:a??"--"})},{title:n.jsx(ua,{content:n.jsx(op,{}),side:"top",align:"center",className:"oui-max-w-[280px] oui-text-2xs",children:n.jsx(h,{children:r("common.unrealizedPnl")})}),dataIndex:"unrealized_pnl",width:180,onSort:!0,rule:"price",numeralProps:{coloring:!0},render:(a,l)=>n.jsxs(g,{gap:2,children:[n.jsxs(g,{children:[n.jsx(h.numeral,{dp:t,rm:T.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",children:a}),n.jsx(h.numeral,{rule:"percentages",dp:t,rm:T.ROUND_DOWN,coloring:!0,className:"oui-font-semibold",prefix:"(",suffix:")",children:l.unrealized_pnl_ROI})]}),n.jsx(En,{position:l,sharePnLConfig:i,modalId:Dn})]})},{title:r("common.tpsl"),dataIndex:"__",width:150,render:(a,l)=>n.jsx(sp,{stopLossPrice:l.sl_trigger_price,takeProfitPrice:l.tp_trigger_price})},{title:r("common.notional"),dataIndex:"notional",className:"oui-h-[48px]",width:100,onSort:!0,render:a=>n.jsx(h.numeral,{dp:t,children:a})},{title:n.jsx(Le,{className:"oui-max-w-[280px] oui-bg-base-8 oui-p-3 oui-text-2xs oui-text-base-contrast-54",content:n.jsxs(g,{direction:"column",gap:3,className:"oui-rounded-sm oui-bg-base-8 oui-text-base-contrast-54",children:[n.jsx("span",{children:r("positions.column.margin.tooltip")}),n.jsx(ye,{className:"oui-w-full"}),n.jsx("span",{children:r("positions.column.margin.formula")})]}),children:n.jsx(h,{children:r("positions.column.margin")})}),dataIndex:"mm",onSort:!0,width:100,rule:"price",render:a=>n.jsx(h.numeral,{children:a})},{title:r("funding.fundingFee"),dataIndex:"fundingFee",width:100,render:(a,l)=>n.jsx(Ln,{fee:a,symbol:l.symbol,start_t:l.timestamp.toString(),end_t:o.current})},{title:r("common.qty"),dataIndex:"close_qty",width:100,fixed:"right",render:ep},{title:r("common.price"),dataIndex:"close_price",width:100,fixed:"right",render:tp},{title:null,dataIndex:"close_position",align:"left",width:136,fixed:"right",render(){return n.jsxs(g,{gapX:2,justify:"end",children:[n.jsx(oi,{}),n.jsx(Qc,{})]})}}],[t,i,r])},dp=e=>{let{t}=S();return n.jsx(te,{variant:"outlined",color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:i=>{i.stopPropagation(),i.preventDefault(),e.openTP_SL()},children:t("common.tpsl")})},cp=e=>{let t=Ee()[e.state.item.symbol](),{tpslOrder:i}=lt(),{t:s}=S();return{openTP_SL:()=>{he.sheet({title:s("common.tpsl"),content:n.jsx(eo,{position:e.state.item,symbolInfo:t,order:i,isEditing:!1})})},...e,...t}},pp=e=>{let t=cp(e);return n.jsx(dp,{...t})},mp=e=>{let{item:t}=e,i=t.position_qty>0,{t:s}=S();return n.jsx(h.formatted,{rule:"symbol",formatString:"base-type",size:"2xs",suffix:n.jsxs("div",{className:"oui-flex oui-items-center oui-gap-1",children:[n.jsx(ee,{color:i?"success":"danger",size:"xs",children:s(i?"common.long":"common.short")}),n.jsx(ao,{symbol:t.symbol})]}),showIcon:!0,onClick:()=>{var r;(r=e.onSymbolChange)==null||r.call(e,{symbol:t.symbol})},children:t.symbol})},hp=e=>{let{item:t}=e,{t:i}=S();return n.jsxs(g,{gap:3,children:[n.jsxs(g,{direction:"column",className:"oui-text-2xs",itemAlign:"end",children:[n.jsxs("div",{children:[n.jsx(h,{intensity:36,children:i("common.unrealizedPnl")}),n.jsx(h,{intensity:20,children:"(USDC)"})]}),n.jsx(h.numeral,{size:"xs",dp:e.pnlNotionalDecimalPrecision,rm:T.ROUND_DOWN,coloring:!0,className:"orderly-font-semibold",suffix:n.jsx(h.numeral,{rule:"percentages",dp:e.pnlNotionalDecimalPrecision,rm:T.ROUND_DOWN,prefix:"(",suffix:")",className:E("oui-ml-1",t.unrealized_pnl_ROI>0?"oui-text-success-darken":"oui-text-danger-darken"),children:t.unrealized_pnl_ROI}),children:t.unrealized_pnl})]}),n.jsx(En,{position:t,sharePnLConfig:e.sharePnLConfig,modalId:In,iconSize:12})]})},fp=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:i("common.qty"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.base_dp,padding:!1,coloring:!0,children:t.position_qty})})},xp=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:n.jsxs("span",{children:[i("positions.column.margin"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,intensity:80,children:t.mm})})},gp=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{align:"end",label:n.jsxs("span",{children:[i("common.notional"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,intensity:80,children:t.notional})})},yp=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:i("common.avgOpen"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,children:t.average_open_price})})},bp=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:i("common.markPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,children:t.mark_price})})},jp=e=>{let{item:t}=e,{t:i}=S(),s=t.est_liq_price&&t.est_liq_price>0?t.est_liq_price:"-";return n.jsx(se,{label:i("positions.column.liqPrice"),align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,color:"warning",children:s})})},wp=e=>{let{item:t}=e,{t:i}=S();return t.tp_trigger_price==null&&t.sl_trigger_price==null?n.jsx(n.Fragment,{}):n.jsxs(g,{className:"oui-text-2xs oui-text-base-contrast-36",children:[n.jsxs(h,{children:[`${i("common.tpsl")}:`," "]}),n.jsxs(g,{className:"oui-gap-[2px]",children:[t.tp_trigger_price&&n.jsx(h.numeral,{color:"buy",children:t.tp_trigger_price}),t.sl_trigger_price&&"/",t.sl_trigger_price&&n.jsx(h.numeral,{color:"sell",children:t.sl_trigger_price})]})]})},_p=e=>{let{t}=S(),i=p.useRef(Date.now().toString());return n.jsxs(g,{justify:"end",className:"oui-w-full oui-text-2xs",children:[n.jsxs(h,{intensity:36,children:[t("funding.fundingFee"),": "]}),n.jsx(Ln,{fee:e.item.fundingFee,symbol:e.item.symbol,start_t:e.item.timestamp.toString(),end_t:i.current})]})},vp=e=>{let{className:t,...i}=e,s=n.jsxs(g,{justify:"between",width:"100%",children:[n.jsx(mp,{...e}),n.jsx(hp,{...e})]}),r=n.jsxs(Oe,{cols:3,rows:2,gap:2,width:"100%",children:[n.jsx(fp,{...e}),n.jsx(xp,{...e}),n.jsx(gp,{...e}),n.jsx(yp,{...e}),n.jsx(bp,{...e}),n.jsx(jp,{...e})]}),o=n.jsxs(Oe,{width:"100%",gap:2,cols:3,rows:1,children:[n.jsx(pp,{state:e}),n.jsx(oi,{type:ie.LIMIT}),n.jsx(oi,{type:ie.MARKET})]});return n.jsxs(g,{direction:"column",width:"100%",gap:2,p:2,r:"xl",itemAlign:"start",className:E(t,"oui-bg-base-9"),children:[s,n.jsx(ye,{intensity:6,className:"oui-w-full"}),r,n.jsx(wp,{...i}),n.jsx(_p,{...i}),o]})},Cp=e=>{let t=Ke();return{...e,...t}},Np=e=>{let t=Cp(e);return n.jsx(vp,{...t,className:e.className})},Oi=e=>{let{position:t}=e,{t:i}=S(),[s,r]=p.useState(Math.abs(t.position_qty).toString()),[o,a]=p.useState(""),[l,u]=p.useState(ie.MARKET);p.useEffect(()=>{r(Math.abs(t.position_qty).toString())},[t.position_qty]);let d=t.symbol,c=Ee(),m=c==null?void 0:c[d],y=m("quote_dp"),j=m("base_dp"),f=m("base_tick"),{side:b,closeOrderData:x,submit:C,isMutating:w,errors:v,calculate:N}=la({position:t,order:{type:l,quantity:s,price:o}}),I=p.useCallback(_=>{let D=N({},"order_quantity",_,t.mark_price,m());r(D.order_quantity)},[N,c,t.mark_price]),O=p.useCallback(_=>{let D=N({},"order_price",_,t.mark_price,m());a(D.order_price)},[N,c,t.mark_price]),A=p.useCallback(_=>{var D;u(_),a(_===ie.LIMIT?(D=t.mark_price)==null?void 0:D.toString():"")},[t.mark_price]),k=p.useCallback(async()=>{if(Number(s)>m("base_max")){U.error(n.jsxs("div",{children:[i("positions.limitClose.errors.exceed.title"),n.jsx("br",{}),n.jsx("div",{className:"oui-break-normal",children:i("positions.limitClose.errors.exceed.description",{quantity:s,symbol:Sp(d,"base"),maxQuantity:m("base_max")})})]}));return}return C().then(_=>{var D;if(_.success)return(D=e.mutatePositions)==null||D.call(e),_;throw _.message&&U.error(_.message),!0}).catch(_=>(_.message&&U.error(_.message),!1))},[C]);return n.jsx(oo.Provider,{value:{quantity:s,price:o,type:l,side:b,position:t,updatePriceChange:O,updateQuantity:I,updateOrderType:A,tpslOrder:t.algo_order,onSubmit:k,submitting:w,closeOrderData:x,quoteDp:y,baseDp:j,baseTick:f,errors:v},children:e.children})};function Sp(e,t="base"){let i=e.split("_"),s=i[0],r=i[1],o=i[2];return(t??"base-quote").replace("type",s).replace("base",r).replace("quote",o)}var Tp=e=>{let{pnlNotionalDecimalPrecision:t,sharePnLConfig:i,pagination:s,isLoading:r,dataSource:o,onSymbolChange:a}=e,l=lo({pnlNotionalDecimalPrecision:t,sharePnLConfig:i,onSymbolChange:a});return n.jsx(Qt,{loading:r,id:"oui-desktop-positions-content",columns:l,bordered:!0,dataSource:o,generatedRowKey:u=>u.symbol,renderRowContainer:(u,d,c)=>n.jsx(Jt,{symbol:u.symbol,children:n.jsx(Oi,{position:u,children:c})}),manualPagination:!1,pagination:s,testIds:{body:"oui-testid-dataList-position-tab-body"}})},Pp=e=>{let{pnlNotionalDecimalPrecision:t,sharePnLConfig:i,dataSource:s,onSymbolChange:r}=e;return n.jsx(Ht,{className:"oui-hide-scrollbar oui-w-full oui-space-y-0 oui-overflow-y-hidden",contentClassName:"!oui-space-y-1",dataSource:s,renderItem:(o,a)=>n.jsx(Jt,{symbol:o.symbol,children:n.jsx(Oi,{position:o,children:n.jsx(Np,{item:o,index:a,pnlNotionalDecimalPrecision:t,sharePnLConfig:i,onSymbolChange:r})})})})},kp=e=>{let{pnlNotionalDecimalPrecision:t,sharePnLConfig:i,pagination:s,isLoading:r,tableData:o,onSymbolChange:a,mutatePositions:l}=e,u=lo({pnlNotionalDecimalPrecision:t,sharePnLConfig:i,onSymbolChange:a}),{dataSource:d=[]}=o;return n.jsx(Qt,{bordered:!0,loading:r,id:"oui-desktop-positions-content",columns:u,dataSource:d,expanded:!0,getSubRows:c=>c.children,generatedRowKey:c=>c.id,onCell:(c,m)=>{if((m.children??[]).length>0)return{children:c.id==="symbol"?n.jsx(ee,{color:"neutral",size:"xs",children:(m==null?void 0:m.description)||Bs(m==null?void 0:m.id)}):null}},renderRowContainer:(c,m,y)=>c.symbol?n.jsx(Jt,{symbol:c.symbol,children:n.jsx(Oi,{position:c,mutatePositions:l,children:y})}):y,manualPagination:!1,pagination:s,testIds:{body:"oui-testid-dataList-position-tab-body"}})},sf=e=>{let t=io(e);return n.jsx(Tp,{...t})},rf=e=>{let t=io(e);return n.jsx(Pp,{...t})},of=e=>{let t=Uc(e);return n.jsx(kp,{...t})},Op=e=>{let{onSymbolChange:t,pnlNotionalDecimalPrecision:i}=e,{t:s}=S();return p.useMemo(()=>[{title:s("common.symbol"),dataIndex:"symbol",fixed:"left",width:200,onSort:(r,o)=>r.symbol.localeCompare(o.symbol),render:(r,o)=>n.jsx(Dp,{record:o,onSymbolChange:t})},{title:s("positions.history.column.closed&maxClosed"),dataIndex:"close_maxClose",width:200,render:(r,o)=>n.jsx(Ip,{record:o})},{title:s("positions.history.column.netPnl"),dataIndex:"netPnL",width:140,onSort:(r,o)=>r.netPnL==null||o.netPnL==null?-1:(r.netPnL??0)-(o.netPnL??0),render:(r,o)=>n.jsxs(g,{gapX:1,children:[n.jsx(Lp,{record:o,pnlNotionalDecimalPrecision:i}),n.jsx(En,{position:o,sharePnLConfig:e.sharePnLConfig,modalId:Dn,isPositionHistory:!0})]})},{title:s("common.avgPrice"),dataIndex:"avg_open",width:140,render:(r,o)=>{let a=o.avg_open_price!=null?Math.abs(o.avg_open_price):"--",{quote_dp:l}=Ke();return n.jsx(h.numeral,{dp:l,padding:!1,children:a})}},{title:s("common.avgClose"),dataIndex:"avg_close",width:175,render:(r,o)=>{let a=o.avg_close_price!=null?Math.abs(o.avg_close_price):"--",{quote_dp:l}=Ke();return n.jsx(h.numeral,{dp:l,padding:!1,children:a})}},{title:s("funding.fundingFee"),dataIndex:"accumulated_funding_fee",render:(r,o)=>{var a;return n.jsx(Ln,{fee:-r,symbol:o.symbol,start_t:o.open_timestamp.toString(),end_t:(a=o.close_timestamp)==null?void 0:a.toString()})}},{title:s("positions.history.column.timeOpened"),dataIndex:"open_timestamp",width:175,onSort:!0,render:(r,o)=>n.jsx(h.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.open_timestamp})},{title:s("positions.history.column.timeClosed"),dataIndex:"close_timestamp",width:175,onSort:!0,render:(r,o)=>o.position_status=="closed"&&o.close_timestamp?n.jsx(h.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.close_timestamp??"--"}):"--"},{title:s("positions.history.column.updatedTime"),dataIndex:"last_update_time",width:175,onSort:!0,render:(r,o)=>n.jsx(h.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:o.last_update_time})}],[i,s])},Dp=e=>{let{record:t,onSymbolChange:i}=e,{t:s}=S(),r=p.useMemo(()=>{let o=[],a=t.position_status,l=()=>a==="closed"?s("positions.history.status.closed"):a==="partial_closed"?s("positions.history.status.partialClosed"):Fs(a.replace("_"," "));return o.push(n.jsx(ee,{color:a!=="closed"?"primaryLight":"neutral",size:"xs",className:"oui-break-normal oui-whitespace-nowrap",children:l()})),t.type==="adl"?o.push(n.jsx(ee,{color:"danger",size:"xs",children:s("positions.history.type.adl")})):t.type==="liquidated"&&o.push(n.jsx(Le,{className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},content:n.jsxs(g,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[t.liquidation_id!=null&&n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:s("positions.history.liquidated.liquidationId")}),n.jsx(h,{intensity:98,children:t.liquidation_id})]}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:s("positions.history.liquidated.liquidatorFee")}),n.jsxs(h,{color:"lose",children:[t.liquidator_fee>0&&"-",re(t.liquidator_fee)]})]}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:s("positions.history.liquidated.insFundFee")}),n.jsxs(h,{color:"lose",children:[t.insurance_fund_fee>0&&"-",re(t.insurance_fund_fee)]})]})]}),children:n.jsx("div",{children:n.jsx(ee,{size:"xs",color:"danger",className:"oui-cursor-pointer",children:n.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:s("positions.history.type.liquidated")})})})})),o},[t,s]);return n.jsxs(g,{gap:2,height:48,children:[n.jsx(W,{width:4,height:38,className:E("oui-rounded-[1px] oui-shrink-0",t.side==="LONG"?"oui-bg-trade-profit":"oui-bg-trade-loss")}),n.jsxs(g,{direction:"column",itemAlign:"start",children:[n.jsx(h.formatted,{formatString:"base-type",className:"oui-cursor-pointer",onClick:o=>{i==null||i({symbol:t.symbol}),o.stopPropagation(),o.preventDefault()},children:`${t.symbol.split("_")[1]}-PERP`}),n.jsx(g,{gap:1,children:r})]})]})},Ip=e=>{let{record:t}=e,{base_dp:i}=Ke();return n.jsxs(g,{gap:1,direction:"column",itemAlign:"start",className:"oui-overflow-hidden oui-whitespace-nowrap oui-text-ellipsis",children:[n.jsx(h.numeral,{dp:i,padding:!1,children:Math.abs(t.closed_position_qty)}),n.jsx(h.numeral,{dp:i,padding:!1,className:"oui-truncate",children:Math.abs(t.max_position_qty)})]})},Lp=e=>{let{record:t,pnlNotionalDecimalPrecision:i}=e,{t:s}=S(),r=t.netPnL!=null?t.netPnL:void 0,o=()=>n.jsx(h.numeral,{dp:i,color:t.netPnL!=null?t.netPnL>0?"profit":"lose":void 0,className:r==null?"":"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:r??"--"});return t.netPnL==null?o():n.jsx(Le,{delayDuration:200,content:n.jsxs(g,{direction:"column",itemAlign:"start",className:"oui-text-2xs",children:[n.jsx(h,{intensity:80,children:s("positions.history.column.netPnl")}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:s("common.realizedPnl")}),n.jsx(h,{color:t.realized_pnl>=0?"profit":"lose",className:"oui-cursor-pointer",children:re(t.realized_pnl)})]}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:s("funding.fundingFee")}),n.jsx(h,{color:t.accumulated_funding_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:re(-t.accumulated_funding_fee)})]}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:s("positions.history.netPnl.tradingFee")}),n.jsx(h,{color:t.trading_fee>0?"lose":"profit",className:"oui-cursor-pointer",children:re(-t.trading_fee)})]})]}),className:"oui-min-w-[204px] oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:n.jsx("div",{children:o()})})};function we(e){if(e==null)return e;let t=new Date(e);return t.setHours(0,0,0,0),t}function _e(e){if(e==null)return e;let t=new Date(e);return t.setHours(23,59,59,999),t}var dn=e=>({from:we(e.from),to:_e(e.to??e.from)}),cn=(e,t)=>e.getTime()===t.getTime(),uo=e=>{let{onSymbolChange:t,symbol:i,pnlNotionalDecimalPrecision:s}=e,{state:r}=Fe(),{data:o,isLoading:a}=Rs(i?`/v1/position_history?symbol=${i}&limit=1000`:"/v1/position_history?limit=1000",{formatter(C){var w;return(w=C.rows??null)==null?void 0:w.map(v=>{if(v.realized_pnl!=null&&v.accumulated_funding_fee!=null&&v.trading_fee!=null){let N=v.realized_pnl-v.accumulated_funding_fee-v.trading_fee;return{...v,netPnL:N}}return v})},revalidateOnFocus:!0}),{pagination:l,setPage:u}=Wt({pageSize:10}),{status:d,side:c,dateRange:m,filterDays:y,updateFilterDays:j,filterItems:f,onFilter:b}=Ep();p.useEffect(()=>{u(1)},[d,c,m,y,i]);let x=p.useMemo(()=>o==null?o:o.filter(C=>{let w=c==="all"?!0:C.side.toLowerCase()===c.toLowerCase(),v=d==="all"?!0:C.position_status.toLowerCase()===d.toLowerCase(),N=(C==null?void 0:C.last_update_time)??C.open_timestamp,I=m.from&&m.to?N>=m.from.getTime()&&N<=m.to.getTime():!0,O=i?C.symbol==i:!0;return w&&v&&I&&O}),[d,c,m,o,i]);return{dataSource:Kt(x,{accountStatus:r.status===Me.EnableTradingWithoutConnected?Me.EnableTradingWithoutConnected:Me.EnableTrading,fallbackData:[]}),isLoading:a,onSymbolChange:t,pagination:l,filterItems:f,onFilter:b,symbol:i,filterDays:y,updateFilterDays:j,pnlNotionalDecimalPrecision:s}},Ep=()=>{let{t:e}=S(),[t,i]=p.useState("all"),[s,r]=p.useState("all"),o=dn({to:_e(new Date),from:we(ge(new Date,89))}),[a,l]=p.useState(90),[u,d]=p.useState(o),c=j=>{l(j),d({from:we(ge(new Date,j-1)),to:_e(new Date)})},m=j=>{if(j.name==="side"&&r(j.value),j.name==="status"&&i(j.value),j.name==="dateRange"){let f=dn(j.value);if(d(f),f.from&&f.to){let b=Math.abs(ji(f.from,f.to))+1,x={1:{from:we(new Date),to:_e(new Date)},7:{from:we(ge(new Date,6)),to:_e(new Date)},30:{from:we(ge(new Date,29)),to:_e(new Date)},90:{from:we(ge(new Date,89)),to:_e(new Date)}}[b];x&&cn(x.from,f.from)&&cn(x.to,f.to)?l(b):l(null)}}},{isMobile:y}=_t();return{filterItems:p.useMemo(()=>{let j={type:"select",name:"side",options:[{label:e("common.side.all"),value:"all"},{label:e("common.buy"),value:"LONG"},{label:e("common.sell"),value:"SHORT"}],value:s},f={type:"range",name:"dateRange",value:u,fromDate:we(ge(new Date,89)),toDate:_e(new Date)},b={type:"select",name:"status",options:[{label:e("common.status.all"),value:"all"},{label:e("positions.history.status.closed"),value:"closed"},{label:e("positions.history.status.partialClosed"),value:"partial_closed"}],value:t};return y?[j,b]:[j,b,f]},[s,t,u]),onFilter:m,side:s,dateRange:u,status:t,filterDays:a,updateFilterDays:c}},Ap=e=>{let{side:t,symbol:i}=e.item,{t:s}=S(),r=t==="LONG";return n.jsx(h.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:n.jsx(ee,{color:r?"success":"danger",size:"xs",children:s(r?"common.buy":"common.sell")}),onClick:()=>{var o;(o=e.onSymbolChange)==null||o.call(e,{symbol:i})},children:i})},qp=e=>{let{item:t}=e,{t:i}=S(),s=()=>{he.alert({title:i("positions.liquidation"),message:n.jsxs(g,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[t.liquidation_id!=null&&n.jsxs(g,{justify:"between",width:"100%",children:[n.jsx(h,{children:i("positions.history.liquidated.liquidationId")}),n.jsx(h,{intensity:98,children:t.liquidation_id})]}),n.jsxs(g,{justify:"between",width:"100%",children:[n.jsx(h,{children:i("positions.history.liquidated.liquidatorFee")}),n.jsxs(h,{color:"lose",children:[t.liquidator_fee>0&&"-",re(t.liquidator_fee)]})]}),n.jsxs(g,{justify:"between",width:"100%",children:[n.jsx(h,{children:i("positions.history.liquidated.insFundFee")}),n.jsxs(h,{color:"lose",children:[t.insurance_fund_fee>0&&"-",re(t.insurance_fund_fee)]})]})]})})},r=p.useMemo(()=>{let o=[],a=t.position_status,l=()=>a==="closed"?i("positions.history.status.closed"):a==="partial_closed"?i("positions.history.status.partialClosed"):Fs(a.replace("_"," "));return o.push(n.jsx(ee,{color:a!=="closed"?"primaryLight":"neutral",size:"xs",children:l()})),t.type==="adl"?o.push(n.jsx(ee,{color:"danger",size:"xs",children:i("positions.history.type.adl")})):t.type==="liquidated"&&o.push(n.jsx(ee,{size:"xs",color:"danger",className:"oui-cursor-pointer",onClick:s,children:n.jsx("span",{className:"oui-underline oui-decoration-dashed oui-decoration-[1px]",children:i("positions.history.type.liquidated")})})),o},[t]);return n.jsx(g,{gap:1,children:r})},Rp=e=>{let{item:t}=e,{t:i}=S(),s=t.closed_position_qty!=null?Math.abs(t.closed_position_qty):"--";return n.jsx(se,{label:n.jsx(h,{children:i("positions.history.column.closed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:s})})},Mp=e=>{let{item:t}=e,{t:i}=S(),s=t.max_position_qty!=null?Math.abs(t.max_position_qty):"--";return n.jsx(se,{label:n.jsx(h,{children:i("positions.history.column.maxClosed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.base_dp,padding:!1,coloring:!0,intensity:80,children:s})})},Fp=e=>{let{item:t}=e,i=t.avg_open_price!=null?Math.abs(t.avg_open_price):"--",{t:s}=S();return n.jsx(se,{label:n.jsxs(g,{gap:1,children:[s("common.avgOpen"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:i})})},$p=e=>{let{item:t}=e,i=t.avg_close_price!=null?Math.abs(t.avg_close_price):"--",{t:s}=S();return n.jsx(se,{label:n.jsxs(g,{gap:1,children:[s("common.avgClose"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,padding:!1,coloring:!0,intensity:80,children:i})})},zp=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:n.jsx(h,{children:i("positions.history.column.timeOpened")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:n.jsx(h.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:t.open_timestamp})})},Up=e=>{let{item:t}=e,{t:i}=S(),s=t.position_status=="closed"&&t.close_timestamp?n.jsx(h.formatted,{intensity:80,formatString:"yyyy-MM-dd HH:mm:ss",rule:"date",children:t.close_timestamp}):"--";return n.jsx(se,{label:n.jsx(h,{children:i("positions.history.column.timeClosed")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:s})},Bp=e=>{var i;let{t}=S();return n.jsxs(g,{justify:"end",className:"oui-text-2xs oui-w-full oui-py-2 oui-gap-1 oui-gap-1",children:[n.jsxs(h,{intensity:36,children:[t("funding.fundingFee"),": "]}),n.jsx(Ln,{fee:-e.item.accumulated_funding_fee,symbol:e.item.symbol,start_t:e.item.open_timestamp.toString(),end_t:(i=e.item.close_timestamp)==null?void 0:i.toString()})]})},Wp=e=>{var t;return n.jsxs(g,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(t=e.classNames)==null?void 0:t.root,children:[n.jsx(Vp,{...e}),n.jsx(ye,{intensity:6,className:"oui-w-full"}),n.jsx(Hp,{...e})]})},Vp=e=>{let{t}=S(),i=()=>{let{item:s}=e;he.alert({title:t("positions.history.column.netPnl"),message:n.jsxs(g,{direction:"column",width:"100%",gap:2,className:"oui-text-2xs oui-text-base-contrast-54",children:[n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:t("common.realizedPnl")}),n.jsx(h,{color:s.realized_pnl>=0?"profit":"lose",children:re(s.realized_pnl)})]}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:t("funding.fundingFee")}),n.jsx(h,{color:s.accumulated_funding_fee>0?"lose":"profit",children:re(-s.accumulated_funding_fee)})]}),n.jsxs(g,{justify:"between",width:"100%",gap:2,children:[n.jsx(h,{intensity:54,children:t("positions.history.netPnl.tradingFee")}),n.jsx(h,{color:s.trading_fee>0?"lose":"profit",children:re(-s.trading_fee)})]})]})})};return n.jsxs(g,{gap:1,width:"100%",children:[n.jsxs(g,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[n.jsx(Ap,{...e}),n.jsx(qp,{...e})]}),n.jsxs(g,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[n.jsx(h,{size:"2xs",intensity:36,children:t("positions.history.column.netPnl")}),n.jsxs(g,{gapX:1,children:[n.jsx("button",{onClick:i,children:n.jsx(h.numeral,{size:"xs",coloring:!0,children:e.item.netPnL??"--"})}),n.jsx(En,{position:e.item,sharePnLConfig:e.sharePnLConfig,modalId:In,iconSize:12,isPositionHistory:!0})]})]})]})},Hp=e=>n.jsxs("div",{className:"oui-w-full",children:[n.jsxs(Oe,{cols:3,rows:2,width:"100%",gap:0,className:"oui-grid-cols-[1fr,1fr,135px]",children:[n.jsx(Rp,{...e}),n.jsx(Mp,{...e}),n.jsx(zp,{...e}),n.jsx(Fp,{...e}),n.jsx($p,{...e}),n.jsx(Up,{...e})]}),n.jsx(Bp,{...e})]}),Qp=e=>{let t=Ke();return{...e,...t}},Kp=e=>{let t=Qp(e);return n.jsx(Wp,{...t})},Gp=e=>{let{onSymbolChange:t,pagination:i,pnlNotionalDecimalPrecision:s}=e,r=Op({onSymbolChange:t,pnlNotionalDecimalPrecision:s,sharePnLConfig:e.sharePnLConfig}),{t:o}=S(),a=p.useMemo(()=>({1:o("common.select.1d"),7:o("common.select.7d"),30:o("common.select.30d"),90:o("common.select.90d")}),[o]);return n.jsxs(g,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[n.jsxs(g,{gap:3,children:[e.filterItems.length>0&&n.jsx(Vt,{items:e.filterItems,onFilter:l=>{e.onFilter(l)}}),[1,7,30,90].map(l=>n.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[n.jsx("div",{className:"oui-z-10",children:n.jsx(h.gradient,{color:e.filterDays===l?"brand":void 0,className:E("oui-whitespace-nowrap oui-break-normal",e.filterDays!==l?"oui-text-base-contrast-54":""),children:a[l]||`${l}D`})}),n.jsx("div",{className:"oui-absolute oui-inset-0 oui-rounded oui-opacity-[.12] oui-gradient-primary",onClick:()=>{e.updateFilterDays(l)}})]},`item-${l}`))]}),n.jsx(Qt,{loading:e.isLoading,id:"oui-desktop-positions-content",columns:r,bordered:!0,dataSource:e.dataSource,generatedRowKey:l=>`${l.symbol}_${l.position_id}`,renderRowContainer:(l,u,d)=>n.jsx(Jt,{symbol:l.symbol,children:d}),manualPagination:!1,pagination:i,testIds:{body:"oui-testid-dataList-positionHistory-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},Xp=e=>{var t,i;return n.jsxs(Oe,{cols:1,rows:2,className:"oui-w-full oui-grid-rows-[auto,1fr]",gap:1,children:[n.jsx(g,{gap:2,p:2,className:"oui-rounded-b-xl oui-bg-base-9",children:n.jsx(Vt,{className:"oui-border-none oui-py-0",items:e.filterItems,onFilter:s=>{e.onFilter(s)}})}),n.jsx(Ht,{className:E("oui-hide-scrollbar oui-w-full oui-space-y-0 oui-overflow-y-hidden",(t=e.classNames)==null?void 0:t.root),contentClassName:E("!oui-space-y-1",(i=e.classNames)==null?void 0:i.content),dataSource:e.dataSource,renderItem:(s,r)=>{var o;return n.jsx(Jt,{symbol:s.symbol,children:n.jsx(Kp,{item:s,index:r,onSymbolChange:e.onSymbolChange,classNames:{root:(o=e.classNames)==null?void 0:o.cell},sharePnLConfig:e.sharePnLConfig})})}})]})},af=e=>{let t=uo(e);return n.jsx(Gp,{...t,sharePnLConfig:e.sharePnLConfig})},lf=e=>{let{classNames:t,...i}=e,s=uo(i);return n.jsx(Xp,{...s,classNames:t,sharePnLConfig:e.sharePnLConfig})},Jp=e=>{let{t}=S();return p.useMemo(()=>[{title:t("common.time"),dataIndex:"timestamp",fixed:"left",width:202,render:i=>n.jsx(h.formatted,{rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:i})},{title:t("positions.Liquidation.column.liquidationId"),dataIndex:"liquidation_id",width:202,render:i=>n.jsx(h,{children:i})},{title:t("positions.Liquidation.column.insFundTransfer"),dataIndex:"transfer_amount_to_insurance_fund",width:202,render:i=>n.jsx(h,{children:re(i)})},{title:t("common.symbol"),dataIndex:"Symbol",width:202,render:(i,s)=>{var r;return n.jsx(g,{direction:"column",itemAlign:"start",children:(r=s.positions_by_perp)==null?void 0:r.map(o=>n.jsx(h.formatted,{rule:"symbol",formatString:"base-quote",children:o.symbol}))})}},{title:`${t("common.price")} (USDC)`,dataIndex:"Price_(USDC)",width:202,render:(i,s)=>{var r;return n.jsx(g,{direction:"column",itemAlign:"start",children:(r=s.positions_by_perp)==null?void 0:r.map(o=>n.jsx(Vn,{value:o.transfer_price,type:"quote"}))})}},{title:t("common.quantity"),dataIndex:"Quantity",width:202,render:(i,s)=>{var r;return n.jsx(g,{direction:"column",itemAlign:"start",children:(r=s.positions_by_perp)==null?void 0:r.map(o=>n.jsx(Vn,{value:o.position_qty,type:"base"}))})}},{title:t("positions.Liquidation.column.liquidationFee"),dataIndex:"abs_liquidation_fee",width:202,render:(i,s)=>{var r;return n.jsx(g,{direction:"column",itemAlign:"start",children:(r=s.positions_by_perp)==null?void 0:r.map(o=>n.jsx(Vn,{value:o.abs_liquidation_fee,type:"quote"}))})}}],[t])},Vn=e=>n.jsx(h,{children:re(e.value)}),Yp=e=>{let{t}=S();return n.jsxs(g,{width:"100%",justify:"between",children:[n.jsxs(g,{gap:1,children:[n.jsx(h,{size:"2xs",intensity:36,children:t("common.price")}),n.jsx(h,{size:"2xs",intensity:20,children:"(USDC)"})]}),n.jsx(h,{size:"2xs",intensity:80,children:re(e.transfer_price)})]})},Zp=e=>{let{t}=S();return n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h,{size:"2xs",intensity:36,children:t("common.quantity")}),n.jsx(h,{size:"2xs",intensity:80,children:re(e.position_qty)})]})},em=e=>{let{t}=S();return n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h,{size:"2xs",intensity:36,children:t("positions.Liquidation.column.liquidationFee")}),n.jsx(h,{size:"2xs",intensity:80,children:re(e.abs_liquidation_fee)})]})},tm=e=>{var t;return n.jsxs(g,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:(t=e.classNames)==null?void 0:t.root,children:[n.jsx(nm,{...e}),n.jsx(im,{...e})]},e.item.timestamp)},nm=e=>{let{t}=S();return n.jsxs(g,{gap:1,width:"100%",children:[n.jsxs(g,{direction:"column",itemAlign:"start",className:"oui-flex-1",gap:1,children:[n.jsx(h.formatted,{size:"2xs",intensity:36,rule:"date",formatString:"yyyy-MM-dd HH:mm:ss",children:e.item.timestamp}),n.jsxs(g,{gap:1,children:[n.jsx(h,{size:"2xs",intensity:36,children:`${t("positions.Liquidation.column.liquidationId")}:`}),n.jsx(h,{size:"2xs",intensity:80,children:` ${e.item.liquidation_id}`})]})]}),n.jsxs(g,{direction:"column",itemAlign:"end",className:"oui-flex-1",children:[n.jsx(h,{size:"2xs",intensity:36,children:`${t("positions.Liquidation.column.insFundTransfer")}:`}),n.jsx(h,{intensity:80,size:"xs",children:re(e.item.transfer_amount_to_insurance_fund)})]})]})},im=e=>{var t;return n.jsx(g,{direction:"column",width:"100%",children:(t=e.item.positions_by_perp)==null?void 0:t.map((i,s)=>n.jsx(sm,{isLast:s===e.item.positions_by_perp.length-1,...i},`${s}-${i.symbol}`))})},sm=e=>n.jsxs(g,{width:"100%",itemAlign:"start",className:E("oui-border-t-[1px] oui-border-line-6 oui-pt-2",!e.isLast&&"oui-pb-2"),children:[n.jsx(h.formatted,{rule:"symbol",formatString:"base-quote",size:"xs",intensity:80,className:"oui-flex-1",children:e.symbol}),n.jsxs(Oe,{cols:1,rows:3,width:"100%",gap:1,className:"oui-flex-1",children:[n.jsx(Yp,{...e}),n.jsx(Zp,{...e}),n.jsx(em,{...e})]})]},e.key),rm=e=>({...e}),om=e=>{let{classNames:t,...i}=e,s=rm(i);return n.jsx(tm,{classNames:t,...s})},am=e=>{let t=Jp();return n.jsxs(g,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[n.jsxs(g,{gap:3,children:[e.filterItems.length>0&&n.jsx(Vt,{items:e.filterItems,onFilter:i=>{e.onFilter(i)}}),[1,7,30,90].map(i=>n.jsxs("button",{className:"oui-relative oui-px-2 oui-py-[2px] oui-text-sm",children:[n.jsx("div",{className:"oui-z-10",children:n.jsx(h.gradient,{color:e.filterDays===i?"brand":void 0,className:e.filterDays!==i?"oui-text-base-contrast-54":"",children:`${i}D`})}),n.jsx("div",{className:"oui-absolute oui-inset-0 oui-rounded oui-opacity-[.12] oui-gradient-primary",onClick:()=>{e.updateFilterDays(i)}})]},`item-${i}`))]}),n.jsx(Qt,{loading:e.isLoading,id:"oui-desktop-liquidation-content",columns:t,bordered:!0,dataSource:e.dataSource,generatedRowKey:i=>`${i.liquidation_id}`,pagination:e.pagination,testIds:{body:"oui-testid-dataList-liquidation-tab-body"},classNames:{root:"!oui-h-[calc(100%_-_49px)]"}})]})},lm=e=>{var t,i;return n.jsxs(Oe,{cols:1,rows:2,className:"oui-w-full oui-grid-rows-[auto,1fr]",gap:1,children:[n.jsx(g,{gap:2,p:2,className:"oui-rounded-b-xl oui-bg-base-9",children:n.jsx(Vt,{className:"oui-border-none oui-py-0",items:e.filterItems,onFilter:s=>{e.onFilter(s)}})}),n.jsx(Ht,{className:E("oui-hide-scrollbar oui-w-full oui-space-y-0 oui-overflow-y-hidden",(t=e.classNames)==null?void 0:t.root),contentClassName:E("!oui-space-y-1",(i=e.classNames)==null?void 0:i.content),dataSource:e.dataSource,loadMore:e.loadMore,renderItem:(s,r)=>{var o;return n.jsx(om,{item:s,index:r,classNames:{root:(o=e.classNames)==null?void 0:o.cell}})}})]})},co=e=>{let{symbol:t,enableLoadMore:i}=e,{page:s,pageSize:r,setPage:o,parsePagination:a}=Wt({pageSize:10}),{dateRange:l,filterDays:u,updateFilterDays:d,filterItems:c,onFilter:m}=dm();p.useEffect(()=>{o(1)},[t,l,u]);let[y,{meta:j,isLoading:f,loadMore:b}]=um({page:i?void 0:s,size:r,symbol:t,start_t:l.from!=null?l.from.getTime():void 0,end_t:l.to!=null?l.to.getTime():void 0});return{dataSource:Kt(y,{fallbackData:[]}),isLoading:f,loadMore:b,pagination:a(j),dateRange:l,filterDays:u,updateFilterDays:d,filterItems:c,onFilter:m}},um=e=>{var o;let t=Ms(cm(e),{initialSize:1,formatter:a=>a,revalidateOnFocus:!0}),i=p.useMemo(()=>{var a,l;return(l=(a=t.data)==null?void 0:a[0])==null?void 0:l.meta},[(o=t.data)==null?void 0:o[0]]),s=p.useMemo(()=>{var a,l;return(l=(a=t.data)==null?void 0:a.map(u=>u.rows))==null?void 0:l.flat()},[t.data]),r=t.isLoading;return[s,{meta:i,isLoading:r,loadMore:()=>{t.setSize(t.size+1)}}]},dm=()=>{let e=dn({to:_e(new Date),from:we(ge(new Date,89))}),[t,i]=p.useState(90),[s,r]=p.useState(e),o=u=>{i(u),r({from:we(ge(new Date,u-1)),to:_e(new Date)})},a=u=>{if(u.name==="dateRange"){let d=dn(u.value);if(r(d),d.from&&d.to){let c=Math.abs(ji(d.from,d.to))+1,m={1:{from:we(new Date),to:_e(new Date)},7:{from:we(ge(new Date,6)),to:_e(new Date)},30:{from:we(ge(new Date,29)),to:_e(new Date)},90:{from:we(ge(new Date,89)),to:_e(new Date)}}[c];m&&cn(m.from,d.from)&&cn(m.to,d.to)?i(c):i(null)}}},{isMobile:l}=_t();return{filterItems:p.useMemo(()=>{let u={type:"range",name:"dateRange",value:s,fromDate:we(ge(new Date,89)),toDate:_e(new Date)};return l?[u]:[u]},[s]),onFilter:a,dateRange:s,filterDays:t,updateFilterDays:o}},cm=e=>(t,i)=>{var d;if(i&&!((d=i.rows)!=null&&d.length))return null;let{symbol:s,size:r=10,page:o,end_t:a,start_t:l}=e,u=new URLSearchParams([["size",r.toString()],["page",`${t+1}`]]);return o&&u.set("page",`${o}`),s&&u.set("symbol",s),a&&u.set("end_t",`${a}`),l&&u.set("start_t",`${l}`),`/v1/liquidations?${u.toString()}`},uf=e=>{let t=co(e);return n.jsx(am,{...t})},df=e=>{let{classNames:t,...i}=e,s=co(i);return n.jsx(lm,{classNames:t,...s})},pm="MarketCloseConfirmID";jt(pm,ki,{size:"md",closable:!1});var mm=e=>{let{current:t,pnlNotionalDecimalPrecision:i,sharePnLConfig:s}=e,r=p.useRef(null);return p.useImperativeHandle(e.ref,()=>({download:()=>{var o,a;(a=(o=r.current)==null?void 0:o.download)==null||a.call(o)}})),{current:t,pnlNotionalDecimalPrecision:i,orderListRef:r,sharePnLConfig:s}},ot=e=>e===void 0||e.length===0?e:e.length===1?e.charAt(0).toUpperCase():e.charAt(0).toUpperCase()+e.toLowerCase().slice(1);function zt(e){var s,r;let t=e.type,i=e.algo_type;if(typeof t<"u"){let o=[];if(e.parent_algo_type){if(i===je.STOP_LOSS){let l=t===ie.CLOSE_POSITION?[q.t("common.position"),q.t("tpsl.sl")]:[q.t("tpsl.sl")];o.push(...l)}if(i===je.TAKE_PROFIT){let l=t===ie.CLOSE_POSITION?[q.t("common.position"),q.t("tpsl.tp")]:[q.t("tpsl.tp")];o.push(...l)}return o}let a=typeof t=="string"?t.replace("_ORDER",""):"";if([ie.ASK,ie.BID].includes(t))return[q.t("orderEntry.orderType.limit")];if(e.algo_order_id===void 0||e.algo_order_id&&i==="BRACKET")return[{[ie.LIMIT]:q.t("orderEntry.orderType.limit"),[ie.MARKET]:q.t("orderEntry.orderType.market"),[ie.POST_ONLY]:q.t("orderEntry.orderType.postOnly"),[ie.IOC]:q.t("orderEntry.orderType.ioc"),[ie.FOK]:q.t("orderEntry.orderType.fok")}[a]||ot(a)];if(a)return[{[ie.LIMIT]:q.t("orderEntry.orderType.stopLimit"),[ie.MARKET]:q.t("orderEntry.orderType.stopMarket")}[a]||a]}if(typeof i<"u"){let o=[];i===Z.POSITIONAL_TP_SL&&o.push(q.t("common.position"));let a=(s=e==null?void 0:e.child_orders)==null?void 0:s.find(u=>u.algo_type===je.TAKE_PROFIT&&!!u.trigger_price),l=(r=e==null?void 0:e.child_orders)==null?void 0:r.find(u=>u.algo_type===je.STOP_LOSS&&!!u.trigger_price);return(a||l)&&o.push(a&&l?q.t("common.tpsl"):a?q.t("tpsl.tp"):q.t("tpsl.sl")),o}}function Ot(e){return e.status===X.CANCELLED||e.algo_status===X.CANCELLED}function hm(e){var r,o,a;if(e.algo_type!==Z.BRACKET)return{tpOrder:void 0,slOrder:void 0};let t=(r=e.child_orders)==null?void 0:r[0];if(!t)return{tpOrder:void 0,slOrder:void 0};let i=(o=t==null?void 0:t.child_orders)==null?void 0:o.find(l=>l.algo_type===je.TAKE_PROFIT),s=(a=t==null?void 0:t.child_orders)==null?void 0:a.find(l=>l.algo_type===je.STOP_LOSS);return{tpOrder:i,slOrder:s}}function po(e){let t={pnl:{tpPnL:void 0,slPnL:void 0},roi:{tpRoi:void 0,slRoi:void 0}},{tpOrder:i,slOrder:s}=hm(e);if(!i&&!s||typeof e.price===void 0||!e.price)return t;let r=e.side===ke.BUY?e.quantity:e.quantity*-1,o=(i==null?void 0:i.trigger_price)&&ue.priceToPnl({qty:r,price:i==null?void 0:i.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:i.algo_type}),a=(s==null?void 0:s.trigger_price)&&ue.priceToPnl({qty:r,price:s==null?void 0:s.trigger_price,entryPrice:e.price,orderSide:e.side,orderType:s.algo_type}),l=o?ue.calcTPSL_ROI({pnl:o,qty:e.quantity,price:e.price}):void 0,u=a?ue.calcTPSL_ROI({pnl:a,qty:e.quantity,price:e.price}):void 0;return{pnl:{tpPnL:o,slPnL:a},roi:{tpRoi:l,slRoi:u}}}function cs(e,t){return!e||!t?!1:e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}var fm=e=>{let{t}=S();return e.sharePnLConfig==null?n.jsx(n.Fragment,{}):n.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),he.show(e.modalId,{pnl:{entity:{symbol:e.order.symbol,pnl:e.order.realized_pnl,side:e.order.side=="BUY"?t("share.pnl.share.long"):t("share.pnl.share.short"),openPrice:e.order.average_executed_price,openTime:e.order.updated_time,quantity:e.order.quantity},refCode:e.refCode,leverage:e.leverage,...e.sharePnLConfig}})},children:n.jsx($s,{color:"white",opacity:.54,size:e.iconSize??16})})},xm=e=>{let{sharePnLConfig:t,order:i,modalId:s,iconSize:r}=e,{getFirstRefCode:o}=gi(),a=p.useMemo(()=>{var u;return(u=o())==null?void 0:u.code},[o]),l=yi(e.order.symbol);return{iconSize:r,order:i,refCode:a,leverage:l,sharePnLConfig:t,modalId:s}},mo=e=>{let t=xm(e);return n.jsx(fm,{...t})},ho=p.createContext({}),Ge=()=>p.useContext(ho),fo=e=>{let t=Ee()[e.symbol];return n.jsx(ho.Provider,{value:{base_dp:t("base_dp"),quote_dp:t("quote_dp"),base_tick:t("base_tick"),quote_tick:t("quote_tick"),base:t("base"),quote:t("quote"),symbol:e.symbol,origin:t(),quote_max:t("quote_max"),quote_min:t("quote_min")},children:e.children})},gm=e=>{let{order:t}=e,{quote_dp:i,base_dp:s}=Ge(),{t:r}=S(),{sl_trigger_price:o,tp_trigger_price:a}=p.useMemo(()=>!("algo_type"in t)||!Array.isArray(t.child_orders)?{}:ue.findTPSLFromOrder(e.order.child_orders[0]),[e.order]),{pnl:l,roi:u}=po(t);return!a&&!o?"--":n.jsx(Le,{content:n.jsxs(g,{direction:"column",itemAlign:"start",gap:1,children:[typeof l.tpPnL<"u"&&n.jsx(h.numeral,{prefix:n.jsxs(h,{intensity:80,children:[`${r("tpsl.tpPnl")}:`,"  "]}),suffix:n.jsx(h,{intensity:20,children:" USDC"}),dp:i,color:"buy",showIdentifier:!0,children:l.tpPnL}),typeof l.slPnL<"u"&&n.jsx(h.numeral,{prefix:n.jsxs(h,{intensity:80,children:[`${r("tpsl.slPnl")}:`,"  "]}),suffix:n.jsx(h,{intensity:20,children:" USDC"}),dp:i,color:"sell",children:l.slPnL})]}),className:"oui-bg-base-6",children:n.jsxs(g,{direction:"column",width:"100%",justify:"start",itemAlign:"start",children:[n.jsx(ps,{type:"TP",value:a,quote_dp:i}),n.jsx(ps,{type:"SL",value:o,quote_dp:i})]})})},ps=e=>{let{type:t,value:i,quote_dp:s}=e,{t:r}=S();return i?n.jsx(h.numeral,{className:E("oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12",t==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:s,prefix:n.jsxs("span",{className:"oui-text-base-contrast-54",children:[t==="TP"?`${r("tpsl.tp")} -`:`${r("tpsl.sl")} -`," "]}),children:i},"tp"):n.jsx(n.Fragment,{})},xo=p.createContext({}),Dt=()=>p.useContext(xo),go=e=>{let{cancelOrder:t,editOrder:i,cancelAlgoOrder:s,editAlgoOrder:r}=e,{t:o}=S(),a=Ee(),l=p.useCallback(async c=>c.algo_order_id!==void 0?"root_algo_order_id"in c&&c.root_algo_order_id!==c.algo_order_id?s(c.root_algo_order_id,c.symbol):s(c.algo_order_id,c.symbol).then(()=>{}):t(c.order_id,c.symbol).then(()=>{}),[]),u=p.useCallback(async(c,m)=>{c.visible_quantity!==void 0?c.visible_quantity:c.visible!==void 0&&c.visible,await he.sheet({title:o("orders.editOrder"),classNames:{content:"oui-edit-order-sheet-content"},content:n.jsx(n.Fragment,{children:"Content"})})},[o]),d=p.useCallback((c,m,y)=>{let{min_notional:j}=a[c](),f=wa({price:m,qty:y,min_notional:j});if(f!==void 0)return o("orderEntry.total.error.min",{value:f})},[a,o]);return n.jsx(xo.Provider,{value:{onCancelOrder:l,onEditOrder:u,editOrder:i,editAlgoOrder:r,checkMinNotional:d},children:e.children})},Di=e=>{let{order:t}=e,{t:i}=S(),{onCancelOrder:s}=Dt(),[r,o]=p.useState(!1);return n.jsx(Nt,{size:"sm",variant:"outlined",color:"secondary",onClick:a=>{s&&(a.preventDefault(),a.stopPropagation(),o(!0),s(t).then(l=>l,l=>{U.error(l.message)}).finally(()=>{o(!1)}))},loading:r,children:i("common.cancel")})},Ii=e=>{let{type:t,base:i,value:s,cancelPopover:r,isSubmitting:o,onConfirm:a}=e,{t:l}=S();return n.jsxs("div",{className:"oui-pt-5 oui-relative",children:[n.jsx("div",{className:"oui-text-base-contrast-54 oui-text-2xs desktop:oui-text-sm",children:(()=>{let u={values:{base:i,value:zs(s)},components:[n.jsx("span",{className:"oui-text-warning-darken"})]};switch(t){case 0:return n.jsx(Qe,{i18nKey:"order.edit.confirm.quantity",...u});case 1:return n.jsx(Qe,{i18nKey:"order.edit.confirm.price",...u});case 2:return n.jsx(Qe,{i18nKey:"order.edit.confirm.triggerPrice",...u})}})()}),n.jsxs("div",{className:"oui-grid oui-grid-cols-2 oui-gap-2 oui-mt-5",children:[n.jsx(te,{color:"secondary",size:"md",onClick:r,disabled:o,children:l("common.cancel")}),n.jsx(Nt,{size:"md",loading:o,onClick:a,children:l("common.confirm")})]}),n.jsx("button",{className:"oui-absolute oui-right-0 oui-top-0 oui-text-base-contrast-54",onClick:r,children:n.jsx(Us,{size:16,color:"white",opacity:1})})]})},Li=e=>{let{inputRef:t,dp:i,value:s,setValue:r,setEditing:o,error:a,handleKeyDown:l,onClick:u,onClose:d,onFocus:c,onBlur:m,hintInfo:y}=e;p.useEffect(()=>{let f=t.current;if(f){let b=f.value.length;f.setSelectionRange(b,b)}o(!0)},[]);let j=((y==null?void 0:y.length)||0)>0;return n.jsx(Le,{content:y,open:j,children:n.jsx(fe,{ref:t,type:"text",size:"sm",formatters:[J.numberFormatter,J.dpFormatter(i),J.currencyFormatter],value:s,onValueChange:f=>r(f),helpText:a,onClick:f=>{f.stopPropagation(),f.preventDefault()},autoComplete:"off",onFocus:c,onBlur:m,onKeyDown:l,autoFocus:!0,color:j?"danger":void 0,classNames:{root:"oui-bg-base-700 oui-px-2 oui-py-1 oui-rounded",input:"oui-pr-2"},suffix:n.jsx("button",{onClick:u,children:n.jsx(Na,{size:18,color:"white",opacity:1,className:"oui-cursor-pointer oui-opacity-50 hover:oui-opacity-100"})})})})},ym=e=>{let{order:t}=e,{t:i}=S(),[s,r]=p.useState(()=>{var F;return t.type===ie.MARKET&&!t.price?"Market":((F=t.price)==null?void 0:F.toString())??"Market"}),[o,a]=p.useState(!1),[l,u]=p.useState(!1),d=(t==null?void 0:t.algo_order_id)!==void 0,c=(t==null?void 0:t.type)==="MARKET"&&d,[m,y]=p.useState(!1),{editOrder:j,editAlgoOrder:f,checkMinNotional:b}=Dt(),{base:x,quote_dp:C}=Ge(),w=Ca(t.symbol,t.side,d?t.trigger_price:void 0),v=()=>{a(!1),u(!1)},N=()=>{var F;a(!1),r(((F=t.price)==null?void 0:F.toString())??"Market"),u(!1)},I=p.useMemo(()=>!w||c||!l?"":Number(s)>w.max?i("orders.price.greaterThan",{max:w.max}):Number(s)<w.min?i("orders.price.lessThan",{min:w.min}):"",[c,l,w,s,i]),O=F=>{if(F==null||F.stopPropagation(),F==null||F.preventDefault(),!(I.length>0)){if(s===`${t.price}`){u(!1);return}if(t.reduce_only!==!0){let z=b(t.symbol,s,t.quantity);if(z){U.error(z),y(!1),N();return}}a(!0)}},A=F=>{F.key==="Enter"&&O(F)},k=()=>{y(!0);let F=t.order_id,z={order_price:s,order_quantity:t.quantity,symbol:t.symbol,order_type:t.type,side:t.side};typeof t.reduce_only<"u"&&(z.reduce_only=t.reduce_only),t.order_tag!==void 0&&(z={...z,order_tag:t.order_tag}),d&&(F=t.algo_order_id,z={...z,order_id:F,price:s,algo_order_id:F}),(t==null?void 0:t.visible_quantity)===0&&(z.visible_quantity=0),t.tag!==void 0&&(z.order_tag=t.tag);let R;t.algo_order_id!==void 0?R=f(t.algo_order_id.toString(),z):R=j(t.order_id.toString(),z),R.then(H=>{v(),r(s)},H=>{U.error(H.message),N()}).finally(()=>y(!1))},_=p.useRef(null);p.useEffect(()=>{e.order.price&&r(`${e.order.price}`)},[e.order.price]);let D=p.useRef(null),M=F=>{D.current&&!D.current.contains(F.target)&&!o&&N()};if(p.useEffect(()=>(document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}),[o,t.price]),t.algo_order_id&&t.type=="MARKET"||s==="Market")return n.jsx("span",{children:i("common.marketPrice")});let L=()=>!l||e.disableEdit?n.jsx(bm,{order:t,price:s,setEditing:u,disableEdit:e.disableEdit}):n.jsx(Li,{inputRef:_,dp:C,value:s,setValue:r,setEditing:u,handleKeyDown:A,onClick:O,onClose:N,hintInfo:I});return n.jsx(bi,{open:o,onOpenChange:a,content:n.jsx(Ii,{type:1,base:x,value:s,cancelPopover:N,isSubmitting:m,onConfirm:k}),children:n.jsx("div",{onClick:F=>{F.stopPropagation(),F.preventDefault()},ref:D,children:L()})})},bm=e=>{let{order:t,price:i}=e;return n.jsx("div",{className:E("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",Ot(t)&&"oui-text-base-contrast-20"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setEditing(!0)},children:n.jsx(g,{r:"base",className:E("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2  oui-border oui-border-line-12"),children:n.jsx(h,{size:"2xs",children:re(i)})})})},yo=p.createContext({}),ut=()=>p.useContext(yo),bo=e=>{let{quote_dp:t}=Ge(),[i,s]=p.useState(),[r]=Jn("/v1/algo/order","DELETE"),[o]=Jn("/v1/algo/order","PUT"),a=_a(),{state:l}=Fe(),u=p.useMemo(()=>va(()=>["/v1/positions",l.accountId]),[l.accountId]),d=async x=>r(null,{order_id:x.algo_order_id,symbol:x.symbol}),c=async(x,C)=>o({order_id:x.algo_order_id,child_orders:x.child_orders.map(w=>({order_id:w.algo_order_id,quantity:C.order_quantity}))}),m=x=>{var C;return(C=a.cache.get(u))==null?void 0:C.data.rows.find(w=>w.symbol===x)},{sl_trigger_price:y,tp_trigger_price:j,tpPnL:f,slPnL:b}=jm({order:e.order,position:i,quote_dp:t});return p.useEffect(()=>{var x;if("algo_type"in e.order||(((x=e.order)==null?void 0:x.reduce_only)??!1)){let C=m(e.order.symbol);C&&s(C)}},[e.order.symbol]),n.jsx(yo.Provider,{value:{order:e.order,sl_trigger_price:y,tp_trigger_price:j,tpPnL:f,slPnL:b,onCancelOrder:d,onUpdateOrder:c,getRelatedPosition:m,position:i},children:e.children})};function jm(e){var c;let{order:t,position:i,quote_dp:s}=e;if(!i)return{sl_trigger_price:void 0,tp_trigger_price:void 0,slPnL:void 0,tpPnL:void 0};let{sl_trigger_price:r,tp_trigger_price:o}=!("algo_type"in t)||!Array.isArray(t.child_orders)?{}:ue.findTPSLFromOrder(t),a=t.quantity;a===0&&((c=t.child_orders)==null?void 0:c[0].type)==="CLOSE_POSITION"&&(a=i.position_qty);let l=i.average_open_price,u=typeof a=="number"&&typeof o=="number"&&typeof l=="number"?ue.priceToPnl({qty:a,price:o,entryPrice:i.average_open_price,orderSide:t.side,orderType:je.TAKE_PROFIT},{symbol:{quote_dp:s}}):void 0,d=typeof a=="number"&&typeof r=="number"&&typeof l=="number"?ue.priceToPnl({qty:a,price:r,entryPrice:i.average_open_price,orderSide:t.side,orderType:je.STOP_LOSS},{symbol:{quote_dp:s}}):void 0;return{sl_trigger_price:r,tp_trigger_price:o,slPnL:d,tpPnL:u}}var jo=e=>{let{order:t,otherOrderQuantity:i}=e,{reduce_only:s}=t,[r,o]=p.useState(t.quantity.toString()),[a,l]=p.useState(!1),{t:u}=S();p.useEffect(()=>{I(t.quantity.toString())},[e.order.quantity]);let[d,c]=p.useState(!1),[m,y]=p.useState(),{editOrder:j,editAlgoOrder:f,checkMinNotional:b}=Dt(),{onUpdateOrder:x,position:C}=ut(),{base_dp:w,base:v,base_tick:N}=Ge(),I=async($,Y)=>{o($);let V=Math.abs((C==null?void 0:C.position_qty)||0);if(C&&s&&Number($)>V)y(u("orders.quantity.lessThanPosition",{quantity:V}));else{let le=Number($);Y&&le>Y?y(u("orders.quantity.lessThan",{quantity:re(Y,{fix:w})})):y(void 0)}return Promise.resolve()},O=()=>{c(!1),l(!1)},A=()=>{c(!1),I(t.quantity.toString()),l(!1)},[k,_]=p.useState(!1),D=p.useRef(null),M=()=>{if(m)return;if(Number(r)===Number(t.quantity)){l(!1);return}let $=t.algo_order_id!==void 0?t.trigger_price:t.price;if($!==null&&t.reduce_only!==!0){let Y=b(t.symbol,$,r);if(Y){U.error(Y),_(!1),A();return}}c(!0)},L=$=>{$==null||$.stopPropagation(),$==null||$.preventDefault(),M()},F=$=>{$.key==="Enter"&&($==null||$.stopPropagation(),$==null||$.preventDefault(),M())},z=p.useCallback(()=>{_(!0);let $={symbol:t.symbol,order_type:t.type,side:t.side,order_price:t.price,order_quantity:r,algo_order_id:t.algo_order_id};if(typeof $.algo_order_id<"u"&&$.order_type==="MARKET"){let{order_price:V,...le}=$;$=le}typeof t.reduce_only<"u"&&($.reduce_only=t.reduce_only),t.order_tag!==void 0&&($={...$,order_tag:t.order_tag}),(t==null?void 0:t.visible_quantity)===0&&($.visible_quantity=0),(t==null?void 0:t.tag)!==void 0&&($.order_tag=t.tag);let Y;"algo_type"in t&&t.algo_type===Z.TP_SL?Y=x(t,$):t.algo_order_id!==void 0?Y=f(t.algo_order_id.toString(),$):Y=j(t.order_id.toString(),$),Y.then(V=>{O(),I(r.toString())},V=>{U.error(V.message),I(t.quantity.toString()),A()}).finally(()=>_(!1))},[r]),R=p.useRef(null),H=p.useRef(null),ne=$=>{R.current&&H.current&&!R.current.contains($.target)&&!H.current.contains($.target)&&!d&&A()};p.useEffect(()=>(document.addEventListener("mousedown",ne),()=>{document.removeEventListener("mousedown",ne)}),[d,t.quantity]);let B=()=>!a||e.disableEdit?n.jsx(wm,{order:t,quantity:r,setEditing:l,disableEdit:e.disableEdit}):n.jsx(_m,{inputRef:D,quantitySliderRef:H,base_dp:w,base_tick:N,quantity:r,setQuantity:I,editing:a,setEditing:l,handleKeyDown:F,onClick:L,onClose:A,symbol:t.symbol,reduce_only:s,positionQty:C==null?void 0:C.position_qty,error:m,confirmOpen:d,side:t.side,order:t,setError:y});return n.jsx(bi,{open:d,onOpenChange:c,content:n.jsx(Ii,{type:0,base:v,value:r,cancelPopover:A,isSubmitting:k,onConfirm:z}),contentProps:{onOpenAutoFocus:$=>{}},children:n.jsx("div",{onClick:$=>{$.stopPropagation(),$.preventDefault()},ref:R,children:B()})})},wm=e=>{let{order:t,quantity:i}=e,s=t.total_executed_quantity;return n.jsxs(g,{direction:"row",justify:"start",gap:1,className:E("oui-max-w-[110px] oui-relative",t.side===ke.BUY&&"oui-text-trade-profit",t.side===ke.SELL&&"oui-text-trade-loss",Ot(t)&&"oui-text-base-contrast-20"),onClick:r=>{r.stopPropagation(),r.preventDefault(),e.setEditing(!0)},children:["algo_type"in t&&t.algo_type===Z.TP_SL?null:n.jsxs(n.Fragment,{children:[n.jsx("span",{children:s}),n.jsx("span",{children:"/"})]}),n.jsx(g,{r:"base",className:E("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:n.jsx(h,{size:"2xs",children:i})})]})},_m=e=>{let{inputRef:t,quantitySliderRef:i,base_dp:s,base_tick:r,quantity:o,setQuantity:a,editing:l,setEditing:u,handleKeyDown:d,onClick:c,onClose:m,error:y,symbol:j,reduce_only:f,positionQty:b,confirmOpen:x,side:C,order:w}=e,v=Vs(j,w.side,w.reduce_only),N=p.useMemo(()=>f?Math.abs(b??0):w.quantity+Math.abs(v),[w.quantity,v,f,b]),[I,O]=p.useState(void 0);p.useEffect(()=>{if(I===void 0){let k=new T(o).div(N).abs().mul(100).toNumber();O(k)}},[I,N,o]);let A=async k=>(r>0&&(k=ue.formatNumber(k,r)??k),a(`${k}`,N));return n.jsxs(xn,{open:!x,children:[n.jsx(gn,{children:n.jsx(Li,{inputRef:t,dp:s,value:o,setValue:k=>{let _=Math.abs(Math.min(Number(k),N)).toString();if(a(k,N),k.endsWith("."))return;if(Number(_)===0){O(0);return}let D=new T(k).div(N).mul(100).toDecimalPlaces(2,T.ROUND_DOWN).toNumber();O(Math.min(100,D))},setEditing:u,handleKeyDown:d,onClick:c,onClose:m,onBlur:k=>{A(k.target.value)},hintInfo:y})}),n.jsx(yn,{className:"oui-w-[360px] oui-rounded-xl",align:"start",side:"bottom",onOpenAutoFocus:k=>{k.preventDefault()},children:n.jsxs(g,{p:1,gap:2,width:"100%",itemAlign:"start",ref:i,children:[n.jsx(h.numeral,{size:"xs",intensity:98,className:"oui-min-w-[30px] ",dp:2,padding:!1,unit:"%",rm:T.ROUND_DOWN,children:`${I}`}),n.jsxs(g,{direction:"column",width:"100%",gap:2,className:"oui-mt-[6px]",children:[n.jsx(wt,{markCount:4,value:[I??0],onValueChange:k=>{let _=Array.from(k.values());O(_[0]);let D=new T(_[0]).div(100).mul(N).abs().toFixed(s,T.ROUND_DOWN);a(D,N)},onValueCommit:k=>{let _=new T(k[0]).div(100).mul(N).abs().toFixed(s,T.ROUND_DOWN);A(_).finally(()=>{t.current.focus()})}}),n.jsx(vm,{onClick:k=>{O(k*100);let _=new T(k).mul(N).abs().toFixed(s,T.ROUND_DOWN);_=ue.formatNumber(_,r)??_,a(_,N),setTimeout(()=>{t.current.focus(),t.current.setSelectionRange(_.length,_.length)},100)}})]})]})})]})},vm=e=>{let{t}=S(),i=[{label:"0%",value:0},{label:"25%",value:.25},{label:"50%",value:.5},{label:"75%",value:.75},{label:t("common.max"),value:1}];return n.jsx(g,{gap:2,width:"100%",children:i.map((s,r)=>n.jsx(te,{variant:"outlined",color:"secondary",size:"xs",onClick:o=>{o.stopPropagation(),o.preventDefault(),e.onClick(s.value)},className:"oui-w-1/5",children:s.label},r))})},Cm=e=>{let{record:t}=e,[i,s]=p.useState(!1),[r,{data:o,error:a,reset:l,isMutating:u}]=Jn("/v1/order"),{t:d}=S(),c=Ne("brokerId"),m=p.useCallback(()=>{s(!1);let y={symbol:t.symbol,order_type:t.type,order_price:t.price,order_quantity:t.quantity,order_amount:t.amount,side:t.side,broker_id:c};Number(t.visible_quantity)<Number(t.quantity)&&(y.visible_quantity=0),typeof t.reduce_only<"u"&&(y.reduce_only=t.reduce_only),r(y)},[]);return n.jsx(te,{size:"sm",variant:"outlined",color:"secondary",loading:u,disabled:u,onClick:y=>{u||(y.preventDefault(),y.stopPropagation(),m())},children:d("orders.history.renew")})},Nm=e=>{let{position:t,order:i}=ut(),{quote_dp:s,base_dp:r}=Ge(),{t:o}=S();return n.jsx(Ti,{quoteDP:s,baseDP:r,position:t,order:i,label:o("common.edit"),isEditing:!0})},Sm=()=>{let{sl_trigger_price:e,tp_trigger_price:t}=ut(),{t:i}=S();return n.jsxs("div",{children:[t?n.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[n.jsxs(h,{intensity:54,children:[`${i("tpsl.tp")} -`," "]}),n.jsx("span",{children:i("common.marketPrice")})]}):null,e?n.jsxs("div",{className:"oui-text-base-contrast-80 oui-td-bg-transparent",children:[n.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${i("tpsl.sl")} -`," "]}),n.jsx("span",{children:i("common.marketPrice")})]}):null]})};function Tm(e){let{sl_trigger_price:t,tp_trigger_price:i}=!("algo_type"in e)||!Array.isArray(e.child_orders)?{}:ue.findTPSLFromOrder(e),s=i?`${q.t("tpsl.tp")} - ${q.t("common.marketPrice")}`:void 0,r=t?`${q.t("tpsl.sl")} - ${q.t("common.marketPrice")}`:void 0;return{tpTriggerPrice:s,slTriggerPrice:r}}var Pm=()=>{let{sl_trigger_price:e,tp_trigger_price:t,order:i,position:s}=ut();return n.jsx(km,{stopLossPrice:e,takeProfitPrice:t,direction:"column",order:i,position:s,tooltip:!0})},km=e=>{let{direction:t="row",order:i,position:s}=e,r=Ee(),{t:o}=S(),a=p.useMemo(()=>{var m;let d=[];if(!e.tooltip||!i||!s)return;let c=i.quantity;return c===0&&((m=i.child_orders)==null?void 0:m[0].type)==="CLOSE_POSITION"&&(c=s.position_qty),e.takeProfitPrice&&d.push(n.jsx(ms,{qty:c,price:e.takeProfitPrice,entryPrice:s.average_open_price,orderSide:i.side,orderType:je.TAKE_PROFIT,symbolInfo:r[i.symbol]()},"tp")),e.stopLossPrice&&d.push(n.jsx(ms,{qty:c,price:e.stopLossPrice,entryPrice:s.average_open_price,orderSide:i.side,orderType:je.STOP_LOSS,symbolInfo:r[i.symbol]()},"sl")),n.jsx("div",{children:d})},[e.takeProfitPrice,e.stopLossPrice,s==null?void 0:s.average_open_price,i==null?void 0:i.side,i==null?void 0:i.quantity,i==null?void 0:i.algo_type]),l=p.useMemo(()=>{let d=[];return i!=null&&i.symbol?(e.takeProfitPrice&&d.push(n.jsx(h.numeral,{className:E("oui-text-trade-profit oui-gap-0  oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:r[i.symbol]("quote_dp",2),children:e.takeProfitPrice,prefix:!e.stopLossPrice||t==="column"?n.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${o("tpsl.tp")} -`," "]}):""},"tp")),e.stopLossPrice&&d.push(n.jsx(h.numeral,{className:E("oui-text-trade-loss oui-gap-0 oui-decoration-white/20 oui-border-b oui-border-dashed oui-border-base-contrast-12"),rule:"price",dp:r[i.symbol]("quote_dp",2),children:e.stopLossPrice,prefix:!e.takeProfitPrice||t==="column"?n.jsxs("span",{className:"oui-text-base-contrast-54",children:[`${o("tpsl.sl")} -`," "]}):""},"sl")),d.length===0?n.jsx("span",{children:"-"}):(d.length===2&&t==="row"&&d.splice(1,0,n.jsx("span",{children:"/"},"split")),d)):n.jsx("span",{children:"-"})},[e.takeProfitPrice,e.stopLossPrice,i==null?void 0:i.symbol,o]),u=n.jsx("div",{className:E("oui-inline-flex oui-text-base-contrast-36",e.direction==="column"?"oui-flex-col":"oui-flex-row oui-gap-1",e.className),children:l});return e.tooltip?n.jsx(Le,{content:a,className:"oui-bg-base-5",arrow:{className:"oui-fill-base-5"},children:u}):u},ms=e=>{let{qty:t,price:i,entryPrice:s,orderSide:r,orderType:o,symbolInfo:a}=e,{t:l}=S(),u=ue.priceToPnl({qty:t,price:i,entryPrice:s,orderSide:r,orderType:o},{symbol:a}),d=(o===je.TAKE_PROFIT?"TP":"SL")=="TP"?`${l("tpsl.tpPnl")}:`:`${l("tpsl.slPnl")}:`;return n.jsxs("div",{className:"oui-flex oui-items-center",children:[n.jsx("span",{className:"oui-text-base-contrast-54 oui-mr-1",children:d}),n.jsx(h.numeral,{rule:"price",dp:a.quote_dp,padding:!1,className:u===0?"oui-text-base-contrast-36":u>0?"oui-text-trade-profit oui-gap-0":"oui-text-trade-loss oui-gap-0",prefix:n.jsx("span",{children:u===0?"":u>0?"+":"-"}),suffix:n.jsx("span",{className:"oui-text-base-contrast-36 oui-ml-1",children:"USDC"}),children:`${Math.abs(u)}`})]})},Om=e=>{let{order:t}=e,[i,s]=p.useState("");p.useEffect(()=>{var L;s(((L=t.trigger_price)==null?void 0:L.toString())??"0")},[t.trigger_price]);let r=(t==null?void 0:t.algo_order_id)!==void 0,o=(t==null?void 0:t.algo_type)==="BRACKET",[a,l]=p.useState(!1),[u,d]=p.useState(!1),[c,m]=p.useState(!1),{editAlgoOrder:y,checkMinNotional:j}=Dt(),{base:f,quote_dp:b,quote_max:x,quote_min:C}=Ge(),w=p.useMemo(()=>{if(!((!r||o)&&!u)){if(Number(i)>x)return`Trigger price must be less than ${x}`;if(Number(i)<C)return`Trigger price must be greater than ${C}`}},[u,i,r,o]),v=()=>{l(!1),d(!1)},N=()=>{var L;s(((L=t.trigger_price)==null?void 0:L.toString())??"0"),l(!1),d(!1)},I=p.useRef(null),O=L=>{I.current&&!I.current.contains(L.target)&&!a&&N()};p.useEffect(()=>(document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}),[a,t.trigger_price]);let A=L=>{if(L==null||L.stopPropagation(),L==null||L.preventDefault(),d(!1),Number(i)!==Number(t.trigger_price)){if(t.price&&t.reduce_only!==!0){let F=j(t.symbol,t.price,t.quantity);if(F){U.error(F),m(!1),N();return}}l(!0)}},k=L=>{L.key==="Enter"&&A(L)},_=()=>{if((w??"").length>0)return;m(!0);let L={quantity:t.quantity,trigger_price:i,symbol:t.symbol,algo_order_id:t.algo_order_id};t.order_tag!==void 0&&(L={...L,order_tag:t.order_tag}),y(`${t.algo_order_id}`,L).then(F=>{v(),s(i)},F=>{var z;U.error(F.message),s(((z=t.trigger_price)==null?void 0:z.toString())??"--"),N()}).finally(()=>m(!1))},D=p.useRef(null);if(!r||o)return n.jsx(h,{children:"--"});let M=()=>!u||e.disableEdit?n.jsx(Dm,{order:t,price:i,setEditing:d,disableEdit:e.disableEdit}):n.jsx(Li,{inputRef:D,dp:b,value:i,setValue:s,setEditing:d,handleKeyDown:k,onClick:A,onClose:N,hintInfo:w});return n.jsx(bi,{open:a,onOpenChange:l,content:n.jsx(Ii,{type:2,base:f,value:i,cancelPopover:N,isSubmitting:c,onConfirm:_}),children:n.jsx("div",{onClick:L=>{L.stopPropagation(),L.preventDefault()},ref:I,children:M()})})},Dm=e=>{let{order:t,price:i}=e;return n.jsx("div",{className:E("oui-flex oui-max-w-[110px] oui-justify-start oui-items-center oui-gap-1 oui-relative oui-font-semibold",Ot(t)&&"oui-text-base-contrast-20"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setEditing(!0)},children:n.jsx(g,{r:"base",className:E("oui-min-w-[70px] oui-h-[28px]",!e.disableEdit&&"oui-bg-base-7 oui-px-2 oui-border oui-border-line-12"),children:n.jsx(h,{size:"2xs",children:i})})})},Im=e=>{let{_type:t,onSymbolChange:i,pnlNotionalDecimalPrecision:s,sharePnLConfig:r}=e,{t:o}=S();return p.useMemo(()=>{switch(t){case"all":return[Ye({width:130,showType:!0,onSymbolChange:i,enableSort:!1}),Lm({width:130}),ct({width:130,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),pt({width:130,title:o("common.orderPrice"),disableEdit:!0,enableSort:!1}),tn({width:130,enableSort:!1}),hs({width:130,symbolsInfo:e.symbolsInfo}),Hn({width:124,pnlNotionalDecimalPrecision:s,sharePnLConfig:r,symbolsInfo:e.symbolsInfo}),mt({width:130,enableSort:!1}),qt({width:130}),Rt({width:130}),Ze({width:130}),ht({width:130}),fs({width:130}),ft({width:160,enableSort:!1})];case"pending":return[Ye({width:172,showType:!0,onSymbolChange:i,enableSort:!1}),ct({width:162,className:"oui-pr-0",enableSort:!1}),pt({width:162,className:"oui-pr-0",enableSort:!1}),At({width:162,className:"oui-pr-0"}),Rm({width:130}),mt({width:162,isPending:!0}),Ze({width:162}),ht({width:162}),ft({width:162,enableSort:!1}),Fm({width:162})];case"tp_sl":return[Ye({width:176,showType:!0,onSymbolChange:i,enableSort:!1}),Em({width:176}),hs({width:176,symbolsInfo:e.symbolsInfo}),Am({width:176}),Mm({width:176}),Ze({width:176}),ft({width:176,enableSort:!1}),$m({width:176})];case"filled":return[Ye({showType:!0,width:154,onSymbolChange:i}),ct({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),pt({width:124,title:o("common.orderPrice"),disableEdit:!0}),qm({width:124}),At({width:124,disableEdit:!0}),Hn({width:124,pnlNotionalDecimalPrecision:s,sharePnLConfig:r,symbolsInfo:e.symbolsInfo,hideShare:!0}),mt({width:124}),qt({width:124}),Rt({width:124}),Ze({width:124}),ht({width:124}),ft({width:176})];case"cancelled":return[Ye({showType:!0,width:154,onSymbolChange:i,enableSort:!1}),ct({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0",enableSort:!1}),pt({width:124,disableEdit:!0,enableSort:!1}),tn({width:124,enableSort:!1}),At({width:124,disableEdit:!0}),mt({width:124}),qt({width:124}),Rt({width:124}),Ze({width:124}),ht({width:124})];case"rejected":return[Ye({showType:!0,width:154,onSymbolChange:i}),ct({width:124,disableEdit:!0,className:"oui-pl-0 oui-pr-0"}),pt({width:124,disableEdit:!0}),tn({width:124}),At({width:124,disableEdit:!0}),mt({width:124}),qt({width:124}),Rt({width:124}),Ze({width:124}),ht({width:124}),ft({width:176})];case"orderHistory":return[Ye({showType:!0,width:154,onSymbolChange:i}),ct({width:150,disableEdit:!0,className:"oui-pl-6 oui-pr-0"}),pt({width:124,disableEdit:!0}),tn({width:124}),At({width:124,disableEdit:!0}),Hn({width:124,pnlNotionalDecimalPrecision:s,sharePnLConfig:r,symbolsInfo:e.symbolsInfo}),mt({width:124}),qt({width:124}),Rt({width:124}),Ze({width:124}),ht({width:124}),ft({width:150}),fs({width:80})]}},[t,s,r,o])};function Ye(e){return{title:q.t("common.symbol"),dataIndex:"symbol",fixed:"left",width:e==null?void 0:e.width,onSort:e!=null&&e.enableSort?(t,i)=>t.symbol.localeCompare(i.symbol):void 0,renderPlantText:(t,i)=>{var o;let s=(o=zt(i))==null?void 0:o.join(","),r=s!=null&&s.length?` (${s})`:"";return`${t.split("_")[1]}-PERP${r}`},render:(t,i)=>{var r;let s=Ot(i);return n.jsxs(g,{gap:2,children:[n.jsx("div",{className:E("oui-rounded-[1px] oui-w-1 oui-h-7 oui-shrink-0",i.side===ke.BUY?"oui-bg-trade-profit":"oui-bg-trade-loss")}),n.jsxs(g,{direction:"column",itemAlign:"start",children:[n.jsx(h.formatted,{size:"xs",className:"oui-cursor-pointer oui-text-xs",onClick:o=>{var a;(a=e==null?void 0:e.onSymbolChange)==null||a.call(e,{symbol:t}),o.stopPropagation(),o.preventDefault()},children:`${t.split("_")[1]}-PERP`}),(e==null?void 0:e.showType)&&n.jsx(g,{direction:"row",gap:1,children:(r=zt(i))==null?void 0:r.map((o,a)=>n.jsx(ee,{color:o.toLocaleLowerCase()==="position"?s?"neutral":"primary":"neutral",size:"xs",className:"oui-break-normal oui-whitespace-nowrap",children:o},a))})]})]})}}}function Lm(e){return{title:q.t("common.side"),dataIndex:"side",width:e==null?void 0:e.width,onSort:e!=null&&e.enableSort?(t,i,s)=>i.side.localeCompare(t.side):void 0,renderPlantText:(t,i)=>ot(t),render:(t,i)=>{let s=Ot(i)?"oui-text-base-contrast-20":t===ke.BUY?"oui-text-trade-profit":"oui-text-trade-loss";return n.jsx("span",{className:E("oui-font-semibold",s),children:ot(t)})}}}function ct(e){return{title:q.t("orders.column.fill&Quantity"),dataIndex:"fill_quantity",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(t,i)=>{let s=(t.algo_type===Z.POSITIONAL_TP_SL?0:t.quantity)??0,r=(i.algo_type===Z.POSITIONAL_TP_SL?0:i.quantity)??0;return Yt(s,r)}:void 0,renderPlantText:(t,i)=>{if(i.type===ie.CLOSE_POSITION&&i.status!==X.FILLED)return q.t("tpsl.entirePosition");let s=i.total_executed_quantity;return("algo_type"in i&&i.algo_type===Z.TP_SL?"":`${s} / `)+`${i.quantity}`},render:(t,i)=>i.type===ie.CLOSE_POSITION&&i.status!==X.FILLED?q.t("tpsl.entirePosition"):n.jsx(jo,{order:i,disableEdit:e==null?void 0:e.disableEdit})}}function Em(e){return{title:q.t("common.quantity"),className:e==null?void 0:e.className,dataIndex:"quantity",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(t,i)=>{let s=(t.algo_type===Z.POSITIONAL_TP_SL?0:t.quantity)??0,r=(i.algo_type===Z.POSITIONAL_TP_SL?0:i.quantity)??0;return Yt(s,r)}:void 0,renderPlantText:(t,i)=>{if(i.algo_type===Z.POSITIONAL_TP_SL)return q.t("tpsl.entirePosition");let s=i.total_executed_quantity;return("algo_type"in i&&i.algo_type===Z.TP_SL?"":`${s}/`)+`${i.quantity}`},render:(t,i)=>i.algo_type===Z.POSITIONAL_TP_SL?q.t("tpsl.entirePosition"):n.jsx(jo,{order:i})}}function pt(e){return{title:(e==null?void 0:e.title)??q.t("common.price"),dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(t,i,s)=>Yt(t.price??0,i.price??0):void 0,renderPlantText:(t,i)=>{var s;return re((s=i.price)==null?void 0:s.toString(),{fallback:q.t("common.marketPrice")})},render:(t,i)=>n.jsx(ym,{order:i,disableEdit:e==null?void 0:e.disableEdit})}}function Am(e){return{title:(e==null?void 0:e.title)??q.t("common.price"),dataIndex:"price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(t,i)=>{let{tpTriggerPrice:s,slTriggerPrice:r}=Tm(i),o=`${s||""}${r?`${s?`
`:""}${r}`:""}`;return o.length>0?o:"--"},render:(t,i)=>n.jsx(Sm,{})}}function qm(e){return{title:q.t("common.avgPrice"),dataIndex:"average_executed_price",className:e==null?void 0:e.className,width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,render:(t,i)=>re(t)}}function At(e){return{title:q.t("common.trigger"),className:e==null?void 0:e.className,dataIndex:"trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(t,i)=>{let s=(i==null?void 0:i.algo_order_id)!==void 0,r=(i==null?void 0:i.algo_type)==="BRACKET";return!s||r?"--":re(t)},render:(t,i)=>n.jsx(Om,{order:i,disableEdit:e==null?void 0:e.disableEdit})}}function hs(e){return{title:(e==null?void 0:e.title)??q.t("common.trigger"),className:e==null?void 0:e.className,dataIndex:"tpsl_trigger_price",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(t,i)=>{var u;let s=(u=e==null?void 0:e.symbolsInfo)==null?void 0:u[i.symbol],r=s==null?void 0:s("quote_dp"),{sl_trigger_price:o,tp_trigger_price:a}=!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ue.findTPSLFromOrder(i),l=(a!=null?`${q.t("tpsl.tp")}: ${re(a,{fix:r,padEnd:!0})}`:"")+(o!=null?`${a?`
`:""}${q.t("tpsl.sl")}: ${re(o,{fix:r,padEnd:!0})}`:"");return l.length>0?l:"--"},render:(t,i)=>n.jsx(Pm,{})}}function Rm(e){return{title:q.t("common.tpsl"),className:e==null?void 0:e.className,dataIndex:"bracketOrderPrice",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,renderPlantText:(t,i)=>{let s=()=>!("algo_type"in i)||!Array.isArray(i.child_orders)?{}:ue.findTPSLFromOrder(i.child_orders[0]),{sl_trigger_price:r,tp_trigger_price:o}=s(),a=(o!=null?`${q.t("tpsl.tp")}: ${o}`:"")+(r!=null?`${o?`
`:""}${q.t("tpsl.sl")}: ${r}`:"");return a.length>0?a:"--"},render:(t,i)=>n.jsx(gm,{order:i})}}function mt(e){return{title:q.t("common.notional"),dataIndex:"executed",width:e==null?void 0:e.width,className:e==null?void 0:e.className,onSort:(e==null?void 0:e.enableSort)??!1?(t,i,s)=>{let r=t.type===ie.CLOSE_POSITION&&t.status!==X.FILLED||t.total_executed_quantity===0||Number.isNaN(t.average_executed_price)||t.average_executed_price===null?0:t.total_executed_quantity*t.average_executed_price,o=i.type===ie.CLOSE_POSITION&&i.status!==X.FILLED||i.total_executed_quantity===0||Number.isNaN(i.average_executed_price)||i.average_executed_price===null?0:i.total_executed_quantity*i.average_executed_price;return Yt(r,o)}:void 0,renderPlantText:(t,i)=>Qn(i,(e==null?void 0:e.isPending)??!1)==="Entire position"?q.t("tpsl.entirePosition"):re(Qn(i,(e==null?void 0:e.isPending)??!1),{fix:2}),render:(t,i)=>{let s=Qn(i,(e==null?void 0:e.isPending)??!1);return s==="Entire position"?q.t("tpsl.entirePosition"):n.jsx(h.numeral,{rm:T.ROUND_DOWN,dp:2,children:s})}}}function Hn(e){return{title:q.t("common.realizedPnl"),dataIndex:"realized_pnl",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(t,i)=>{var u;let s=(u=e==null?void 0:e.symbolsInfo)==null?void 0:u[i.symbol],r=s==null?void 0:s("quote_dp"),o=(e==null?void 0:e.pnlNotionalDecimalPrecision)??r,a=new T(t??0).toDecimalPlaces(o,T.ROUND_DOWN).toNumber(),l=re(a);return a>0?`+${l}`:l},render:(t,i)=>{let{quote_dp:s}=Ge(),r=(e==null?void 0:e.pnlNotionalDecimalPrecision)??s,o=new T(t??0).toDecimalPlaces(r,T.ROUND_DOWN).toNumber();return n.jsxs(g,{gap:1,children:[n.jsx(h.numeral,{dp:r,rm:T.ROUND_DOWN,padding:!1,intensity:(o??0)==0?80:void 0,showIdentifier:(o??0)>0,coloring:(o??0)!=0,children:o??"--"}),!(e!=null&&e.hideShare)&&n.jsx(mo,{order:i,sharePnLConfig:e==null?void 0:e.sharePnLConfig,modalId:Dn})]})}}}function Ze(e){return{title:q.t("orderEntry.reduceOnly"),dataIndex:"reduce_only",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(t,i)=>t?q.t("common.yes"):q.t("common.no"),render:t=>n.jsx(h,{children:t?q.t("common.yes"):q.t("common.no")})}}function ht(e){return{title:q.t("orders.column.hidden"),dataIndex:"visible",width:e==null?void 0:e.width,className:e==null?void 0:e.className,renderPlantText:(t,i)=>t!==0?q.t("common.no"):q.t("common.yes"),render:(t,i)=>n.jsx(h,{children:i.visible_quantity!==0?q.t("common.no"):q.t("common.yes")})}}function ft(e){return{title:q.t("orders.column.orderTime"),dataIndex:"created_time",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(t,i)=>{let s=new Date(t);return Ws(s,"yyyy-MM-dd HH:mm:ss")},render:t=>n.jsx(h.formatted,{rule:"date",formatString:(e==null?void 0:e.formatString)||"yyyy-MM-dd HH:mm:ss",className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:t})}}function qt(e){return{title:q.t("common.fee"),dataIndex:"total_fee",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className}}function Mm(e){return{title:q.t("common.notional"),dataIndex:"executed",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(t,i)=>i.algo_type===Z.POSITIONAL_TP_SL?q.t("tpsl.entirePosition"):re(i.quantity===0?"--":`${new T(i.mark_price).mul(i.quantity).todp(2).toNumber()}`),render:(t,i)=>i.algo_type===Z.POSITIONAL_TP_SL?q.t("tpsl.entirePosition"):n.jsx(h.numeral,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:i.quantity===0?"--":`${new T(i.mark_price).mul(i.quantity).todp(2).toNumber()}`})}}function Rt(e){let t={[X.NEW]:q.t("orders.status.pending"),[X.FILLED]:q.t("orders.status.filled"),[X.PARTIAL_FILLED]:q.t("orders.status.partialFilled"),[X.CANCELLED]:q.t("orders.status.canceled"),[X.REJECTED]:q.t("orders.status.rejected"),[X.INCOMPLETE]:q.t("orders.status.incomplete"),[X.COMPLETED]:q.t("orders.status.completed")};return{title:q.t("common.status"),dataIndex:"status",width:e==null?void 0:e.width,onSort:e==null?void 0:e.enableSort,className:e==null?void 0:e.className,renderPlantText:(i,s)=>{let r=i||s.algo_status;return t[r]||ot(r)},render:(i,s)=>{let r=i||s.algo_status;return t[r]||ot(r)}}}function tn(e){return{title:q.t("common.avgPrice"),dataIndex:"average_executed_price",width:e==null?void 0:e.width,onSort:(e==null?void 0:e.enableSort)??!1?(t,i)=>Yt(t.average_executed_price??0,i.average_executed_price??0):void 0,className:e==null?void 0:e.className,render:(t,i)=>i.type===ie.MARKET&&!t?"--":n.jsx(h,{className:"oui-break-normal oui-whitespace-nowrap oui-font-semibold",children:t}),renderPlantText:(t,i)=>re(t,{fix:2})}}function fs(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(t,i)=>i.status===X.CANCELLED?n.jsx(Cm,{record:i}):i.status===X.NEW||i.algo_status===X.NEW?n.jsx(Di,{order:i}):null}}function Fm(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(t,i)=>n.jsx(Di,{order:i})}}function $m(e){return{title:"",type:"action",dataIndex:"action",width:e==null?void 0:e.width,className:e==null?void 0:e.className,align:"right",fixed:"right",render:(t,i)=>n.jsxs(g,{gap:3,children:[n.jsx(Nm,{order:i}),n.jsx(Di,{order:i})]})}}function Yt(e,t){return e>t?1:e<t?-1:0}function Qn(e,t){return t?e.price&&e.quantity?new T(e.price).mul(e.quantity).toFixed(2,T.ROUND_DOWN):"--":e.type===ie.CLOSE_POSITION&&e.status!==X.FILLED?q.t("tpsl.entirePosition"):e.total_executed_quantity===0||Number.isNaN(e.average_executed_price)||e.average_executed_price===null?"--":`${e.total_executed_quantity*e.average_executed_price}`}var zm=e=>{let{item:t}=e,i=t.side===ke.BUY,{t:s}=S();return n.jsx(h.formatted,{intensity:80,rule:"symbol",formatString:"base-type",size:"sm",prefix:n.jsx(ee,{color:i?"success":"danger",size:"xs",children:s(i?"common.buy":"common.sell")}),onClick:()=>{var r;(r=e.onSymbolChange)==null||r.call(e,{symbol:t.symbol})},children:t.symbol})},Um=e=>{var i;let{item:t}=e;return p.useCallback(()=>{let s=typeof t.type=="string"?t.type.replace("_ORDER","").toLowerCase():t.type;return t.algo_order_id&&t.algo_type!==Z.BRACKET?`Stop ${s}`:ot(t.type)},[t]),n.jsx(g,{direction:"row",gap:1,children:(i=zt(e.item))==null?void 0:i.map((s,r)=>n.jsx(ee,{color:s.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:s},r))})},Bm=e=>{let{item:t}=e;return n.jsx(h.formatted,{rule:"date",formatString:"yyyy-MM-dd hh:mm:ss",intensity:36,size:"2xs",children:t.updated_time})},Wm=e=>{let{item:t}=e,{t:i}=S(),s=t.status||t.algo_status,r=p.useMemo(()=>({[X.NEW]:i("orders.status.pending"),[X.FILLED]:i("orders.status.filled"),[X.PARTIAL_FILLED]:i("orders.status.partialFilled"),[X.CANCELLED]:i("orders.status.canceled"),[X.REJECTED]:i("orders.status.rejected"),[X.INCOMPLETE]:i("orders.status.incomplete"),[X.COMPLETED]:i("orders.status.completed")}),[i]);return n.jsx(h.formatted,{intensity:80,size:"2xs",children:r[s]||ot(s)})},xs=e=>{let{item:t}=e,{t:i}=S(),s=t.type===ie.CLOSE_POSITION&&(t==null?void 0:t.status)!==X.FILLED;return n.jsx(se,{label:i("common.qty"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.base_dp,padding:!1,coloring:!0,placeholder:i("tpsl.entirePosition"),intensity:80,children:s?i("tpsl.entirePosition"):t.quantity})})},gs=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:n.jsx(h,{children:i("orders.status.filled")}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.base_dp,intensity:80,padding:!1,rm:T.ROUND_DOWN,children:t.total_executed_quantity})})},Vm=e=>{let{item:t}=e,{t:i}=S(),s=p.useMemo(()=>t.price&&t.quantity?new T(t.price).mul(t.quantity).toFixed(e.quote_dp,T.ROUND_DOWN):"--",[t.price,t.quantity]);return n.jsx(se,{align:"end",label:n.jsxs(h,{children:[i("common.notional"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,coloring:!0,intensity:80,padding:!1,rm:T.ROUND_DOWN,children:s})})},ys=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:i("orders.column.triggerPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:e.align,children:n.jsx(h.numeral,{dp:e.quote_dp,intensity:80,padding:!1,rm:T.ROUND_DOWN,children:t.trigger_price??"--"})})},Hm=e=>{let{item:t}=e,{t:i}=S();return n.jsx(se,{label:i("common.markPrice"),align:"end",classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,padding:!1,children:t.mark_price})})},Qm=e=>{let{item:t}=e,{t:i}=S(),s=(t==null?void 0:t.algo_order_id)!==void 0,r=(t==null?void 0:t.type)==="MARKET"&&s;return n.jsx(se,{label:i("common.limitPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:r?n.jsx(h,{children:i("common.marketPrice")}):n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,padding:!1,children:t.price??"--"})})},Km=e=>{let{tp_trigger_price:t,tpPnL:i}=ut(),{t:s}=S();return n.jsx(se,{label:s("tpsl.tpTrigger"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(Ei,{content:i&&n.jsx(h.numeral,{size:"2xs",showIdentifier:!0,prefix:n.jsxs(h,{intensity:54,children:[`${s("tpsl.tpPnl")}:`," "]}),suffix:n.jsx(h,{intensity:20,children:" USDC"}),coloring:!0,children:i}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,color:"buy",padding:!1,className:t?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:t??"--"})})})},Gm=e=>{let{sl_trigger_price:t,slPnL:i}=ut(),{t:s}=S();return n.jsx(se,{label:s("tpsl.slTrigger"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(Ei,{content:i&&n.jsx(h.numeral,{size:"2xs",prefix:n.jsxs(h,{intensity:54,children:[`${s("tpsl.slPnl")}:`,"  "]}),suffix:n.jsx(h,{intensity:20,children:" USDC"}),coloring:!0,children:i}),classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,color:"sell",padding:!1,className:t?"oui-border-b oui-border-dashed oui-border-base-contrast-12":void 0,children:t??"--"})})})},Xm=e=>{let{t}=S();return n.jsx(se,{label:t("tpsl.tpPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h,{intensity:80,children:t("common.marketPrice")})})},Jm=e=>{let{t}=S();return n.jsx(se,{label:t("tpsl.slPrice"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h,{intensity:80,children:t("common.marketPrice")})})},Ym=e=>{let{item:t}=e,{t:i}=S(),s=p.useMemo(()=>t.algo_type===Z.POSITIONAL_TP_SL?n.jsx("span",{className:"oui-text-base-contrast-80",children:i("tpsl.entirePosition")}):n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,padding:!1,children:t.quantity}),[t,i]);return n.jsx(se,{label:i("common.quantity"),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:s})},Zm=e=>{var i;let{t}=S();return n.jsx(se,{label:n.jsxs(h,{children:[t("common.avgPrice"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,padding:!1,children:((i=e.item)==null?void 0:i.average_executed_price)??"--"})})},eh=e=>{var i;let{t}=S();return n.jsx(se,{label:n.jsxs(h,{children:[t("common.orderPrice"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},children:n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,intensity:80,padding:!1,placeholder:t("common.marketPrice"),children:((i=e.item)==null?void 0:i.price)??"--"})})},th=e=>{var s;let t=(s=e==null?void 0:e.item)==null?void 0:s.realized_pnl,{t:i}=S();return n.jsx(se,{label:n.jsxs(h,{children:[i("common.realizedPnl"),n.jsx(h,{intensity:20,children:"(USDC)"})]}),classNames:{root:"oui-text-xs",label:"oui-text-2xs"},align:"end",children:n.jsxs(g,{gap:1,children:[n.jsx(h.numeral,{dp:e.quote_dp,rm:T.ROUND_DOWN,padding:!1,intensity:(t??0)==0?80:void 0,showIdentifier:(t??0)>0,coloring:(t??0)!=0,children:t??"--"}),n.jsx(mo,{order:e.item,sharePnLConfig:e.sharePnLConfig,modalId:In,iconSize:12})]})})},Ei=e=>{let{classNames:t,content:i}=e,[s,r]=p.useState(!1);return typeof i>"u"?e.children:n.jsx(Le,{content:i,className:t==null?void 0:t.content,open:s,onOpenChange:r,arrow:{className:t==null?void 0:t.arrow},children:n.jsx("div",{onClick:()=>r(o=>!o),children:e.children})})},nh=e=>{var i;let{t}=S();return n.jsxs(g,{justify:"end",gapX:1,mt:1,children:[n.jsxs(h,{size:"2xs",intensity:36,children:[t("common.fee"),":"]}),n.jsx(h,{size:"2xs",intensity:80,children:((i=e.item)==null?void 0:i.total_fee)??"--"})]})},ih=e=>{var i,s,r,o;let{t}=S();return!e.sl_trigger_price&&!e.tp_trigger_price?n.jsx(n.Fragment,{}):n.jsx(n.Fragment,{children:n.jsx(Ei,{classNames:{content:"oui-bg-base-6 oui-ml-2",arrow:"oui-fill-base-6"},content:n.jsxs(g,{direction:"column",itemAlign:"start",gap:1,children:[typeof((i=e.pnl)==null?void 0:i.tpPnL)<"u"&&n.jsx(h.numeral,{prefix:n.jsxs(h,{intensity:80,children:[`${t("tpsl.tpPnl")}:`,"  "]}),suffix:n.jsx(h,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"buy",showIdentifier:!0,children:(s=e.pnl)==null?void 0:s.tpPnL}),typeof((r=e.pnl)==null?void 0:r.slPnL)<"u"&&n.jsx(h.numeral,{prefix:n.jsxs(h,{intensity:80,children:[`${t("tpsl.slPnl")}:`,"  "]}),suffix:n.jsx(h,{intensity:20,children:" USDC"}),dp:e.quote_dp,color:"sell",children:(o=e.pnl)==null?void 0:o.slPnL})]}),children:n.jsx("button",{onClick:()=>{e.setOpen(!e.open)},children:n.jsxs(g,{gap:1,width:"1",children:[e.tp_trigger_price&&n.jsx(bs,{type:"TP",value:e.tp_trigger_price,quote_dp:e.quote_dp}),e.sl_trigger_price&&n.jsx(bs,{type:"SL",value:e.sl_trigger_price,quote_dp:e.quote_dp})]})})})})},bs=e=>{let{type:t,value:i,quote_dp:s}=e;return i?n.jsx(h.numeral,{size:"2xs",className:E("oui-border-b oui-border-dashed oui-border-base-contrast-12",t==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),rule:"price",dp:s,padding:!1,rm:T.ROUND_DOWN,prefix:n.jsxs("span",{className:"oui-text-base-contrast-36",children:[`${t} `,":  "]}),children:i},"tp"):n.jsx(n.Fragment,{})},sh=e=>{let{item:t,quote_dp:i,base_dp:s}=e,[r,o]=p.useState(!1),{sl_trigger_price:a,tp_trigger_price:l}=p.useMemo(()=>!("algo_type"in t)||!Array.isArray(t.child_orders)?{}:ue.findTPSLFromOrder(t.child_orders[0]),[t]),{pnl:u,roi:d}=po(t);return{sl_trigger_price:a,tp_trigger_price:l,pnl:u,roi:d,quote_dp:i,open:r,setOpen:o}},rh=e=>{let t=sh(e);return n.jsx(ih,{...t})},oh=e=>{let{t}=S();return n.jsxs(n.Fragment,{children:[n.jsx(te,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:i=>e.setOpen(!0),children:t("common.cancel")}),e.open&&n.jsx(vt,{size:"xs",open:e.open,onOpenChange:e.setOpen,title:t("orders.cancelOrder"),actions:{primary:{label:t("common.confirm"),loading:e.isLoading,fullWidth:!0,size:"md",onClick:i=>{e.onCancel(i)}},secondary:{label:t("common.cancel"),fullWidth:!0,size:"md",onClick:()=>{e.onClose()}}},children:n.jsx(h,{size:"2xs",intensity:54,children:t("orders.cancelOrder.description")})})]})},ah=e=>{let{state:t}=e,[i,s]=p.useState(!1),{onCancelOrder:r}=Dt(),[o,a]=p.useState(!1);return{...t,open:i,setOpen:s,onCancel:l=>r?(l==null||l.preventDefault(),l==null||l.stopPropagation(),a(!0),r(t.item).then(u=>{s(!1)},u=>{U.error(u.message)}).finally(()=>{a(!1)})):Promise.resolve(),onClose:()=>{s(!1)},isLoading:o}},lh=e=>{let t=ah(e);return n.jsx(oh,{...t})},uh=e=>{let{t}=S(),{item:i}=e;return i.quantity>0,n.jsx(n.Fragment,{children:n.jsx(te,{variant:"outlined",fullWidth:!0,color:"secondary",size:"sm",className:"oui-border-base-contrast-36",onClick:()=>{e.onShowEditSheet()},children:t("common.edit")})})},dh=e=>{var u;let{side:t}=e.item,{price:i,quantity:s,triggerPrice:r,isAlgoOrder:o}=e,a=t===ke.BUY,{t:l}=S();return n.jsxs("div",{className:"oui-pt-2",children:[n.jsx(h,{intensity:80,children:`You agree to edit your ${e.base}-PERP order.`}),n.jsxs(g,{gap:2,mb:3,mt:2,justify:"between",children:[n.jsx(h.formatted,{rule:"symbol",formatString:"base-type",size:"base",showIcon:!0,children:e.item.symbol}),n.jsxs(g,{direction:"row",gap:1,children:[(u=zt(e.item))==null?void 0:u.map((d,c)=>n.jsx(ee,{color:d.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:d},c)),a&&n.jsx(ee,{color:"success",size:"xs",children:l("common.buy")}),!a&&n.jsx(ee,{color:"danger",size:"xs",children:l("common.sell")})]})]}),n.jsx(ye,{}),n.jsxs(g,{direction:"column",gap:1,width:"100%",className:"oui-text-sm oui-text-base-contrast-54",py:3,children:[o&&n.jsxs(g,{justify:"between",width:"100%",gap:1,children:[n.jsx(h,{children:l("orders.column.triggerPrice")}),n.jsx(h.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:T.ROUND_DOWN,suffix:n.jsx(h,{intensity:54,children:" USDC"}),children:r??"--"})]}),n.jsxs(g,{justify:"between",width:"100%",gap:1,children:[n.jsx(h,{children:l("common.price")}),n.jsx(h.numeral,{intensity:80,dp:e.quote_dp,padding:!1,rm:T.ROUND_DOWN,suffix:n.jsx(h,{intensity:54,children:" USDC"}),placeholder:e.isStopMarket?l("common.marketPrice"):"--",children:e.isStopMarket?l("common.marketPrice"):i??"--"})]}),n.jsxs(g,{justify:"between",width:"100%",gap:1,children:[n.jsx(h,{children:l("common.qty")}),n.jsx(h.numeral,{color:t===ke.BUY?"buy":"sell",dp:e.base_dp,padding:!1,rm:T.ROUND_DOWN,children:s??"--"})]})]}),n.jsxs(g,{className:"oui-gap-[2px]",children:[n.jsx(As,{color:"white",id:"oui-checkbox-disableOrderConfirmation",checked:!e.orderConfirm,onCheckedChange:d=>{e.setOrderConfirm(!d)}}),n.jsx("label",{className:"oui-text-2xs oui-text-base-contrast-54",htmlFor:"oui-checkbox-disableOrderConfirmation",children:l("orderEntry.disableOrderConfirm")})]})]})},ch=e=>{var c,m,y;let{item:t}=e,i=t.side===ke.BUY,{t:s}=S(),{parseErrorMsg:r}=wn(e.errors),o=r("order_quantity"),a=r("order_price"),l=r("trigger_price"),u=e.quantity&&e.maxQty?Math.min(Number(e.quantity)/e.maxQty,1):void 0,d=j=>{let f=e.baseTick;if(f&&f>0){let b=ue.formatNumber(j,f)??j;e.setQuantity(b)}};return n.jsxs(n.Fragment,{children:[n.jsxs(g,{direction:"column",gap:3,width:"100%",itemAlign:"start",className:"oui-text-sm",children:[n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h.formatted,{rule:"symbol",showIcon:!0,intensity:80,children:t.symbol}),n.jsxs(g,{direction:"row",gap:1,children:[(c=zt(e.item))==null?void 0:c.map((j,f)=>n.jsx(ee,{color:j.toLocaleLowerCase()==="position"?"primary":"neutral",size:"xs",children:j},f)),i&&n.jsx(ee,{color:"success",size:"xs",children:s("common.buy")}),!i&&n.jsx(ee,{color:"danger",size:"xs",children:s("common.sell")})]})]}),n.jsx(ye,{intensity:8,className:"oui-w-full"}),n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h,{children:s("common.lastPrice")}),n.jsx(h.numeral,{dp:(y=(m=e.item)==null?void 0:m.symbolInfo)==null?void 0:y.duote_dp,children:e.curMarkPrice??"--"})]}),n.jsxs(g,{width:"100%",direction:"column",itemAlign:"stretch",gap:2,children:[e.isAlgoOrder&&n.jsx(fe.tooltip,{prefix:n.jsx(h,{intensity:54,className:"oui-px-3",children:s("orders.column.triggerPrice")}),suffix:n.jsx(h,{intensity:54,className:"oui-px-3",children:e.quote}),color:l?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(e.quote_dp)],value:e.triggerPrice,onValueChange:j=>e.setTriggerPrice(j),tooltip:l,tooltipProps:{content:{className:"oui-bg-base-6 oui-text-base-contrast-80"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast oui-w-full",root:E("oui-outline-line-12",l&&"oui-outline-danger")}}),n.jsx(fe.tooltip,{prefix:n.jsx(h,{intensity:54,className:"oui-px-3",children:s("common.price")}),suffix:n.jsx(h,{intensity:54,className:"oui-px-3",children:e.quote}),color:a?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(e.quote_dp)],disabled:!e.priceEdit,value:e.isStopMarket?s("orderEntry.orderType.market"):e.price,onValueChange:j=>e.setPrice(j),tooltip:a,tooltipProps:{content:{className:"oui-bg-base-5"},arrow:{className:"oui-fill-base-5"}},classNames:{input:"oui-text-base-contrast",root:E("oui-outline-line-12",a&&"oui-outline-danger")}}),n.jsx(fe.tooltip,{prefix:n.jsx(h,{intensity:54,className:"oui-px-3",children:s("common.quantity")}),suffix:n.jsx(h,{intensity:54,className:"oui-px-3",children:e.base}),color:o?"danger":void 0,align:"right",fullWidth:!0,autoComplete:"off",formatters:[J.numberFormatter,J.dpFormatter(e.base_dp)],value:e.quantity,onValueChange:j=>{e.setQuantity(j)},onBlur:j=>d(j.target.value),tooltip:o,tooltipProps:{content:{className:"oui-bg-base-6"},arrow:{className:"oui-fill-base-6"}},classNames:{input:"oui-text-base-contrast",root:E("oui-outline-line-12",o&&"oui-outline-danger")}}),n.jsx(wt,{markCount:4,value:[e.sliderValue??0],onValueChange:j=>{e.setSliderValue(j[0])},color:"primary"}),n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(h.numeral,{color:"primary",size:"2xs",dp:2,padding:!1,rule:"percentages",children:`${u??0}`}),n.jsxs(g,{gap:1,onClick:()=>{e.setQuantity(e.maxQty.toString())},children:[n.jsx(h,{size:"2xs",color:"primary",children:s("common.max")}),n.jsx(h.numeral,{intensity:54,size:"2xs",dp:e.base_dp,children:e.maxQty})]})]})]}),n.jsxs(g,{width:"100%",gap:3,mt:2,children:[n.jsx(te,{fullWidth:!0,color:"secondary",onClick:j=>{e.onClose()},children:s("common.cancel")}),n.jsx(Nt,{fullWidth:!0,onClick:j=>{j.stopPropagation(),j.preventDefault(),e.onSheetConfirm()},loading:e.submitting,disabled:!e.isChanged,children:s("common.confirm")})]})]}),n.jsx(vt,{open:e.dialogOpen,onOpenChange:e.setDialogOpen,title:s("orders.editOrder"),size:"xs",actions:{primary:{label:s("common.confirm"),onClick:e.onDialogConfirm,loading:e.submitting,fullWidth:!0},secondary:{label:s("common.cancel"),onClick:e.onCloseDialog,fullWidth:!0}},classNames:{content:"oui-pb-4",body:"oui-p-0",footer:"oui-pt-3 oui-pb-0"},children:n.jsx(dh,{...e})})]})},ph=e=>{let{state:t,editAlgoOrder:i,editOrder:s,autoCheckInput:r=!0,position:o}=e,{item:a}=t,{hide:l}=pn(),[u,d]=p.useState(!1),c=(a==null?void 0:a.algo_order_id)!==void 0&&a.algo_type!==Z.BRACKET,m=(a==null?void 0:a.type)==="MARKET"&&c;m||(a==null||a.type);let[y,j]=p.useState(!1),f=p.useMemo(()=>c&&a.algo_type!==Z.BRACKET?`STOP_${a.type}`:a.type,[a,c]),[b,x]=De("orderly_order_confirm",!0),{base_dp:C,base_tick:w}=e.state,{formattedOrder:v,setValue:N,markPrice:I,errors:O,validate:A,maxQty:k}=mh({order:a,orderType:f,position:o}),_=()=>{A().then(B=>{b?d(!0):F(v)},B=>{var $;($=B==null?void 0:B.total)!=null&&$.message&&U.error(B==null?void 0:B.total.message)}).catch(B=>{})},D=p.useCallback(()=>{d(!1)},[]),M=()=>v?F(v):Promise.reject(),L=p.useCallback(()=>{l()},[]),F=p.useCallback(async B=>{let $,Y=a.visible_quantity!==void 0?a.visible_quantity===0:a.visible!==void 0?a.visible===0:!1;if(a.algo_order_id!==void 0){if(m&&"order_price"in B){let{order_price:V,...le}=B;B=le}$=i(a.algo_order_id.toString(),{...B})}else $=s(a.order_id.toString(),{...B,...Y?{visible_quantity:0}:{}});try{j(!0);let V=await $;L()}catch(V){U.error((V==null?void 0:V.message)??`${V}`)}finally{j(!1)}},[i,s]),z=p.useMemo(()=>{let B=v.order_quantity;return B&&Number(B)!==0&&k!==0?new T(B).div(k).mul(100).toDecimalPlaces(2,T.ROUND_DOWN).toNumber():0},[v.order_quantity,k]),R=a.price!=v.order_price||a.quantity!=v.order_quantity||a.trigger_price!=v.trigger_price,H=Sa(B=>{let $=new T(B).div(100).mul(k).toDecimalPlaces(C,T.ROUND_DOWN).toNumber();N("order_quantity",ue.formatNumber($,w))},50,{}),ne=(B,$)=>{N(B,$)};return{...t,curMarkPrice:I,isAlgoOrder:c,isStopMarket:m,price:v.order_price,setPrice:B=>ne("order_price",B),priceEdit:!m,triggerPrice:v.trigger_price,setTriggerPrice:B=>ne("trigger_price",B),quantity:v.order_quantity,setQuantity:B=>{ne("order_quantity",B)},maxQty:k,sliderValue:z,setSliderValue:H,onClose:L,onSheetConfirm:_,errors:O,orderType:f,isChanged:R,baseTick:w,dialogOpen:u,setDialogOpen:d,onDialogConfirm:M,onCloseDialog:D,submitting:y,orderConfirm:b,setOrderConfirm:x}},mh=e=>{let{order:t,orderType:i,position:s}=e,[r,o]=p.useState({side:t.side,order_type:i,order_price:t.price,order_quantity:t.quantity,trigger_price:t.trigger_price,reduce_only:t.reduce_only,symbol:t.symbol}),{reduce_only:a}=t,l=s==null?void 0:s.position_qty,u=Vs(t.symbol,t.side,t.reduce_only),d=p.useMemo(()=>a?Math.abs(l??0):t.quantity+Math.abs(u),[t.quantity,u,a,l]),{symbolInfo:c,markPrice:m,errors:y,validate:j}=Ta({...r,symbol:t.symbol},{maxQty:d});return{symbolInfo:c,markPrice:m,errors:y,validate:j,setValue:(f,b)=>{o(x=>({...x,[f]:b}))},formattedOrder:r,maxQty:d}},hh=e=>{let t=ph(e);return n.jsx(ch,{...t})},fh=e=>{let{state:t}=e,{t:i}=S(),{editAlgoOrder:s,editOrder:r}=Dt(),{order:o,position:a}=ut(),l=p.useCallback(()=>{e.state.type==="tp_sl"?he.sheet({title:i("common.tpsl"),content:n.jsx(eo,{isEditing:!0,order:e.state.item,position:a,symbolInfo:e.state.origin})}).catch(u=>{}):he.sheet({title:i("orders.editOrder"),classNames:{content:"oui-bg-base-8"},content:n.jsx(hh,{position:a,state:t,editAlgoOrder:s,editOrder:r})}).catch(u=>{})},[t]);return{...t,onShowEditSheet:l}},xh=e=>{let t=fh(e);return n.jsx(uh,{...t})},gh=e=>n.jsxs(g,{direction:"column",width:"100%",gap:2,itemAlign:"start",className:e.className,children:[n.jsx(yh,{...e}),n.jsx(ye,{intensity:6,className:"oui-w-full"}),n.jsx(bh,{...e}),e.type==="pending"&&n.jsx(rh,{...e}),e.type!=="orderHistory"&&n.jsx(jh,{...e})]}),yh=e=>n.jsxs(g,{direction:"column",gap:1,width:"100%",children:[n.jsxs(g,{justify:"between",width:"100%",children:[n.jsx(zm,{...e}),n.jsx(Bm,{...e})]}),n.jsxs(g,{width:"100%",justify:"between",children:[n.jsx(Um,{...e}),e.type==="orderHistory"&&n.jsx(Wm,{...e})]})]}),bh=e=>n.jsx(Oe,{cols:3,rows:2,width:"100%",gap:1,children:wh(e)}),jh=e=>n.jsxs(Oe,{cols:3,rows:1,width:"100%",gap:2,children:[n.jsx("div",{}),n.jsx(xh,{state:e}),n.jsx(lh,{state:e})]});function wh(e){switch(e.type){case"all":return n.jsx(n.Fragment,{});case"pending":return n.jsxs(n.Fragment,{children:[n.jsx(xs,{...e}),n.jsx(gs,{...e}),n.jsx(Vm,{...e}),n.jsx(ys,{...e}),n.jsx(Qm,{...e}),n.jsx(Hm,{...e})]});case"tp_sl":return n.jsxs(n.Fragment,{children:[n.jsx(Km,{...e}),n.jsx(Xm,{...e}),n.jsx(Ym,{...e}),n.jsx(Gm,{...e}),n.jsx(Jm,{...e})]});case"filled":return n.jsx(n.Fragment,{});case"cancelled":return n.jsx(n.Fragment,{});case"rejected":return n.jsx(n.Fragment,{});case"orderHistory":return n.jsxs(n.Fragment,{children:[n.jsx(xs,{...e}),n.jsx(gs,{...e}),n.jsx(ys,{...e,align:"end"}),n.jsx(Zm,{...e}),n.jsx(eh,{...e}),n.jsx(th,{...e}),n.jsx("div",{}),n.jsx("div",{}),n.jsx(nh,{...e})]})}}var _h=e=>{let t=Ge();return{...e,...t}},vh=e=>{let{className:t,...i}=e,s=_h(i);return n.jsx(gh,{...s,className:t})},Ch=e=>{var r;let{sharePnLConfig:t,...i}=e,s=Im({_type:e.type,onSymbolChange:e.onSymbolChange,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:t,symbolsInfo:e.symbolsInfo});return n.jsx(go,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:n.jsxs(g,{direction:"column",width:"100%",height:"100%",itemAlign:"start",children:[e.filterItems.length>0&&n.jsx(Vt,{items:e.filterItems,onFilter:o=>{e.onFilter(o)},trailing:["pending","tp_sl"].includes(e.type)&&n.jsx(Sh,{...e})}),n.jsx(Qt,{columns:s,loading:e.isLoading,dataSource:e.dataSource,bordered:!0,ignoreLoadingCheck:!0,testIds:{body:(r=e.testIds)==null?void 0:r.tableBody},classNames:{header:"oui-h-[38px]",root:"oui-items-start !oui-h-[calc(100%_-_49px)]"},onRow:(o,a)=>({className:E("oui-h-[48px]",Ot(o)?"oui-text-base-contrast-20":"oui-text-base-contrast-80")}),generatedRowKey:(o,a)=>`${e.type}${a}${o.order_id||o.algo_order_id}_index${a}`,renderRowContainer:(o,a,l)=>((e.type==="tp_sl"||e.type==="pending")&&(l=n.jsx(bo,{order:o,children:l})),n.jsx(fo,{symbol:o.symbol,children:l})),pagination:e.pagination,manualPagination:e.manualPagination,features:[ba.DownloadFeature],getTableInstance:o=>{e.tableInstance.current=o}})]})})},Nh=e=>{var i,s;let{t}=S();return n.jsx(go,{cancelOrder:e.cancelOrder,editOrder:e.updateOrder,cancelAlgoOrder:e.cancelAlgoOrder,editAlgoOrder:e.updateAlgoOrder,children:n.jsxs(Oe,{cols:1,rows:2,className:"oui-w-full oui-grid-rows-[auto,1fr]",gap:2,children:[e.showFilter?n.jsx(g,{gap:2,p:2,className:"oui-rounded-b-xl oui-bg-base-9",children:e.filterItems.map(r=>r.type!=="select"?null:n.jsx(ja,{options:r.options,size:"sm",value:r.value,className:"oui-text-2xs oui-text-base-contrast-54 ",placeholder:r.name==="side"?t("common.side.all"):r.name==="status"?t("common.status.all"):"",onValueChange:o=>{var a;(a=e.onFilter)==null||a.call(e,{name:r.name,value:o})}},`item-${r.name}`))}):n.jsx("div",{}),n.jsx(Ht,{className:(i=e.classNames)==null?void 0:i.root,contentClassName:(s=e.classNames)==null?void 0:s.content,dataSource:e.dataSource,loadMore:e.loadMore,isLoading:e.isLoading,renderItem:(r,o)=>{var l;let a=n.jsx(vh,{item:r,index:o,className:(l=e.classNames)==null?void 0:l.cell,type:e.type,onSymbolChange:e.onSymbolChange,sharePnLConfig:e.sharePnLConfig});return["tp_sl","pending"].includes(e.type)&&(a=n.jsx(bo,{order:r,children:a})),n.jsx(fo,{symbol:r.symbol,children:a})}})]})})},Sh=e=>{var i;let{t}=S();return n.jsx(te,{variant:"outlined",color:"secondary",size:"xs",disabled:(((i=e.dataSource)==null?void 0:i.length)??0)==0,className:"disabled:oui-bg-transport",onClick:s=>e.onCancelAll(),"data-testid":`oui-testid-dataList-${e.type.toLowerCase()}-cancelAll-button`,children:t("orders.cancelAll")})},Th=e=>p.useMemo(()=>{let t=[];for(let i=0;i<e.length;i++){let s=e[i];if(s.algo_type===Z.POSITIONAL_TP_SL||s.algo_type===Z.TP_SL)if(s.algo_status!==X.FILLED&&s.algo_status!==X.PARTIAL_FILLED)for(let r=0;r<s.child_orders.length;r++){let o=s.child_orders[r];!o.is_activated||!o.trigger_price||(o.parent_algo_type=s.algo_type,t.push(o))}else for(let r=0;r<s.child_orders.length;r++){let o=s.child_orders[r];o&&(o.algo_status===X.FILLED||o.algo_status===X.PARTIAL_FILLED)&&(o.parent_algo_type=s.algo_type,t.push(o))}else t.push(s)}return t},[e]),wo=e=>{let{ordersStatus:t,type:i,enableLoadMore:s=!1,onSymbolChange:r,filterConfig:o,pnlNotionalDecimalPrecision:a,sharePnLConfig:l}=e,{t:u}=S(),d=Ee(),c=p.useMemo(()=>t!==X.INCOMPLETE,[t]),m=50,{page:y,pageSize:j,setPage:f,pagination:b,parsePagination:x}=Wt({pageSize:m});p.useEffect(()=>{f(1)},[e.symbol]);let{orderStatus:C,ordersSide:w,dateRange:v,filterItems:N,onFilter:I,filterDays:O,updateFilterDays:A}=Ph(i,{ordersStatus:t,setPage:f,filterConfig:o}),k=p.useMemo(()=>{if(i==="tp_sl")return[Z.POSITIONAL_TP_SL,Z.TP_SL]},[i]),_=p.useMemo(()=>{if(i==="pending")return[Z.POSITIONAL_TP_SL,Z.TP_SL]},[i]),D=p.useRef();p.useImperativeHandle(e.ref,()=>({download:()=>{var de;let ae=`orders_${Ws(new Date,"yyyyMMdd_HHmmss")}`;(de=D.current)==null||de.download(ae)}}));let[M,{isLoading:L,loadMore:F,cancelOrder:z,updateOrder:R,cancelAlgoOrder:H,updateAlgoOrder:ne,cancelAllOrders:B,cancelAllTPSLOrders:$,meta:Y,refresh:V}]=ya({symbol:e.symbol,status:C,side:w,page:s||!c?void 0:y,size:c?j:500,sourceTypeAll:i==="orderHistory",dateRange:v,includes:k,excludes:_}),le=`orderly_${i}_pageSize`,[xe,Se]=De(le,m);p.useEffect(()=>{xe!==j&&Se(j)},[j,xe]);let Ae=p.useCallback(()=>{let ae=e.type==="pending"?u("orders.pending.cancelAll"):e.type==="tp_sl"?u("orders.tpsl.cancelAll"):"",de=u("orders.pending.cancelAll.description");he.confirm({title:ae,content:n.jsx(h,{size:"sm",children:de}),onCancel:async()=>{},onOk:async()=>{try{return i==="tp_sl"?await $():await B(),V(),Promise.resolve(!0)}catch(Ie){return(Ie==null?void 0:Ie.message)!==void 0&&toast.error(Ie.message),Promise.resolve(!1)}finally{Promise.resolve()}}})},[i,u]),Te=Th(M??[]),qe=Kt(i!=="tp_sl"?Te:M,{fallbackData:[]})??void 0,Be=p.useMemo(()=>c?x(Y):b,[Y,c,x,b]);return{type:i,dataSource:qe,isLoading:L,loadMore:F,cancelOrder:z,updateOrder:R,cancelAlgoOrder:H,updateAlgoOrder:ne,pagination:Be,manualPagination:c,pnlNotionalDecimalPrecision:a,onFilter:I,filterItems:N,onCancelAll:Ae,onSymbolChange:r,sharePnLConfig:l,tableInstance:D,symbolsInfo:d,filterDays:O,updateFilterDays:A}},Ph=(e,t)=>{var f,b;let{t:i}=S(),[s,r]=p.useState(t.ordersStatus??"all"),[o,a]=p.useState(((f=t.filterConfig)==null?void 0:f.side)??"all"),[l,u]=p.useState(90),d=((b=t.filterConfig)==null?void 0:b.range)??(e==="all"||e==="orderHistory"?Kn({to:new Date,from:et(ge(new Date,89))}):{}),[c,m]=p.useState(d),y=x=>{u(x),m({from:gt(ge(new Date,x-1)),to:et(new Date)}),t.setPage(1)},j=x=>{if(x.name==="side"&&(a(x.value),t.setPage(1)),x.name==="status"&&(r(x.value),t.setPage(1)),x.name==="dateRange"){m(Kn(x.value)),t.setPage(1);let C=Kn(x.value);if(C.from&&C.to){let w=Math.abs(ji(C.from,C.to))+1,v={1:{from:gt(new Date),to:et(new Date)},7:{from:gt(ge(new Date,6)),to:et(new Date)},30:{from:gt(ge(new Date,29)),to:et(new Date)},90:{from:gt(ge(new Date,89)),to:et(new Date)}}[w];v&&cs(v.from,C.from)&&cs(v.to,C.to)?u(w):u(null)}}};return{filterItems:p.useMemo(()=>{let x={type:"select",name:"side",options:[{label:i("common.side.all"),value:"all"},{label:i("common.buy"),value:"BUY"},{label:i("common.sell"),value:"SELL"}],value:o},C={type:"range",name:"dateRange",value:c},w={type:"select",name:"status",options:[{label:i("common.status.all"),value:"all"},{label:i("orders.status.pending"),value:X.INCOMPLETE},{label:i("orders.status.filled"),value:X.FILLED},{label:i("orders.status.partialFilled"),value:X.PARTIAL_FILLED},{label:i("orders.status.canceled"),value:X.CANCELLED},{label:i("orders.status.rejected"),value:X.REJECTED}],value:s};switch(e){case"all":return[x,w,C];case"pending":return[x];case"tp_sl":return[x];case"filled":return[x];case"cancelled":return[x];case"rejected":return[x];case"orderHistory":return[x,w,C]}},[e,o,s,c,i]),onFilter:j,ordersSide:o==="all"?void 0:o,dateRange:c,orderStatus:s==="all"?void 0:s,filterDays:l,updateFilterDays:y}};function gt(e){if(e==null)return e;let t=new Date(e);return t.setHours(0,0,0,0),t}function et(e){if(e==null)return e;let t=new Date(e);return t.setHours(23,59,59,999),t}var Kn=e=>({from:gt(e.from),to:et(e.to??e.from)}),xt=p.forwardRef((e,t)=>{let{testIds:i,...s}=e,r=wo({...s,ref:t});return n.jsx(Ch,{...r,testIds:i})}),cf=e=>{let t=wo({...e,enableLoadMore:!0});return n.jsx(Nh,{...t,classNames:e.classNames,showFilter:e.showFilter})},kh=e=>{let{t}=S(),i={pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision};return n.jsxs(li,{defaultValue:e.current||"all",variant:"contained",className:"oui-h-full",classNames:{tabsContent:"oui-h-[calc(100%_-_28px)]"},children:[n.jsx(Ue,{value:"all",title:t("common.all"),children:n.jsx(xt,{ref:e.orderListRef,type:"all",pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...i})}),n.jsx(Ue,{value:"pending",title:t("orders.status.pending"),children:n.jsx(xt,{ref:e.orderListRef,type:"pending",ordersStatus:X.INCOMPLETE,...i})}),n.jsx(Ue,{value:"tp_sl",title:t("common.tpsl"),children:n.jsx(xt,{ref:e.orderListRef,type:"tp_sl",ordersStatus:X.INCOMPLETE,...i})}),n.jsx(Ue,{value:"filled",title:t("orders.status.filled"),children:n.jsx(xt,{ref:e.orderListRef,type:"filled",ordersStatus:X.FILLED,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,...i})}),n.jsx(Ue,{value:"cancelled",title:t("orders.status.canceled"),children:n.jsx(xt,{ref:e.orderListRef,type:"cancelled",ordersStatus:X.CANCELLED,...i})}),n.jsx(Ue,{value:"rejected",title:t("orders.status.rejected"),children:n.jsx(xt,{ref:e.orderListRef,type:"rejected",ordersStatus:X.REJECTED,...i})})]})},Oh=(e=>(e.all="all",e.pending="pending",e.tp_sl="tp_sl",e.filled="filled",e.cancelled="cancelled",e.rejected="rejected",e.orderHistory="orderHistory",e))(Oh||{}),pf=p.forwardRef((e,t)=>{let i=mm({...e,ref:t});return n.jsx(kh,{...i})});export{Ed as F,uf as H,Ld as I,of as M,pf as Q,rf as R,Oh as S,xt as T,cf as W,Fd as a,Aa as b,Md as d,af as f,qa as i,sf as q,nf as u,lf as y,df as z};
