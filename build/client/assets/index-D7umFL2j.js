import{I as Kt,v as A,d5 as S,d6 as B,d7 as qr,a6 as ue,a4 as U,by as _t,br as ut,d8 as Fr,d9 as J,da as Yt,ca as Ai,bz as Zt,a as _,l as Qe,L as g,M as b,K,a3 as Rt,G as W,db as Ur,q as p,O as Ce,dc as Wr,dd as Qr,t as ie,ck as Nt,W as E,de as F,df as qe,dg as jt,e as L,F as Xt,at as Y,b2 as xe,dh as Kr,di as at,au as Z,dj as Dt,bh as Yr,dk as Zr,bj as Xr,dl as Gr,dm as Jr,bS as es,bf as ts,cl as ci,c7 as At,H as St,o as re,ba as be,d as is,dn as rs,ar as zi,bP as $i,c9 as ss,dp as Vi,dq as Ot,dr as os,ds as Gt,cA as Jt,V as Ct,N as as,k as ns,cS as ls,R as kt,s as Ke,dt as Bi,du as Hi,Q as Fe,cC as ei,bk as ds,bx as ct,dv as Oe,d4 as ae,C as Ye,D as Ze,E as ht,P as Xe,a7 as Ue,dw as us,dx as hi,dy as cs,cH as hs,bw as dt,bU as ms,bR as mi,bX as pi,bC as ti,bD as ii,bq as ps,x as mt,b as ee,T as gs,bO as qi,dz as xs,cq as nt,aI as We,dA as bs,dB as Fi,d2 as gt,bE as fs,r as ys,dC as vs,cj as js,a5 as Ui,aq as Wi,dD as Qi,a9 as Ki,dE as Cs,ai as Yi,a8 as ws,$ as Zi,dF as Xi,bA as _s,w as Ns,dG as Gi,dH as Ss,dI as ks,dJ as Ts,d3 as gi,cB as Ps,bG as Os,be as Ls,bu as Ms,z as Es,ap as Is,a_ as Rs,dK as Ds,_ as As,S as xi,a1 as zs,c0 as Ji}from"./index-B1yGdhtz.js";import{i as $s,u as Vs,F as bi,a as Bs,S as ne,z as Hs,T as xt,f as qs,H as Fs,b as Us,I as Ws,d as Qs,R as Ks,W as Ys,y as Zs,q as Xs}from"./index-BgbMmrC1.js";import{j as t}from"./jsx-runtime-DF5SV9au.js";import{D as pt,M as er,_ as de}from"./index-BHYcTakE.js";import{r as u,W as ge}from"./index-TjLUG_Bo.js";import{A as Tt,T as zt}from"./index-7JkPJWjm.js";import"./index-DCRsf1dF.js";import{_ as Gs,C as Js,Z as eo,$ as to}from"./index-C4zuLi6K.js";function io(e){const i=Kt(e);return i.setSeconds(0,0),i}function ro(e){const i=Kt(e);return i.setMinutes(0,0,0),i}function so(e){const i=Kt(e);return i.setMilliseconds(0),i}function Ie(){return Ie=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ie.apply(null,arguments)}function oo(e,i){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(i.indexOf(s)!==-1)continue;r[s]=e[s]}return r}var ao=e=>e>=0&&e<50?"oui-text-success":e>=50&&e<80?"oui-text-warning":e>=80?"oui-text-danger":"",no=e=>{let{t:i}=_(),{ltv_threshold:r,negative_usdc_threshold:s,isThresholdLoading:o,holdingData:a=[],currentLtv:n,onConvert:l}=e;return t.jsxs(g,{gap:1,className:"oui-w-72 oui-max-w-72",direction:"column",children:[t.jsxs(g,{width:"100%",justify:"between",itemAlign:"center",children:[t.jsx(p,{intensity:36,size:"xs",children:i("common.assets")}),t.jsx(p,{intensity:36,size:"xs",children:i("transfer.deposit.collateralContribution")})]}),a.map((d,c)=>t.jsxs(g,{width:"100%",justify:"between",itemAlign:"center",children:[t.jsx(p,{intensity:80,size:"xs",children:d.token}),t.jsx(p,{size:"xs",intensity:80,className:b(Number(d.collateralContribution)<0&&"oui-text-warning"),children:jt(d.collateralContribution)})]},`item-${c}`)),t.jsx(ie,{className:"oui-w-full"}),t.jsxs(g,{width:"100%",justify:"between",itemAlign:"center",children:[t.jsx(p,{intensity:36,size:"xs",children:i("transfer.LTV.currentLTV")}),t.jsxs(p,{size:"xs",intensity:36,className:b("oui-select-none",ao(n)),children:[n,"%"]})]}),t.jsx(p,{className:"oui-py-2",intensity:54,size:"2xs",children:i("transfer.LTV.tooltip",{threshold:o?"-":r,usdcThreshold:o?"-":s})}),t.jsx(K,{fullWidth:!0,size:"md",variant:"outlined",color:"secondary",onClick:l,children:i("transfer.convert.convertAssets")})]})},lo=()=>{let{data:e,error:i,isLoading:r}=is("/v1/public/auto_convert_threshold",{errorRetryCount:3});return{ltv_threshold:new L((e==null?void 0:e.ltv_threshold)??0).mul(100).toNumber(),negative_usdc_threshold:e==null?void 0:e.negative_usdc_threshold,isLoading:r,error:i}},uo=()=>{let{data:e=[],isLoading:i}=Jr(),{ltv_threshold:r,negative_usdc_threshold:s,isLoading:o}=lo(),a=es(),{data:n}=ts(),l=e.map(m=>{let h=a==null?void 0:a.find(({token:C})=>C===m.token),x=m.token==="USDC"?1:(n==null?void 0:n[`PERP_${m.token}_USDC`])??0,y=h?ci.collateralRatio({baseWeight:h.base_weight??0,discountFactor:h.discount_factor??0,collateralQty:m.holding,collateralCap:(h==null?void 0:h.user_max_qty)??m.holding,indexPrice:x}):At,f=ci.collateralContribution({collateralQty:m.holding,collateralCap:(h==null?void 0:h.user_max_qty)??m.holding,collateralRatio:y.toNumber(),indexPrice:x});return{...m,collateralContribution:f}}),d=Yt(),c=u.useCallback(async()=>W.show("ConvertDialogId"),[]);return{holdingData:l,isHoldingLoading:i,ltv_threshold:r,negative_usdc_threshold:s,isThresholdLoading:o,currentLtv:d,onConvert:c}},tr=()=>{let e=uo();return t.jsx(no,{...e})},co=e=>{let{pinned:i,orderTypeExtra:r}=e,{t:s}=_(),o=a=>n=>{e.onValueChange&&e.onValueChange("order_type_ext",n?a:"")};return u.useEffect(()=>{var a;(a=e.onValueChange)==null||a.call(e,"visible_quantity",e.hidden?0:1)},[e.hidden]),t.jsxs("div",{className:"oui-text-base-contrast-54",children:[t.jsxs(g,{justify:i?"start":"between",mb:3,width:i?"unset":"100%",className:"oui-gap-x-2 md:oui-gap-x-3",wrap:"wrap",gapY:1,children:[t.jsxs(g,{itemAlign:"center",children:[t.jsx(be,{"data-testid":"oui-testid-orderEntry-postOnly-checkBox",id:"toggle_order_post_only",className:"oui-peer",color:"white",variant:"radio",disabled:!e.showExtra,checked:r===S.POST_ONLY,onCheckedChange:o(S.POST_ONLY)}),t.jsx("label",{htmlFor:"toggle_order_post_only",className:b("oui-text-2xs oui-ml-1 peer-data-[disabled]:oui-text-base-contrast-20","oui-break-normal oui-whitespace-nowrap"),children:s("orderEntry.orderType.postOnly")})]}),t.jsxs(g,{itemAlign:"center",children:[t.jsx(be,{"data-testid":"oui-testid-orderEntry-ioc-checkBox",id:"toggle_order_iov",color:"white",className:"oui-peer",variant:"radio",checked:r===S.IOC,onCheckedChange:o(S.IOC),disabled:!e.showExtra}),t.jsx("label",{htmlFor:"toggle_order_iov",className:b("oui-text-2xs oui-ml-1 peer-data-[disabled]:oui-text-base-contrast-20","oui-break-normal oui-whitespace-nowrap"),children:s("orderEntry.orderType.ioc")})]}),t.jsxs(g,{itemAlign:"center",children:[t.jsx(be,{"data-testid":"oui-testid-orderEntry-fox-checkBox",id:"toggle_order_fok",color:"white",variant:"radio",className:"oui-peer",checked:r===S.FOK,onCheckedChange:o(S.FOK),disabled:!e.showExtra}),t.jsx("label",{htmlFor:"toggle_order_fok",className:b("oui-text-2xs oui-ml-1 peer-data-[disabled]:oui-text-base-contrast-20","oui-break-normal oui-whitespace-nowrap"),children:s("orderEntry.orderType.fok")})]})]}),t.jsxs(g,{gapX:6,children:[t.jsxs(g,{children:[t.jsx(be,{"data-testid":"oui-testid-orderEntry-orderConfirm-checkBox",id:"toggle_order_confirm",color:"white",checked:e.needConfirm,onCheckedChange:a=>{e.setNeedConfirm(!!a)}}),t.jsx("label",{htmlFor:"toggle_order_confirm",className:"oui-text-2xs oui-ml-1",children:s("orderEntry.orderConfirm")})]}),t.jsxs(g,{children:[t.jsx(be,{"data-testid":"oui-testid-orderEntry-hidden-checkBox",id:"toggle_order_hidden",color:"white",checked:e.hidden,onCheckedChange:a=>{e.setHidden(a)}}),t.jsx("label",{htmlFor:"toggle_order_hidden",className:"oui-text-2xs oui-ml-1",children:s("orderEntry.hidden")})]})]}),!i&&t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"oui-my-3"}),t.jsxs(g,{children:[t.jsx(Nt,{"data-testid":"oui-testid-orderEntry-additional-keepVisible-switch",id:"toggle_order_keep_visible",onCheckedChange:a=>{e.setPinned(a)}}),t.jsx("label",{htmlFor:"toggle_order_keep_visible",className:"oui-text-2xs oui-ml-1",children:s("orderEntry.keepVisible")})]})]})]})},ho=()=>({}),ir=e=>{let i=ho();return t.jsx(co,{...i,...e})};function $t(e){let{order_type:i,order_type_ext:r}=e,s=[S.ASK,S.BID].includes(r);return i?i===S.LIMIT&&s:s}function mo(e,i){if([F.COUNTERPARTY1,F.COUNTERPARTY5].includes(e))return i===B.BUY?S.ASK:S.BID;if([F.QUEUE1,F.QUEUE5].includes(e))return i===B.BUY?S.BID:S.ASK}function po(e){if([F.COUNTERPARTY1,F.QUEUE1].includes(e))return qe.ONE;if([F.COUNTERPARTY5,F.QUEUE5].includes(e))return qe.FIVE}function go(e){let{type:i,side:r,level:s}=e;if(i===S.ASK){if(s===qe.ONE)return r===B.BUY?F.COUNTERPARTY1:F.QUEUE1;if(s===qe.FIVE)return r===B.BUY?F.COUNTERPARTY5:F.QUEUE5}if(i===S.BID){if(s===qe.ONE)return r===B.BUY?F.QUEUE1:F.COUNTERPARTY1;if(s===qe.FIVE)return r===B.BUY?F.QUEUE5:F.COUNTERPARTY5}}function xo(e){var r;let i=((r=e==null?void 0:e.data)==null?void 0:r.rows)||[];if(i.length>0){let s=i.length,o=i.filter(a=>a.success).length;return o===s?re.t("orderEntry.scaledOrder.fullySuccessful",{total:s}):o===0?re.t("orderEntry.scaledOrder.allFailed"):re.t("orderEntry.scaledOrder.partiallySuccessful",{successCount:o,total:s})}}var rr=e=>{let{symbolInfo:i,order:r,onConfirm:s,onCancel:o}=e,{quote_dp:a,base_dp:n}=i,{side:l,order_type:d,order_type_ext:c,level:m}=r,{t:h}=_(),[x,y]=A("orderly_order_confirm",!0),f=()=>{if(d===S.MARKET||d===S.STOP_MARKET)return t.jsx(p,{intensity:80,children:h("common.marketPrice")});if($t({order_type:d,order_type_ext:c})){let C=go({type:c,side:l,level:m}),j={[F.COUNTERPARTY1]:h("orderEntry.bbo.counterparty1"),[F.COUNTERPARTY5]:h("orderEntry.bbo.counterparty5"),[F.QUEUE1]:h("orderEntry.bbo.queue1"),[F.QUEUE5]:h("orderEntry.bbo.queue5")}[C];return t.jsx(p,{intensity:80,children:j})}return t.jsx(p.numeral,{unit:"USDC",rule:"price",className:"oui-text-base-contrast",unitClassName:"oui-text-base-contrast-36 oui-ml-1",dp:a,padding:!1,children:r.order_price})};return t.jsxs(t.Fragment,{children:[t.jsxs(g,{justify:"between",children:[t.jsx(p.formatted,{rule:"symbol",showIcon:!0,children:r.symbol}),t.jsxs(g,{justify:"end",gapX:1,children:[t.jsx(bo,{type:d}),l===B.BUY?t.jsx(Ct,{color:"buy",size:"sm",children:h("common.buy")}):t.jsx(Ct,{color:"sell",size:"sm",children:h("common.sell")})]})]}),t.jsx(ie,{className:"oui-my-4"}),t.jsxs("div",{className:at({size:"sm",intensity:54,className:"oui-space-y-1"}),children:[t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("common.qty")}),t.jsx(p.numeral,{rule:"price",dp:n,padding:!1,className:"oui-text-base-contrast",children:r.order_quantity})]}),r.trigger_price?t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("common.trigger")}),t.jsx(p.numeral,{unit:"USDC",rule:"price",className:"oui-text-base-contrast",unitClassName:"oui-text-base-contrast-36 oui-ml-1",dp:a,padding:!1,children:r.trigger_price})]}):null,t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("common.price")}),f()]}),t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("common.notional")}),t.jsx(p.numeral,{unit:"USDC",rule:"price",dp:a,padding:!1,className:"oui-text-base-contrast",unitClassName:"oui-text-base-contrast-36 oui-ml-1",children:r.total})]})]}),r.tp_trigger_price||r.sl_trigger_price?t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"oui-my-4"}),t.jsxs("div",{className:at({size:"sm",intensity:54,className:"oui-space-y-1"}),children:[r.tp_trigger_price&&t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("orderEntry.tpMarkPrice")}),t.jsx(p.numeral,{unit:"USDC",rule:"price",coloring:!0,dp:a,padding:!1,unitClassName:"oui-text-base-contrast-36 oui-ml-1",children:r.tp_trigger_price})]}),r.sl_trigger_price&&t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("orderEntry.slMarkPrice")}),t.jsx(p.numeral,{unit:"USDC",rule:"price",coloring:!0,className:"oui-text-trade-loss",unitClassName:"oui-text-base-contrast-36 oui-ml-1",dp:a,padding:!1,children:r.sl_trigger_price})]})]})]}):null,t.jsxs(g,{gapX:1,pt:4,pb:5,children:[t.jsx(be,{id:"orderConfirm",color:"white",onCheckedChange:C=>{y(!C)}}),t.jsx("label",{htmlFor:"orderConfirm",className:at({size:"xs",intensity:54}),children:h("orderEntry.disableOrderConfirm")})]}),r.tp_trigger_price||r.sl_trigger_price?t.jsx(E,{py:3,px:3,className:"oui-text-center",children:t.jsx(p,{color:"warning",size:"xs",children:h("orderEntry.tpsl.trigger.description")})}):null,t.jsxs(xe,{cols:2,gapX:3,children:[t.jsx(K,{color:"secondary",size:"md",onClick:()=>o(),children:h("common.cancel")}),t.jsx(K,{size:"md",onClick:()=>s(),children:h("common.confirm")})]})]})};rr.displayName="OrderConfirmDialog";var bo=e=>{let{t:i}=_(),r=u.useMemo(()=>{switch(e.type){case S.LIMIT:return i("orderEntry.orderType.limit");case S.MARKET:return i("common.marketPrice");case S.STOP_LIMIT:return i("orderEntry.orderType.stopLimit");case S.STOP_MARKET:return i("orderEntry.orderType.stopMarket");default:return""}},[e.type]);return t.jsx(Ct,{color:"neutral",size:"sm",children:r})},fo=e=>{let{close:i,resolve:r,reject:s,...o}=e;return t.jsx(rr,{...o,onCancel:()=>{s(),i()},onConfirm:()=>{r(),i()}})},sr="orderConfirm";Jt(sr,fo,{size:"sm",title:()=>re.t("orderEntry.orderConfirm")});var yo=e=>{var C,j;let{order:i,symbolInfo:r,dataSource:s,national:o,askAndBid:a,totalQuantity:n}=e,{base:l,quote:d,base_dp:c,quote_dp:m}=r,{t:h}=_(),x=()=>{var w;e.reject(),(w=e.close)==null||w.call(e)},y=()=>{var w;e.resolve(),(w=e.close)==null||w.call(e)},f=u.useMemo(()=>[{title:h("common.symbol"),dataIndex:"symbol",width:125,render:(w,k)=>t.jsxs(g,{gap:2,children:[t.jsx("div",{className:b("oui-h-[38px] oui-w-1 oui-shrink-0 oui-rounded-[1px]",k.side===B.BUY?"oui-bg-trade-profit":"oui-bg-trade-loss")}),t.jsxs(g,{direction:"column",itemAlign:"start",children:[t.jsxs(g,{gapX:1,children:[t.jsx(as,{symbol:w,className:"oui-size-3"}),t.jsx(p.formatted,{rule:"symbol",size:"xs",formatString:"base-type",children:w})]}),t.jsx(Ct,{color:"neutral",size:"xs",children:h("orderEntry.orderType.limit")})]})]})},{title:h("common.quantity"),dataIndex:"order_quantity",width:100,render:(w,k)=>t.jsx(p.numeral,{rule:"price",dp:c,padding:!1,color:k.side===B.BUY?"buy":"sell",children:w})},{title:h("common.orderPrice"),dataIndex:"order_price",width:100,render:(w,k)=>{let N=!!(k.side===B.BUY?a!=null&&a[0]&&Number(w)>=(a==null?void 0:a[0]):a!=null&&a[1]&&Number(w)<=(a==null?void 0:a[1]));return t.jsxs(g,{gapX:1,children:[t.jsx(p.numeral,{rule:"price",dp:m,children:w}),N&&t.jsx(Ce,{content:h("orderEntry.confirmScaledOrder.orderPrice.warning"),className:"oui-w-[240px] oui-text-2xs oui-font-semibold oui-text-base-contrast-80",children:t.jsx(vo,{className:"oui-text-warning-darken"})})]})}}],[h,r,a,c,m]);return t.jsxs("div",{className:"oui-font-semibold",children:[t.jsx(ns,{classNames:{root:b("oui-bg-base-7","oui-rounded-lg","oui-overflow-hidden",((C=i.orders)==null?void 0:C.length)>=6&&"oui-h-[320px]"),scroll:"!oui-min-h-[130px]"},dataSource:s,columns:f,bordered:!0,onRow:()=>({className:b("oui-h-[50px]")})}),t.jsxs("div",{className:"oui-mb-5 oui-mt-4 oui-text-2xs",children:[t.jsxs(g,{justify:"between",children:[t.jsx(p,{children:h("orderEntry.totalOrders")}),t.jsx(p,{intensity:80,children:(j=i.orders)==null?void 0:j.length})]}),t.jsxs(g,{justify:"between",mt:2,children:[t.jsx(p,{children:h("orderEntry.totalQuantity")}),t.jsx(p.numeral,{rule:"price",unit:l,dp:c,padding:!1,intensity:80,unitClassName:"oui-text-base-contrast-36 oui-ml-1",children:n})]}),t.jsxs(g,{justify:"between",mt:2,children:[t.jsx(p,{children:h("common.notional")}),t.jsx(p.numeral,{rule:"price",unit:d,dp:m,padding:!1,intensity:80,unitClassName:"oui-text-base-contrast-36 oui-ml-1",children:o})]})]}),t.jsxs(xe,{cols:2,gapX:3,children:[t.jsx(K,{color:"secondary",size:"md",onClick:x,children:h("common.cancel")}),t.jsx(K,{size:"md",onClick:y,children:h("common.confirm")})]})]})},vo=u.forwardRef((e,i)=>t.jsx("svg",{width:"12",height:"13",viewBox:"0 0 12 13",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",ref:i,...e,children:t.jsx("path",{d:"M5.99951 1.50708C3.23811 1.50708 0.999512 3.74558 0.999512 6.50708C0.999512 9.26858 3.23811 11.5071 5.99951 11.5071C8.76091 11.5071 10.9995 9.26858 10.9995 6.50708C10.9995 3.74558 8.76091 1.50708 5.99951 1.50708ZM5.99951 4.00708C6.27566 4.00708 6.49951 4.23108 6.49951 4.50708C6.49951 4.78308 6.27566 5.00708 5.99951 5.00708C5.72336 5.00708 5.49951 4.78308 5.49951 4.50708C5.49951 4.23108 5.72336 4.00708 5.99951 4.00708ZM5.99951 5.50708C6.27566 5.50708 6.49951 5.73108 6.49951 6.00708V8.50708C6.49951 8.78308 6.27566 9.00708 5.99951 9.00708C5.72336 9.00708 5.49951 8.78308 5.49951 8.50708V6.00708C5.49951 5.73108 5.72336 5.50708 5.99951 5.50708Z"})}));function jo(e){let{order:i,symbolInfo:r}=e,s=i.orders,[o,a]=u.useState(),n=ut(),l=u.useMemo(()=>s.reduce((c,m)=>c.add(new L(m.order_price).mul(m.order_quantity)),At).toNumber(),[s]),d=u.useMemo(()=>s.reduce((c,m)=>c.add(new L(m.order_quantity)),At).toString(),[s,r.base_dp]);return u.useEffect(()=>{let c=m=>{var y,f,C,j;let h=(f=(y=m.asks)==null?void 0:y[m.asks.length-1])==null?void 0:f[0],x=(j=(C=m.bids)==null?void 0:C[0])==null?void 0:j[0];a([h,x])};return n.on("orderbook:update",c),()=>{n.off("orderbook:update",c)}},[]),{dataSource:s,national:l,askAndBid:o,totalQuantity:d}}var Co=e=>{let i=jo(e);return t.jsx(yo,{...e,...i})},or="scaledOrderConfirm";Jt(or,Co,{size:"md",title:()=>re.t("orderEntry.confirmScaledOrder"),contentProps:{}});var wo=e=>{let{t:i}=_(),{takerFeeRate:r,makerFeeRate:s}=e;return t.jsxs(g,{justify:"between",children:[t.jsx(p,{size:"2xs",children:i("common.fees")}),t.jsx(Tt,{fallback:()=>t.jsxs(p,{size:"2xs",children:[i("portfolio.feeTier.column.taker"),": --% /"," ",i("portfolio.feeTier.column.maker"),": --%"]}),children:t.jsxs(g,{gap:1,children:[t.jsxs(p,{size:"2xs",children:[i("portfolio.feeTier.column.taker"),":"]}),t.jsx(p,{size:"2xs",className:"oui-text-base-contrast-80",children:r}),t.jsx(p,{size:"2xs",children:"/"}),t.jsxs(p,{size:"2xs",children:[i("portfolio.feeTier.column.maker"),":"]}),t.jsx(p,{size:"2xs",className:"oui-text-base-contrast-80",children:s})]})})]})},_o=()=>{let{data:e}=ss(),i=u.useMemo(()=>{let s=e==null?void 0:e.futures_taker_fee_rate;if(!(typeof s>"u"))return`${new L(s).mul(.01).toString()}%`},[e]),r=u.useMemo(()=>{let s=e==null?void 0:e.futures_maker_fee_rate;if(!(typeof s>"u"))return`${new L(s).mul(.01).toString()}%`},[e]);return{takerFeeRate:i,makerFeeRate:r}},No=()=>{let e=_o();return t.jsx(wo,{...e})},ri=u.createContext({}),So=ri.Provider,ko=e=>{let{t:i}=_(),{className:r,...s}=e,o=()=>{W.dialog({title:i("common.tips"),size:"sm",content:t.jsx(To,{value:e.value})})};return t.jsxs(g,{direction:"column",itemAlign:"start",justify:"center",p:2,r:"base",width:"100%",intensity:600,className:b("oui-t-rounded oui-text-base-contrast-36","oui-border oui-border-solid oui-border-line",r),children:[t.jsx(p,{size:"2xs",className:"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",onClick:o,children:i("orderEntry.quantityDistribution")}),t.jsx(Po,{...s})]})},To=e=>{let{t:i}=_(),[r,s]=u.useState(J.FLAT);u.useEffect(()=>{s([J.FLAT,J.ASCENDING,J.DESCENDING].includes(e.value)?e.value:J.FLAT)},[e.value]);let o=u.useMemo(()=>[{type:J.FLAT,title:i("orderEntry.distributionType.flat"),description:i("orderEntry.distributionType.flat.description"),formula:`${i("orderEntry.skew")} = 1`,quantity:t.jsx(Oo,{})},{type:J.ASCENDING,title:i("orderEntry.distributionType.ascending"),description:i("orderEntry.distributionType.ascending.description"),formula:`${i("orderEntry.skew")} > 1`,quantity:t.jsx(Lo,{})},{type:J.DESCENDING,title:i("orderEntry.distributionType.descending"),description:i("orderEntry.distributionType.descending.description"),formula:`0 < ${i("orderEntry.skew")} < 1`,quantity:t.jsx(Mo,{})}],[]),a=u.useMemo(()=>o.find(n=>n.type===r),[o,r]);return t.jsxs("div",{className:"oui-text-2xs oui-font-semibold oui-text-base-contrast-54",children:[t.jsxs(g,{direction:"column",itemAlign:"start",gapY:1,children:[t.jsx(p,{intensity:80,children:i("orderEntry.quantityDistribution.description")}),t.jsx(p,{children:i("orderEntry.quantityDistribution.formula")})]}),t.jsxs(g,{intensity:600,p:1,r:"base",mt:3,itemAlign:"start",children:[t.jsx(g,{direction:"column",itemAlign:"start",children:o.map(n=>t.jsx(E,{intensity:r===n.type?500:600,width:78,p:2,className:"oui-cursor-pointer oui-rounded-l",onClick:()=>{s(n.type)},children:t.jsx(p,{children:n.title})},n.title))}),t.jsxs(g,{direction:"column",itemAlign:"start",gapY:1,p:2,intensity:500,width:"100%",className:b("oui-rounded-r",r===J.FLAT&&"oui-rounded-bl",r===J.ASCENDING&&"oui-rounded-l",r===J.DESCENDING&&"oui-rounded-tl"),children:[t.jsx("div",{children:a==null?void 0:a.formula}),t.jsx(p,{children:a==null?void 0:a.description}),t.jsx(g,{width:"100%",justify:"center",children:a==null?void 0:a.quantity}),t.jsxs(g,{width:"100%",gapX:1,justify:"center",children:[t.jsx(p,{className:"oui-text-base-1",children:i("common.price")}),t.jsx(Eo,{})]})]})]})]})},Po=e=>{let{value:i,onValueChange:r}=e,{t:s}=_(),o=n=>l=>{r(n)},a=u.useMemo(()=>({[J.FLAT]:s("orderEntry.distributionType.flat"),[J.ASCENDING]:s("orderEntry.distributionType.ascending.abbr"),[J.DESCENDING]:s("orderEntry.distributionType.descending.abbr"),[J.CUSTOM]:s("orderEntry.distributionType.custom")}),[s]);return t.jsx(g,{className:b("oui-gap-x-[6px] lg:oui-gap-x-2"),wrap:"wrap",children:Object.values(J).map(n=>t.jsxs(g,{itemAlign:"center",children:[t.jsx(be,{id:`distribution-type-${n}`,color:"white",variant:"radio",checked:i===n,onCheckedChange:o(n)}),t.jsx("label",{htmlFor:`distribution-type-${n}`,className:b("oui-text-2xs","oui-ml-1","oui-whitespace-nowrap oui-break-normal"),children:a[n]})]},n))})},Oo=()=>t.jsxs("svg",{width:"218",height:"40",viewBox:"0 0 218 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{x:"18",y:"18",width:"181",height:"4",fill:"rgb(var(--oui-color-base-2))"}),t.jsx("circle",{cx:"15",cy:"20",r:"6",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"}),t.jsx("circle",{cx:"62",cy:"20",r:"6",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"}),t.jsx("circle",{cx:"109",cy:"20",r:"6",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"}),t.jsx("circle",{cx:"156",cy:"20",r:"6",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"}),t.jsx("circle",{cx:"203",cy:"20",r:"6",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"})]}),Lo=()=>t.jsxs("svg",{width:"218",height:"40",viewBox:"0 0 218 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{x:"18",y:"18",width:"181",height:"4",fill:"rgb(var(--oui-color-base-2))"}),t.jsx("circle",{cx:"15",cy:"20",r:"4.28571",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"1.42857"}),t.jsx("circle",{cx:"62",cy:"20",r:"5.14286",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"1.71429"}),t.jsx("circle",{cx:"109",cy:"20",r:"6",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"}),t.jsx("circle",{cx:"156",cy:"20",r:"6.85714",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2.28571"}),t.jsx("circle",{cx:"203",cy:"20",r:"7.71429",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2.57143"})]}),Mo=()=>t.jsxs("svg",{width:"218",height:"40",viewBox:"0 0 218 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"181",height:"4",transform:"matrix(-1 0 0 1 200 18)",fill:"rgb(var(--oui-color-base-2))"}),t.jsx("circle",{cx:"5",cy:"5",r:"4.28571",transform:"matrix(-1 0 0 1 208 15)",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"1.42857"}),t.jsx("circle",{cx:"6",cy:"6",r:"5.14286",transform:"matrix(-1 0 0 1 162 14)",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"1.71429"}),t.jsx("circle",{cx:"7",cy:"7",r:"6",transform:"matrix(-1 0 0 1 116 13)",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2"}),t.jsx("circle",{cx:"8",cy:"8",r:"6.85714",transform:"matrix(-1 0 0 1 70 12)",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2.28571"}),t.jsx("circle",{cx:"9",cy:"9",r:"7.71429",transform:"matrix(-1 0 0 1 24 11)",fill:"rgb(var(--oui-color-base-2))",stroke:"rgb(var(--oui-color-base-5))",strokeWidth:"2.57143"})]}),Eo=()=>t.jsx("svg",{width:"176",height:"8",viewBox:"0 0 176 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M175.354 4.35355C175.549 4.15829 175.549 3.84171 175.354 3.64645L172.172 0.464466C171.976 0.269204 171.66 0.269204 171.464 0.464466C171.269 0.659728 171.269 0.976311 171.464 1.17157L174.293 4L171.464 6.82843C171.269 7.02369 171.269 7.34027 171.464 7.53553C171.66 7.7308 171.976 7.7308 172.172 7.53553L175.354 4.35355ZM0 4V4.5H175V4V3.5H0V4Z",fill:"rgb(var(--oui-color-base-1))"})}),fi=[.01,.05,.1],Io=u.forwardRef((e,i)=>{let{t:r}=_(),[s,o]=u.useState(),[a,n]=u.useState(""),[l,d]=u.useState(void 0);u.useImperativeHandle(i,()=>({getValue:()=>{var x;return a?(x=new L(a))==null?void 0:x.toNumber():s}})),u.useEffect(()=>{e.initialValue&&!fi.includes(e.initialValue)?n(e.initialValue.toString()):o(e.initialValue)},[e.initialValue,open]);let c=x=>{o(x),n(""),d(void 0)},m=x=>{if(!x){n(x);return}let y=new L(x);o(void 0),y.gt(3)?(n("3"),d(r("orderEntry.slippage.error.exceed"))):(n(x),d(void 0))},h=e.isMobile?t.jsx("button",{onClick:()=>{W.alert({title:r("common.tips"),message:t.jsx(p,{size:"2xs",children:r("orderEntry.slippage.tips")})})},children:t.jsx(Dt,{className:"oui-text-base-contrast-54",size:16})}):t.jsx(Ce,{content:t.jsx(p,{intensity:80,size:"2xs",children:r("orderEntry.slippage.tips")}),className:"oui-w-[260px] oui-bg-base-6",arrow:{className:"oui-fill-base-6"},children:t.jsx(Vi,{children:t.jsx(Dt,{className:"oui-text-base-contrast-54",size:16})})});return t.jsxs("div",{className:"oui-text-2xs",children:[t.jsxs(g,{mb:2,gapX:1,children:[t.jsx(p,{size:"xs",children:r("orderEntry.slippage")}),h]}),t.jsxs(g,{gapX:2,children:[fi.map(x=>t.jsx(Ro,{value:x,isActive:s===x,onClick:()=>{c(x)}},x)),t.jsx(St,{suffix:"%",formatters:[Y.numberFormatter,Y.dpFormatter(2)],value:a,onValueChange:m,classNames:{root:b("oui-rounded-md oui-bg-base-6","oui-h-[40px] oui-w-[74px]"),input:"oui-text-base-contrast",additional:"oui-pl-1"}})]}),!!l&&t.jsx(E,{mt:5,className:"-oui-mb-5",children:t.jsx(p,{size:"2xs",color:"danger",children:l})})]})}),Ro=({value:e,isActive:i,onClick:r})=>t.jsx(g,{intensity:600,justify:"center",itemAlign:"center",r:"md",width:74,height:40,className:b("oui-cursor-pointer oui-select-none",i&&"oui-bg-primary-light"),onClick:r,children:t.jsxs(p,{size:"sm",intensity:80,children:[e,"%"]})}),Do=e=>{let{t:i}=_(),[r,{setTrue:s,setFalse:o,toggle:a}]=rs(!1),{isMobile:n}=Qe(),l=u.useRef(null),d=()=>{var m;let c=(m=l.current)==null?void 0:m.getValue();return e.setSlippage(c?c.toString():"1"),o(),Promise.resolve(!0)};return t.jsxs(t.Fragment,{children:[t.jsx(zi,{open:r,onOpenChange:a,title:i("common.settings"),contentProps:{size:n?"xs":"sm"},actions:{primary:{disabled:!1,label:i("common.save"),onClick:d},secondary:{label:i("common.cancel"),onClick:()=>o()}},children:t.jsx(Io,{ref:l,isMobile:n,initialValue:e.slippage?Number(e.slippage):void 0})}),t.jsxs(g,{justify:"between",children:[t.jsx(p,{size:"2xs",children:i("orderEntry.slippage")}),t.jsx(Tt,{fallback:()=>t.jsxs(p,{size:"2xs",children:[i("orderEntry.slippage.est"),": -% / ",i("common.max"),": --%"]}),children:t.jsxs(g,{gap:1,children:[t.jsx(p.numeral,{size:"2xs",rule:"percentages",prefix:`${i("orderEntry.slippage.est")}: `,suffix:` / ${i("common.max")}: `,children:e.estSlippage??0}),t.jsx("button",{className:"oui-text-2xs",onClick:()=>s(),children:t.jsxs(g,{className:"oui-gap-0.5",as:"span",children:[t.jsx(p,{size:"2xs",className:"oui-text-primary",children:`${e.slippage||"-"}%`}),t.jsx($i,{className:"oui-text-primary oui-hidden md:oui-block",size:12,opacity:1})]})})]})})]})]})},Ao=e=>t.jsx(Do,{...e}),ar=u.createContext({}),nr=()=>u.useContext(ar),yi=e=>{let{type:i,values:r}=e,[s,o]=A("TP/SL_Mode","Offset%"),{t:a}=_(),n=u.useMemo(()=>!r.PnL||!e.values.trigger_price?null:t.jsxs(g,{children:[t.jsx("span",{className:"oui-text-xs oui-text-base-contrast-54",children:a(s==="PnL"?"orderEntry.estRoi":"orderEntry.estPnL")}),s==="PnL"?t.jsx(p.numeral,{rule:"percentages",className:b("oui-text-xs oui-ml-1",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),children:r.ROI}):t.jsx(p.numeral,{rule:"price",className:b("oui-text-xs oui-ml-1",i==="TP"?"oui-text-trade-profit":"oui-text-trade-loss"),children:r.PnL})]}),[s,e.values.PnL,e.values.trigger_price]);return t.jsx(ar.Provider,{value:{mode:s,setMode:o,tipsEle:n},children:e.children})},zo=e=>{let{type:i,values:r,quote_dp:s}=e,{t:o}=_(),{mode:a,setMode:n,tipsEle:l}=nr(),[d,c]=u.useState(!1),[m,h]=u.useState(!1),x=u.useMemo(()=>{switch(a){case"Offset":return`${i.toLowerCase()}_offset`;case"Offset%":return`${i.toLowerCase()}_offset_percentage`;default:return`${i.toLowerCase()}_pnl`}},[a]),[y,f]=u.useState(r[a]);u.useEffect(()=>{m||f(r[a])},[r,a,m]);let C=u.useMemo(()=>[{label:o("tpsl.pnl"),value:"PnL",testId:"PnL_menu_item"},{label:o("tpsl.offset"),value:"Offset",testId:"Offset_mneu_item"},{label:`${o("tpsl.offset")}%`,value:"Offset%",testId:"Offset%_menu_item"}],[o]),j=u.useMemo(()=>({PnL:o("tpsl.pnl"),Offset:o("tpsl.offset"),"Offset%":`${o("tpsl.offset")}%`}),[o]),w=u.useRef("");return{mode:a,modes:C,modeLabelMap:j,formatter:k=>{let{dp:N=2}=k;return{onRenderBefore:(v,T)=>(v=`${v}`,i==="SL"&&a==="PnL"&&(v=v.startsWith("-")?v:"-"+v),v===""||v==="-"?"":a==="Offset%"?`${new L(v.replace(new RegExp(w.current.replace(".","\\.")+"$"),"")).mul(100).todp(2,4).toString()}${w.current}`:(a==="Offset"&&(v=Ot(v,N)),`${v}`)),onSendBefore:v=>{if(/^\-?0{2,}$/.test(v))return"0";if(a==="Offset%"){if(v!==""){v=Ot(v,2);let T=v.match(/\.0{0,2}$/);T?w.current=T[0]:w.current="",v=new L(v).div(100).toString(),v=`${v}${w.current}`}}else v=Ot(v,N);return v===""||v==="-"?"":v}}},onModeChange:k=>{n(k)},onFocus:()=>{c(!0),h(!0)},onBlur:()=>{c(!1),h(!1),e.onChange(x,y)},value:y,onValueChange:k=>{f(k),e.onChange(x,k)},quote_dp:s,tips:d?l:void 0}},$o=e=>{var k,N;let{mode:i,modes:r,modeLabelMap:s,onModeChange:o,onValueChange:a,quote:n,quote_dp:l,value:d,type:c,tips:m,onFocus:h,onBlur:x}=e,[y,f]=u.useState(i),[C,j]=u.useState(i==="Offset%"?"%":n);u.useEffect(()=>{f(i),j(i==="Offset%"?"%":n)},[i]),u.useEffect(()=>{f(d?"":i)},[d]);let w=u.useMemo(()=>`${c.toLowerCase()}_${i.toLowerCase()}`,[]);return t.jsx(St.tooltip,{prefix:s[y]||y,size:"md",placeholder:C,id:w,align:"right",value:d,tooltip:m,tooltipProps:{content:{side:e.type==="TP"?"top":"bottom"}},"data-testid":(k=e.testIds)==null?void 0:k.input,autoComplete:"off",onValueChange:a,formatters:[e.formatter({dp:l,mode:i,type:c}),Y.currencyFormatter],classNames:{root:c==="TP"?"oui-text-trade-profit":"oui-text-trade-loss",additional:"oui-text-base-contrast-54",input:"oui-text-inherit"},onFocus:()=>{f(""),j(""),h()},onBlur:()=>{f(d?"":i),j(i==="Offset%"?"%":n),x()},suffix:t.jsxs(t.Fragment,{children:[i==="Offset%"&&!!d&&t.jsx(p,{size:"2xs",color:"inherit",className:"oui-ml-[2px]",children:"%"}),t.jsx(Vo,{mode:i,modes:r,onModeChange:v=>o(v.value),testId:(N=e.testIds)==null?void 0:N.dropDown})]})})},Vo=e=>t.jsx(os,{currentValue:e.mode,menu:e.modes,align:"end",size:"xs",className:"oui-min-w-[80px]",onCloseAutoFocus:i=>i.preventDefault(),onSelect:i=>e.onModeChange(i),children:t.jsx("button",{className:"oui-p-2","data-testid":e.testId,children:t.jsx(Gt,{size:12,color:"white"})})}),Bo=e=>{let{testIds:i,quote:r,...s}=e,o=zo(s);return t.jsx($o,{...o,testIds:i,quote:r,type:e.type})},Ho=e=>{let i=ge.useRef(null),{t:r}=_();return u.useEffect(()=>{e.orderType!==S.LIMIT&&e.orderType!==S.MARKET&&e.onSwitchChanged(!1)},[e.orderType]),e.orderType!==S.LIMIT&&e.orderType!==S.MARKET||e.isReduceOnly?null:t.jsxs("div",{children:[t.jsxs(g,{itemAlign:"center",gapX:1,children:[t.jsx(Nt,{id:"order_entry_tpsl",className:"oui-h-[14px]",checked:e.switchState,disabled:e.orderType!==S.LIMIT&&e.orderType!==S.MARKET||e.isReduceOnly,onCheckedChange:s=>{e.onSwitchChanged(s)}}),t.jsx("label",{htmlFor:"order_entry_tpsl",className:"oui-text-xs",children:r("common.tpsl")}),t.jsx(Dt,{color:"white",size:14,opacity:1,className:"oui-cursor-pointer oui-text-white/[.36] hover:oui-text-white/80",onClick:()=>{W.dialog({title:r("common.tips"),size:"xs",content:t.jsx(p,{intensity:54,children:r("orderEntry.tpsl.tips")})})}})]}),t.jsx("div",{className:b("oui-max-h-0 oui-overflow-hidden oui-transition-all",e.switchState&&"oui-max-h-[100px]"),onTransitionEnd:()=>{var s;(s=i.current)==null||s.style.setProperty("opacity",e.switchState?"1":"0")},children:t.jsx(lr,{ref:i,onChange:e.onChange,values:e.values,errors:e.errors,quote_dp:e.quote_dp})})]})},lr=ge.forwardRef((e,i)=>{let{parseErrorMsg:r}=er(e.errors);return t.jsxs("div",{ref:i,className:"oui-space-y-1 oui-px-px oui-py-2 oui-transition-all",children:[t.jsx(yi,{values:e.values.tp,type:"TP",children:t.jsx(vi,{type:"TP",error:r("tp_trigger_price"),onChange:e.onChange,values:e.values.tp,quote_dp:e.quote_dp,testIds:{first:"oui-testid-orderEntry-tpsl-tpPrice-input",second:"oui-testid-orderEntry-tpsl-tpPnl-input",dropDown:"oui-testid-orderEntry-tpsl-tp-dropDown-trigger-button"}})}),t.jsx(yi,{values:e.values.sl,type:"SL",children:t.jsx(vi,{type:"SL",error:r("sl_trigger_price"),onChange:e.onChange,values:e.values.sl,quote_dp:e.quote_dp,testIds:{first:"oui-testid-orderEntry-tpsl-slPrice-input",second:"oui-testid-orderEntry-tpsl-slPnl-input",dropDown:"oui-testid-orderEntry-tpsl-sl-dropDown-trigger-button"}})})]})});lr.displayName="TPSLInputForm";var qo=e=>{let{t:i}=_(),{errorMsgVisible:r}=u.useContext(ri),{tipsEle:s}=nr(),[o,a]=u.useState(`${e.type} Price`),[n,l]=u.useState("USDC"),[d,c]=u.useState(!1),[m,h]=u.useState(!1),[x,y]=u.useState(e.values.trigger_price??"");u.useEffect(()=>{m||y(e.values.trigger_price??"")},[e.values.trigger_price,m]);let f=u.useMemo(()=>e.error&&r?e.error:d?s:null,[e.error,r,d,s]),C=N=>{let v=e.type==="TP"?i("tpsl.tpPrice"):i("tpsl.slPrice");return N&&(v=e.type==="TP"?i("tpsl.tp"):i("tpsl.sl")),v},j=N=>{y(N),e.onChange(N)};u.useEffect(()=>{a(C(e.values.trigger_price)),m||y(e.values.trigger_price??"")},[e.type,e.values.trigger_price]);let w=()=>{a(e.type==="TP"?i("tpsl.tp"):i("tpsl.sl")),l(""),c(!0),h(!0)},k=()=>{a(C(e.values.trigger_price)),l("USDC"),c(!1),h(!1),e.onChange(x)};return t.jsx(St.tooltip,{"data-testid":e.testId,prefix:o,size:"md",placeholder:n,align:"right",onFocus:w,onBlur:k,tooltip:f,tooltipProps:{content:{side:e.type==="TP"?"top":"bottom"}},color:e.error?"danger":void 0,autoComplete:"off",value:x,classNames:{additional:"oui-text-base-contrast-54",root:"oui-pr-2 md:oui-pr-3",prefix:"oui-pr-1 md:oui-pr-2"},onValueChange:j,formatters:[Y.numberFormatter,Y.dpFormatter(e.quote_dp??2),Y.currencyFormatter]})},vi=e=>{var r,s,o;let i=e.type==="SL"?"sl_trigger_price":"tp_trigger_price";return t.jsxs(xe,{cols:2,gapX:1,children:[t.jsx(qo,{testId:(r=e.testIds)==null?void 0:r.first,type:e.type,error:e.error,values:e.values??"",onChange:a=>{e.onChange(i,a)},quote_dp:e.quote_dp}),t.jsx(Bo,{testIds:{input:(s=e.testIds)==null?void 0:s.second,dropDown:(o=e.testIds)==null?void 0:o.dropDown},onChange:e.onChange,quote:"USDC",quote_dp:e.quote_dp,type:e.type,values:{PnL:e.values.PnL,Offset:e.values.Offset,"Offset%":e.values["Offset%"],ROI:e.values.ROI}})]})},Fo=e=>{let{side:i,formattedOrder:r,setOrderValue:s,symbolInfo:o,maxQty:a,freeCollateral:n,helper:l,submit:d,metaState:c,bboStatus:m,bboType:h,onBBOChange:x,toggleBBO:y,disableFeatures:f,currentLtv:C,fillMiddleValue:j}=e,{curLeverage:w}=Zt(),{t:k}=_(),{isMobile:N}=Qe(),{errors:v,validated:T}=c,[M,R]=u.useState(!1),[V,X]=A("orderly_order_confirm",!0),[G,Q]=A("orderly-order-additional-pinned",!0),[q,se]=A("orderly-order-hidden",!1),[oe,ce]=A("orderly-slippage","1",{parseJSON:I=>!I||I==='""'?"1":JSON.parse(I)}),{parseErrorMsg:we}=er(T?v:null),he=u.useMemo(()=>i===B.BUY?k("orderEntry.buyLong"):k("orderEntry.sellShort"),[i,k]);u.useEffect(()=>{T&&R(!0)},[T]),u.useEffect(()=>{var I;(I=e.disableFeatures)!=null&&I.includes("slippageSetting")||(oe?s("slippage",Number(oe)):s("slippage",void 0))},[oe,e.disableFeatures]),u.useEffect(()=>{let I=$=>{$.target.closest("#order-entry-submit-button")||R(pe=>pe&&!1)};return M?document.addEventListener("click",I):document.removeEventListener("click",I),()=>{document.removeEventListener("click",I)}},[M]);let me=()=>{let I=r.order_type===S.SCALED;l.validate().then($=>I?W.show(or,{order:$,symbolInfo:o,size:N?"sm":"md"}):V?W.show(sr,{order:r,symbolInfo:o}):!0,$=>($.slippage&&Z.error(k("orderEntry.slippage.error.max")),R(!0),Promise.reject())).then(()=>d({resetOnSuccess:!1}).then($=>{if(!$.success&&$.message)Z.error($.message);else if($.success&&I){let pe=xo($);pe&&Z.success(pe)}})).catch($=>{$!=null&&$.message&&Z.error($.message)})},_e=N&&e.canTrade,Ne=typeof C=="number"&&!Number.isNaN(C)&&C>0;return t.jsx(So,{value:{errorMsgVisible:M},children:t.jsxs("div",{className:"oui-space-y-2 oui-text-base-contrast-54 xl:oui-space-y-3",ref:e.containerRef,children:[t.jsxs(g,{gapX:2,className:"oui-flex-col oui-gap-y-3 lg:oui-flex-row",children:[t.jsxs("div",{className:b("oui-grid oui-w-full oui-flex-1 oui-gap-x-2 lg:oui-flex lg:oui-gap-x-[6px]",_e?"oui-grid-cols-3":"oui-grid-cols-2"),children:[t.jsx(K,{onClick:()=>{e.setOrderValue("side",B.BUY)},size:"md",fullWidth:!0,"data-type":B.BUY,className:b(i===B.BUY&&e.canTrade?"oui-bg-success-darken hover:oui-bg-success-darken/80 active:oui-bg-success-darken/80":"oui-bg-base-7 oui-text-base-contrast-36 hover:oui-bg-base-6 active:oui-bg-base-6"),"data-testid":"oui-testid-orderEntry-side-buy-button",children:k("common.buy")}),t.jsx(K,{onClick:()=>{e.setOrderValue("side",B.SELL)},"data-type":B.SELL,fullWidth:!0,size:"md",className:b(i===B.SELL&&e.canTrade?"oui-bg-danger-darken hover:oui-bg-danger-darken/80 active:oui-bg-danger-darken/80":"oui-bg-base-7 oui-text-base-contrast-36 hover:oui-bg-base-6 active:oui-bg-base-6"),"data-testid":"oui-testid-orderEntry-side-sell-button",children:k("common.sell")}),_e&&t.jsx(K,{size:"md",fullWidth:!0,trailing:t.jsx(Ur,{size:12,className:"oui-text-base-contrast-36"}),onClick:()=>{W.show($s,{currentLeverage:w})},className:b("oui-bg-base-7 oui-text-primary-light hover:oui-bg-base-6 active:oui-bg-base-6"),children:Rt(w,{fix:2})+"x"})]}),t.jsx("div",{className:"oui-w-full lg:oui-flex-1",children:t.jsx(Yo,{type:r.order_type,side:i,canTrade:e.canTrade,onChange:I=>{s("order_type",I)}})})]}),t.jsxs(g,{itemAlign:"center",justify:"between",children:[t.jsx(p,{size:"2xs",children:k("common.available")}),t.jsxs(g,{itemAlign:"center",justify:"center",gap:1,children:[Ne&&t.jsx(Ce,{className:"oui-bg-base-6 oui-p-2",content:t.jsx(tr,{}),children:t.jsx(Wr,{className:"oui-cursor-pointer oui-text-warning oui-opacity-80"})}),t.jsx(p.numeral,{unit:o.quote,size:"2xs",className:"oui-text-base-contrast-80",unitClassName:"oui-ml-1 oui-text-base-contrast-54",dp:2,padding:!1,children:e.canTrade?n:0})]})]}),r.order_type===S.SCALED?t.jsx(Jo,{type:e.type,symbolInfo:o,values:{quantity:r.order_quantity,total:r.total,side:r.side,max_price:r.max_price,min_price:r.min_price,total_orders:r.total_orders,distribution_type:r.distribution_type,skew:r.skew},onChange:(I,$)=>{e.setOrderValue(I,$)},onValuesChange:e.setOrderValues,onBlur:e.onBlur,onFocus:e.onFocus,parseErrorMsg:we}):t.jsx(Wo,{type:e.type,symbolInfo:o,values:{quantity:r.order_quantity,price:r.order_price,trigger_price:r.trigger_price,total:r.total,level:r.level,side:r.side,order_type_ext:r.order_type_ext},onChange:(I,$)=>{e.setOrderValue(I,$)},onValuesChange:e.setOrderValues,refs:e.refs,onBlur:e.onBlur,onFocus:e.onFocus,bbo:{bboStatus:m,bboType:h,onBBOChange:x,toggleBBO:y},priceInputContainerWidth:e.priceInputContainerWidth,parseErrorMsg:we,fillMiddleValue:j}),t.jsx(Ko,{canTrade:e.canTrade,maxQty:a,currentQtyPercentage:e.currentQtyPercentage,value:r.order_quantity?Number(r.order_quantity):0,tick:o.base_tick,dp:o.base_dp,setMaxQty:e.setMaxQty,onValueChange:I=>{s("order_quantity",I)},side:e.side}),t.jsx(Qr,{fullWidth:!0,id:"order-entry-submit-button","data-type":B.BUY,className:b(i===B.BUY?"orderly-order-entry-submit-button-buy oui-bg-success-darken hover:oui-bg-success-darken/80 active:oui-bg-success-darken/80":"orderly-order-entry-submit-button-sell oui-bg-danger-darken hover:oui-bg-danger-darken/80 active:oui-bg-danger-darken/80"),onClick:()=>{me()},loading:e.isMutating,disabled:!e.canTrade,children:he}),t.jsx(Zo,{canTrade:e.canTrade,quote:o.quote,estLiqPrice:e.estLiqPrice,estLeverage:e.estLeverage,currentLeverage:e.currentLeverage,slippage:oe,dp:o.quote_dp,setSlippage:ce,estSlippage:e.estSlippage,orderType:r.order_type,disableFeatures:f}),t.jsx(ie,{className:"oui-w-full"}),t.jsx(Ho,{quote_dp:e.symbolInfo.quote_dp,switchState:e.tpslSwitch,onSwitchChanged:e.setTpslSwitch,orderType:r.order_type,errors:T?v:null,isReduceOnly:r.reduce_only,values:{tp:{trigger_price:r.tp_trigger_price??"",PnL:r.tp_pnl??"",Offset:r.tp_offset??"","Offset%":r.tp_offset_percentage??"",ROI:r.tp_ROI??""},sl:{trigger_price:r.sl_trigger_price??"",PnL:r.sl_pnl??"",Offset:r.sl_offset??"","Offset%":r.sl_offset_percentage??"",ROI:r.sl_ROI??""}},onChange:(I,$)=>{e.setOrderValue(I,$)}}),t.jsxs(g,{justify:"between",itemAlign:"center",className:"!oui-mt-0 xl:!oui-mt-3",children:[t.jsxs(g,{itemAlign:"center",gapX:1,children:[t.jsx(Nt,{"data-testid":"oui-testid-orderEntry-reduceOnly-switch",className:"oui-h-[14px]",id:"reduceOnly",checked:e.formattedOrder.reduce_only,onCheckedChange:I=>{e.setOrderValue("reduce_only",I)}}),t.jsx("label",{htmlFor:"reduceOnly",className:"oui-text-xs",children:k("orderEntry.reduceOnly")})]}),!G&&t.jsx(Xo,{pinned:G,setPinned:Q,needConfirm:V,setNeedConfirm:X,onValueChange:s,orderTypeExtra:r.order_type_ext,showExtra:r.order_type===S.LIMIT&&!e.tpslSwitch,hidden:q,setHidden:se})]}),G&&t.jsxs(E,{p:2,r:"md",intensity:700,position:"relative",children:[t.jsx(ir,{pinned:G,setPinned:Q,needConfirm:V,setNeedConfirm:X,onValueChange:s,orderTypeExtra:r.order_type_ext,showExtra:r.order_type===S.LIMIT&&!e.tpslSwitch,hidden:q,setHidden:se}),t.jsx(Uo,{onClick:()=>{Q(!1)},className:"oui-group oui-absolute oui-right-2 oui-top-2","data-testid":"oui-testid-orderEntry-pinned-button"})]})]})})},ji="M10.007 1.302a.74.74 0 0 0-.486.214c-1.033.989-1.349 1.815-.972 2.948-.88.675-1.437.84-2.536.84-1.503 0-2.484.182-3.152.85v.02a1.583 1.583 0 0 0 0 2.248l1.867 1.882-3.181 3.18c-.26.26-.28.696-.02.956.261.26.699.26.959 0l3.193-3.194 1.87 1.861a1.585 1.585 0 0 0 2.25 0h.02c.668-.667.854-1.523.854-3.144 0-1.03.212-1.758.852-2.523 1.233.361 1.95.015 2.961-.995a.68.68 0 0 0 .188-.48c0-.234-.06-.593-.209-1.04a5.34 5.34 0 0 0-1.312-2.103 5.35 5.35 0 0 0-2.104-1.312c-.448-.15-.808-.208-1.042-.208",Uo=e=>{let[i,r]=u.useState(ji);return t.jsx("button",{...e,children:t.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",onMouseEnter:()=>{r('M10.008 1.302a.74.74 0 0 0-.486.214c-1.033.989-1.349 1.815-.972 2.948-.88.675-1.437.84-2.536.84-1.503 0-2.484.182-3.152.85v.02a1.583 1.583 0 0 0 0 2.248l1.867 1.882-3.181 3.18c-.26.26-.28.696-.02.956.261.26.699.26.959 0l3.193-3.194 1.87 1.861a1.585 1.585 0 0 0 2.25 0h.02c.668-.667.854-1.523.854-3.144 0-1.03.212-1.758.853-2.523 1.232.361 1.95.015 2.96-.995a.68.68 0 0 0 .188-.48c0-.234-.06-.593-.209-1.04a5.34 5.34 0 0 0-1.312-2.103A5.35 5.35 0 0 0 11.05 1.51c-.448-.15-.808-.208-1.042-.208m.258 1.37c.708.131 1.421.6 1.93 1.107.507.508.94 1.13 1.119 1.945-.636.61-1.026.658-1.662.323a.67.67 0 0 0-.779.117c-1.214 1.213-1.533 2.314-1.533 3.8 0 1.292-.076 1.773-.48 2.206-.113.123-.27.104-.374 0L3.799 7.486a.24.24 0 0 1-.017-.34c.239-.29.769-.515 2.226-.514 1.742.001 2.668-.448 3.812-1.52a.67.67 0 0 0 .125-.77c-.343-.686-.29-1.047.321-1.67"')},onMouseLeave:()=>{r(ji)},className:"oui-text-primary-darken ",children:t.jsx("path",{d:i})})})},Wo=e=>{let{type:i,symbolInfo:r,values:s,onFocus:o,onBlur:a,bbo:n,parseErrorMsg:l,fillMiddleValue:d}=e,{t:c}=_(),m=n.bboStatus==="on",h=i===S.LIMIT?t.jsxs(g,{direction:"column",itemAlign:"end",className:"oui-text-2xs",children:[r.quote,t.jsxs(g,{justify:"end",itemAlign:"center",gap:2,children:[t.jsx(g,{px:3,height:20,justify:"center",itemAlign:"center",r:"base",className:b("oui-mt-[2px] oui-cursor-pointer oui-select-none oui-border",n.bboStatus==="on"?"oui-border-primary":"oui-border-line-12",n.bboStatus==="disabled"&&"oui-cursor-not-allowed"),onClick:()=>{n.bboStatus==="disabled"?W.dialog({title:c("common.tips"),size:"xs",content:t.jsx(p,{intensity:54,children:c("orderEntry.bbo.disabled.tips")})}):n.toggleBBO()},children:t.jsx(p,{className:b(n.bboStatus==="on"&&"oui-text-primary",n.bboStatus==="off"&&"oui-text-base-contrast-54",n.bboStatus==="disabled"&&"oui-text-base-contrast-20"),children:c("orderEntry.bbo")})}),t.jsx(p,{className:b("oui-select-none","oui-cursor-pointer oui-text-primary"),onClick:d,children:"Mid"})]})]}):r.quote;return t.jsxs("div",{className:"oui-space-y-1",children:[i===S.STOP_LIMIT||i===S.STOP_MARKET?t.jsx("div",{className:"oui-group",children:t.jsx(fe,{label:c("common.trigger"),suffix:r.quote,error:l("trigger_price"),id:"trigger",ref:e.refs.triggerPriceInputRef,value:s.trigger_price,onChange:x=>{e.onChange("trigger_price",x)},formatters:[Y.dpFormatter(r.quote_dp)],onFocus:o(1),onBlur:a(1)})}):null,i===S.LIMIT||i===S.STOP_LIMIT?t.jsxs("div",{ref:e.refs.priceInputContainerRef,className:"oui-group oui-relative oui-w-full",children:[t.jsx(fe,{label:c("common.price"),suffix:h,id:"price",value:s.price,error:l("order_price"),ref:e.refs.priceInputRef,onChange:x=>{e.onChange("order_price",x)},formatters:[Y.dpFormatter(r.quote_dp)],onFocus:o(0),onBlur:a(0),readonly:m,classNames:{root:b(m&&"focus-within:oui-outline-transparent "),input:b(m&&"oui-cursor-auto")}}),n.bboStatus==="on"&&t.jsx("div",{className:b("oui-absolute oui-bottom-1 oui-left-0"),children:t.jsx(Go,{value:n.bboType,onChange:n.onBBOChange,contentStyle:{width:e.priceInputContainerWidth}})})]}):null,t.jsxs(xe,{cols:2,className:"oui-group oui-space-x-1",children:[t.jsx(fe,{label:c("common.qty"),suffix:r.base,id:"order_quantity_input",name:"order_quantity_input",className:"!oui-rounded-r",value:s.quantity,error:l("order_quantity"),onChange:x=>{e.onChange("order_quantity",x)},formatters:[Y.dpFormatter(r.base_dp)],onFocus:o(2),onBlur:a(2)}),t.jsx(fe,{label:`${c("common.total")}â‰ˆ`,suffix:r.quote,id:"total",className:"!oui-rounded-l",value:s.total,error:l("total"),onChange:x=>{e.onChange("total",x)},onFocus:o(3),onBlur:a(3),formatters:[Y.dpFormatter(r.quote_dp)]})]})]})},fe=u.forwardRef((e,i)=>{var o,a,n,l;let{placeholder:r="0"}=e,{errorMsgVisible:s}=u.useContext(ri);return t.jsx(St.tooltip,{ref:i,tooltip:s?e.error:void 0,autoComplete:"off",autoFocus:e.autoFocus,size:"lg",placeholder:e.readonly?"":r,id:e.id,name:e.name,color:e.error?"danger":void 0,prefix:t.jsx(Qo,{id:e.id,className:(o=e.classNames)==null?void 0:o.prefix,children:e.label}),suffix:e.suffix,value:e.readonly?"":e.value||"",onValueChange:e.onChange,onFocus:d=>{var c;(c=e.onFocus)==null||c.call(e,d)},onBlur:d=>{var c;(c=e.onBlur)==null||c.call(e,d)},formatters:e.overrideFormatters||[...e.formatters??[],Y.numberFormatter,Y.currencyFormatter,Y.decimalPointFormatter],classNames:{root:b("orderly-order-entry oui-relative oui-h-[54px] oui-rounded oui-border oui-border-solid oui-border-line oui-px-2 oui-py-1 group-first:oui-rounded-t-xl group-last:oui-rounded-b-xl",e.className,(a=e.classNames)==null?void 0:a.root),input:b("oui-mb-1 oui-mt-5 oui-h-5",(n=e==null?void 0:e.classNames)==null?void 0:n.input),suffix:b("oui-absolute oui-right-0 oui-top-0 oui-justify-start oui-py-2 oui-text-2xs oui-text-base-contrast-36",(l=e.classNames)==null?void 0:l.suffix)},readOnly:e.readonly})});fe.displayName="CustomInput";var Qo=e=>t.jsx("label",{htmlFor:e.id,className:b("oui-absolute oui-left-2 oui-top-[7px] oui-text-2xs oui-text-base-contrast-36",e.className),children:e.children}),Ko=e=>{let{canTrade:i}=e,{t:r}=_(),s=u.useMemo(()=>i?e.side===B.BUY?"buy":"sell":void 0,[e.side,i]),o=u.useMemo(()=>e.side===B.BUY?r("orderEntry.maxBuy"):r("orderEntry.maxSell"),[e.side,r]);return t.jsxs("div",{children:[t.jsx(Kr.single,{disabled:e.maxQty===0||!i,value:e.value,color:s,markCount:4,showTip:!0,max:e.maxQty,step:e.tick,onValueChange:e.onValueChange}),t.jsxs(g,{justify:"between",className:"oui-pt-1 xl:oui-pt-2",children:[t.jsx(p.numeral,{rule:"percentages",size:"2xs",color:s,dp:2,padding:!1,children:i?e.currentQtyPercentage:0}),t.jsxs(g,{children:[t.jsx("button",{className:at({size:"2xs",className:"oui-mr-1"}),onClick:()=>e.setMaxQty(),"data-testid":"oui-testid-orderEntry-maxQty-value-button",children:o}),t.jsx(p.numeral,{size:"2xs",color:s,dp:e.dp,padding:!1,"data-testid":"oui-testid-orderEntry-maxQty-value",children:i?e.maxQty:0})]})]})]})},Yo=e=>{let{t:i}=_(),r=u.useMemo(()=>[{label:i("orderEntry.orderType.limitOrder"),value:S.LIMIT},{label:i("orderEntry.orderType.marketOrder"),value:S.MARKET},{label:i("orderEntry.orderType.stopLimit"),value:S.STOP_LIMIT},{label:i("orderEntry.orderType.stopMarket"),value:S.STOP_MARKET},{label:i("orderEntry.orderType.scaledOrder"),value:S.SCALED}],[i]),s=u.useMemo(()=>({[S.LIMIT]:i("orderEntry.orderType.limit"),[S.MARKET]:i("common.marketPrice"),[S.STOP_LIMIT]:i("orderEntry.orderType.stopLimit"),[S.STOP_MARKET]:i("orderEntry.orderType.stopMarket"),[S.SCALED]:i("orderEntry.orderType.scaledOrder")}),[i]);return t.jsx(Xt.options,{testid:"oui-testid-orderEntry-orderType-button",currentValue:e.type,value:e.type,options:r,onValueChange:e.onChange,contentProps:{className:"oui-bg-base-8 oui-w-full"},valueFormatter:(o,a)=>{if(!r.find(l=>l.value===o))return t.jsx(p,{size:"xs",children:a.placeholder});let n=s[o];return t.jsx(p,{size:"xs",color:e.canTrade?e.side===B.BUY?"buy":"sell":void 0,children:n})},size:"md"})};function Zo(e){var s,o;let{canTrade:i}=e,{t:r}=_();return t.jsxs("div",{className:"oui-space-y-[2px] xl:oui-space-y-1",children:[t.jsxs(g,{justify:"between",children:[t.jsx(p,{size:"2xs",children:r("orderEntry.estLiqPrice")}),t.jsx(p.numeral,{unit:e.quote,size:"2xs",dp:e.dp,className:"oui-text-base-contrast-80",unitClassName:"oui-ml-1 oui-text-base-contrast-36",children:i?e.estLiqPrice??"--":"--"})]}),t.jsxs(g,{justify:"between",children:[t.jsx(p,{size:"2xs",children:r("leverage.accountLeverage")}),t.jsxs(g,{gapX:1,className:at({size:"2xs",intensity:80}),children:[t.jsx(p.numeral,{unit:i?"x":void 0,children:i?e.currentLeverage??"--":"--"}),e.estLeverage&&t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M2.505 4.997c0-.23.186-.416.416-.416H6.07L4.833 3.332l.586-.585 1.964 1.95a.42.42 0 0 1 .122.3.42.42 0 0 1-.122.3l-1.964 1.95-.586-.585L6.07 5.413H2.921a.416.416 0 0 1-.416-.416",fill:"#fff",fillOpacity:".54"})}),t.jsx("span",{children:`${e.estLeverage}x`})]})]})]}),e.orderType===S.MARKET&&!((s=e.disableFeatures)!=null&&s.includes("slippageSetting"))&&t.jsx(Ao,{slippage:e.slippage,setSlippage:e.setSlippage,estSlippage:e.estSlippage}),!((o=e.disableFeatures)!=null&&o.includes("feesInfo"))&&t.jsx(No,{})]})}function Xo(e){let[i,r]=u.useState(!1);return t.jsxs(Yr,{open:i,onOpenChange:r,children:[t.jsx(Zr,{asChild:!0,children:t.jsx("button",{"data-testid":"oui-testid-orderEntry-additional-button",onClick:()=>{r(!0)},children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-white/[.36] hover:oui-fill-white/80",children:t.jsx("path",{d:"M3.332 2.665a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667V3.332a.667.667 0 0 0-.667-.667zm4 0a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667V3.332a.667.667 0 0 0-.667-.667zm4 0a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667V3.332a.667.667 0 0 0-.667-.667zm-8 4a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667V7.332a.667.667 0 0 0-.667-.667zm4 0a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667V7.332a.667.667 0 0 0-.667-.667zm4 0a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667V7.332a.667.667 0 0 0-.667-.667zm-8 4a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667v-1.333a.667.667 0 0 0-.667-.667zm4 0a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667v-1.333a.667.667 0 0 0-.667-.667zm4 0a.667.667 0 0 0-.667.667v1.333c0 .368.299.667.667.667h1.333a.667.667 0 0 0 .667-.667v-1.333a.667.667 0 0 0-.667-.667z"})})})}),t.jsx(Xr,{side:"top",align:"end",className:"oui-w-[230px]",children:t.jsx(ir,{...e})})]})}var Go=e=>{let{t:i}=_(),r=[{label:i("orderEntry.bbo.counterparty1"),value:F.COUNTERPARTY1},{label:i("orderEntry.bbo.counterparty5"),value:F.COUNTERPARTY5},{label:i("orderEntry.bbo.queue1"),value:F.QUEUE1},{label:i("orderEntry.bbo.queue5"),value:F.QUEUE5}];return t.jsx(Xt.options,{testid:"oui-testid-orderEntry-bbo-orderType-button",currentValue:e.value,value:e.value,options:r,onValueChange:e.onChange,contentProps:{className:"oui-bg-base-8 oui-w-full",style:e.contentStyle},size:"sm",classNames:{trigger:"oui-border-none oui-bg-transparent"},valueFormatter:(s,o)=>{let a=r.find(n=>n.value===s);return t.jsx(E,{children:t.jsx(p,{size:"sm",children:a==null?void 0:a.label})})}})},Jo=e=>{let{symbolInfo:i,values:r,onFocus:s,onBlur:o,parseErrorMsg:a}=e,{t:n}=_(),l=r.distribution_type===J.CUSTOM;return t.jsxs("div",{className:"oui-space-y-1",children:[t.jsx(fe,{label:n("orderEntry.upperPrice"),suffix:i.quote,id:"order_max_price_input",value:r.max_price,error:a("max_price"),onChange:d=>{e.onChange("max_price",d)},formatters:[Y.dpFormatter(i.quote_dp)],onFocus:s(5),onBlur:o(5),classNames:{root:"oui-rounded-t-xl"}}),t.jsx(fe,{label:n("orderEntry.lowerPrice"),suffix:i.quote,id:"order_min_price_input",value:r.min_price,error:a("min_price"),onChange:d=>{e.onChange("min_price",d)},formatters:[Y.dpFormatter(i.quote_dp)],onFocus:s(4),onBlur:o(4)}),t.jsxs(xe,{cols:2,className:"oui-group oui-space-x-1",children:[t.jsx(fe,{label:n("common.qty"),suffix:i.base,id:"order_quantity_input",name:"order_quantity_input",className:"!oui-rounded-r",value:r.quantity,error:a("order_quantity"),onChange:d=>{e.onChange("order_quantity",d)},formatters:[Y.dpFormatter(i.base_dp)],onFocus:s(2),onBlur:o(2)}),t.jsx(fe,{label:n("orderEntry.totalOrders"),placeholder:"2-20",id:"order_total_orders_input",className:"!oui-rounded-l",value:r.total_orders,error:a("total_orders"),onChange:d=>{e.onChange("total_orders",d)},overrideFormatters:[Y.numberFormatter,Y.dpFormatter(0)],onFocus:s(6),onBlur:o(6)})]}),t.jsx(ko,{value:r.distribution_type,onValueChange:d=>{e.onChange("distribution_type",d)},className:b(!l&&"oui-rounded-b-xl")}),l&&t.jsx(fe,{id:"order_skew_input",label:n("orderEntry.skew"),value:r.skew,error:a("skew"),onChange:d=>{e.onChange("skew",d)},onFocus:s(7),onBlur:o(7),overrideFormatters:[Y.rangeFormatter({min:0,max:100,dp:2}),Y.dpFormatter(2)],classNames:{root:"oui-rounded-b-xl"}})]})},Ci=e=>Number.isNaN(Number(e))?0:Number(e),ea=e=>{let[i,r]=A("orderly-order-entry-order-type",S.LIMIT),[s,o]=A("orderly-order-entry-order-side",B.BUY),[a,n]=A("orderly_order_bbo_type",void 0),l=u.useRef(a),{formattedOrder:d,setValue:c,setValues:m,symbolInfo:h,...x}=qr(e.symbol,{initialOrder:{symbol:e.symbol,order_type:i,side:s}}),[y,f]=A("orderly-order-entry-tp_sl-switch",!1),{state:C}=ue(),{wrongNetwork:j,disabledConnect:w}=pt(),k=u.useMemo(()=>!j&&!w&&(C.status===U.EnableTrading||C.status===U.EnableTradingWithoutConnected),[C.status,j,w]),{currentLeverage:N}=_t(),v=ut(),T=u.useRef(8),M=u.useRef(5),R=u.useRef(null),V=u.useRef(null),X=u.useRef(null),[G,Q]=u.useState(0),q=u.useMemo(()=>Number(d.order_quantity)>=Number(x.maxQty)?1:Fr(Number(d.order_quantity??0),0,x.maxQty)/100,[d.order_quantity,x.maxQty]),se=()=>{if(h.base_tick<1||d.order_type===S.SCALED||!d.order_quantity)return;let O=Gr.formatNumber(d==null?void 0:d.order_quantity,new L((h==null?void 0:h.base_tick)||"0").toNumber());c("order_quantity",O,{shouldUpdateLastChangedField:!1})},oe=O=>z=>{T.current=O,[4,5].includes(T.current)&&(M.current=O)},ce=O=>z=>{setTimeout(()=>{T.current===O&&(T.current=8)},300),O===2&&se()},we=()=>{m({tp_trigger_price:"",sl_trigger_price:""})},he=()=>{m({order_type_ext:void 0})},me=()=>{c("order_quantity",x.maxQty)},_e=(O,z,te)=>{if(O==="order_type"&&r(z),O==="side"&&o(z),O==="reduce_only"&&z||O==="order_type"&&(z===S.STOP_LIMIT||z===S.STOP_MARKET)){let P={tp_trigger_price:"",sl_trigger_price:"",[O]:z};O==="order_type"&&(P.order_type_ext=""),m(P);return}if(O==="order_type"&&z!==S.LIMIT){let P={level:void 0,order_type_ext:void 0,[O]:z};m(P);return}if(O==="order_type"&&z===S.SCALED){m({distribution_type:J.FLAT,[O]:z});return}c(O,z,te)},Ne=O=>{f(O),O?he():we()},I=u.useMemo(()=>y||[S.POST_ONLY,S.IOC,S.FOK].includes(d.order_type_ext)?"disabled":a&&d.order_type===S.LIMIT?"on":"off",[y,d.order_type_ext,d.order_type,a]),$=()=>{a?(n(void 0),m({order_type_ext:void 0,level:void 0})):n(l.current||F.COUNTERPARTY1)},pe=O=>{n(O),l.current=O};u.useEffect(()=>{if(I==="disabled"){let{order_type_ext:O}=d;m({order_type_ext:$t({order_type_ext:O})?void 0:O,level:void 0})}},[I,d.order_type_ext]),u.useEffect(()=>{if(I==="on"){let O=mo(a,d.side),z=po(a);m({order_type_ext:O,level:z})}},[a,I,d.side]),u.useEffect(()=>{let O=z=>{c("order_price",z)};return v.on("update:orderPrice",O),()=>{v.off("update:orderPrice",O)}},[]),u.useEffect(()=>{let O=te=>{setTimeout(()=>{te==null||te.focus()},0)},z=te=>{let P=jt(te[0]),{order_type:D,order_type_ext:ve}=d;if(T.current===1&&(D===S.STOP_LIMIT||D===S.STOP_MARKET)){c("trigger_price",P),O(R.current);return}if($t({order_type:D,order_type_ext:ve})){n(void 0),m({order_type_ext:void 0,level:void 0}),setTimeout(()=>{v.emit("update:orderPrice",P)},0),O(V.current);return}if(D===S.STOP_LIMIT||D===S.LIMIT){c("order_price",P),O(V.current);return}if(D===S.STOP_MARKET){c("trigger_price",P),O(R.current);return}if(D===S.MARKET){n(void 0),m({order_type:S.LIMIT,order_price:P}),O(V.current);return}if(D===S.SCALED&&M.current){let Se=M.current===4?"min_price":"max_price";c(Se,P),O(V.current);return}c("order_price",P),O(V.current)};return v.on("orderbook:item:click",z),()=>{v.off("orderbook:item:click",z)}},[d,h]),u.useEffect(()=>{let O=X.current;if(!O)return;let z=new ResizeObserver(te=>{for(let P of te){let D=P.contentRect.width;D&&Q(D)}});return z.observe(O),()=>{z.unobserve(O)}},[X,d.order_type_ext]),u.useEffect(()=>{x.reset(),x.resetMetaState()},[e.symbol]),u.useEffect(()=>{d.order_type===S.SCALED&&!d.distribution_type&&c("distribution_type",J.FLAT)},[d.order_type,d.distribution_type]);let Ae=Yt(),[Je,et]=u.useState([0,0]),ye=Ai(O=>{var z,te,P,D;et([(te=(z=O.asks)==null?void 0:z[O.asks.length-1])==null?void 0:te[0],(D=(P=O.bids)==null?void 0:P[0])==null?void 0:D[0]])},200);u.useEffect(()=>(v.on("orderbook:update",ye),()=>{v.off("orderbook:update",ye),ye.cancel()}),[ye]);let ze=()=>{if(I==="on"&&$(),d.order_type===S.LIMIT){let[O=0,z=0]=Je,te=new L(Ci(O)).add(Ci(z)).div(2).toNumber();c("order_price",te)}};return{...x,currentQtyPercentage:q,side:d.side,type:d.order_type,level:d.level,setOrderValue:_e,setOrderValues:m,currentLeverage:N,formattedOrder:d,tpslSwitch:y,setTpslSwitch:Ne,setMaxQty:me,symbolInfo:h,onFocus:oe,onBlur:ce,refs:{triggerPriceInputRef:R,priceInputRef:V,priceInputContainerRef:X},canTrade:k,bboStatus:I,bboType:a,onBBOChange:pe,toggleBBO:$,priceInputContainerWidth:G,currentLtv:Ae,fillMiddleValue:ze}},dr=e=>{let i=ea(e);return t.jsx(Fo,{...i,containerRef:e.containerRef,disableFeatures:e.disableFeatures})},ta=["prefixCls","className","children","mode","visiable","visible","renderBar","lineBar","disable","onDragEnd","onDragging"];class ur extends ge.Component{constructor(i){super(i),this.state={dragging:!1},this.warpper=void 0,this.paneNumber=void 0,this.startX=void 0,this.startY=void 0,this.move=void 0,this.target=void 0,this.boxWidth=void 0,this.boxHeight=void 0,this.preWidth=void 0,this.nextWidth=void 0,this.preHeight=void 0,this.nextHeight=void 0,this.preSize=void 0,this.nextSize=void 0,this.onDragEnd=this.onDragEnd.bind(this),this.onDragging=this.onDragging.bind(this)}componentWillUnmount(){this.removeEvent()}removeEvent(){window.removeEventListener("mousemove",this.onDragging,!1),window.removeEventListener("mouseup",this.onDragEnd,!1)}onMouseDown(i,r){if(!(!r.target||!this.warpper)){this.paneNumber=i,this.startX=r.clientX,this.startY=r.clientY,this.move=!0,this.target=r.target.parentNode;var s=this.target.previousElementSibling,o=this.target.nextElementSibling;this.boxWidth=this.warpper.clientWidth,this.boxHeight=this.warpper.clientHeight,s&&(this.preWidth=s.clientWidth,this.preHeight=s.clientHeight),o&&(this.nextWidth=o.clientWidth,this.nextHeight=o.clientHeight),window.addEventListener("mousemove",this.onDragging),window.addEventListener("mouseup",this.onDragEnd,!1),this.setState({dragging:!0})}}onDragging(i){if(this.move){this.state.dragging||this.setState({dragging:!0});var{mode:r,onDragging:s}=this.props,o=this.target.nextElementSibling,a=this.target.previousElementSibling,n=i.clientX-this.startX,l=i.clientY-this.startY;if(this.preSize=0,this.nextSize=0,r==="horizontal"){if(this.preSize=this.preWidth+n>-1?this.preWidth+n:0,this.nextSize=this.nextWidth-n>-1?this.nextWidth-n:0,this.preSize===0||this.nextSize===0)return;this.preSize=(this.preSize/this.boxWidth>=1?1:this.preSize/this.boxWidth)*100,this.nextSize=(this.nextSize/this.boxWidth>=1?1:this.nextSize/this.boxWidth)*100,a&&o&&(a.style.width=this.preSize+"%",o.style.width=this.nextSize+"%")}if(r==="vertical"&&this.preHeight+l>-1&&this.nextHeight-l>-1){if(this.preSize=this.preHeight+l>-1?this.preHeight+l:0,this.nextSize=this.nextHeight-l>-1?this.nextHeight-l:0,this.preSize=(this.preSize/this.boxHeight>=1?1:this.preSize/this.boxHeight)*100,this.nextSize=(this.nextSize/this.boxHeight>=1?1:this.nextSize/this.boxHeight)*100,this.preSize===0||this.nextSize===0)return;a&&o&&(a.style.height=this.preSize+"%",o.style.height=this.nextSize+"%")}s&&s(this.preSize,this.nextSize,this.paneNumber)}}onDragEnd(){var{onDragEnd:i}=this.props;this.move=!1,i&&i(this.preSize,this.nextSize,this.paneNumber),this.removeEvent(),this.setState({dragging:!1})}render(){var i,r=this.props,{prefixCls:s,className:o,children:a,mode:n,visible:l=(i=this.props.visible)!=null?i:this.props.visiable,renderBar:d,lineBar:c,disable:m}=r,h=oo(r,ta),{dragging:x}=this.state,y=[s,o,s+"-"+n,x?"dragging":null].filter(Boolean).join(" ").trim(),f=ge.Children.toArray(a);return t.jsx("div",Ie({className:y},h,{ref:C=>this.warpper=C,children:ge.Children.map(f,(C,j)=>{var w=Object.assign({},C.props,{className:[s+"-pane",C.props.className].filter(Boolean).join(" ").trim(),style:Ie({},C.props.style)}),k=l===!0||l&&l.includes(j+1)||!1,N={className:[s+"-bar",c?s+"-line-bar":null,c?null:s+"-large-bar"].filter(Boolean).join(" ").trim()};(m===!0||m&&m.includes(j+1))&&(N.className=[N.className,m?"disable":null].filter(Boolean).join(" ").trim());var v=null;return j!==0&&k&&d?v=d(Ie({},N,{onMouseDown:this.onMouseDown.bind(this,j+1)})):j!==0&&k&&(v=ge.createElement("div",Ie({},N),t.jsx("div",{onMouseDown:this.onMouseDown.bind(this,j+1)}))),t.jsxs(ge.Fragment,{children:[v,ge.cloneElement(C,Ie({},w))]},j)})}))}}ur.defaultProps={prefixCls:"w-split",visiable:!0,mode:"horizontal"};var ia="#008676",ra="#D92D6B",cr="#131519",sa="#00B49E",oa="#FF447C",aa="#333948",na="#FFFFFF",la="#F4F7F9",da="regular 11px Manrope",ua={upColor:ia,downColor:ra,chartBG:cr,pnlUpColor:sa,pnlDownColor:oa,pnlZoreColor:aa,textColor:na,qtyTextColor:la,font:da,volumeUpColor:"#0C3E3A",volumeDownColor:"#5A1E36",closeIcon:"rgba(255, 255, 255, 0.8)"},ca=(e,i)=>{let r={"paneProperties.background":e.chartBG,"paneProperties.backgroundType":"solid","mainSeriesProperties.candleStyle.upColor":e.upColor,"mainSeriesProperties.candleStyle.downColor":e.downColor,"mainSeriesProperties.candleStyle.borderColor":e.upColor,"mainSeriesProperties.candleStyle.borderUpColor":e.upColor,"mainSeriesProperties.candleStyle.borderDownColor":e.downColor,"mainSeriesProperties.candleStyle.wickUpColor":e.upColor,"mainSeriesProperties.candleStyle.wickDownColor":e.downColor,"paneProperties.separatorColor":"#2B2833","paneProperties.vertGridProperties.color":"#26232F","paneProperties.horzGridProperties.color":"#26232F","scalesProperties.fontSize":i?8:12,"scalesProperties.textColor":"#97969B","paneProperties.legendProperties.showSeriesTitle":!i,"mainSeriesProperties.statusViewStyle.symbolTextSource":"ticker"},s={"volume.volume.color.0":e.volumeDownColor,"volume.volume.color.1":e.volumeUpColor};return{overrides:r,studiesOverrides:s}},Vt="Orderly",je=e=>e.includes(":")?e.split(":")[1]:e,hr=e=>e.startsWith(`${Vt}:`)?e:`${Vt}:${e}`,ha=(e,i)=>{let r,s=o=>[null,"limit","MARKET","STOP_MARKET","STOP_LIMIT"][o];return{symbolInfo:async o=>(r=i.getSymbolInfo(je(o)),{qty:{min:(r==null?void 0:r.baseMin)??0,max:(r==null?void 0:r.baseMax)??0,step:(r==null?void 0:r.baseTick)??0},pipValue:0,pipSize:(r==null?void 0:r.quoteTick)??0,minTick:(r==null?void 0:r.quoteTick)??0,description:""}),placeOrder:async o=>{let a=["SELL","BUY"][+(o.side>0)],n=o.qty.toString();(o.limitPrice??0).toString(),(o.stopPrice??0).toString();let l=je(o.symbol);s(o.type)==="MARKET"&&i.sendMarketOrder({side:a,order_quantity:n,symbol:l,order_type:S.MARKET})},orders:()=>[],positions:()=>[],executions:()=>[],connectionStatus:()=>1,chartContextMenuActions:o=>e.defaultContextMenuActions(o),isTradable:async()=>!0,accountManagerInfo:()=>({}),currentAccount:()=>"1",accountsMetainfo:async()=>[{id:"1"}],remove:()=>e==null?void 0:e.silentOrdersPlacement().unsubscribe()}},ma=ha;function wt(e){return e===void 0?"":typeof e=="string"?e:e.message}var pa=class{constructor(e,i,r){this._datafeedUrl=e,this._requester=i,this._limitedServerResponse=r}getBars(e,i,r){let s={symbol:e.ticker||"",resolution:i,from:r.from,to:r.to};return r.countBack!==void 0&&(s.countback=r.countBack),e.currency_code!==void 0&&(s.currencyCode=e.currency_code),e.unit_id!==void 0&&(s.unitId=e.unit_id),new Promise(async(o,a)=>{try{let n=await this._requester.sendRequest(this._datafeedUrl,"history",s),l=this._processHistoryResponse(n);this._limitedServerResponse&&await this._processTruncatedResponse(l,s),o(l)}catch(n){if(n instanceof Error||typeof n=="string"){let l=wt(n);a(l)}}})}async _processTruncatedResponse(e,i){let r=e.bars.length;try{for(;this._limitedServerResponse&&this._limitedServerResponse.maxResponseLength>0&&this._limitedServerResponse.maxResponseLength===r&&i.from<i.to;){i.countback&&(i.countback=i.countback-r),this._limitedServerResponse.expectedOrder==="earliestFirst"?i.from=Math.round(e.bars[e.bars.length-1].time/1e3):i.to=Math.round(e.bars[0].time/1e3);let s=await this._requester.sendRequest(this._datafeedUrl,"history",i),o=this._processHistoryResponse(s);r=o.bars.length,this._limitedServerResponse.expectedOrder==="earliestFirst"?(o.bars[0].time===e.bars[e.bars.length-1].time&&o.bars.shift(),e.bars.push(...o.bars)):(o.bars[o.bars.length-1].time===e.bars[0].time&&o.bars.pop(),e.bars.unshift(...o.bars))}}catch(s){(s instanceof Error||typeof s=="string")&&wt(s)}}_processHistoryResponse(e){if(e.s!=="ok"&&e.s!=="no_data")throw new Error(e.errmsg);let i=[],r={noData:!1};if(e.s==="no_data")r.noData=!0,r.nextTime=e.nextTime;else{let s=e.v!==void 0,o=e.o!==void 0;for(let a=0;a<e.t.length;++a){let n={time:e.t[a]*1e3,close:parseFloat(e.c[a]),open:parseFloat(e.c[a]),high:parseFloat(e.c[a]),low:parseFloat(e.c[a])};o&&(n.open=parseFloat(e.o[a]),n.high=parseFloat(e.h[a]),n.low=parseFloat(e.l[a])),s&&(n.volume=parseFloat(e.v[a])),i.push(n)}}return{bars:i,meta:r}}},ga=class{constructor(e){e&&(this._headers=e)}sendRequest(e,i,r){if(r!==void 0){let o=Object.keys(r);o.length!==0&&(i+="?"),i+=o.map(a=>`${encodeURIComponent(a)}=${encodeURIComponent(r[a].toString())}`).join("&")}""+i;let s={credentials:"same-origin"};return this._headers!==void 0&&(s.headers=this._headers),fetch(`${e}/${i}`,s).then(o=>o.text()).then(o=>JSON.parse(o))}};function H(e,i,r,s){let o=e[i];return Array.isArray(o)&&(!s||Array.isArray(o[0]))?o[r]:o}function bt(e,i,r){return e+(i!==void 0?"_%|#|%_"+i:"")+(r!==void 0?"_%|#|%_"+r:"")}var xa=class{constructor(e,i,r){this._exchangesList=["Orderly"],this._symbolsInfo={},this._symbolsList=[],this._datafeedUrl=e,this._datafeedSupportedResolutions=i,this._requester=r,this._readyPromise=this._init(),this._readyPromise.catch(s=>{})}resolveSymbol(e,i,r){return this._readyPromise.then(()=>{let s=this._symbolsInfo[bt(e,i,r)];return s===void 0?Promise.reject("invalid symbol"):Promise.resolve(s)})}searchSymbols(e,i,r,s){return this._readyPromise.then(()=>{let o=[],a=e.length===0;e=e.toUpperCase();for(let l of this._symbolsList){let d=this._symbolsInfo[l];if(d===void 0||r.length>0&&d.type!==r||i&&i.length>0&&d.exchange!==i)continue;let c=d.name.toUpperCase().indexOf(e),m=d.description.toUpperCase().indexOf(e);if((a||c>=0||m>=0)&&!o.some(h=>h.symbolInfo===d)){let h=c>=0?c:8e3+m;o.push({symbolInfo:d,weight:h})}}let n=o.sort((l,d)=>l.weight-d.weight).slice(0,s).map(l=>{let d=l.symbolInfo;return{symbol:d.name,full_name:`${d.exchange}:${d.name}`,description:d.description,exchange:d.exchange,params:[],type:d.type,ticker:d.name}});return Promise.resolve(n)})}_init(){let e=[],i={};for(let r of this._exchangesList)i[r]||(i[r]=!0,e.push(this._requestExchangeData(r)));return Promise.all(e).then(()=>{this._symbolsList.sort()})}_requestExchangeData(e){return new Promise((i,r)=>{this._requester.sendRequest(this._datafeedUrl,"symbol_info",{group:e}).then(s=>{try{this._onExchangeDataReceived(e,s)}catch(o){r(o instanceof Error?o:new Error(`SymbolsStorage: Unexpected exception ${o}`));return}i()}).catch(s=>{`${e}${wt(s)}`,i()})})}_onExchangeDataReceived(e,i){let r=0;try{let s=i.symbol.length,o=i.ticker!==void 0;for(;r<s;++r){let a=i.symbol[r],n=H(i,"exchange-listed",r),l=H(i,"exchange-traded",r),d=l+":"+a,c=H(i,"currency-code",r),m=H(i,"unit-id",r),h=o?H(i,"ticker",r):a,x={ticker:h,name:a,base_name:[n+":"+a],listed_exchange:n,exchange:l,currency_code:c,original_currency_code:H(i,"original-currency-code",r),unit_id:m,original_unit_id:H(i,"original-unit-id",r),unit_conversion_types:H(i,"unit-conversion-types",r,!0),description:H(i,"description",r),has_intraday:$e(H(i,"has-intraday",r),!1),visible_plots_set:$e(H(i,"visible-plots-set",r),"ohlcv"),minmov:H(i,"minmovement",r)||H(i,"minmov",r)||0,minmove2:H(i,"minmove2",r)||H(i,"minmov2",r),fractional:H(i,"fractional",r),pricescale:H(i,"pricescale",r),type:H(i,"type",r),session:H(i,"session-regular",r),session_holidays:H(i,"session-holidays",r),corrections:H(i,"corrections",r),timezone:H(i,"timezone",r),supported_resolutions:$e(H(i,"supported-resolutions",r,!0),this._datafeedSupportedResolutions),has_daily:$e(H(i,"has-daily",r),!0),intraday_multipliers:$e(H(i,"intraday-multipliers",r,!0),["1","5","15","30","60"]),has_weekly_and_monthly:H(i,"has-weekly-and-monthly",r),has_empty_bars:H(i,"has-empty-bars",r),volume_precision:$e(H(i,"volume-precision",r),0),format:"price"};this._symbolsInfo[h]=x,this._symbolsInfo[a]=x,this._symbolsInfo[d]=x,(c!==void 0||m!==void 0)&&(this._symbolsInfo[bt(h,c,m)]=x,this._symbolsInfo[bt(a,c,m)]=x,this._symbolsInfo[bt(d,c,m)]=x),this._symbolsList.push(a)}}catch(s){throw new Error(`SymbolsStorage: API error when processing exchange ${e} symbol #${r} (${i.symbol[r]}): ${Object(s).message}`)}}};function $e(e,i){return e!==void 0?e:i}var ba=class{constructor(e){this._configuration=wi(),this._symbolsStorage=null,this._datafeedURL=e,this._requester=new ga,this._historyProvider=new pa(e,this._requester),this._configurationReadyPromise=this._requestConfiguration().then(i=>{i===null&&(i=wi()),this._setupWithConfiguration(i)})}getBars(e,i,r,s,o){this._historyProvider.getBars(e,i,r).then(a=>{s(a.bars,a.meta)}).catch(o)}onReady(e){this._configurationReadyPromise.then(()=>{e(this._configuration)})}searchSymbols(e,i,r,s){if(this._symbolsStorage===null)throw new Error("Datafeed: inconsistent configuration (symbols storage)");this._symbolsStorage.searchSymbols(e,i,r,30).then(s).catch(s.bind(null,[]))}resolveSymbol(e,i,r,s){let o=s&&s.currencyCode,a=s&&s.unitId;function n(l){i(l)}if(this._symbolsStorage===null)throw new Error("Datafeed: inconsistent configuration (symbols storage)");this._symbolsStorage.resolveSymbol(e,o,a).then(n).catch(r)}getMarks(){}getTimescaleMarks(){}getServerTime(){}_requestConfiguration(){return this._send("config").catch(e=>(`${wt(e)}`,null))}_send(e,i){return this._requester.sendRequest(this._datafeedURL,e,i)}_setupWithConfiguration(e){if(this._configuration=e,e.exchanges===void 0&&(e.exchanges=[]),!e.supports_search&&!e.supports_group_request)throw new Error("Unsupported datafeed configuration. Must either support search, or support group request");(e.supports_group_request||!e.supports_search)&&(this._symbolsStorage=new xa(this._datafeedURL,e.supported_resolutions||[],this._requester)),`${JSON.stringify(e)}`}};function wi(){return{supports_search:!1,supports_group_request:!0,supported_resolutions:["1","3","5","15","30","60","120","240","480","720","1D","3D","1W","1M"],supports_marks:!1,supports_timescale_marks:!1}}var fa=class{constructor(){this.subscribers=new Map}subscribe(e,i){return this.subscribers.has(e)||this.subscribers.set(e,[]),this.subscribers.get(e).push(i),()=>{this.unsubscribe(e,i)}}unsubscribe(e,i){if(this.subscribers.has(e)){let r=this.subscribers.get(e);this.subscribers.set(e,r.filter(s=>s!==i)),this.subscribers.get(e).length===0&&this.subscribers.delete(e)}}publish(e,i){this.subscribers.has(e)&&this.subscribers.get(e).forEach(r=>{r(i)})}},_i=e=>{let i="1d";switch(e){case"1":i="1m";break;case"3":i="3m";break;case"5":i="5m";break;case"15":i="15m";break;case"30":i="30m";break;case"60":i="1h";break;case"120":i="2h";break;case"240":i="4h";break;case"480":i="8h";break;case"720":i="12h";break;case"D":case"1D":i="1d";break;case"3D":i="3d";break;case"1W":i="1w";break;case"1M":i="1M ";break}return i},Ve={interval:"TradingviewSDK.lastUsedTimeBasedResolution",lineType:"TradingviewSDK.lastUsedStyle",displayControlSetting:"TradingviewSDK.displaySetting"},Lt=(e,i)=>`${e}kline_${i}`,ya=e=>["trade"].map(i=>`${e}@${i}`),Bt=class ot{constructor(i){return this.klineSubscribeIdMap=new Map,this.klineOnTickCallback=new Map,this.subscribeCachedTopics=new Map,this.wsInstance=null,this.klineData=new Map,ot._created||(this.wsInstance=i,ot._instance=this,ot._created=!0),ot._instance}subscribeKline(i,r,s,o){var l;let a=_i(s);this.klineSubscribeIdMap.set(i,{symbol:r,resolution:s});let n=Lt(r,a);if(this.klineOnTickCallback.has(n)){let d=this.klineOnTickCallback.get(n);d[i]=o}else{this.klineOnTickCallback.set(n,{[i]:o});let d=(l=this.wsInstance)==null?void 0:l.subscribe({event:"subscribe",topic:`${r}@kline_${a}`,id:`${r}@kline_${a}`,ts:new Date().getTime()},{onMessage:c=>{let{open:m,close:h,high:x,low:y,volume:f,startTime:C}=c,j=Lt(c.symbol,c.type);this.updateKline(j,{time:C,close:h,open:m,high:x,low:y,volume:f})}});this.subscribeCachedTopics.set(`${r}@kline_${a}`,d)}}unsubscribeKline(i){if(!this.klineSubscribeIdMap.has(i))return;let{symbol:r,resolution:s}=this.klineSubscribeIdMap.get(i),o=_i(s),a=Lt(r,o);if(this.klineOnTickCallback.has(a)){let n=this.klineOnTickCallback.get(a);delete n[i],Object.keys(n).length===0&&(this.klineOnTickCallback.delete(a),this.subscribeCachedTopics.get(`${r}@kline_${o}`)())}delete this.klineSubscribeIdMap[i]}subscribeSymbol(i){ya(i).forEach(r=>{var s;if(!this.subscribeCachedTopics.has(r)){let o=(s=this.wsInstance)==null?void 0:s.subscribe({event:"subscribe",topic:r,id:r,ts:new Date().getTime()},{onMessage:a=>{this.updateKlineByLastPrice(a.symbol,a.price)}});this.subscribeCachedTopics.set(r,o)}})}updateKlineByLastPrice(i,r){this.klineOnTickCallback.forEach((s,o)=>{if(o.startsWith(i)){let a=this.klineData.get(o);a&&this.updateKline(o,{...a,close:r})}})}updateKline(i,r){let s=this.klineOnTickCallback.get(i);s&&r&&(this.klineData.set(i,r),Object.keys(s).forEach(o=>{let a=s[o];a&&typeof a=="function"&&a(r)}))}};Bt._created=!1,Bt._instance=null;var mr=Bt,va=(()=>{let e=0;return()=>e++})(),ja=class extends ba{constructor(i,r){let s=`${i}/tv`;super(s),this.bbosMap=new Map,this.tickersMap=new Map,this.eventBus=new fa,this._subscribeQuoteMap=new Map,this._prefixId=va(),this._publicWs=new mr(r),this.bbosMap=new Map,r.on("tickers",o=>{for(let a of o.data)a.change=a.close-a.open,a.perChange=a.open?+(100*a.change/a.open).toFixed(2):0,this.tickersMap.set(a.symbol,a);this.eventBus.publish("tickerUpdate",{message:"ticker"})}),r.subscribe({event:"subscribe",topic:"bbos"},{formatter:o=>o,onMessage:o=>{for(let a of o.data)this.bbosMap.set(a.symbol,{ask:a.ask,bid:a.bid,askSize:a.askSize,bidSize:a.bidSize});this.eventBus.publish("tickerUpdate",{message:"bbos"})}})}remove(){Array.from(this._subscribeQuoteMap.values()).forEach(i=>i==null?void 0:i())}getSubscriptionId(i){return`${this._prefixId}${i}`}subscribeBars(i,r,s,o,a){window.onResetCacheNeededCallback=a,this._publicWs.subscribeKline(`${this._prefixId}${o}`,i.ticker,r,s)}unsubscribeBars(i){this._publicWs.unsubscribeKline(`${this._prefixId}${i}`)}getQuotes(i,r){let s=this.getSubscriptionId("getQuotes");this.unsubscribeQuotes("getQuotes");let o=this.eventBus.subscribe("tickerUpdate",a=>{let n=new Map;i.forEach(l=>{let d=this.bbosMap.get(je(l)),c=this.tickersMap.get(je(l));if(!d||!c)return;let m={...c,ask:d.ask,bid:d.bid};n.set(je(l),m)}),n.size&&r(Array.from(n.values()).map(l=>this._toUDFTicker(l)))});this._subscribeQuoteMap.set(s,o)}subscribeQuotes(i,r,s,o){let a=`${this._prefixId}${o}`;if(i.length>0){this.unsubscribeQuotes(a);let n=this.eventBus.subscribe("tickerUpdate",l=>{let d=new Map;i.forEach(c=>{let m=this.bbosMap.get(je(c)),h=this.tickersMap.get(je(c));if(!m||!h)return;let x={...h,ask:m.ask,bid:m.bid};d.set(je(c),x)}),d.size&&s(Array.from(d.values()).map(c=>this._toUDFTicker(c)))});this._subscribeQuoteMap.set(a,n)}}unsubscribeQuotes(i){let r=this.getSubscriptionId(i),s=this._subscribeQuoteMap.get(r);s&&(s(),this._subscribeQuoteMap.delete(r))}_toUDFTicker(i){return{n:hr(i.symbol),s:"ok",v:{ask:i.ask,bid:i.bid,ch:i.change,chp:i.perChange/100,description:"",exchange:Vt,hight_price:i.high,low_price:i.low,lp:i.close,open_price:i.open,prev_close_price:0,volume:i.volume}}}},Ca=2,wa="--",pr=["BRACKET","STOP_BRACKET"],gr=["POSITIONAL_TP_SL","TP_SL"],xr=e=>e.root_algo_order_id!==e.algo_order_id&&(e.algo_type==="TAKE_PROFIT"||e.algo_type==="STOP_LOSS"),_a=e=>!!e&&pr.includes(e),br=e=>e.type==="CLOSE_POSITION",Na=e=>br(e)&&e.is_activated,Sa=e=>xr(e)&&e.is_activated,fr=e=>e.root_algo_order_algo_type==="TP_SL"||_a(e.root_algo_order_algo_type)&&e.is_activated,ka=(e,i)=>{let r=e.algo_type;return{TAKE_PROFIT:re.t("tpsl.takeProfit"),STOP_LOSS:re.t("tpsl.stopLoss")}[r]||null},Ta=e=>{let i=new Map,r=1;return[...e].reverse().filter(fr).forEach(s=>{s.root_algo_order_id&&!i.has(s.root_algo_order_id)&&i.set(s.root_algo_order_id,r++)}),i},Pa=(e,i)=>{let r=Math.abs(e.type==="CLOSE_POSITION"?i.balance:e.quantity),s=e.side==="SELL"?1:-1,o=i.open.toString();return{estPnl:new L(e.trigger_price).minus(o??0).times(r).times(s).toString(),quantity:r,openPrice:o}},Oa=e=>e!==void 0&&e!==""?new L(e).todp(Ca,L.ROUND_FLOOR):wa;function La(){let[e,{cancelOrder:i,cancelAlgoOrder:r,cancelTPSLChildOrder:s}]=Oe({status:ae.INCOMPLETE});return u.useCallback(o=>{if(o.algo_order_id){if(gr.includes(o.root_algo_order_algo_type)){let a=e==null?void 0:e.find(n=>n.algo_order_id===o.root_algo_order_id);return a.child_orders.every(n=>!!n.trigger_price)?s(o.algo_order_id,o.root_algo_order_id):r(a.algo_order_id,o.symbol).then()}return r(o.algo_order_id,o.symbol).then()}return i(o.order_id,o.symbol).then()},[i,e])}function Ma(e){ut();let[,{updateOrder:i,cancelAlgoOrder:r,updateAlgoOrder:s,updateTPSLOrder:o}]=Oe({status:ae.INCOMPLETE});return u.useCallback((a,n)=>{var d;if(a.algo_order_id)if(gr.includes(a.root_algo_order_algo_type)){let c=[{order_id:a.algo_order_id,trigger_price:new L(n.value).toString()}];return o(a.root_algo_order_id,c).then(m=>{}).catch(m=>{e&&e.error(m.message)})}else{if(pr.includes(a.algo_type))return s(a.algo_order_id,{order_price:new L(n.value).toString()}).then(c=>{}).catch(c=>{e&&e.error(c.message)});{let c={quantity:a.quantity,trigger_price:a.trigger_price,symbol:a.symbol,price:a.price,algo_order_id:a.algo_order_id};return a.order_tag&&(c.order_tag=a.order_tag),n.type==="price"&&(c.price=new L(n.value).toString()),n.type==="trigger_price"&&(c.trigger_price=new L(n.value).toString()),s(a.algo_order_id,c).then(m=>{}).catch(m=>{e&&e.error(m.message)})}}let l={order_price:(d=a.price)==null?void 0:d.toString(),order_quantity:a.quantity.toString(),symbol:a.symbol,order_type:a.type,side:a.side,visible_quantity:0,reduce_only:a.reduce_only};return new L(a.visible_quantity??a.visible??0).eq(a.quantity)&&delete l.visible_quantity,Object.keys(a).includes("reduce_only")||delete l.reduce_only,a.order_tag&&(l.order_tag=a.order_tag),n.type==="price"&&(l.order_price=new L(n.value).toString()),i(a.order_id,l).then(c=>{}).catch(c=>{e.error(c.message)})},[i])}function Ea(e){let{onSubmit:i}=Hi({symbol:e,side:B.BUY,order_type:S.MARKET},{watchOrderbook:!0});return{sendLimitOrder:()=>{},sendMarketOrder:r=>(r.reduce_only=!1,i(r).catch(s=>{Z.error(s)}))}}var Ia=e=>i=>e(i),Ra=({closeConfirm:e,colorConfig:i,onToast:r,mode:s,symbol:o})=>{let a=La(),n=Ma(r),l=Ke(),d=u.useCallback(y=>e&&e(y),[e]),{sendMarketOrder:c,sendLimitOrder:m}=Ea(o),h=u.useCallback(y=>{if(l)return{baseMin:l[y]("base_min"),baseMax:l[y]("base_max"),baseTick:l[y]("base_tick"),quoteTick:l[y]("quote_tick")}},[l]),x=u.useRef({cancelOrder:a,closePosition:d,editOrder:n,colorConfig:i,sendLimitOrder:m,getSymbolInfo:h,sendMarketOrder:Ia(c),mode:s});return u.useEffect(()=>{x.current.getSymbolInfo=h},[l]),u.useEffect(()=>{x.current.sendLimitOrder=m,x.current.sendMarketOrder=c},[m,c]),u.useEffect(()=>{x.current.closePosition=d},[e]),u.useEffect(()=>{x.current.cancelOrder=a},[a]),x.current},Da=Ra,Aa=class Ht{constructor(i,r){this.instance=i,this.currentSymbol="",this.broker=r,this.positionLines={},this.lastPositions=null}renderPositions(i){var r;if(i===null||i.length===0){this.removePositions();return}((r=this.lastPositions)==null?void 0:r.length)!==i.length&&this.removePositions(),i[0].symbol!==this.currentSymbol&&(this.removePositions(),this.currentSymbol=i[0].symbol),i.forEach((s,o)=>this.drawPositionLine(s,o)),this.lastPositions=i}getBasePositionLine(){return this.instance.activeChart().createPositionLine().setTooltip(re.t("positions.closePosition")).setQuantityBackgroundColor(this.broker.colorConfig.chartBG).setCloseButtonBackgroundColor(this.broker.colorConfig.chartBG).setBodyTextColor(this.broker.colorConfig.textColor).setQuantityTextColor(this.broker.colorConfig.qtyTextColor).setBodyFont(this.broker.colorConfig.font).setQuantityFont(this.broker.colorConfig.font).setLineLength(100).setLineStyle(1)}static getPositionQuantity(i){return Ue(new L(i).todp(4,L.ROUND_DOWN).toString())}static getPositionPnL(i,r){let s=re.t("tpsl.pnl"),o=new L(i).toFixed(r,L.ROUND_DOWN);return new L(i).eq(0)?`${s} 0`:new L(i).greaterThan(0)?`${s} +${Ue(o)}`:`${s} ${Ue(o)}`}removePositions(){Object.keys(this.positionLines).forEach(i=>{this.positionLines[Number(i)].remove(),delete this.positionLines[Number(i)]})}drawPositionLine(i,r){let s=this.broker.colorConfig,o=i.unrealPnl>=0,a=i.balance>=0,n=s.pnlZoreColor,l=new L(i.unrealPnl);l.greaterThan(0)?n=s.upColor:l.lessThan(0)&&(n=s.downColor),o?s.pnlUpColor:s.pnlDownColor;let d=a?s.upColor:s.downColor,c=new L(i.open).toNumber();this.positionLines[r]=this.positionLines[r]??this.getBasePositionLine(),this.positionLines[r].setQuantity(Ht.getPositionQuantity(i.balance)).setPrice(c).setCloseButtonIconColor(s.closeIcon).setCloseButtonBorderColor(d).setBodyBackgroundColor(n).setQuantityTextColor(d).setBodyBorderColor(n).setLineColor(d).setQuantityBorderColor(d).setText(Ht.getPositionPnL(i.unrealPnl,i.unrealPnlDecimal)),this.broker.mode!==3&&this.positionLines[r].onClose(null,()=>{this.broker.closePosition(i)})}},qt=e=>{if(e!=null)return e.algo_order_id||e.order_id},za=class{constructor(){this.quantityTpslNoMap=new Map,this.tpslPnlMap=new Map,this.positions=null}getQuantityTpslNoMap(){return this.quantityTpslNoMap}getTpslPnlMap(){return this.tpslPnlMap}getFormattedEstPnl(i){if(this.positions===null)return"";let r=this.positions[0];if(!r)return"";let{estPnl:s}=Pa(i,r);return Oa(s)}prepareTpslPnlMap(i){let r=[];return i.forEach(s=>{let o=qt(s);if(o&&Sa(s)){let a=this.tpslPnlMap.get(o),n=this.getFormattedEstPnl(s);a!==n&&(r.push(o),this.tpslPnlMap.set(o,n))}}),r}prepareQuantityTpslNoMap(i){this.quantityTpslNoMap=Ta(i)}recalculatePnl(i,r){return this.positions=i,this.prepareTpslPnlMap(r)}clear(){this.positions=null,this.quantityTpslNoMap.clear(),this.tpslPnlMap.clear()}},yr=class Ee{constructor(i,r){this.instance=i,this.pendingOrderLineMap=new Map,this.pendingOrders=[],this.broker=r,this.tpslCalService=new za}renderPendingOrders(i){i&&(this.pendingOrders=i),this.cleanOldPendingOrders(this.pendingOrders),this.tpslCalService.prepareTpslPnlMap(this.pendingOrders),this.tpslCalService.prepareQuantityTpslNoMap(this.pendingOrders),this.pendingOrders.forEach(r=>this.renderPendingOrder(r))}updatePositions(i){let r=this.tpslCalService.recalculatePnl(i,this.pendingOrders);this.pendingOrders.filter(s=>r.includes(qt(s))).forEach(s=>this.renderPendingOrder(s))}renderPendingOrder(i){let r=Ee.getOrderId(i);if(!r)return;let s=this.drawOrderLine(r,i);s&&this.pendingOrderLineMap.set(r,s)}cleanOldPendingOrders(i){let r=new Set(i.map(s=>Ee.getOrderId(s)));this.pendingOrderLineMap.forEach((s,o)=>!r.has(o)&&this.removePendingOrder(o))}removePendingOrder(i){if(i===void 0)return;let r=this.pendingOrderLineMap.get(i);r&&(this.pendingOrderLineMap.delete(i),r.remove())}getBaseOrderLine(){let i=this.broker.colorConfig;return this.instance.activeChart().createOrderLine().setCancelTooltip(re.t("orders.cancelOrder")).setQuantityTextColor(i.qtyTextColor).setQuantityBackgroundColor(i.chartBG).setBodyBackgroundColor(i.chartBG).setCancelButtonBackgroundColor(i.chartBG).setLineStyle(1).setBodyFont(i.font).setQuantityFont(i.font)}static getCombinationType(i){let{algo_type:r,type:s}=i;if((r==="STOP_LOSS"||r==="TAKE_PROFIT"||r==="STOP")&&s==="LIMIT")return"STOP_LIMIT";if((r==="STOP_LOSS"||r==="TAKE_PROFIT"||r==="STOP")&&s==="MARKET")return"STOP_MARKET";if(r==="BRACKET"){if(s==="LIMIT")return"BRACKET_LIMIT";if(s==="MARKET")return"BRACKET_MARKET"}return"LIMIT"}static getText(i){let r=Ee.getCombinationType(i);return r==="STOP_LIMIT"||r==="STOP_MARKET"||r==="STOP_BRACKET_LIMIT"||r==="STOP_BRACKET_MARKET"?i.type==="LIMIT"?`${re.t("orderEntry.orderType.stopLimit")} ${Ue(i.price)}`:re.t("orderEntry.orderType.stopMarket"):re.t("orderEntry.orderType.limit")}static getOrderPrice(i){return i.trigger_price||i.price}getTPSLTextWithTpsl(i,r){return qt(r),i}getTPSLText(i){let r=ka(i,this.tpslCalService.getQuantityTpslNoMap());return r?this.getTPSLTextWithTpsl(r,i):null}getOrderQuantity(i){if(i.algo_order_id){if(Na(i)||br(i))return"100%";if(fr(i)){let r=new L(i.quantity).minus(i.executed??0).div(new L(i.position_qty)).mul(100).todp(2).toNumber();return`${Math.min(Math.abs(r),100).toString()}%`}}return Ue(new L(i.quantity).toString())}drawOrderLine(i,r){let s=xr(r)?this.getTPSLText(r):Ee.getText(r);if(s===null)return null;let o=this.broker.colorConfig,a=this.pendingOrderLineMap.get(i)??this.getBaseOrderLine(),n=r.side==="BUY"?o.upColor:o.downColor;r.side==="BUY"?o.pnlUpColor:o.pnlDownColor;let l=Ee.getOrderPrice(r),d=100,c=this.getOrderQuantity(r),m=o.textColor;return a.setText(s).setCancelButtonIconColor(o.closeIcon).setCancelButtonBorderColor(n).setBodyTextColor(m).setBodyBorderColor(n).setQuantityBorderColor(n).setQuantityTextColor(n).setLineColor(n).setLineLength(d).setQuantity(c??"").setPrice(l),this.broker.mode!==3?(a.onCancel(null,()=>this.broker.cancelOrder(r)),this.applyEditOnMove(a,r)):a.setEditable(!1).setCancellable(!1),a}static getOrderEditKey(i){let r=this.getCombinationType(i);if(["LIMIT","BRACKET_LIMIT"].includes(r))return"price";if(r==="STOP_LIMIT"||r==="STOP_MARKET"||i.rootAlgoOrderAlgoType==="POSITIONAL_TP_SL"||i.rootAlgoOrderAlgoType==="TP_SL"||i.rootAlgoOrderAlgoType==="BRACKET"||i.rootAlgoOrderAlgoType==="STOP_BRACKET")return"trigger_price"}applyEditOnMove(i,r){let s=Ee.getOrderEditKey(r);i.onMove(()=>{this.broker.editOrder(r,{type:s,value:`${i.getPrice()}`}).then(o=>{o.success||this.renderPendingOrder(r)}).catch(()=>this.renderPendingOrder(r))})}removeAll(){this.pendingOrderLineMap.forEach(i=>i.remove()),this.pendingOrderLineMap.clear(),this.pendingOrders=[],this.tpslCalService.clear()}};yr.getOrderId=e=>{if(e!=null)return e.algo_order_id||e.order_id};var $a=yr,vr={1:{startOf:"minute",period:0},3:{startOf:"hour",period:3*60*1e3},5:{startOf:"hour",period:5*60*1e3},15:{startOf:"hour",period:15*60*1e3},30:{startOf:"hour",period:30*60*1e3},60:{startOf:"hour",period:0},120:{startOf:"day",period:2*60*60*1e3},240:{startOf:"day",period:4*60*60*1e3},480:{startOf:"day",period:8*60*60*1e3},720:{startOf:"day",period:12*60*60*1e3},D:{startOf:"day",period:0},"1D":{startOf:"day",period:0},"3D":{startOf:"year",period:3*24*60*60*1e3},"5D":{startOf:"year",period:5*24*60*60*1e3},"1W":{startOf:"week",period:0},"1M":{startOf:"month",period:0}};function Ni(e,i,r,s){let{startOf:o,period:a}=vr[r],n=new Date(e.updated_time).getTime(),l=so(n).getTime();o==="minute"?l=io(n).getTime():o==="hour"?l=ro(n).getTime():o==="day"?l=us(n).getTime():o==="month"?l=hi(n).getTime():o==="year"?l=cs(n).getTime():o==="week"?l=hs(n).getTime():o==="month"&&(l=hi(n).getTime());let d=a===0?l:Math.floor((n-l)/a)*a+l;i[d]||(i[d]={BUY:[],SELL:[]}),i[d][e.side].length<5&&(i[d][e.side].push(e),s.push(e))}var Va=(e,i)=>{let r=[],s={};return vr[i]?(e.forEach(o=>{if(o.child_orders)for(let a of o.child_orders)a.is_activated&&a.algo_status===ae.FILLED&&Ni(a,s,i,r);else Ni(o,s,i,r)}),r):[]},Ba=class jr{constructor(i,r){this.interval="1D",this.changeInterval=s=>{let o=()=>{this.renderExecutions(this.filledOrders,this.basePriceDecimal),this.instance.activeChart().onDataLoaded().unsubscribe(null,o)};this.interval=s,this.instance.activeChart().onDataLoaded().subscribe(null,o)},this.instance=i,this.executions=[],this.filledOrders=[],this.basePriceDecimal=0,this.broker=r,this.subscribeIntervalChange()}async subscribeIntervalChange(){this.interval=this.instance.symbolInterval().interval;let i=this.changeInterval;this.instance.activeChart().onIntervalChanged().subscribe(null,i)}renderExecutions(i,r){this.filledOrders=i,this.basePriceDecimal=r,this.interval&&(this.removeAll(),Va(i,this.interval).forEach(s=>{this.executions.push(this.drawExecution(s,r))}))}removeAll(){this.executions.forEach(i=>i.remove()),this.executions=[]}static getExecutionInfo(i,r){var n,l;let s=i.side,o=i.average_executed_price||((l=(n=i.child_orders)==null?void 0:n.find(d=>!!d.average_executed_price))==null?void 0:l.average_executed_price)||0,a=new L(o).todp(r,L.ROUND_FLOOR).toString();return`${s==="BUY"?re.t("common.buy"):re.t("common.sell")} ${i.total_executed_quantity} @${Ue(a)}`}drawExecution(i,r){var l,d;let s=i.side,o=i.average_executed_price||((d=(l=i.child_orders)==null?void 0:l.find(c=>!!c.average_executed_price))==null?void 0:d.average_executed_price)||0,a=new Date(i.updated_time).getTime()/1e3,n=this.broker.colorConfig;return this.instance.activeChart().createExecutionShape().setArrowHeight(9).setTooltip(jr.getExecutionInfo(i,r)).setTime(a).setPrice(o).setArrowColor(s==="BUY"?n.upColor:n.downColor).setDirection(s==="BUY"?"buy":"sell")}unsubscribeIntervalChange(){let i=this.changeInterval;try{this.instance.activeChart().onIntervalChanged().unsubscribe(null,i)}catch(r){r instanceof Error&&r.message}}destroy(){this.removeAll(),this.unsubscribeIntervalChange()}},Ha=class{constructor(e,i,r){this.instance=e,this.positionLineService=new Aa(e,r),this.orderLineService=new $a(e,r),this.executionService=new Ba(e,r)}async renderPositions(e){await this.chartReady(),await this.onDataLoaded(),this.positionLineService.renderPositions(e),this.orderLineService.updatePositions(e)}async renderPendingOrders(e){await this.chartReady(),this.orderLineService.renderPendingOrders(e)}async renderFilledOrders(e,i){await this.chartReady(),await this.onDataLoaded(),this.executionService.renderExecutions(e,i)}remove(){this.orderLineService.removeAll(),this.positionLineService.removePositions(),this.executionService.destroy()}onDataLoaded(){return this.instance.activeChart().symbolExt()?Promise.resolve():new Promise(e=>this.instance.activeChart().onDataLoaded().subscribe(null,()=>{e()},!0))}chartReady(){return new Promise(e=>this.instance.onChartReady(()=>{try{this.instance.activeChart().dataReady(()=>e())}catch(i){i.toString().includes("tradingViewApi")}}))}};function qa(e,i){var C;let[r,s]=u.useState(),o=u.useRef(),{state:a}=ue(),[n]=A("unPnlPriceBasis","markPrice"),[{rows:l},d]=ct(e,{calcMode:n}),[c]=Oe({status:ae.INCOMPLETE,symbol:e}),m=(C=Ke())==null?void 0:C[e],h=m("quote_dp"),[x]=Oe({symbol:e,status:ae.FILLED,size:500}),y=u.useRef((j,w,k)=>{o.current&&o.current.remove(),o.current=new Ha(j,w,k),s(o.current)}),f=u.useRef(()=>{var j;(j=o.current)==null||j.remove(),o.current=void 0});return u.useEffect(()=>{if(a.status<U.EnableTrading&&a.status!==U.EnableTradingWithoutConnected){r==null||r.renderPositions([]);return}if(!i||!i.position){r==null||r.renderPositions([]);return}let j=(l??[]).filter(w=>w.symbol===e).map(w=>({symbol:w.symbol,open:w.average_open_price,balance:w.position_qty,closablePosition:9999,unrealPnl:w.unrealized_pnl??0,interest:0,unrealPnlDecimal:2,basePriceDecimal:4}));r==null||r.renderPositions(j)},[r,l,e,i,a]),u.useEffect(()=>{if(!i||!i.buySell){r==null||r.renderFilledOrders([],6);return}let j=x==null?void 0:x.filter(w=>w.symbol===e);r==null||r.renderFilledOrders(j??[],h??6)},[r,x,e,h,i]),u.useEffect(()=>{let j=[],w=[],k=[],N=[],v=[];if(a.status<U.EnableTrading&&a.status!==U.EnableTradingWithoutConnected){r==null||r.renderPendingOrders([]);return}let T=(l??[]).find(M=>M.symbol===e);c==null||c.forEach(M=>{if(e===M.symbol){if(!M.algo_order_id)k.push(M);else if(M.algo_order_id)if(M.algo_type==="POSITIONAL_TP_SL")for(let R of M.child_orders)R.root_algo_order_algo_type=M.algo_type,R.trigger_price&&R.status!==ae.FILLED&&w.push(R);else if(M.algo_type==="TP_SL"){if(T)for(let R of M.child_orders)R.root_algo_order_algo_type=M.algo_type,R.position_qty=T.position_qty,R.trigger_price&&R.status!==ae.FILLED&&j.push(R)}else M.algo_type==="STOP_LOSS"||M.algo_type==="TAKE_PROFIT"?N.push(M):M.algo_type==="BRACKET"&&v.push(M)}}),i&&(i.positionTpsl||(w=[]),i.tpsl||(j=[]),i.limitOrders||(k=[],v=[]),i.stopOrders||(N=[])),r==null||r.renderPendingOrders(j.concat(w).concat(k).concat(N).concat(v))},[r,c,e,i,l,a.status]),[y.current,f.current]}function Fa(e){e.setBrokerConnectionAdapter=function(i){let r={subscribe:()=>{},unsubscribe:()=>{},unsubscribeAll:()=>{}};Object.defineProperty(i,"_ordersCache",{get:function(){return{start:()=>{},stop:()=>{},update:()=>{},partialUpdate:()=>{},fullUpdate:()=>{},getObjects:async()=>[],updateDelegate:r,partialUpdateDelegate:r}},set:()=>{}}),i._waitForOrderModification=async()=>!0,this._adapter=i}}function Ua(e,i){e.onChartReady(()=>{i.silentOrdersPlacement().subscribe(r=>{var s;r||(i.silentOrdersPlacement().setValue(!0),e&&(e._iFrame.contentDocument.querySelector(".wrapper-3X2QgaDd").className="wrapper-3X2QgaDd highButtons-3X2QgaDd"),(s=i.sellBuyButtonsVisibility())==null||s.setValue(!1))})})}function Wa(e,i){Fa(i),Ua(e,i)}var Qa=(e,i)=>new Promise(r=>{let s=e.querySelector(i);s&&r(s);let o=new MutationObserver(()=>{let a=e.querySelector(i);a&&(r(a),o.disconnect())});o.observe(e,{childList:!0,subtree:!0})}),Ka=class{constructor({iframeDocument:e}){this.iframeDocument=e}defaultHack(){this.showFavoriteStarByDefault()}showFavoriteStarByDefault(){Qa(this.iframeDocument,".dropdown-2R6OKuTS").then(()=>{this.iframeDocument.querySelectorAll(".toolbox-2IihgTnv.showOnHover-2IihgTnv").forEach(e=>{e.style.opacity="1"})})}},Ya=e=>{let i=["header_symbol_search","volume_force_overlay","trading_account_manager","drawing_templates","open_account_manager","right_toolbar","support_multicharts","header_layouttoggle","order_panel","order_info","trading_notifications","display_market_status","broker_button","add_to_watchlist","chart_crosshair_menu","header_fullscreen_button","header_widget"];return e===3&&(i=[...i,"left_toolbar","timeframes_toolbar","go_to_date","timezone_menu","create_volume_indicator_by_default","buy_sell_buttons"]),e===0?i=[...i,"header_widget","left_toolbar","timeframes_toolbar","buy_sell_buttons"]:e===1&&(i=[...i,"left_toolbar","timeframes_toolbar","buy_sell_buttons"]),i};function Za(e,i){return{...e,disabled_features:Ya(i),enabled_features:["hide_left_toolbar_by_default","order_panel_close_button","iframe_loading_compatibility_mode"],auto_save_delay:.1,broker_config:{configFlags:{supportStopLimitOrders:!0,supportReversePosition:!1}}}}var si=e=>`${e}_adapter`,Ft={"trading.chart.proterty":JSON.stringify({showSellBuyButtons:0,noConfirmEnabled:1,qweqrq:0,showPricesWithZeroVolume:1,showSpread:1,orderExecutedSoundParams:'{"enabled":0,"name":"alert/alarm_clock"}'}),"hint.startFocusedZoom":"true"},Pe=new Map,Xa=(e,i,r)=>{let s=si(e);try{let o=i,a=o?JSON.parse(o):void 0,n=r?JSON.parse(r):Ft;return o&&Pe.set(e,o),r&&Pe.set(s,r),{savedData:a,adapterSetting:n}}catch{}return{savedData:void 0,adapterSetting:Ft}},Ga=async(e,i)=>{let r=si(e),s=localStorage.getItem(e)||"",o=localStorage.getItem(r)||"";try{if(Pe.has(e)&&Pe.has(r))return{savedData:JSON.parse(Pe.get(e)),adapterSetting:JSON.parse(Pe.get(r))}}catch{}return Xa(e,s,o)},Ja=async(e,i,r)=>{i&&(localStorage.setItem(e,i),Pe.set(e,i))},en=async(e,i,r)=>{let s=si(e);i&&(localStorage.setItem(s,i),Pe.set(s,i))},Si=(e,i)=>{let r=null,s=(...o)=>{r&&window.clearTimeout(r),r=setTimeout(()=>{e(...o)},i)};return s.cancel=()=>{r&&window.clearTimeout(r),r=null},s},tn="chartProp_default",ki=300,rn=class{constructor(i){this._instance=null,this._onClick=null,this._datafeed=null,this._chartKey=tn,this._adapterSetting=Ft,this._savedData=null,this._isLoggedIn=!1,this.debounceSaveChart=Si(()=>{var r;try{(r=this._instance)==null||r.save(s=>{Object.is(this._savedData,s)||(this._savedData=s,Ja(this._chartKey,JSON.stringify(s),this._isLoggedIn))})}catch{}},ki*2),this.debounceSaveChartAdapterSetting=Si(()=>{en(this._chartKey,JSON.stringify(this._adapterSetting),this._isLoggedIn)},ki),this._create(i)}remove(){var i,r,s;this.unsubscribeClick(),(i=this._datafeed)==null||i.remove(),(r=this._broker)==null||r.remove(),(s=this._instance)==null||s.remove(),this.debounceSaveChart.cancel(),this.debounceSaveChartAdapterSetting.cancel()}updateOverrides(i){this.instance&&this.instance.applyOverrides(i)}setSymbol(i,r,s){var o;try{(o=this._instance)==null||o.onChartReady(()=>{var n,l,d;let a=r??((l=(n=this._instance)==null?void 0:n.symbolInterval())==null?void 0:l.interval);a||(a=1),(d=this._instance)==null||d.setSymbol(i,a,s)})}catch{}}executeActionById(i){var r;try{(r=this._instance)==null||r.onChartReady(()=>{var s;(s=this._instance)==null||s.activeChart().executeActionById(i)})}catch{}}changeLineType(i){var r;try{(r=this._instance)==null||r.onChartReady(()=>{var s;(s=this._instance)==null||s.activeChart().setChartType(i)})}catch{}}subscribeClick(i){var r;this._onClick=i,(r=this._instance)==null||r.onChartReady(()=>{var s,o;(o=(s=this._instance)==null?void 0:s._iFrame.contentDocument)==null||o.addEventListener("click",this._onClick)})}unsubscribeClick(){var i,r;(r=(i=this._instance)==null?void 0:i._iFrame.contentDocument)==null||r.removeEventListener("click",this._onClick)}get instance(){return this._instance}chartHack(){var i;(i=this._instance)==null||i.onChartReady(()=>{let r=this._instance._iFrame.contentWindow.document;new Ka({iframeDocument:r}).defaultHack()})}subscribeAutoSave(){var i;(i=this._instance)==null||i.onChartReady(()=>{var r,s;(r=this._instance)==null||r.subscribe("onAutoSaveNeeded",()=>{this.debounceSaveChart()}),(s=this._instance)==null||s.activeChart().onVisibleRangeChanged().subscribe(null,()=>{this.debounceSaveChart()})})}async _create({options:i,chartKey:r,mode:s,onClick:o}){let a=i.getBroker,n={fullscreen:i.fullscreen??!0,autosize:i.autosize??!1,timezone:i.timezone,symbol:i.symbol,library_path:i.libraryPath,interval:i.interval??"1",custom_css_url:i.customCssUrl,custom_font_family:i.customFontFamily,datafeed:i.datafeed,studies_overrides:i.studiesOverrides,locale:i.locale,theme:i.theme,loading_screen:i.loadingScreen,overrides:i.overrides,container:i.container,favorites:{intervals:["1","3","5","15","30","60","240","1D","1W","1M"],chartTypes:["Area","Line"]},broker_factory:a?c=>(this._broker&&this._broker.remove(),this._broker=a(this._instance,c),this._broker):void 0};this._datafeed=i.datafeed,r&&(this._chartKey=r);let{savedData:l,adapterSetting:d}=await Ga(this._chartKey,this._isLoggedIn);this._adapterSetting=d,this._savedData=l,this._instance=new TradingView.widget({...Za(n,s),interval:d["chart.lastUsedTimeBasedResolution"]??n.interval,saved_data:l,settings_adapter:{initialSettings:d,setValue:(c,m)=>{this._adapterSetting={...this._adapterSetting,[c]:m},this.debounceSaveChartAdapterSetting()},removeValue:()=>{}}}),this._instance.onChartReady(()=>{var c;i.symbol&&((c=this._instance)==null?void 0:c.activeChart().symbol())!==je(i.symbol)&&this.setSymbol(i.symbol)}),this.subscribeAutoSave(),this.subscribeClick(o),this.chartHack()}},sn="SDK_Tradingview",on="SDK_Moblie_Tradingview",an=e=>e?on:sn,nn=e=>e==="id"?"id_ID":e;function ln(e){let{scriptSRC:i,libraryPath:r,customCssUrl:s,overrides:o,studiesOverrides:a,symbol:n,theme:l,loadingScreen:d,mode:c,colorConfig:m,locale:h=nn,classNames:x}=e,y=ls(),f=u.useRef(),C=kt("apiBaseUrl"),{state:j}=ue(),[w,k]=u.useState(B.SELL),N=Ke(),[v,T]=A(Bi,!1),{onSubmit:M,submitting:R}=Hi({symbol:n??"",side:w,order_type:S.MARKET},{watchOrderbook:!0}),[V,X]=u.useState(()=>{let P=localStorage.getItem(Ve.displayControlSetting);return P?JSON.parse(P):{position:!0,buySell:!0,limitOrders:!0,stopOrders:!0,tpsl:!0,positionTpsl:!0}}),[G,Q]=u.useState(()=>localStorage.getItem(Ve.interval)||"15"),[q,se]=u.useState(()=>localStorage.getItem(Ve.lineType)||"1"),oe=Fe(ei),ce=u.useMemo(()=>Object.assign({},ua,m??{}),[m]),we=u.useMemo(()=>typeof d=="object"?d:{backgroundColor:cr},[d]),he=ds(),[me,_e]=u.useState(!1),Ne=P=>{let D=N[n];if(!D)return;let ve=new L(P.balance).greaterThan(0)?B.SELL:B.BUY,Se={order_quantity:new L(P.balance).abs().toNumber(),symbol:n,order_type:S.MARKET,side:ve,reduce_only:!0};k(ve),W.show("MarketCloseConfirmID",{base:D("base"),quantity:P.balance,onConfirm:async()=>M(Se).catch(Me=>{typeof Me=="string"?Z.error(Me):Z.error(Me.message)}),submitting:R})},I=u.useRef(null),$=u.useMemo(()=>!(j.status<U.EnableTrading&&j.status!==U.EnableTradingWithoutConnected),[j]),pe=Da({closeConfirm:Ne,colorConfig:ce,onToast:Z,symbol:n??"",mode:c}),[Ae,Je]=qa(n,V),et=()=>{var P;T(!v),(P=e.onFullScreenChange)==null||P.call(e,!v)},ye=P=>{f.current&&(localStorage.setItem(Ve.interval,P),Q(P),f.current.setSymbol(n,P))},ze=P=>{f.current&&(localStorage.setItem(Ve.lineType,P),se(P),f.current.changeLineType(Number(P)))},O=P=>{localStorage.setItem(Ve.displayControlSetting,JSON.stringify(P)),X(P)},z=()=>{f.current&&f.current.executeActionById("chartProperties")},te=()=>{f.current&&f.current.executeActionById("insertIndicator")};return u.useEffect(()=>{if(i&&I.current&&!me){let P=document.createElement("script");P.setAttribute("data-nscript","afterInteractive"),P.src=i,P.async=!0,P.type="text/javascript",P.onload=()=>{_e(!0)},P.onerror=()=>{},I.current.appendChild(P)}},[I,me,i]),u.useEffect(()=>{if(!n||!me||!i)return;let P=ca(ce,oe),D=o?Object.assign({},P.overrides,o):P.overrides,ve=a?Object.assign({},P.studiesOverrides,a):P.studiesOverrides;if(I.current){let Se={options:{fullscreen:!1,autosize:!0,symbol:hr(n),locale:typeof h=="function"?h(y):h,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,container:I.current,libraryPath:r,customCssUrl:s,interval:G??"1",theme:l??"dark",loadingScreen:we??{},overrides:D,studiesOverrides:ve,datafeed:new ja(C,he),contextMenu:{items_processor:async Me=>Me},getBroker:(Me,ui)=>(Wa(Me,ui),ma(ui,pe))},chartKey:an(oe),mode:c,onClick:()=>{}};f.current=new rn(Se)}return()=>{var Se;(Se=f.current)==null||Se.remove()}},[me,oe,c,f,I,me,i,ce,h,y]),u.useEffect(()=>{he.on("status:change",P=>{var D,ve;!P.isPrivate&&P.isReconnect&&typeof window.onResetCacheNeededCallback=="function"&&(window.onResetCacheNeededCallback(),(ve=(D=f.current)==null?void 0:D.instance.activeChart())==null||ve.resetData())},"tradingview")},[he]),u.useEffect(()=>(f.current&&f.current.instance&&f.current.instance.onChartReady(()=>{$&&f.current.instance&&Ae(f.current.instance,void 0,pe)}),()=>{Je()}),[f.current,$]),u.useEffect(()=>{var D;if(!n||!f.current)return;(D=f.current)==null||D.setSymbol(n);let P=new mr(he);return P.subscribeSymbol(n),()=>{P.unsubscribeKline(n)}},[n]),{tradingViewScriptSrc:i,chartRef:I,changeDisplaySetting:O,displayControlState:V,interval:G,changeInterval:ye,lineType:q,changeLineType:ze,openChartSetting:z,openChartIndicators:te,symbol:n,onFullScreenChange:et,classNames:x,fullscreen:v}}var oi=e=>t.jsx("svg",{viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Caret-down",children:t.jsx("path",{id:"Vector",d:"M3.00349 3.9978C2.59149 3.9978 2.36564 4.4653 2.61289 4.7948C2.98789 5.2948 5.23784 8.29479 5.61289 8.79479C5.81289 9.06128 6.20974 9.06128 6.40974 8.79479L9.40974 4.7948C9.65694 4.4653 9.41554 3.9978 9.00349 3.9978H3.00349Z"})})}),Cr=e=>t.jsx("svg",{viewBox:"0 0 18 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Display settings",children:t.jsx("path",{id:"Union",fillRule:"evenodd",clipRule:"evenodd",d:"M15.0571 10.9856L11.6295 5.06523L8.71377 10.8968C8.38933 11.5456 7.54464 11.7223 6.98733 11.2579L5.75311 10.2294L2.83709 14.7654L1.57532 13.9543L4.49134 9.41824C4.97892 8.65978 6.0207 8.49981 6.71338 9.07705L7.58387 9.80246L10.5991 3.77192C10.9997 2.97082 12.1302 2.93624 12.579 3.71137L14.6517 7.29147C14.7714 7.03643 15.0305 6.85983 15.3309 6.85983C15.7451 6.85983 16.0809 7.19562 16.0809 7.60983C16.0809 8.02405 15.7451 8.35983 15.3309 8.35983C15.31 8.35983 15.2892 8.35897 15.2687 8.35729L16.3553 10.2341L15.0571 10.9856ZM2.58093 6.85983C2.16672 6.85983 1.83093 7.19562 1.83093 7.60983C1.83093 8.02405 2.16672 8.35983 2.58093 8.35983C2.99515 8.35983 3.33093 8.02405 3.33093 7.60983C3.33093 7.19562 2.99515 6.85983 2.58093 6.85983ZM4.83093 6.85983C4.41672 6.85983 4.08093 7.19562 4.08093 7.60983C4.08093 8.02405 4.41672 8.35983 4.83093 8.35983C5.24515 8.35983 5.58093 8.02405 5.58093 7.60983C5.58093 7.19562 5.24515 6.85983 4.83093 6.85983ZM6.33093 7.60983C6.33093 7.19562 6.66672 6.85983 7.08093 6.85983C7.49515 6.85983 7.83093 7.19562 7.83093 7.60983C7.83093 8.02405 7.49515 8.35983 7.08093 8.35983C6.66672 8.35983 6.33093 8.02405 6.33093 7.60983ZM11.5809 6.85983C11.1667 6.85983 10.8309 7.19562 10.8309 7.60983C10.8309 8.02405 11.1667 8.35983 11.5809 8.35983C11.9951 8.35983 12.3309 8.02405 12.3309 7.60983C12.3309 7.19562 11.9951 6.85983 11.5809 6.85983Z"})})}),dn=e=>t.jsx("svg",{viewBox:"0 0 18 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Indicators",children:t.jsx("path",{id:"Union",fillRule:"evenodd",clipRule:"evenodd",d:"M9.74483 2.25C8.96145 2.25 8.26885 2.76459 8.04549 3.51818L7.46202 5.48254H5.06262V7.08339H6.98652L5.00539 13.7532L4.31554 13.1112L3.22498 14.2831L4.4777 15.4489C5.08739 16.015 6.08317 15.7469 6.32134 14.945L8.65649 7.08339H11.6032V5.48254H9.13198L9.58033 3.97311C9.60167 3.90112 9.66833 3.85084 9.74483 3.85084H11.69V2.25H9.74483ZM10.6234 11.2354L10.2638 11.5172C10.0153 11.712 9.65591 11.6684 9.46115 11.4199C9.26639 11.1713 9.30998 10.812 9.55852 10.6172L10.1451 10.1575C10.5693 9.82514 11.1868 9.94011 11.4642 10.4005L11.4682 10.407L12.1304 11.5752L13.4594 10.3111C13.6882 10.0935 14.05 10.1025 14.2677 10.3313C14.4853 10.5601 14.4763 10.922 14.2475 11.1396L12.7116 12.6006L13.3897 13.797L13.6482 13.4503C13.8369 13.1972 14.1951 13.145 14.4483 13.3337C14.7014 13.5225 14.7536 13.8807 14.5649 14.1338L13.9917 14.9025L13.94 14.9457C13.5178 15.2981 12.8837 15.1886 12.6003 14.7226L12.5958 14.7151L11.8576 13.4129L10.3563 14.841C10.1275 15.0586 9.76561 15.0495 9.54798 14.8208C9.33036 14.592 9.3394 14.2301 9.56819 14.0125L11.2764 12.3875L10.6234 11.2354Z"})})}),un=e=>t.jsx("svg",{viewBox:"0 0 18 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Setting",children:t.jsx("path",{id:"Vector",d:"M6.72589 1.84154C5.66239 2.17904 4.74515 2.72954 3.93665 3.48254C3.6869 3.71504 3.6104 4.09604 3.7724 4.39604C4.37315 5.50679 3.74464 6.69554 2.38939 6.76379C2.05789 6.78029 1.76465 7.0263 1.68665 7.34955C1.5524 7.9083 1.49915 8.37629 1.49915 8.98979C1.49915 9.50504 1.55464 10.0885 1.66339 10.6075C1.73089 10.9315 2.0129 11.1648 2.3429 11.1933C3.7064 11.311 4.3814 12.3513 3.7724 13.6773C3.6374 13.972 3.6989 14.3245 3.93665 14.545C4.73315 15.2815 5.64814 15.8013 6.72589 16.1388C7.03339 16.2348 7.38064 16.1185 7.56964 15.8575C8.40364 14.7033 9.6134 14.6995 10.4054 15.8575C10.5921 16.1298 10.9341 16.261 11.2491 16.162C12.2894 15.8343 13.2584 15.277 14.0616 14.545C14.3091 14.3193 14.3744 13.954 14.2259 13.654C13.6019 12.3948 14.3197 11.239 15.6082 11.2165C15.9502 11.2105 16.2547 10.9863 16.3349 10.654C16.4647 10.1163 16.4991 9.64829 16.4991 8.98979C16.4991 8.42429 16.4324 7.86704 16.3116 7.32629C16.2351 6.98354 15.9359 6.74054 15.5849 6.73979C14.3167 6.73754 13.6056 5.49104 14.2259 4.39604C14.3984 4.09154 14.3444 3.71804 14.0849 3.48254C13.2674 2.74004 12.2706 2.15954 11.2259 1.84154C10.9049 1.74404 10.5636 1.86404 10.3821 2.14604C9.65764 3.27179 8.30465 3.29129 7.5929 2.17004C7.41065 1.88204 7.04989 1.73879 6.72589 1.84154ZM11.2844 3.43455C11.7966 3.64905 12.2009 3.8733 12.6651 4.22505C12.1206 5.9478 13.0439 7.73729 14.9564 8.17304C15.0036 8.48279 14.9991 8.67029 14.9991 8.98979C14.9991 9.37154 15.0044 9.50579 14.9609 9.78179C13.0566 10.1763 12.1146 11.9155 12.6449 13.7538C12.1889 14.0845 11.8626 14.314 11.2904 14.5353C9.94639 13.1673 8.0804 13.1073 6.7079 14.5443C6.1724 14.3088 5.76066 14.0995 5.34441 13.7478C5.86041 11.881 4.98815 10.2693 3.05165 9.7803C2.9654 9.4383 2.9999 8.4723 3.0494 8.17905C5.0519 7.69905 5.8409 5.92679 5.34365 4.21979C5.78315 3.88904 6.1784 3.6483 6.69215 3.4398C7.9859 4.75605 9.92839 4.8873 11.2844 3.43455ZM8.99915 5.98979C7.3424 5.98979 5.99915 7.33304 5.99915 8.98979C5.99915 10.6473 7.3424 11.9898 8.99915 11.9898C10.6559 11.9898 11.9991 10.6473 11.9991 8.98979C11.9991 7.33304 10.6559 5.98979 8.99915 5.98979ZM8.99915 7.48979C9.8279 7.48979 10.4991 8.16179 10.4991 8.98979C10.4991 9.81855 9.8279 10.4898 8.99915 10.4898C8.1704 10.4898 7.49915 9.81855 7.49915 8.98979C7.49915 8.16179 8.1704 7.48979 8.99915 7.48979Z"})})}),cn=e=>t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Bars",children:t.jsx("path",{id:"Union",fillRule:"evenodd",clipRule:"evenodd",d:"M12.5 15.5C12.5 15.7761 12.7239 16 13 16H14C14.2761 16 14.5 15.7761 14.5 15.5V14H16C16.2761 14 16.5 13.7761 16.5 13.5V12.5C16.5 12.2239 16.2761 12 16 12H14.5V2.5C14.5 2.22386 14.2761 2 14 2H13C12.7239 2 12.5 2.22386 12.5 2.5V4H11C10.7239 4 10.5 4.22386 10.5 4.5V5.5C10.5 5.77614 10.7239 6 11 6H12.5V15.5ZM5.5 17.5C5.5 17.7761 5.72386 18 6 18H7C7.27614 18 7.5 17.7761 7.5 17.5V10H9C9.27614 10 9.5 9.77614 9.5 9.5V8.5C9.5 8.22386 9.27614 8 9 8H7.5V4.5C7.5 4.22386 7.27614 4 7 4H6C5.72386 4 5.5 4.22386 5.5 4.5V14H4C3.72386 14 3.5 14.2239 3.5 14.5V15.5C3.5 15.7761 3.72386 16 4 16H5.5V17.5Z"})})}),hn=e=>t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Candles",children:t.jsx("path",{id:"Union",fillRule:"evenodd",clipRule:"evenodd",d:"M7.25 2.5V4H8.5C8.77614 4 9 4.22386 9 4.5V15.5C9 15.7761 8.77614 16 8.5 16H7.25V17.5C7.25 17.7761 7.02614 18 6.75 18H6.25C5.97386 18 5.75 17.7761 5.75 17.5V16H4.5C4.22386 16 4 15.7761 4 15.5V4.5C4 4.22386 4.22386 4 4.5 4H5.75V2.5C5.75 2.22386 5.97386 2 6.25 2H6.75C7.02614 2 7.25 2.22386 7.25 2.5ZM5.5 5.5V14.5H7.5V5.5H5.5ZM14.25 4.5V7H15.5C15.7761 7 16 7.22386 16 7.5V15.5C16 15.7761 15.7761 16 15.5 16H14.25V17.5C14.25 17.7761 14.0261 18 13.75 18H13.25C12.9739 18 12.75 17.7761 12.75 17.5V16H11.5C11.2239 16 11 15.7761 11 15.5V7.5C11 7.22386 11.2239 7 11.5 7H12.75V4.5C12.75 4.22386 12.9739 4 13.25 4H13.75C14.0261 4 14.25 4.22386 14.25 4.5ZM12.5 8.5V14.5H14.5V8.5H12.5Z"})})}),mn=e=>t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsxs("g",{id:"Hollow Candles",children:[t.jsx("path",{id:"Subtract",fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 14.5V5.5H7.5V14.5H5.5Z",fill:"white",fillOpacity:"0.12"}),t.jsx("path",{id:"Union",fillRule:"evenodd",clipRule:"evenodd",d:"M7.25 2.5V4H8.5C8.77614 4 9 4.22386 9 4.5V15.5C9 15.7761 8.77614 16 8.5 16H7.25V17.5C7.25 17.7761 7.02614 18 6.75 18H6.25C5.97386 18 5.75 17.7761 5.75 17.5V16H4.5C4.22386 16 4 15.7761 4 15.5V4.5C4 4.22386 4.22386 4 4.5 4H5.75V2.5C5.75 2.22386 5.97386 2 6.25 2H6.75C7.02614 2 7.25 2.22386 7.25 2.5ZM5.5 5.5V14.5H7.5V5.5H5.5ZM14.25 4.5V7H15.5C15.7761 7 16 7.22386 16 7.5V15.5C16 15.7761 15.7761 16 15.5 16H14.25V17.5C14.25 17.7761 14.0261 18 13.75 18H13.25C12.9739 18 12.75 17.7761 12.75 17.5V16H11.5C11.2239 16 11 15.7761 11 15.5V7.5C11 7.22386 11.2239 7 11.5 7H12.75V4.5C12.75 4.22386 12.9739 4 13.25 4H13.75C14.0261 4 14.25 4.22386 14.25 4.5ZM12.5 8.5V14.5H14.5V8.5H12.5Z"})]})}),pn=e=>t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Line",children:t.jsx("path",{id:"Vector 16 (Stroke)",fillRule:"evenodd",clipRule:"evenodd",d:"M18.3 2.72288C18.542 2.85596 18.6303 3.15999 18.4972 3.40195L13.495 12.4968C13.0776 13.2557 12.1061 13.5044 11.3754 13.0394L7.19878 10.3816L2.97738 17.558C2.83737 17.796 2.53092 17.8754 2.2929 17.7354L1.43097 17.2284C1.19295 17.0884 1.1135 16.7819 1.25351 16.5439L5.73746 8.92122C6.16792 8.18943 7.1194 7.96045 7.83567 8.41626L11.9995 11.0659L16.7448 2.43811C16.8778 2.19615 17.1819 2.10788 17.4238 2.24096L18.3 2.72288Z"})})}),gn=e=>t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsxs("g",{id:"Area",children:[t.jsx("path",{id:"Vector 16 (Stroke)",fillRule:"evenodd",clipRule:"evenodd",d:"M18.3 2.72288C18.542 2.85596 18.6303 3.15999 18.4972 3.40195L13.495 12.4968C13.0776 13.2557 12.1061 13.5044 11.3754 13.0394L7.19878 10.3816L2.97738 17.558C2.83737 17.796 2.53092 17.8754 2.2929 17.7354L1.43097 17.2284C1.19295 17.0884 1.1135 16.7819 1.25351 16.5439L5.73746 8.92122C6.16792 8.18943 7.1194 7.96045 7.83567 8.41626L11.9995 11.0659L16.7448 2.43811C16.8778 2.19615 17.1819 2.10788 17.4238 2.24096L18.3 2.72288Z"}),t.jsx("path",{id:"Subtract",fillRule:"evenodd",clipRule:"evenodd",d:"M2.7608 17.7562C2.84602 17.899 3.00106 18 3.19016 18H16.362C17.4665 18 18.362 17.1046 18.362 16V3.94663C18.362 3.86618 18.3453 3.79397 18.3162 3.73108L13.495 12.4968C13.0776 13.2557 12.1061 13.5044 11.3754 13.0394L7.19881 10.3816L2.9774 17.558C2.92465 17.6477 2.84826 17.7148 2.7608 17.7562Z",fill:"white",fillOpacity:"0.12"})]})}),xn=e=>t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Baseline",children:t.jsx("path",{id:"Union",fillRule:"evenodd",clipRule:"evenodd",d:"M6.05938 2.93544C6.55642 1.71198 8.27766 1.68139 8.81785 2.88642L11.4361 8.72723H9.24438L7.4717 4.77279L5.86521 8.72723H3.70647L6.05938 2.93544ZM13.9282 14.2865L13.0051 12.2272H10.8133L12.5586 16.1204C13.088 17.3014 14.7641 17.3026 15.2952 16.1224L17.048 12.2272H14.8549L13.9282 14.2865ZM2.28459 12.2272H4.44333L1.85293 18.6036L0 17.8509L2.28459 12.2272ZM16.4299 8.72723H18.623L19.3384 7.13759L17.5145 6.31686L16.4299 8.72723ZM1.42645 10.2272C1.42645 9.95109 1.65031 9.72723 1.92645 9.72723H2.92645C3.20259 9.72723 3.42645 9.95109 3.42645 10.2272V10.7272C3.42645 11.0034 3.20259 11.2272 2.92645 11.2272H1.92645C1.65031 11.2272 1.42645 11.0034 1.42645 10.7272V10.2272ZM4.42645 10.2272C4.42645 9.95109 4.65031 9.72723 4.92645 9.72723H5.92645C6.20259 9.72723 6.42645 9.95109 6.42645 10.2272V10.7272C6.42645 11.0034 6.20259 11.2272 5.92645 11.2272H4.92645C4.65031 11.2272 4.42645 11.0034 4.42645 10.7272V10.2272ZM7.92645 9.72723C7.65031 9.72723 7.42645 9.95109 7.42645 10.2272V10.7272C7.42645 11.0034 7.65031 11.2272 7.92645 11.2272H8.92645C9.20259 11.2272 9.42645 11.0034 9.42645 10.7272V10.2272C9.42645 9.95109 9.20259 9.72723 8.92645 9.72723H7.92645ZM10.4265 10.2272C10.4265 9.95109 10.6503 9.72723 10.9265 9.72723H11.9265C12.2026 9.72723 12.4265 9.95109 12.4265 10.2272V10.7272C12.4265 11.0034 12.2026 11.2272 11.9265 11.2272H10.9265C10.6503 11.2272 10.4265 11.0034 10.4265 10.7272V10.2272ZM13.9265 9.72723C13.6503 9.72723 13.4265 9.95109 13.4265 10.2272V10.7272C13.4265 11.0034 13.6503 11.2272 13.9265 11.2272H14.9265C15.2026 11.2272 15.4265 11.0034 15.4265 10.7272V10.2272C15.4265 9.95109 15.2026 9.72723 14.9265 9.72723H13.9265ZM16.4265 10.2272C16.4265 9.95109 16.6503 9.72723 16.9265 9.72723H17.9265C18.2026 9.72723 18.4265 9.95109 18.4265 10.2272V10.7272C18.4265 11.0034 18.2026 11.2272 17.9265 11.2272H16.9265C16.6503 11.2272 16.4265 11.0034 16.4265 10.7272V10.2272Z"})})}),bn=e=>t.jsx("svg",{viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Unselected",children:t.jsx("path",{id:"Vector",d:"M6.00684 0.999023C3.24544 0.999023 1.00684 3.23752 1.00684 5.99902C1.00684 8.76051 3.24544 10.999 6.00684 10.999C8.76834 10.999 11.0068 8.76051 11.0068 5.99902C11.0068 3.23752 8.76834 0.999023 6.00684 0.999023ZM6.00684 1.99902C8.21584 1.99902 10.0068 3.79002 10.0068 5.99902C10.0068 8.20801 8.21584 9.99901 6.00684 9.99901C3.79769 9.99901 2.00684 8.20801 2.00684 5.99902C2.00684 3.79002 3.79769 1.99902 6.00684 1.99902Z",fill:"white",fillOpacity:"0.2"})})}),fn=e=>t.jsx("svg",{viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Selected-Multiple Choices-fill",children:t.jsx("path",{id:"Subtract",fillRule:"evenodd",clipRule:"evenodd",d:"M1.00684 5.99902C1.00684 3.23752 3.24544 0.999023 6.00684 0.999023C8.76834 0.999023 11.0068 3.23752 11.0068 5.99902C11.0068 8.76051 8.76834 10.999 6.00684 10.999C3.24544 10.999 1.00684 8.76051 1.00684 5.99902ZM8.49243 3.65563C8.60602 3.54726 8.76156 3.49957 8.91068 3.49957C9.05981 3.49957 9.21534 3.54726 9.32893 3.65563C9.5567 3.87231 9.5567 4.23649 9.32893 4.45317L5.25362 8.33706C5.02644 8.55374 4.6443 8.55374 4.41712 8.33706L2.67014 6.67253C2.44296 6.45585 2.44296 6.09161 2.67014 5.87499C2.89791 5.65831 3.28004 5.65831 3.50722 5.87499L4.83537 7.1407L8.49243 3.65563Z",fill:"#608CFF"})})});function yn({displayControlState:e,changeDisplayControlState:i}){let[r,s]=u.useState(!1),{t:o}=_(),a=u.useMemo(()=>[{label:o("common.position"),id:"position"},{label:o("tradingView.displayControl.buySell"),id:"buySell"},{label:o("tradingView.displayControl.limitOrders"),id:"limitOrders"},{label:o("tradingView.displayControl.stopOrders"),id:"stopOrders"},{label:o("common.tpsl"),id:"tpsl"},{label:o("tpsl.positionTpsl"),id:"positionTpsl"}],[o]);return t.jsx(t.Fragment,{children:t.jsxs(Ye,{open:r,onOpenChange:s,children:[t.jsx(Ze,{asChild:!0,children:t.jsxs(g,{justify:"start",itemAlign:"center",className:"oui-gap-[2px] oui-cursor-pointer oui-text-base-contrast-36  hover:oui-text-base-contrast-80",children:[t.jsx(Cr,{className:b("oui-w-[18px] oui-h-[18px] ",r&&"oui-text-base-contrast-80")}),t.jsx(oi,{className:b("oui-w-3 oui-h-3",r&&"oui-text-base-contrast-80 oui-rotate-180")})]})}),t.jsx(ht,{children:t.jsx(Xe,{onCloseAutoFocus:n=>n.preventDefault(),onClick:n=>n.stopPropagation(),align:"start",className:"oui-bg-base-8",children:t.jsx(g,{direction:"column",gap:4,px:5,py:5,width:240,justify:"start",itemAlign:"start",children:a.map(n=>t.jsxs(g,{justify:"between",itemAlign:"center",className:"oui-w-full",children:[t.jsx(p,{className:b("oui-text-sm oui-text-base-contrast-80",!e[n.id]&&"oui-text-base-contrast-36"),children:n.label}),t.jsx(Nt,{className:"oui-h-4 oui-w-8",checked:e[n.id],onCheckedChange:l=>{i({...e,[n.id]:l})}})]},n.id))})})})]})})}function vn(e){let[i,r]=u.useState(!1),{t:s}=_(),o=u.useMemo(()=>[[{label:s("common.position"),id:"position"},{label:s("tradingView.displayControl.limitOrders"),id:"limitOrders"}],[{label:s("tradingView.displayControl.stopOrders"),id:"stopOrders"},{label:s("common.tpsl"),id:"tpsl"}],[{label:s("tpsl.positionTpsl"),id:"positionTpsl"},{label:s("tradingView.displayControl.buySell"),id:"buySell"}]],[s]);return t.jsxs(Ye,{open:i,onOpenChange:r,children:[t.jsx(Ze,{asChild:!0,children:t.jsxs("div",{className:b("oui-flex oui-gap-0.5 oui-justify-center oui-text-base-contrast-36 oui-items-center",i&&"oui-text-base-contrast-8"),children:[t.jsx(Cr,{className:b("oui-w-[18px] oui-h-[18px] ",i&&"oui-text-base-contrast-80")}),t.jsx(oi,{className:b("oui-w-3 oui-h-3",i&&"oui-text-base-contrast-80 oui-rotate-180")})]})}),t.jsx(ht,{children:t.jsx(Xe,{onCloseAutoFocus:a=>a.preventDefault(),onClick:a=>a.stopPropagation(),align:"start",alignOffset:0,sideOffset:0,className:b("oui-tradingview-display-control-dropdown-menu-content oui-bg-base-9 oui-w-screen oui-flex oui-flex-col oui-gap-2 oui-p-3"),children:o.map((a,n)=>t.jsx("div",{className:"oui-flex oui-gap-2",children:a.map(l=>t.jsxs("div",{className:b("oui-w-full oui-bg-base-5  oui-text-2xs oui-flex oui-items-center oui-justify-between oui-h-6  oui-rounded oui-px-2",e.displayControlState[l.id]?"oui-text-base-contrast":"oui-text-base-contrast-36 "),onClick:()=>{e.changeDisplayControlState({...e.displayControlState,[l.id]:!e.displayControlState[l.id]})},children:[t.jsx("div",{children:l.label}),e.displayControlState[l.id]?t.jsx(fn,{className:"oui-h-3 oui-w-3"}):t.jsx(bn,{className:"oui-h-3 oui-w-3"})]},l.id))},n))})})]})}function jn(e){let[i,r]=u.useState(!1),{t:s}=_(),o=u.useMemo(()=>[{icon:t.jsx(cn,{fill:"currentColor",className:"oui-w-5 oui-h-5"}),label:s("tradingView.lineType.bars"),value:"0"},{icon:t.jsx(hn,{fill:"currentColor",className:"oui-w-5 oui-h-5"}),label:s("tradingView.lineType.candles"),value:"1"},{icon:t.jsx(mn,{fill:"currentColor",className:"oui-w-5 oui-h-5"}),label:s("tradingView.lineType.hollowCandles"),value:"9"},{icon:t.jsx(pn,{fill:"currentColor",className:"oui-w-5 oui-h-5"}),label:s("tradingView.lineType.line"),value:"2"},{icon:t.jsx(gn,{fill:"currentColor",className:"oui-w-5 oui-h-5"}),label:s("tradingView.lineType.area"),value:"3"},{icon:t.jsx(xn,{fill:"currentColor",className:"oui-w-5 oui-h-5"}),label:s("tradingView.lineType.baseline"),value:"10"}],[s]),a=u.useMemo(()=>{let n=o.find(l=>l.value===e.lineType);return n?n.icon:o[1].icon},[e.lineType]);return t.jsxs(Ye,{open:i,onOpenChange:r,children:[t.jsx(Ze,{asChild:!0,children:t.jsx(E,{className:b("oui-w-[18px] oui-h-[18px] oui-cursor-pointer oui-text-base-contrast-36 hover:oui-text-base-contrast-80",i&&"oui-text-base-contrast-80"),children:a})}),t.jsx(ht,{children:t.jsx(Xe,{onCloseAutoFocus:n=>n.preventDefault(),onClick:n=>n.stopPropagation(),align:"start",sideOffset:20,className:"oui-bg-base-8",children:t.jsx(g,{direction:"column",gap:4,px:5,py:5,width:240,justify:"start",itemAlign:"start",children:o.map(n=>t.jsxs(g,{justify:"start",itemAlign:"center",gap:2,className:b("oui-text-base-contrast-36 oui-cursor-pointer oui-w-full hover:oui-text-base-contrast",e.lineType===n.value&&"oui-text-base-contrast"),onClick:()=>e.changeLineType(n.value),children:[n.icon,t.jsx(p,{className:"oui-text-sm",children:n.label})]},n.value))})})})]})}var Ti=({url:e,children:i})=>t.jsx("span",{onClick:()=>{window.open(e)},className:"oui-text-primary-light oui-underline oui-cursor-pointer",children:i});function Cn(){let{t:e}=_();return t.jsx("div",{className:"oui-z-0 oui-text-base-contrast-80 oui-absolute oui-top-0 oui-left-0 oui-right-0 oui-bottom-0 oui-flex oui-flex-col oui-justify-start md:oui-justify-center oui-items-center oui-p-2 md:oui-p-10",children:t.jsxs("div",{children:[t.jsx("p",{className:"oui-mb-6 oui-text-xs",children:e("tradingView.noScriptSrc")}),t.jsx("p",{className:"oui-mb-3 oui-text-2xs md:oui-text-xs oui-text-base-contrast-54 md:oui-text-base-contrast-80 md:oui-text-base oui-pl-0 md:oui-pl-2",children:t.jsx(zt,{i18nKey:"tradingView.noScriptSrc.1",components:[t.jsx(Ti,{url:"https://www.tradingview.com/advanced-charts"})]})}),t.jsx("p",{className:"oui-text-2xs md:oui-text-xs oui-text-base-contrast-54 md:oui-text-base-contrast-80 md:oui-text-base oui-pl-0 md:oui-pl-2",children:t.jsx(zt,{i18nKey:"tradingView.noScriptSrc.2",components:[t.jsx(Ti,{url:"https://orderly.network/docs/sdks/react/components/trading#tradingviewconfig"})]})})]})})}var wr=()=>{let{t:e}=_();return{mobileTimeIntervalMoreMap:u.useMemo(()=>[[{value:"3",label:e("tradingView.timeInterval.3m")},{value:"5",label:e("tradingView.timeInterval.5m")},{value:"30",label:e("tradingView.timeInterval.30m")},{value:"120",label:e("tradingView.timeInterval.2h")}],[{value:"360",label:e("tradingView.timeInterval.6h")},{value:"720",label:e("tradingView.timeInterval.12h")},{value:"3d",label:e("tradingView.timeInterval.3d")},{value:"1M",label:e("tradingView.timeInterval.1M")}]],[e])}};function Pi(e){return Fe(ei)?t.jsx(_n,{...e}):t.jsx(wn,{...e})}function wn(e){let{t:i}=_(),r=u.useMemo(()=>[{value:"1",label:i("tradingView.timeInterval.1m")},{value:"3",label:i("tradingView.timeInterval.3m")},{value:"5",label:i("tradingView.timeInterval.5m")},{value:"15",label:i("tradingView.timeInterval.15m")},{value:"30",label:i("tradingView.timeInterval.30m")},{value:"60",label:i("tradingView.timeInterval.1h")},{value:"240",label:i("tradingView.timeInterval.4h")},{value:"720",label:i("tradingView.timeInterval.12h")},{value:"1D",label:i("tradingView.timeInterval.1d")},{value:"1W",label:i("tradingView.timeInterval.1w")},{value:"1M",label:i("tradingView.timeInterval.1M")}],[i]);return t.jsx("div",{className:b("oui-text-2xs oui-text-base-contrast-36 oui-flex oui-gap-[2px] oui-items-center oui-mr-3 oui-font-semibold","oui-overflow-hidden"),children:r.map(s=>t.jsx("div",{className:b("oui-cursor-pointer oui-px-2","hover:oui-text-base-contrast-80","oui-break-normal oui-whitespace-nowrap",e.interval===s.value&&"oui-text-base-contrast-80 oui-bg-white/[.06] oui-rounded"),id:s.value,onClick:()=>e.changeInterval(s.value),children:s.label},s.value))})}function _n(e){let{t:i}=_(),r=u.useMemo(()=>[{value:"1",label:i("tradingView.timeInterval.1m")},{value:"15",label:i("tradingView.timeInterval.15m")},{value:"60",label:i("tradingView.timeInterval.1h")},{value:"240",label:i("tradingView.timeInterval.4h")},{value:"1D",label:i("tradingView.timeInterval.1d")},{value:"1W",label:i("tradingView.timeInterval.1w")}],[i]),{mobileTimeIntervalMoreMap:s}=wr(),o=u.useMemo(()=>{for(let a of s)for(let n of a)if(n.value===e.interval)return n.label;return null},[e.interval,s]);return t.jsxs(g,{justify:"start",itemAlign:"center",gap:3,className:b("oui-text-2xs oui-text-base-contrast-36","oui-overflow-hidden"),children:[t.jsx("div",{className:" oui-flex oui-gap-1 oui-items-center oui-mr-3 oui-font-semibold",children:r.map(a=>t.jsx("div",{className:b("oui-px-2","oui-break-normal oui-whitespace-nowrap",e.interval===a.value&&"oui-text-base-contrast-80 oui-bg-white/[.06] oui-rounded"),onClick:()=>e.changeInterval(a.value),children:a.label},a.value))}),t.jsx(Nn,{...e,children:o?t.jsx("div",{className:"oui-text-base-contrast-80",children:o}):t.jsx(p,{className:"oui-break-normal oui-whitespace-nowrap",children:i("tradingView.timeInterval.more")})})]})}function Nn(e){let[i,r]=ge.useState(!1),{mobileTimeIntervalMoreMap:s}=wr();return t.jsxs(Ye,{open:i,onOpenChange:r,children:[t.jsx(Ze,{asChild:!0,children:t.jsxs("div",{className:"oui-flex oui-justify-start oui-items-center oui-gap-0.5",children:[e.children,t.jsx(oi,{className:b("oui-w-3 oui-h-3",i&&"oui-text-base-contrast-80 oui-rotate-180")})]})}),t.jsx(ht,{children:t.jsx(Xe,{onCloseAutoFocus:o=>o.preventDefault(),onClick:o=>o.stopPropagation(),align:"start",alignOffset:0,sideOffset:0,className:b("oui-markets-dropdown-menu-content oui-bg-base-9 oui-w-screen oui-flex oui-flex-col oui-gap-2 oui-p-3"),children:s.map((o,a)=>t.jsx("div",{className:"oui-flex oui-gap-2",children:o.map(n=>t.jsx("div",{className:b("oui-w-full  oui-text-2xs oui-flex oui-items-center oui-justify-center oui-h-6  oui-rounded",n.value===e.interval?"oui-text-base-contrast oui-bg-primary-darken":"oui-text-base-contrast-36 oui-bg-base-5"),onClick:()=>{e.changeInterval(n.value)},children:t.jsx("div",{children:n.label})},n.value))},a))})})]})}function Sn(e){return t.jsx("div",{className:"top-toolbar oui-flex oui-h-[44px] oui-justify-between md:oui-justify-start oui-items-center oui-p-2 md:oui-px-3 md:oui-pt-3 md:oui-pb-[14px]",children:e.children})}var Oi=({children:e,onClick:i})=>t.jsx(E,{onClick:i,className:"oui-cursor-pointer oui-w-[18px] oui-h-[18px] oui-text-base-contrast-36  hover:oui-text-base-contrast-80",children:e}),kn=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"currentColor",...e,children:t.jsx("path",{d:"M15.0008 2.24304C14.8088 2.24304 14.6085 2.30755 14.4615 2.4538L11.2508 5.66455V3.74304H9.75079V7.49304C9.75079 7.90704 10.0868 8.24304 10.5008 8.24304H14.2508V6.74304H12.3285L15.54 3.53229C15.8325 3.23904 15.8325 2.74705 15.54 2.4538C15.393 2.30755 15.1928 2.24304 15.0008 2.24304ZM3.7508 9.74303V11.243H5.67231L2.46156 14.4538C2.16906 14.747 2.16906 15.239 2.46156 15.5323C2.75481 15.8248 3.2468 15.8248 3.54005 15.5323L6.7508 12.3215V14.243H8.25079V10.493C8.25079 10.079 7.9148 9.74303 7.5008 9.74303H3.7508Z"})}),Tn=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"currentColor",...e,children:t.jsx("path",{d:"M7.49219 9.74304C7.30026 9.74304 7.09964 9.80755 6.95309 9.9538L3.74219 13.1646V11.243H2.24219V14.993C2.24219 15.407 2.57796 15.743 2.99219 15.743H6.74219V14.243H4.82031L8.03121 11.0323C8.32416 10.739 8.32416 10.247 8.03121 9.9538C7.88481 9.80755 7.68404 9.74304 7.49219 9.74304ZM11.2509 2.24304V3.74304H13.1728L9.96186 6.9538C9.66899 7.24705 9.66899 7.73904 9.96186 8.03229C10.2547 8.32479 10.7471 8.32479 11.04 8.03229L14.2509 4.82153V6.74304H15.7509V2.99304C15.7509 2.57904 15.4151 2.24304 15.0009 2.24304H11.2509Z"})}),Pn=u.forwardRef((e,i)=>{var f,C;let{chartRef:r,interval:s,changeDisplaySetting:o,displayControlState:a,tradingViewScriptSrc:n,changeInterval:l,lineType:d,changeLineType:c,openChartSetting:m,openChartIndicators:h,onFullScreenChange:x}=e,y=Fe(ei);return t.jsx("div",{className:b("oui-h-full oui-w-full  oui-relative",(f=e.classNames)==null?void 0:f.root),ref:i,children:n?t.jsxs("div",{className:b("oui-z-[1] oui-absolute oui-top-0 oui-bottom-0 oui-right-0 oui-left-0 oui-flex oui-flex-col",(C=e.classNames)==null?void 0:C.content),children:[t.jsx(Sn,{children:y?t.jsxs(g,{gapX:2,width:"100%",justify:"between",className:"oui-overflow-x-scroll oui-hide-scrollbar",children:[t.jsx(Pi,{interval:s??"15",changeInterval:l}),t.jsx(vn,{displayControlState:a,changeDisplayControlState:o})]}):t.jsxs(g,{justify:"between",itemAlign:"center",width:"100%",children:[t.jsxs(g,{children:[t.jsx(Pi,{interval:s??"1",changeInterval:l}),t.jsx(ie,{direction:"vertical",className:"oui-h-4",mx:2,intensity:8}),t.jsxs(g,{justify:"start",itemAlign:"center",gap:2,children:[t.jsx(yn,{displayControlState:a,changeDisplayControlState:o}),t.jsx(Oi,{onClick:h,children:t.jsx(dn,{})}),t.jsx(jn,{lineType:d,changeLineType:c}),t.jsx(Oi,{onClick:m,children:t.jsx(un,{})})]})]}),t.jsx(g,{children:e.fullscreen?t.jsx(kn,{className:"oui-text-base-contrast-54 hover:oui-text-base-contrast oui-cursor-pointer",onClick:x}):t.jsx(Tn,{className:"oui-text-base-contrast-54 hover:oui-text-base-contrast oui-cursor-pointer",onClick:x})})]})}),t.jsx("div",{className:"oui-h-full oui-w-full oui-overflow-hidden",ref:r})]}):t.jsx(Cn,{})})}),_r=u.forwardRef((e,i)=>{let r=ln(e);return t.jsx(Pn,{...r,ref:i})}),On=e=>{let{isMobile:i}=Qe();return i?t.jsx(Ln,{...e}):t.jsx(Mn,{...e})},Ln=e=>{let{t:i}=_();return t.jsxs(g,{direction:"column",gap:2,width:"100%",itemAlign:"start",p:2,className:"oui-bg-base-9 oui-rounded-b-xl",children:[t.jsxs(g,{width:"100%",justify:"between",children:[t.jsx(Nr,{classNames:{label:"oui-text-2xs oui-text-base-contrast-54",root:"oui-text-sm"},...e}),t.jsx(Sr,{classNames:{label:"oui-text-2xs oui-text-base-contrast-54",root:"oui-text-sm"},...e})]}),t.jsx(ie,{className:"oui-w-full"}),t.jsxs(g,{className:"oui-gap-[2px] oui-cursor-pointer",children:[t.jsx(be,{id:"oui-checkbox-hideOtherSymbols",color:"white",checked:!e.showAllSymbol,onCheckedChange:r=>{e.setShowAllSymbol(!r)}}),t.jsx("label",{className:"oui-text-2xs oui-text-base-contrast-54 oui-cursor-pointer",htmlFor:"oui-checkbox-hideOtherSymbols",children:i("trading.hideOtherSymbols")})]})]})},Mn=e=>t.jsxs(g,{py:2,px:3,gap:6,width:"100%",justify:"start",children:[t.jsx(Nr,{...e,classNames:{label:"oui-text-base-contrast-54"}}),t.jsx(Sr,{...e,classNames:{label:"oui-text-base-contrast-54"}})]}),Nr=e=>{let{t:i}=_(),r=typeof e.unrealPnL=="number"?e.unrealPnL>=0?"oui-text-trade-profit":"oui-text-trade-loss":"oui-text-base-contrast-80",s=typeof e.unrealPnL=="number"&&e.unrealPnlROI?e.unrealPnlROI>=0?"oui-text-success-darken":"oui-text-danger-darken":"oui-text-base-contrast-80";return t.jsx(We,{label:i("common.unrealizedPnl"),classNames:e.classNames,children:t.jsxs(g,{gap:1,children:[t.jsx(p.numeral,{dp:e.pnlNotionalDecimalPrecision,rm:L.ROUND_DOWN,intensity:80,className:r,children:e.unrealPnL??"--"}),typeof e.unrealPnlROI<"u"&&t.jsx(p.numeral,{prefix:"(",suffix:")",rule:"percentages",size:"2xs",dp:e.pnlNotionalDecimalPrecision,rm:L.ROUND_DOWN,className:s,children:e.unrealPnlROI})]})})},Sr=e=>{let{t:i}=_();return t.jsx(We,{label:i("common.notional"),classNames:e.classNames,children:t.jsx(p.numeral,{dp:e.pnlNotionalDecimalPrecision,rm:L.ROUND_DOWN,intensity:80,children:e.notional??"--"})})},De=e=>{let[i,r]=A("unPnlPriceBasis","markPrice"),[s,o]=A("pnlNotionalDecimalPrecision",(e==null?void 0:e.pnlNotionalDecimalPrecision)??2),[a,n]=A("showAllSymbol",!0),[l,d]=A("hideAssets",!1);return{unPnlPriceBasis:i,setUnPnlPriceBasic:r,pnlNotionalDecimalPrecision:s,setPnlNotionalDecimalPrecision:o,showAllSymbol:a,setShowAllSymbol:n,hideAssets:l,setHideAssets:d}},En=e=>{let{pnlNotionalDecimalPrecision:i,unPnlPriceBasis:r,symbol:s}=e,o=r,[a]=ct(s,{calcMode:o}),n=de(a.aggregated),l=n==null?void 0:n.total_unreal_pnl,d=n==null?void 0:n.unrealPnlROI,c=n==null?void 0:n.notional,{showAllSymbol:m,setShowAllSymbol:h}=De();return{pnlNotionalDecimalPrecision:i,unrealPnL:l,unrealPnlROI:d,notional:c,showAllSymbol:m,setShowAllSymbol:h}},kr=e=>{let i=En(e);return t.jsx(On,{...i})},Tr=e=>{var o;let{showAllSymbol:i}=De(),[r]=ct(i?void 0:e),s=u.useMemo(()=>{var a;return(a=r.rows)==null?void 0:a.length},[(o=r.rows)==null?void 0:o.length]);return{positionCount:de(s)??0}},Pr=e=>{let{showAllSymbol:i}=De();`${ne.pending}`,`${ne.tp_sl}`;let[r,{total:s}]=Oe({symbol:i?void 0:e,status:ae.INCOMPLETE,excludes:[gt.POSITIONAL_TP_SL,gt.TP_SL],size:500},{keeplive:!0}),[o,{total:a}]=Oe({symbol:i?void 0:e,status:ae.INCOMPLETE,includes:[gt.POSITIONAL_TP_SL,gt.TP_SL],size:500},{keeplive:!0}),n=de(s)??0,l=de(a)??0;return{pendingOrderCount:n,tpSlOrderCount:l}},Ut=e=>({base_dp:e("base_dp"),quote_dp:e("quote_dp"),base_tick:e("base_tick"),base:e("base"),quote:e("quote")}),Or=u.createContext({}),Le=()=>u.useContext(Or),In=e=>{let i=Ke()[e.symbol];return t.jsx(Or.Provider,{value:{...e,symbolInfo:{...Ut(i),symbol:e.symbol}},children:e.children})},Rn=e=>{let{current:i,pnlNotionalDecimalPrecision:r,sharePnLConfig:s,symbol:o,includedPendingOrder:a}=e,n=De({pnlNotionalDecimalPrecision:r}),{onSymbolChange:l}=Le(),{positionCount:d}=Tr(e.symbol),{pendingOrderCount:c,tpSlOrderCount:m}=Pr(e.symbol);return{current:i,sharePnLConfig:s,symbol:o,calcMode:n.unPnlPriceBasis,includedPendingOrder:a,...n,positionCount:d,pendingOrderCount:c,tpSlOrderCount:m,onSymbolChange:l}},Dn=e=>{let[i,r]=u.useState(!1),{t:s}=_();return t.jsxs(g,{gap:0,children:[t.jsxs(g,{gap:1,children:[t.jsx(be,{id:"oui-checkbox-hideOtherSymbols",color:"white",checked:e.hideOtherSymbols,onCheckedChange:o=>{e.setHideOtherSymbols(o)}}),t.jsx("label",{className:"oui-text-xs oui-text-base-contrast-54 oui-cursor-pointer",htmlFor:"oui-checkbox-hideOtherSymbols",children:s("trading.hideOtherSymbols")})]}),t.jsxs(Ye,{open:i,onOpenChange:r,children:[t.jsx(Ze,{asChild:!0,children:t.jsx(K,{size:"xs",type:"button",variant:"contained",className:"oui-bg-transparent hover:oui-bg-transparent",children:t.jsx(js,{size:16,color:"white",opacity:1,className:"oui-text-white/[.36] hover:oui-text-white/80"})})}),t.jsx(Xe,{className:"oui-px-5 oui-py-3 oui-w-[360px]",alignOffset:2,align:"end",children:t.jsxs("div",{className:"oui-flex oui-flex-col oui-text-sm",children:[t.jsx(p,{className:"oui-text-base oui-pb-3",children:s("trading.portfolioSettings")}),t.jsx(ie,{}),t.jsx(p,{className:"oui-pb-3 oui-text-base-contrast-54 oui-mt-2",children:s("trading.portfolioSettings.decimalPrecision")}),t.jsx(zn,{value:e.pnlNotionalDecimalPrecision,onValueChange:o=>{e.setPnlNotionalDecimalPrecision(o),r(!1)}}),t.jsx(ie,{className:"oui-my-3"}),t.jsx(p,{className:"oui-pb-3 oui-text-base-contrast-54 oui-mt-2",children:s("trading.portfolioSettings.unrealPnlPriceBasis")}),t.jsx(An,{value:e.unPnlPriceBasis,onValueChange:o=>{e.setUnPnlPriceBasic(o),r(!1)}})]})})]})]})},An=e=>{let{value:i,onValueChange:r}=e,{t:s}=_();return t.jsxs(g,{gap:2,children:[t.jsx(lt,{sel:i==="markPrice",label:s("common.markPrice"),value:"markPrice",onCheckChange:r}),t.jsx(lt,{sel:i==="lastPrice",label:s("common.lastPrice"),value:"lastPrice",onCheckChange:r})]})},zn=e=>{let{value:i,onValueChange:r}=e;return t.jsxs(g,{gap:2,children:[t.jsx(lt,{sel:i===0,label:1,value:0,onCheckChange:r}),t.jsx(lt,{sel:i===1,label:.1,value:1,onCheckChange:r}),t.jsx(lt,{sel:i===2,label:.01,value:2,onCheckChange:r})]})},lt=e=>{let{sel:i,label:r,value:s,onCheckChange:o}=e;return t.jsxs(g,{onClick:a=>{o(s),a.stopPropagation()},gap:1,className:"oui-cursor-pointer",children:[i?t.jsx($n,{}):t.jsx(Vn,{}),t.jsx(p,{size:"2xs",intensity:i?98:54,children:r})]})},$n=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-white",children:[t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".36"}),t.jsx("circle",{cx:"8",cy:"8",r:"3.333"})]}),Vn=()=>t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M8.01 1.333a6.667 6.667 0 1 0 0 13.333 6.667 6.667 0 0 0 0-13.333m0 1.333a5.334 5.334 0 1 1-.001 10.667 5.334 5.334 0 0 1 0-10.667",fill:"#fff",fillOpacity:".54"})}),Bn=e=>({...e}),Hn=e=>{let i=Bn(e);return t.jsx(Dn,{...i})},qn=e=>{let{t:i}=_();return t.jsxs(mt,{defaultValue:e.current||"Positions",variant:"contained",trailing:t.jsx(Hn,{pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,setPnlNotionalDecimalPrecision:e.setPnlNotionalDecimalPrecision,unPnlPriceBasis:e.unPnlPriceBasis,setUnPnlPriceBasic:e.setUnPnlPriceBasic,hideOtherSymbols:!e.showAllSymbol,setHideOtherSymbols:r=>e.setShowAllSymbol(!r)}),size:"lg",className:"oui-h-full",classNames:{tabsContent:"oui-h-[calc(100%_-_32px)]"},children:[t.jsx(ee,{testid:"oui-testid-dataList-position-tab",value:"Positions",title:`${i("common.positions")} ${(e.positionCount??0)>0?`(${e.positionCount})`:""}`,children:t.jsx(Fn,{...e})}),t.jsx(ee,{testid:"oui-testid-dataList-pending-tab",value:"Pending",title:`${i("orders.status.pending")} ${(e.pendingOrderCount??0)>0?`(${e.pendingOrderCount})`:""}`,children:t.jsx(xt,{type:ne.pending,ordersStatus:ae.INCOMPLETE,symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,testIds:{tableBody:"oui-testid-dataList-pending-table-body"}})}),t.jsx(ee,{testid:"oui-testid-dataList-tpsl-tab",value:"TP/SL",title:`${i("common.tpsl")} ${(e.tpSlOrderCount??0)>0?`(${e.tpSlOrderCount})`:""}`,children:t.jsx(xt,{type:ne.tp_sl,ordersStatus:ae.INCOMPLETE,symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,testIds:{tableBody:"oui-testid-dataList-tpsl-table-body"}})}),t.jsx(ee,{testid:"oui-testid-dataList-filled-tab",value:"Filled",title:i("orders.status.filled"),children:t.jsx(xt,{type:ne.filled,symbol:e.showAllSymbol?void 0:e.symbol,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,ordersStatus:ae.FILLED,onSymbolChange:e.onSymbolChange,testIds:{tableBody:"oui-testid-dataList-filled-table-body"},sharePnLConfig:e.sharePnLConfig})}),t.jsx(ee,{testid:"oui-testid-dataList-positionHistory-tab",value:"Position history",title:i("positions.positionHistory"),children:t.jsx(qs,{pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,sharePnLConfig:e.sharePnLConfig})}),t.jsx(ee,{testid:"oui-testid-dataList-orderHistory-tab",value:"Order history",title:i("orders.orderHistory"),children:t.jsx(xt,{type:ne.orderHistory,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,testIds:{tableBody:"oui-testid-dataList-orderHistory-table-body"},sharePnLConfig:e.sharePnLConfig})}),t.jsx(ee,{testid:"oui-testid-dataList-liquidation-tab",value:"Liquidation",title:i("positions.liquidation"),children:t.jsx(Fs,{symbol:e.showAllSymbol?void 0:e.symbol})})]})},Fn=e=>t.jsxs(g,{direction:"column",width:"100%",height:"100%",children:[t.jsx(kr,{pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,symbol:e.showAllSymbol?void 0:e.symbol,unPnlPriceBasis:e.unPnlPriceBasis}),t.jsx(ie,{className:"oui-w-full"}),t.jsx(E,{className:"oui-h-[calc(100%_-_60px)]",width:"100%",children:t.jsx(Xs,{symbol:e.showAllSymbol?void 0:e.symbol,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,sharePnLConfig:e.sharePnLConfig,calcMode:e.calcMode,includedPendingOrder:e.includedPendingOrder,onSymbolChange:e.onSymbolChange})})]}),Un=e=>{let i=Rn({...e});return t.jsx(qn,{...i})},Wn=e=>{var i,r,s,o;return t.jsxs(E,{className:b("oui-grid oui-grid-rows=[auto,1fr] oui-h-full oui-w-full",(i=e.classNames)==null?void 0:i.root),style:e.style,children:[t.jsx(E,{className:"oui-pr-1",children:t.jsx(Qn,{base:e.base,quote:e.quote,className:(r=e.classNames)==null?void 0:r.listHeader})}),t.jsx(Kn,{data:e.data,isLoading:e.isLoading,baseDp:e.baseDp,quoteDp:e.quoteDp,classNames:(s=e.classNames)==null?void 0:s.listItem,className:(o=e.classNames)==null?void 0:o.list})]})},Lr=e=>{let{left:i,mid:r,right:s,classNames:o}=e;return t.jsxs(xe,{cols:3,gapX:2,width:"100%",className:b("oui-text-xs oui-tabular-nums",o==null?void 0:o.root),children:[t.jsx("div",{className:b("oui-flex-1",o==null?void 0:o.left),children:i}),t.jsx("div",{className:b("oui-flex-1",o==null?void 0:o.mid),children:r}),t.jsx("div",{className:b("oui-flex-1 oui-text-right",o==null?void 0:o.right),children:s})]})},Qn=e=>{let{t:i}=_();return t.jsx(Lr,{left:i("common.time"),mid:`${i("common.price")}(${e.quote})`,right:`${i("common.qty")}(${e.base})`,classNames:{root:b("oui-text-base-contrast-54 oui-h-[32px] oui-sticky",e.className)}})},Kn=e=>t.jsx(ws,{dataSource:e.data,className:b("oui-last-trades-list","oui-w-full oui-h-full",e.className,"oui-overflow-auto"),contentClassName:"!oui-space-y-0 oui-pr-[-4px]",renderItem:(i,r)=>{var s,o,a;return t.jsx(Lr,{left:t.jsx(p.formatted,{rule:"date",formatString:"HH:mm:ss",children:i==null?void 0:i.ts}),mid:Rt(i==null?void 0:i.price,{fix:e.quoteDp}),right:Rt(i==null?void 0:i.size,{fix:e.baseDp}),classNames:{left:b("oui-text-base-contrast-80",(s=e.classNames)==null?void 0:s.left),right:b(i.side===B.BUY?"oui-text-trade-profit":"oui-text-trade-loss",(o=e.classNames)==null?void 0:o.mid),mid:b(i.side===B.BUY?"oui-text-trade-profit":"oui-text-trade-loss",(a=e.classNames)==null?void 0:a.right)}},r)}}),Yn=e=>{var d;let{data:i,isLoading:r}=Cs(e),s=(d=Ke())==null?void 0:d[e],o=s==null?void 0:s("base"),a=s==null?void 0:s("quote"),n=s==null?void 0:s("base_dp"),l=s==null?void 0:s("quote_dp");return{base:o,quote:a,data:i,isLoading:r,baseDp:n,quoteDp:l}},ai=e=>{let i=Yn(e.symbol);return t.jsx(Wn,{...i,classNames:e.classNames,style:e.style})};function Zn(e){let{t:i}=_();return e.showFaucet?t.jsx(K,{variant:"outlined",fullWidth:!0,size:"md",onClick:e.getFaucet,loading:e.loading,className:"oui-text-primary-light oui-border-primary-light oui-rounded","data-testid":"oui-testid-assetView-getFaucet-button",children:i("trading.faucet.getTestUSDC")}):null}function Xn(){let{t:e}=_(),{connectedChain:i,namespace:r}=Ui(),{state:s,account:o}=ue(),a=kt(),n=a.get("operatorUrl"),[l,{isMutating:d}]=Wi(`${n}/v1/faucet/usdc`),[c,m]=u.useState(!1),h=u.useMemo(()=>!i||!i.id?!1:(s.status===U.EnableTrading||s.status===U.EnableTradingWithoutConnected)&&Qi(parseInt(i.id)),[s,i]);return{getFaucet:()=>{var y;if(c)return;m(!0);let x=e("trading.faucet.getTestUSDC.success",{quantity:r===Ki.solana?"100":"1,000"});return l({chain_id:(y=o.walletAdapter)==null?void 0:y.chainId.toString(),user_address:s.address,broker_id:a.get("brokerId")}).then(f=>{if(m(!1),f.success)return W.alert({title:e("trading.faucet.getTestUSDC"),message:x,onOk:()=>new Promise(C=>C(!0))});f.message&&Z.error(f.message)},f=>{Z.error(f.message)})},showFaucet:h,loading:c}}function Li(){let e=Xn();return t.jsx(Zn,{...e})}var Gn=()=>{let{state:e}=ue(),{wrongNetwork:i,disabledConnect:r}=pt(),{t:s}=_();return u.useMemo(()=>{let o={wrongNetwork:{title:s("connector.wrongNetwork"),description:s("connector.wrongNetwork.tooltip"),titleColor:"warning"},connectWallet:{title:s("connector.connectWallet"),description:s("connector.trade.connectWallet.tooltip"),titleClsName:"oui-text-transparent oui-bg-clip-text oui-gradient-brand"},notSignedIn:{title:s("connector.createAccount"),description:s("connector.trade.createAccount.tooltip"),titleColor:"primary"},disabledTrading:{title:s("connector.enableTrading"),description:s("connector.trade.enableTrading.tooltip"),titleColor:"primary"},default:{title:"",description:""}};if(r)return o.connectWallet;if(i)return o.wrongNetwork;switch(e.status){case U.NotConnected:return o.connectWallet;case U.NotSignedIn:return o.notSignedIn;case U.DisabledTrading:return o.disabledTrading;default:return o.default}},[e.status,i,s])},Mr=e=>{let{description:i,formula:r}=e;return t.jsxs("div",{className:"oui-min-w-[204px] oui-max-w-[240px] oui-text-2xs oui-leading-normal oui-text-base-contrast-80",children:[typeof i<"u"&&i!==null&&t.jsx("span",{children:i}),t.jsx(ie,{className:"oui-border-white/10",my:2}),typeof r<"u"&&r!==null&&t.jsx("span",{children:r})]})},Jn=e=>{let{t:i}=_(),{totalValue:r,visible:s=!0,onToggleVisibility:o}=e;return t.jsxs(g,{direction:"column",gap:1,className:"oui-text-2xs",itemAlign:"center",children:[t.jsx(p.numeral,{visible:s,weight:"bold",size:"2xl",className:qi({color:"brand"}),as:"div",padding:!1,dp:2,children:r??"--"}),t.jsxs(g,{gap:1,itemAlign:"center",children:[t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",children:`${i("trading.asset.myAssets")} (USDC)`}),t.jsx("button",{onClick:o,children:s?t.jsx(ti,{size:18,className:"oui-text-base-contrast-54"}):t.jsx(ii,{size:18,className:"oui-text-base-contrast-54"})})]})]})},Mt=e=>{let{label:i,description:r,formula:s,visible:o,value:a,unit:n,rule:l,placeholder:d}=e;return t.jsxs(g,{justify:"between",children:[t.jsx(Ce,{className:"",content:t.jsx(Mr,{description:r,formula:s}),children:t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",className:"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:i})}),t.jsx(p.numeral,{visible:o,size:"2xs",unit:n,unitClassName:"oui-text-base-contrast-36 oui-ml-0.5",as:"div",rule:l,padding:!1,dp:2,placeholder:d,children:a||"--"})]})},el=e=>{let{visible:i,value:r}=e,{t:s}=_();return t.jsxs(g,{justify:"between",children:[t.jsx(Ce,{className:b("oui-bg-base-6 oui-p-2"),content:t.jsx(tr,{}),children:t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",className:"oui-cursor-pointer oui-border-b oui-border-dashed oui-border-line-12",children:s("transfer.LTV")})}),t.jsx(p,{size:"2xs",className:"select-none",children:i?`${r}%`:"*****"})]})},tl=e=>{let{visible:i=!0,freeCollateral:r,marginRatioVal:s,renderMMR:o,isConnected:a,currentLtv:n}=e,[l,d]=A("orderly_entry_asset_list_open",!1),[c,m]=u.useState(l),{t:h}=_(),x=u.useCallback(()=>{m(f=>!f),setTimeout(()=>{d(!c)},0)},[]),y=typeof n=="number"&&!Number.isNaN(n)&&n>0;return t.jsxs(E,{className:"oui-group",children:[t.jsxs(g,{justify:"center",gap:1,itemAlign:"center",className:"oui-cursor-pointer",onClick:x,children:[t.jsx(ie,{className:"oui-flex-1"}),t.jsx(fs,{size:12,color:"white",className:b("oui-transition-transform",c&&"oui-rotate-180")}),t.jsx(ie,{className:"oui-flex-1"})]}),t.jsxs(E,{style:{transform:"translateZ(0)"},className:b("oui-select-none oui-space-y-1.5 oui-overflow-hidden","oui-transition-[max-height] oui-duration-150","group-hover:oui-will-change-[max-height]",c?y?"oui-max-h-[94px]":"oui-max-h-[69px]":"oui-max-h-0"),children:[t.jsx(Mt,{label:h("trading.asset.freeCollateral"),description:h("trading.asset.freeCollateral.tooltip"),formula:h("trading.asset.freeCollateral.formula"),visible:i,value:r===0?"0":r,unit:"USDC"}),t.jsx(Mt,{label:h("trading.asset.marginRatio"),description:h("trading.asset.marginRatio.tooltip"),formula:h("trading.asset.marginRatio.formula"),visible:i,value:s,isConnected:a,rule:"percentages",showPercentage:!0,placeholder:"--%"}),t.jsx(Mt,{label:h("trading.asset.maintenanceMarginRatio"),description:h("trading.asset.maintenanceMarginRatio.tooltip"),formula:h("trading.asset.maintenanceMarginRatio.formula"),visible:i,value:o,rule:"percentages",showPercentage:!0,placeholder:"--%"}),y&&t.jsx(el,{visible:i,value:n})]})]})},il=({networkId:e,isFirstTimeDeposit:i,totalValue:r,onDeposit:s,onWithdraw:o,onTransfer:a,toggleVisible:n,visible:l,freeCollateral:d,marginRatioVal:c,renderMMR:m,isConnected:h,isMainAccount:x,hasSubAccount:y,currentLtv:f})=>{let{title:C,description:j,titleColor:w,titleClsName:k}=Gn(),{t:N}=_(),v=y&&t.jsx(K,{fullWidth:!0,color:"secondary",size:"md",onClick:a,"data-testid":"oui-testid-assetView-transfer-button",children:t.jsx(p,{children:N("common.transfer")})}),T=x&&t.jsxs(t.Fragment,{children:[t.jsxs(K,{fullWidth:!0,color:"secondary",size:"md",onClick:o,"data-testid":"oui-testid-assetView-withdraw-button",children:[!y&&t.jsx(nt,{color:"white",opacity:1,className:"oui-rotate-180"}),t.jsx(p,{children:N("common.withdraw")})]}),t.jsxs(K,{"data-testid":"oui-testid-assetView-deposit-button",fullWidth:!0,size:"md",onClick:s,children:[!y&&t.jsx(nt,{color:"white",opacity:1}),t.jsx(p,{children:N("common.deposit")})]})]});return t.jsxs(E,{className:"oui-relative",children:[C&&j&&t.jsxs(g,{direction:"column",gap:1,className:"oui-mb-[32px]",children:[t.jsx(p,{size:"lg",weight:"bold",color:w||"inherit",className:k,children:C}),t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",className:"oui-text-center",children:j})]}),t.jsx(Tt,{networkId:e,buttonProps:{size:"md",fullWidth:!0},children:i&&x?t.jsxs(t.Fragment,{children:[t.jsx(E,{children:t.jsxs(g,{direction:"column",gap:1,className:"oui-mb-[32px]",children:[t.jsx(p.gradient,{size:"lg",weight:"bold",color:"brand",children:N("trading.asset.startTrading")}),t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",children:N("trading.asset.startTrading.description")})]})}),t.jsxs(K,{"data-testid":"oui-testid-assetView-deposit-button",fullWidth:!0,size:"md",onClick:s,children:[t.jsx(nt,{color:"white",opacity:1}),t.jsx(p,{children:N("common.deposit")})]}),t.jsx(E,{className:"oui-mt-3",children:t.jsx(Li,{})})]}):t.jsxs(E,{className:"oui-space-y-4",children:[t.jsx(Jn,{totalValue:r,visible:l,onToggleVisibility:n}),t.jsx(tl,{visible:l,freeCollateral:d,marginRatioVal:c,renderMMR:m,isConnected:h,currentLtv:f}),t.jsx(g,{gap:x?y?2:3:0,itemAlign:"center",children:x?t.jsxs(t.Fragment,{children:[v,T]}):v}),x&&t.jsx(Li,{})]})}),t.jsx("div",{className:b("oui-absolute oui-inset-0 oui-rotate-180","oui-pointer-events-none oui-rounded-2xl oui-blur-[200px]"),style:{background:"conic-gradient(from -40.91deg at 40.63% 50.41%, rgba(159, 115, 241, 0) -48.92deg, rgba(242, 98, 181, 0) 125.18deg, #5FC5FF 193.41deg, #FFAC89 216.02deg, #8155FF 236.07deg, #789DFF 259.95deg, rgba(159, 115, 241, 0) 311.08deg, rgba(242, 98, 181, 0) 485.18deg)"}})]})},rl=()=>{var Q;let{t:e}=_(),i=xs(),r=ut(),{totalValue:s}=dt({dp:2}),o=kt("networkId"),{state:a,isMainAccount:n}=ue(),{freeCollateral:l}=dt({dp:2}),{marginRatio:d,mmr:c}=_t(),m=a.status>=U.Connected,[{aggregated:h},x]=ct(),y=u.useMemo(()=>Math.min(10,h.notional===0?x.margin_ratio(10):d),[d,h]),f=u.useCallback(q=>W.show(Ws,{activeTab:q}),[]),C=u.useCallback(async()=>f("deposit"),[]),j=u.useCallback(async()=>f("withdraw"),[]),w=u.useCallback(async()=>W.show(Qs),[]),k=u.useCallback(async()=>i.settle().catch(q=>{if(q.code===-1104)return Z.error(e("settle.settlement.error")),Promise.reject(q);q.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1&&r.emit("wallet:sign-message-with-ledger-error",{message:q.message,userAddress:i.address})}).then(q=>(Z.success(e("settle.settlement.requested")),Promise.resolve(q))),[i,e]),[N,v]=A("orderly_assets_visible",!0),T=u.useCallback(()=>{v(q=>!q)},[N]),M=Yt(),R=de(l)??void 0,V=de(y)??void 0,X=de(c)??void 0,G=de(s)??void 0;return{onDeposit:C,onWithdraw:j,onTransfer:w,onSettle:k,visible:N,toggleVisible:T,networkId:o,totalValue:G,status:a.status,freeCollateral:R,marginRatioVal:V,renderMMR:X,isConnected:m,isMainAccount:n,hasSubAccount:!!((Q=a.subAccounts)!=null&&Q.length),currentLtv:M}},sl=e=>{let i=rl();return t.jsx(il,{...i,isFirstTimeDeposit:e.isFirstTimeDeposit})},ni=u.createContext({cellHeight:22}),Ge=()=>u.useContext(ni),Pt="orderbook_coin_type",li="orderbook_mobile_coin_type",Er=e=>{let[i,r]=u.useState("quantity"),[s,o]=u.useState("quantity"),a=ge.useMemo(()=>({cellHeight:e.cellHeight,onItemClick:e.onItemClick,mode:i,totalMode:s||"quantity",depth:e.depth,onModeChange:r,onTotalModeChange:o,showTotal:e.showTotal||!1,pendingOrders:e.pendingOrders,symbolInfo:e.symbolInfo}),[i,e.cellHeight,e.depth,e.onItemClick,e.pendingOrders,e.showTotal,e.symbolInfo,s]);return t.jsx(ni.Provider,{value:a,children:e.children})},Ir=e=>{let{direction:i=1}=e,r=u.useMemo(()=>{let s=Math.max(e.width,0);return i===0?{transform:`translateX(${s}%)`}:{transform:`translateX(-${s}%)`}},[e.width]);return t.jsx("div",{className:b("oui-absolute oui-right-[-100%] oui-top-0 oui-h-full oui-w-full oui-transition-transform oui-pointer-events-none",i===0&&"oui-left-[-100%]",e.className),style:r})},ol=e=>{let{cellHeight:i,showTotal:r,onItemClick:s,depth:o,pendingOrders:a}=Ge(),{symbolInfo:n,currentHover:l,accumulated:d,accumulatedAmount:c,count:m,price:h,quantity:x,base:y,quote:f}=e,{base_dp:C,quote_dp:j}=n,[w]=A(Pt,y),k=Number.isNaN(h)?0:d/m*100,N=u.useMemo(()=>Gi(o||`${j}`),[o,j]),v=Number.isNaN(d)?"-":c==null?void 0:c.toString(),T=u.useMemo(()=>{let M=gi(h,{dp:N,padding:!0});return a.some(R=>M===gi(R,{dp:N,padding:!0}))},[a,h,N]);return t.jsxs("div",{className:"oui-relative oui-flex oui-cursor-pointer oui-flex-row oui-justify-between oui-pl-3 oui-text-xs oui-tabular-nums oui-text-base-contrast-80",style:{height:`${i}px`},onClick:()=>{Number.isNaN(h)||Number.isNaN(x)||(s==null||s([h,x]))},onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[t.jsxs("div",{className:b("oui-mr-2 oui-flex oui-basis-7/12 oui-flex-row oui-items-center",r&&"oui-basis-5/12"),children:[t.jsx("div",{className:b("oui-flex-1 oui-text-left",e.type==="ask"?"oui-text-trade-loss":"oui-text-trade-profit"),children:t.jsx(p.numeral,{dp:N,children:h})}),t.jsx("div",{className:"oui-flex-1 oui-text-right oui-text-base-contrast-80",children:t.jsx(p.numeral,{dp:C,children:x})})]}),t.jsxs("div",{className:b("oui-fex-row oui-relative oui-flex oui-basis-5/12 oui-items-center oui-justify-end oui-overflow-hidden",r&&"oui-basis-7/12"),children:[r?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:b("oui-flex-1 oui-pr-3 oui-text-right"),children:t.jsx(p.numeral,{dp:C,className:"oui-z-10",children:d})}),t.jsx("div",{className:b("oui-flex-1 oui-pr-3 oui-text-right"),children:t.jsx(p.numeral,{dp:0,className:"oui-z-10",children:v})})]}):t.jsxs("div",{className:b("oui-flex-1 oui-pr-3 oui-text-right"),children:[w===y&&t.jsx(p.numeral,{dp:C,className:"oui-z-10",children:d}),w===f&&t.jsx(p.numeral,{dp:0,className:"oui-z-10",children:v})]}),t.jsx(Ir,{width:k,direction:0,className:e.type==="ask"?"oui-bg-trade-loss/10":"oui-bg-trade-profit/10"})]}),T&&t.jsx("div",{className:b("oui-pointer-events-none oui-absolute oui-left-[4px] oui-size-[4px] oui-rounded-full",e.type==="ask"&&"oui-bg-trade-loss",e.type==="bid"&&"oui-bg-trade-profit"),style:{top:`${i/2-2}px`}}),e.isHover&&t.jsx("div",{className:"oui-absolute oui-inset-0 oui-bg-white oui-opacity-[.12]"}),l&&t.jsx("div",{className:b("oui-absolute oui-inset-x-0",e.type==="ask"&&"oui-top-0",e.type==="bid"&&"oui-bottom-0"),children:t.jsx(ie,{lineStyle:"dashed",className:b("oui-w-full",e.type==="bid"&&"oui-border-trade-profit",e.type==="ask"&&"oui-border-trade-loss")})})]})},Rr=e=>{let{data:i,type:r,countQty:s}=e,{symbolInfo:o,depth:a}=Ge(),n=u.useCallback(()=>{if(((i==null?void 0:i.length)||0)===0)return null;if(r==="ask"){let h=i.findIndex(x=>!Number.isNaN(x[0]));return h!=-1?i[h]:null}else{for(let h=i.length-1;h>=0;h--){let x=i[h];if(!Number.isNaN(x[0]))return x}return null}},[i,r]),l=u.useMemo(()=>a!=null&&a.toString().includes(".")?a.toString().split(".")[1].length:0,[a]),d=u.useMemo(()=>i.reduce((h,x)=>Math.max(h,x[1]),0),[i]),[c,m]=u.useState(-1);return t.jsx("div",{className:"oui-order-book-list oui-flex oui-flex-col oui-gap-px",children:i.map((h,x)=>t.jsx(al,{index:x,item:h,countQty:s,setHoverIndex:m,hoverIndex:c,type:r,maxQty:d,priceDp:l,symbolInfo:o,findMaxItem:n},x))})},al=e=>{let{index:i,item:r,setHoverIndex:s,type:o,maxQty:a,hoverIndex:n,priceDp:l,countQty:d,symbolInfo:c}=e,{base:m,quote:h,base_dp:x,quote_dp:y}=c,{t:f}=_(),C=n!==-1?o==="ask"?i>=n:i<=n:!1,[j,w]=u.useState(!1),k=v=>{if(v===null)return{sumQty:0,sumQtyAmount:0,avgPrice:0};let T={sumQty:0,sumQtyAmount:0};return Number.isNaN(v[2])||(T={sumQty:v[2],sumQtyAmount:v[3]}),{...T,avgPrice:T.sumQtyAmount==0?0:T.sumQtyAmount/T.sumQty}},N=u.useMemo(()=>{let v=k(r);return v.avgPrice===0?k(e.findMaxItem()):v},[r,e]);return t.jsxs(Ss,{open:j,onOpenChange:w,children:[t.jsx(Vi,{children:t.jsx(ol,{background:"",price:r[0],quantity:r[1],accumulated:r[2],count:d,type:o,accumulatedAmount:r[3],maxQty:a,isHover:C,currentHover:n===i,symbolInfo:c,base:m,quote:h,onMouseEnter:()=>{s(i),w(!0)},onMouseLeave:()=>{s(-1),w(!1)}})}),t.jsxs(ks,{className:b("oui-rounded-base oui-flex oui-w-full oui-max-w-[400px] oui-flex-col oui-gap-2 oui-bg-base-6 oui-p-3 oui-text-2xs oui-shadow-md"),align:o==="ask"?"end":"start",alignOffset:-25.4,side:"left",sideOffset:2,onPointerEnter:v=>v.preventDefault(),children:[t.jsx(Et,{title:`${f("common.avgPrice")}â‰ˆ`,content:N.avgPrice,contentDp:l}),t.jsx(Et,{title:`${f("trading.orderBook.sum")} (${m})`,content:N.sumQty,contentDp:x}),t.jsx(Et,{title:`${f("trading.orderBook.sum")} (${h})`,content:N.sumQtyAmount,contentDp:y}),t.jsx(Ts,{className:"oui-fill-base-6",style:{transform:o==="ask"?"translateX(80%)":"translateX(-80%)"}})]})]})},Et=e=>{let{title:i,content:r,contentDp:s}=e;return t.jsxs("div",{className:"oui-flex oui-flex-row oui-justify-between oui-gap-4",children:[t.jsx("div",{className:"oui-text-base-contrast-36",children:i}),t.jsx("div",{className:"oui-text-right",children:t.jsx(p.numeral,{dp:s,children:r})})]})},nl=e=>{let{data:i}=e,r=u.useMemo(()=>{let s=Number.NaN,o=i.length,a=0;for(;Number.isNaN(s)&&a<o;)s=i[a][2],a++;return s},[i]);return t.jsx(Rr,{type:"ask",data:i,countQty:r})},ll=e=>{let{data:i}=e,r=u.useMemo(()=>{let s=Number.NaN,o=i.length-1;for(;Number.isNaN(s)&&o>0;)s=i[o][2],o--;return s},[i]);return t.jsx(Rr,{type:"bid",data:i,countQty:r})},dl=e=>{let i=u.useMemo(()=>e.depths.map(r=>({value:r,label:`${r}`})),[e.depths]);return t.jsx(E,{pl:3,width:97,className:"oui-py-[10px]",children:t.jsx(Xt.options,{options:i,size:"xs",value:e.value,onValueChange:r=>{var s;(s=e.onChange)==null||s.call(e,r)}})})},ul=e=>{let{item:i,base:r,onClick:s}=e,{t:o}=_(),[a,n]=A(Pt,r);return t.jsxs(g,{justify:"between",itemAlign:"center",className:b("oui-w-full oui-px-2 oui-py-[3px]","oui-cursor-pointer","oui-text-xs","oui-text-base-contrast-54","hover:oui-bg-base-6","oui-rounded-[3px]","oui-transition-all",a===i&&"oui-bg-base-5"),onClick:l=>{n(i),s(l)},children:[o("common.total"),"(",i,")",t.jsx("div",{className:b("oui-transition-all","oui-w-1","oui-h-1","oui-rounded-full","oui-bg-gradient-to-r",a===i&&"oui-from-[rgb(var(--oui-gradient-brand-start))] oui-to-[rgb(var(--oui-gradient-brand-end))]")})]})},cl=e=>{let{base:i,quote:r}=e,{showTotal:s}=Ge(),{t:o}=_(),[a,n]=ge.useState(!1),[l]=A(Pt,i),d=a?Xi:Gt;return t.jsxs(g,{pl:3,justify:"between",className:"oui-py-[6px]",children:[t.jsxs(g,{gap:1,className:b("oui-basis-7/12",s&&"oui-basis-1/2"),children:[t.jsx(E,{width:"100%",children:t.jsx(tt,{id:"oui-order-book-header-price",className:"oui-text-base-contrast-36",children:`${o("common.price")}(${r})`})}),t.jsx(E,{width:"100%",children:t.jsx(tt,{justifyEnd:!0,id:"oui-order-book-header-qty",className:"oui-text-base-contrast-36",children:`${o("common.qty")}(${i})`})})]}),t.jsx(g,{gap:1,pr:3,className:b("oui-basis-5/12",s&&"oui-basis-1/2"),children:s?t.jsxs(t.Fragment,{children:[t.jsx(E,{className:"oui-text-base-contrast-36",width:"100%",children:t.jsx(tt,{id:"oui-order-book-header-total-quote",justifyEnd:!0,children:`${o("common.total")}(${i})`})}),t.jsx(E,{className:"oui-text-base-contrast-36",width:"100%",children:t.jsx(tt,{justifyEnd:!0,id:"oui-order-book-header-total-base",children:`${o("common.total")}(${r})`})})]}):t.jsx(E,{width:"100%",children:t.jsx(_s,{open:a,onOpenChange:n,contentProps:{className:b("oui-w-28 oui-p-1")},content:t.jsx(g,{direction:"column",itemAlign:"start",className:b("oui-w-full oui-gap-0.5"),children:[i,r].map(c=>t.jsx(ul,{item:c,base:i,onClick:()=>n(!1)},`type-${c}`))}),children:t.jsxs(g,{justify:"end",itemAlign:"center",className:"oui-cursor-pointer oui-select-none oui-text-base-contrast-36 oui-transition-all hover:oui-text-base-contrast",children:[t.jsx(tt,{justifyEnd:!0,id:"oui-order-book-header-total-base",children:`${o("common.total")}(${l})`}),t.jsx(d,{color:"inherit",className:"oui-size-4 oui-text-3xs"})]})})})})]})},tt=e=>{let{children:i,className:r,justifyEnd:s=!1}=e;return t.jsx(g,{id:e.id,className:b(r,"oui-items-end oui-text-xs",s&&"oui-justify-end"),children:i})},Dr=e=>{let{markPrice:i=0,lastPrice:r,quote_dp:s,className:o,iconSize:a=18}=e,[n,l]=r,d=l<n,c=l>n;return t.jsxs(g,{gap:1,className:b(c?"oui-text-trade-profit":d?"oui-text-trade-loss":"",o),children:[t.jsx(p.numeral,{dp:s,intensity:98,children:l}),t.jsxs(E,{width:19,children:[d&&t.jsx(nt,{size:a,color:"danger",opacity:1}),c&&t.jsx(Fi,{size:a,color:"success",opacity:1})]})]})},Ar=e=>{let{isMobile:i}=Qe();return i?t.jsx(ml,{...e}):t.jsx(hl,{...e})},hl=e=>{let{quote_dp:i,className:r,iconSize:s=18}=e,{t:o}=_();return t.jsx(Ce,{content:o("trading.orderBook.markPrice.tooltip"),className:"oui-max-w-[270px]",children:t.jsxs(g,{gap:1,className:b("oui-cursor-pointer oui-text-2xs",r),children:[t.jsx(zr,{size:s}),t.jsx(p.numeral,{dp:i,color:"warning",className:"oui-underline oui-text-base oui-decoration-dashed oui-decoration-1 oui-underline-offset-4 oui-decoration-warning-darken",children:e.markPrice})]})})},ml=e=>{let{quote_dp:i,className:r,iconSize:s=18}=e,[o,a]=u.useState(!1),{t:n}=_();return t.jsxs(t.Fragment,{children:[t.jsxs(g,{gap:1,className:b("oui-cursor-pointer oui-text-2xs",r),onClick:()=>{a(!0)},children:[t.jsx(zr,{size:s}),t.jsx(p.numeral,{dp:i,color:"warning",className:"oui-underline oui-decoration-dashed oui-decoration-1 oui-underline-offset-4 oui-decoration-warning-darken",children:e.markPrice})]}),t.jsx(zi,{size:"xs",open:o,onOpenChange:a,title:n("common.tips"),actions:{primary:{label:n("common.ok"),onClick:()=>a(!1)}},children:t.jsx(p,{children:n("trading.orderBook.markPrice.tooltip")})})]})},zr=e=>t.jsx("svg",{width:e.size,height:e.size,viewBox:"0 0 18 18",fill:"currenColor",xmlns:"http://www.w3.org/2000/svg",className:"oui-fill-warning-darken",children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.75 1.5a.75.75 0 0 1 .75.75h6a.75.75 0 0 1 .75.75v1.5h3a.75.75 0 0 1 .75.75V12a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75v-1.5H4.5v5.25a.75.75 0 0 1-1.5 0V2.25a.75.75 0 0 1 .75-.75M4.5 9h5.25V3.75H4.5zm6.75-3v3.75a.75.75 0 0 1-.75.75H8.25v.75h5.25V6z"})}),pl=e=>{let{markPrice:i=0,lastPrice:r,asks:s,bids:o,symbolInfo:a}=e,{showTotal:n}=Ge();return t.jsxs("div",{className:"oui-flex oui-flex-row oui-pl-3 oui-tabular-nums oui-justify-between oui-text-base-contrast-80 oui-text-xs oui-relative oui-cursor-pointer oui-py-[6px]",children:[t.jsxs("div",{className:b("oui-basis-7/12 oui-flex oui-flex-row oui-items-center oui-mr-2 oui-justify-between",n&&"oui-basis-5/12"),children:[t.jsx(Dr,{markPrice:i,lastPrice:r,quote_dp:a.quote_dp,className:"oui-text-base"}),t.jsx(Ar,{markPrice:i,quote_dp:a.quote_dp})]}),t.jsx("div",{className:b("oui-basis-5/12 oui-flex oui-items-center oui-fex-row oui-overflow-hidden oui-relative oui-justify-end",n&&"oui-basis-7/12","oui-pr-3"),children:t.jsx(gl,{asks:s,bids:o})})]})},gl=e=>{let{asks:i,bids:r}=e,{t:s}=_(),o=u.useMemo(()=>{if(r.length===0&&i.length===0)return 0;let a=Number.isNaN(r[0][0])?0:r[0][0],n=i.reverse().findIndex(c=>!Number.isNaN(c[0])),l=0;n!==-1&&(l=Number.isNaN(i[n][0])?0:i[n][0]);let d=new L(l).sub(a).div(new L(l).add(a).div(2));return Math.ceil(d.toNumber()*1e6+.1)/1e4},[i,r]);return t.jsx("div",{children:t.jsx(Ce,{content:s("trading.orderBook.spreadRatio.tooltip"),className:"oui-max-w-[240px]",children:t.jsx(p,{size:"2xs",intensity:36,className:"oui-cursor-pointer oui-underline oui-decoration-dashed oui-decoration-1 oui-underline-offset-4 oui-decoration-base-contrast-36",children:`${o}%`})})})},xl=e=>{let{lastPrice:i,markPrice:r,quote:s,base:o,isLoading:a,onDepthChange:n}=e,l=u.useRef(null),[d,c]=u.useState(!1),[m,h]=A(Pt,o);return u.useEffect(()=>{m!==s&&o&&h(o)},[o,s]),u.useEffect(()=>{let x=new ResizeObserver(f=>{for(let C of f){let{inlineSize:j}=C.borderBoxSize[0];c(j>=360)}}),y=l.current;return y&&x.observe(y),()=>{y&&x.unobserve(y)}},[]),t.jsx(Er,{cellHeight:e.cellHeight??20,onItemClick:e.onItemClick,depth:e.activeDepth,showTotal:d,pendingOrders:e.pendingOrders||[],symbolInfo:e.symbolInfo,children:t.jsxs(xe,{cols:1,rows:5,id:"oui-orderbook-desktop",ref:l,className:"oui-relative oui-size-full oui-grid-rows-[auto,auto,1fr,auto,1fr]",children:[t.jsx(dl,{depths:e.depths,value:e.activeDepth,onChange:n}),t.jsx(cl,{quote:s,base:o}),t.jsx(nl,{data:[...e.asks]}),t.jsx(pl,{lastPrice:i,markPrice:r,asks:[...e.asks],bids:[...e.bids],symbolInfo:e.symbolInfo}),t.jsx(ll,{data:[...e.bids]}),a&&t.jsx("div",{className:"oui-bg-bg-8/70 oui-absolute oui-inset-0 oui-z-10 oui-flex oui-items-center oui-justify-center",children:t.jsx(Yi,{})})]})})},bl=e=>{let{data:i,onClick:r}=e,s=i.est_funding_rate,o=i.countDown,{t:a}=_();return t.jsxs(g,{direction:"column",itemAlign:"start",pb:2,children:[t.jsx(p,{size:"2xs",intensity:36,className:"oui-cursor-pointer oui-underline oui-decoration-line-16 oui-decoration-dashed oui-underline-offset-4",onClick:r,children:a("trading.fundingRate.predFundingRate")}),s===null?"--":t.jsxs("div",{className:"orderly-flex orderly-gap-1 oui-text-2xs oui-text-base-contrast-36",children:[t.jsx(p.numeral,{coloring:!0,suffix:"%",dp:4,children:s??"--"}),t.jsx("span",{children:" in"}),t.jsx("span",{children:" "+o})]})]})},fl=e=>{let{data:i,isLoading:r}=Es(e.symbol),s=u.useMemo(()=>!i||r?"-":`${i.funding_period}h`,[i,r]),o=u.useMemo(()=>!i||r?"-":`${new L(i.cap_funding).mul(100).toNumber()}%`,[i,r]),a=u.useMemo(()=>!i||r?"-":`${new L(i.floor_funding).mul(100).toNumber()}%`,[i,r]);return{fundingPeriod:s,capFunding:o,floorFunding:a}},yl=e=>{let{t:i}=_(),{fundingPeriod:r,capFunding:s,floorFunding:o}=e;return t.jsxs(g,{width:"100%",itemAlign:"center",direction:"column",gap:1,children:[t.jsxs(g,{justify:"between",itemAlign:"center",width:"100%",children:[t.jsx(p,{intensity:54,children:i("trading.fundingRate.predFundingRate.interval")}),t.jsx(p,{intensity:80,children:r})]}),t.jsxs(g,{justify:"between",itemAlign:"center",width:"100%",children:[t.jsxs(p,{intensity:54,children:[i("trading.fundingRate.predFundingRate.cap")," /",i("trading.fundingRate.predFundingRate.floor")]}),t.jsxs(p,{intensity:80,children:[s," / ",o]})]}),t.jsx(ie,{my:4,className:"oui-w-full",intensity:8}),i("markets.symbolInfoBar.predFundingRate.tooltip")]})},$r=e=>{let i=fl(e);return t.jsx(yl,{...i})},Vr="FundingRateDialogId",vl="FundingRateSheetId";Jt(Vr,$r,{size:"md",classNames:{content:"oui-border oui-border-line-6"},title:()=>re.t("funding.fundingRate")});Ps(vl,$r,{title:()=>re.t("funding.fundingRate")});var jl=e=>{let i=Ns(e),r=u.useCallback(()=>{W.show(Vr,{symbol:e})},[e]);return{data:i,onClick:r}},Cl=e=>{let i=jl(e.symbol);return t.jsx(bl,{...i})},wl=e=>{let{accumulated:i,count:r,quantity:s,price:o,type:a,accumulatedAmount:n}=e,l=i/r*100,{cellHeight:d,onItemClick:c,depth:m,symbolInfo:h}=u.useContext(ni),{base_dp:x,quote_dp:y,base:f,quote:C}=h,[j,w]=A(li,["total",f].join("_")),[k,N]=(j==null?void 0:j.split("_"))??[],v=Number.isNaN(i)?"-":n==null?void 0:n.toString(),T=u.useMemo(()=>Gi(m||`${y}`),[m,y]);return t.jsxs(E,{className:b("oui-relative oui-w-full oui-cursor-pointer oui-overflow-hidden oui-text-2xs oui-tabular-nums"),style:{height:`${d}px`},onClick:()=>{Number.isNaN(o)||Number.isNaN(s)||(c==null||c([o,s]))},children:[t.jsxs(g,{itemAlign:"center",justify:"between",children:[t.jsx(p.numeral,{color:a==="bid"?"buy":"sell",dp:T,children:o}),k==="qty"&&t.jsx(p.numeral,{className:"oui-text-base-contrast-80",dp:x,children:Number.isNaN(s)?"-":s}),k==="total"&&N===f&&t.jsx(p.numeral,{className:"oui-text-base-contrast-80",dp:x,children:i}),k==="total"&&N===C&&t.jsx(p.numeral,{className:"oui-text-base-contrast-80",dp:0,children:v})]}),Number.isNaN(l)?null:t.jsx(Ir,{width:l,className:b(a==="ask"?"oui-bg-trade-loss/20":"oui-bg-trade-profit/20")})]})},Br=e=>{let{data:i}=e,{mode:r}=Ge();return t.jsx(E,{className:"oui-order-book-list oui-flex oui-w-full oui-flex-col oui-gap-px",children:i.map((s,o)=>t.jsx(wl,{background:"",price:s[0],quantity:s[1],accumulated:s[2],accumulatedAmount:s[3],count:e.countQty,type:e.type,mode:r},`item-${o}`))})},_l=e=>{let{data:i}=e,r=u.useMemo(()=>{let s=i.length,o=Number.NaN,a=0;for(;Number.isNaN(o)&&a<s;)o=i[a][2],a++;return o},[i]);return t.jsx(Br,{type:"ask",data:i,countQty:r})},Nl=e=>{let{data:i}=e,r=u.useMemo(()=>{let s=Number.NaN,o=i.length-1;for(;Number.isNaN(s)&&o>0;)s=i[o][2],o--;return s},[i]);return t.jsx(Br,{type:"bid",data:i,countQty:r})},Sl=e=>{let i=u.useMemo(()=>e.depth.map(r=>({value:r,label:`${r}`})),[e.depth]);return t.jsx(E,{id:"oui-order-book-depth",className:"oui-w-full oui-pt-2",children:t.jsx(Zi,{options:i,fullWidth:!0,size:"sm",value:e.value,className:"oui-text-2xs oui-text-base-contrast-54",onValueChange:r=>{var s;(s=e.onChange)==null||s.call(e,r)}})})},kl=e=>{let{t:i}=_(),{base:r,quote:s}=e,[o,a]=A(li,["total",r].join("_")),n=u.useMemo(()=>[{value:["qty",r].join("_"),label:`${i("common.quantity")}(${r})`,data:[i("common.quantity"),r]},{value:["total",r].join("_"),label:`${i("common.total")}(${r})`,data:[i("common.total"),r]},{value:["total",s].join("_"),label:`${i("common.total")}(${s})`,data:[i("common.total"),s]}],[i,r,s]);return t.jsxs(g,{justify:"between",width:"100%",className:"oui-py-[5px] oui-text-2xs oui-text-base-contrast-36",children:[t.jsxs(g,{direction:"column",itemAlign:"start",id:"oui-order-book-header-price",children:[t.jsx(p,{children:i("common.price")}),t.jsx(p,{children:`(${s})`})]}),t.jsx(Zi,{size:"sm",value:o,onValueChange:a,options:n,valueRenderer:(l,{open:d,data:c})=>t.jsxs(g,{justify:"between",itemAlign:"center",gap:1,children:[Array.isArray(c)&&t.jsxs(g,{direction:"column",itemAlign:"end",children:[c[0]&&t.jsx(p,{children:c[0]}),c[1]&&t.jsxs(p,{children:["(",c[1],")"]})]}),d?t.jsx(Xi,{size:14,color:"inherit"}):t.jsx(Gt,{size:14,color:"inherit"})]})})]})},Tl=e=>{let{symbolInfo:i}=Ge(),{quote_dp:r}=i;return t.jsxs(g,{id:"oui-order-book-mark-price",className:"oui-py-[6px]",width:"100%",justify:"between",children:[t.jsx(Dr,{markPrice:e.markPrice,lastPrice:e.lastPrice,quote_dp:r,className:"oui-text-sm",iconSize:14}),t.jsx(Ar,{markPrice:e.markPrice,quote_dp:r,className:"oui-text-2xs",iconSize:12})]})},Pl=e=>{let{lastPrice:i,markPrice:r,quote:s,base:o,isLoading:a,onDepthChange:n}=e,l=`PERP_${e.symbolInfo.base}_${e.symbolInfo.quote}`,[d,c]=A(li,["total",o].join("_"));return u.useEffect(()=>{let[m]=(d==null?void 0:d.split("_"))??[];!d.includes(s)&&o&&c([m,o].join("_"))},[s,o,d]),t.jsx(Er,{cellHeight:e.cellHeight??20,onItemClick:e.onItemClick,depth:e.activeDepth,pendingOrders:[],showTotal:!1,symbolInfo:e.symbolInfo,children:t.jsxs(g,{direction:"column",p:2,id:"oui-orderbook-mobile",className:b("oui-relative oui-size-full",e.className),justify:"start",itemAlign:"start",children:[t.jsx(Cl,{symbol:l}),t.jsx(kl,{quote:s,base:o}),t.jsx(_l,{data:e.asks}),t.jsx(Tl,{lastPrice:i,markPrice:r}),t.jsx(Nl,{data:e.bids}),t.jsx(Sl,{depth:e.depths||[],value:e.activeDepth,onChange:n}),a&&t.jsx("div",{className:"oui-bg-base-800/70 oui-absolute oui-inset-0 oui-z-10 oui-flex oui-h-full oui-min-h-[420px] oui-items-center oui-justify-center",children:t.jsx(Yi,{})})]})})},Ol=e=>t.jsx(E,{className:"oui-font-semibold",width:"100%",height:"100%",children:e.isMobile?t.jsx(Pl,{level:e.level,asks:e.asks,bids:e.bids,markPrice:e.markPrice,lastPrice:e.lastPrice,depths:e.depths,activeDepth:e.selDepth,base:e.base,quote:e.quote,isLoading:e.isLoading,onItemClick:e.onItemClick,cellHeight:e.cellHeight,onDepthChange:e.onDepthChange,className:e.className,symbolInfo:e.symbolInfo}):t.jsx(xl,{level:e.level,asks:e.asks,bids:e.bids,markPrice:e.markPrice,lastPrice:e.lastPrice,depths:e.depths,activeDepth:e.selDepth,base:e.base,quote:e.quote,isLoading:e.isLoading,onItemClick:e.onItemClick,cellHeight:e.cellHeight,onDepthChange:e.onDepthChange,className:e.className,pendingOrders:e.pendingOrders,symbolInfo:e.symbolInfo})}),it=20,Mi=104,Ll=e=>{let{symbol:i,height:r}=e,s=Ke()[e.symbol],[o,a]=u.useState(it),[n,l]=u.useState(10),{base:d,quote:c,quote_dp:m}=Ut(s),[h,{onDepthChange:x,isLoading:y,onItemClick:f,depth:C,allDepths:j}]=vs(i,void 0,{level:n}),w=Ml(i);u.useEffect(()=>{if(r){let T=Math.floor((r-Mi)/((it+1)*2)),M=(it+1)*2*T,R=r-Mi-M;R>10?a(it+R/T/2):a(it),l(T)}},[r]);let k=u.useMemo(()=>{if(!(typeof C>"u"||typeof m>"u"))return jt(C)},[C,m,i]),N=u.useMemo(()=>(j==null?void 0:j.map(T=>jt(T)))||[],[j,m]),{isMobile:v}=Qe();return{level:n,asks:h==null?void 0:h.asks,bids:h==null?void 0:h.bids,markPrice:h==null?void 0:h.markPrice,lastPrice:h==null?void 0:h.middlePrice,depths:N,selDepth:k,base:d,quote:c,isLoading:y,onItemClick:f,cellHeight:o,onDepthChange:x,pendingOrders:w,symbolInfo:Ut(s),isMobile:v}},Ml=e=>{let[i]=Oe({status:ae.INCOMPLETE,symbol:e});return u.useMemo(()=>i==null?void 0:i.filter(r=>r.symbol===e).reduce((r,s)=>{let o=s.price||s.trigger_price||0;return[...r,o]},[]),[i,e])},di=e=>{let i=Ll({symbol:e.symbol,height:e.height});return t.jsx(Ol,{...i,className:e.className})},El=e=>{let{riskRate:i,riskRateColor:r,currentLeverage:s,maxLeverage:o}=e,{isHigh:a,isMedium:n,isLow:l}=r,{wrongNetwork:d}=pt(),{t:c}=_(),m=d?"":a?"oui-text-danger":n?"oui-text-warning-darken":l?qi({color:"brand"}):"";return t.jsxs(E,{"data-risk":"",className:"oui-space-y-2",children:[t.jsx(g,{itemAlign:"center",justify:"start",className:"oui-w-full oui-bg-base-6 oui-rounded-full oui-h-2 oui-px-[1px]",children:t.jsx(E,{className:d?"oui-bg-gradient-to-r oui-opacity-20 oui-from-[#26fefe]  oui-via-[#ff7d00] oui-to-[#d92d6b] oui-h-1.5 oui-rounded-full":a?"oui-bg-gradient-to-tr oui-from-[#791438] oui-to-[#ff447c] oui-h-1.5 oui-rounded-full":n?"oui-bg-gradient-to-tr oui-from-[#792e00] oui-to-[#ffb65d] oui-h-1.5 oui-rounded-full":l?"oui-bg-gradient-to-tr oui-from-[#59b0fe] oui-to-[#26fefe] oui-h-1.5 oui-rounded-full":"oui-bg-gradient-to-r oui-opacity-20 oui-from-[#26fefe]  oui-via-[#ff7d00] oui-to-[#d92d6b] oui-h-1.5 oui-rounded-full",style:i&&i!=="--"?{width:i}:{width:"100%"}})}),t.jsxs(g,{className:"oui-gap-2",justify:"between",children:[t.jsxs(g,{direction:"column",children:[t.jsx(Ce,{content:t.jsx(Mr,{description:c("trading.riskRate.tooltip"),formula:c("trading.riskRate.formula")}),children:t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",className:b("oui-cursor-pointer","oui-border-b oui-border-dashed oui-border-b-white/10"),children:c("trading.riskRate")})}),t.jsx(p,{size:"xs",color:"neutral",weight:"semibold",className:b(m),children:i??"--"})]}),t.jsxs(g,{direction:"column",children:[t.jsx(p,{size:"2xs",color:"neutral",weight:"semibold",className:b("oui-cursor-pointer","oui-border-b oui-border-b-transparent"),children:c("leverage.maxAccountLeverage")}),t.jsxs(g,{className:"oui-gap-1",children:[t.jsx(p.numeral,{dp:2,padding:!1,suffix:s?"x":void 0,children:s??"--"}),t.jsx("span",{className:"oui-text-base-contrast-54",children:"/"}),t.jsxs("button",{className:"oui-flex oui-items-center oui-gap-1",onClick:()=>{W.show(Us,{currentLeverage:5})},"data-testid":"oui-testid-riskRate-leverage-button",children:[t.jsx(p.numeral,{dp:2,padding:!1,suffix:o?"x":void 0,"data-testid":"oui-testid-riskRate-leverage-value",children:o??"--"}),typeof o<"u"&&o!==null&&t.jsx($i,{size:12,color:"white"})]})]})]})]})]})},Il=e=>{if(e===null)return{isHigh:!1,isMedium:!1,isLow:!1,isDefault:!0};let i=e<40,r=e>=40&&e<80,s=e>=80;return{isHigh:s,isMedium:r,isLow:i,isDefault:!i&&!r&&!s}},Rl=()=>{let{state:e}=ue(),i=e.status>=U.EnableTrading||e.status===U.EnableTradingWithoutConnected,{marginRatio:r,currentLeverage:s,mmr:o}=_t(),{curLeverage:a}=Zt(),n=u.useMemo(()=>!i||r===null||o===null?"--":r===0||o===0?"0%":`${new L(o).div(r).mul(100).todp(2,L.ROUND_UP).toString().replace(/\.?0+$/,"")}%`,[i,r,o]),l=n==="--"?null:parseFloat(n),d=u.useMemo(()=>Il(l),[l]),c=de(s),m=de(a);return{riskRate:de(n),riskRateColor:d,isConnected:i,currentLeverage:c,maxLeverage:m}},Dl=()=>{let e=Rl();return t.jsx(El,{...e})},Al=e=>{var i;return t.jsx("div",{ref:e.containerRef,className:"oui-h-full",children:(((i=e.containerSize)==null?void 0:i.width)||0)>=572?t.jsx(zl,{...e}):t.jsx($l,{...e})})},zl=e=>{var r;let{t:i}=_();return t.jsxs(xe,{cols:2,width:"100%",gap:3,className:"oui-auto-rows-fr",style:{height:(r=e.containerSize)==null?void 0:r.height},children:[t.jsxs(g,{direction:"column",itemAlign:"start",pt:3,pb:3,r:"2xl",className:"oui-bg-base-9",children:[t.jsx(Ei,{title:i("trading.orderBook"),className:"oui-pl-3 oui-text-sm"}),t.jsx(di,{symbol:e.symbol,height:e.containerSize?e.containerSize.height-29-24:void 0})]}),t.jsxs(g,{direction:"column",itemAlign:"start",py:3,r:"2xl",className:"oui-bg-base-9 oui-h-full",children:[t.jsx(Ei,{title:i("trading.lastTrades"),className:"oui-text-sm oui-px-3"}),t.jsx(ai,{symbol:e.symbol,style:{height:e.containerSize&&e.containerSize.height-29-24},classNames:{listHeader:"oui-px-3",list:"oui-px-3"}})]})]})},$l=e=>{var r;let{t:i}=_();return t.jsx(E,{pt:3,pb:3,pr:0,r:"2xl",className:"oui-bg-base-9",style:{maxHeight:(r=e.containerSize)==null?void 0:r.height},children:t.jsxs(mt,{value:e.tab,variant:"contained",onValueChange:s=>{e.setTab(s)},classNames:{tabsList:"oui-pl-3"},size:"lg",children:[t.jsx(ee,{value:"orderBook",title:i("trading.orderBook"),children:t.jsx(di,{symbol:e.symbol,height:e.containerSize?e.containerSize.height-29-18:void 0})}),t.jsx(ee,{value:"lastTrades",title:i("trading.lastTrades"),children:t.jsx(ai,{symbol:e.symbol,style:{height:e.containerSize&&e.containerSize.height-29-18},classNames:{root:"oui-pt-[6px]",listHeader:"oui-px-3",list:"oui-px-3"}})})]})})},Ei=e=>t.jsx(p,{size:"base",intensity:80,className:b("oui-pb-[5px]",e.className),children:e.title}),Vl=e=>{let[i,r]=u.useState(void 0),[s,o]=u.useState("orderBook"),a=u.useRef();return u.useEffect(()=>{let n=new ResizeObserver(d=>{for(let c of d){let{width:m,height:h}=c.contentRect;r({width:m,height:h})}}),l=a.current;return l&&n.observe(l),()=>{l&&n.unobserve(l)}},[]),{symbol:e,containerSize:i,containerRef:a,tab:s,setTab:o}},Bl=e=>{let i=Vl(e.symbol);return t.jsx(Al,{...i})},Hl=e=>{let{onMouseDown:i,mode:r="horizontal",...s}=e,o=u.useMemo(()=>{var n;return(n=e.className)==null?void 0:n.split(" ").includes("disable")},[e.className]),a=u.useMemo(()=>{var n;return(n=e.className)==null?void 0:n.split(" ").filter(l=>l!=="disable")},[e.className]);return t.jsx("div",{...s,className:b(a,"!oui-transition-none","!oui-shadow-none !oui-bg-transparent","hover:!oui-bg-primary-light hover:!oui-shadow-[0px_0px_4px_0px] hover:!oui-shadow-primary-light/80","active:!oui-bg-primary-light active:!oui-shadow-[0px_0px_4px_0px] active:!oui-shadow-primary-light/80","focus:!oui-bg-primary-light focus:!oui-shadow-[0px_0px_4px_0px] focus:!oui-shadow-primary-light/80",r==="horizontal"?"!oui-w-[2px] !oui-min-w-[2px] !oui-mx-[3px]":"!oui-h-[2px] !oui-min-h-[2px] !oui-my-[3px]",o&&"oui-pointer-events-none"),children:t.jsx("div",{onMouseDown:i,className:b("!oui-transition-none",r==="horizontal"?"after:!oui-w-[2px]":"after:!oui-h-[2px]","after:!oui-bg-transparent after:!oui-shadow-transparent")})})},rt=u.forwardRef((e,i)=>{let{onSizeChange:r,...s}=e;return t.jsx(ur,{ref:i,...s,lineBar:!0,renderBar:o=>t.jsx(Hl,{...o,mode:e.mode}),onDragEnd:(o,a,n)=>{r==null||r(`${a}`)}})}),ql=()=>t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"oui-rounded-full",children:[t.jsxs("g",{clipPath:"url(#a)",children:[t.jsx("path",{d:"m31.002 14.493-8.326-22.51L.166.31l8.327 22.51z",fill:"#03435D"}),t.jsx("path",{d:"m4.456-8.716-18.03 15.84 15.84 18.03 18.03-15.84z",fill:"#157CF2"}),t.jsx("path",{d:"m17.548 38.67 22.825-7.416-7.416-22.825-22.826 7.416z",fill:"#F3E200"})]}),t.jsx("defs",{children:t.jsx("clipPath",{id:"a",children:t.jsx("rect",{width:"24",height:"24",rx:"12",fill:"#fff"})})})]}),Fl=()=>t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5.832 2.492A3.333 3.333 0 0 0 2.5 5.826v5a3.333 3.333 0 0 0 3.333 3.333 3.333 3.333 0 0 0 3.334 3.333h5a3.333 3.333 0 0 0 3.333-3.333v-5a3.333 3.333 0 0 0-3.333-3.333 3.333 3.333 0 0 0-3.334-3.334zm8.334 5c.92 0 1.666.746 1.666 1.667v5c0 .92-.746 1.666-1.666 1.666h-5c-.92 0-1.667-.745-1.667-1.666h3.333a3.333 3.333 0 0 0 3.334-3.334z",fill:"rgb(var(--oui-color-primary))"})}),Ii=e=>{let{size:i=20}=e;return t.jsxs("svg",{width:i,height:i,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsxs("g",{clipPath:"url(#a)",children:[t.jsx("path",{d:"M10 20c5.542 0 10-4.458 10-10S15.542 0 10 0 0 4.458 0 10s4.458 10 10 10",fill:"#2775CA"}),t.jsx("path",{d:"M13 11.473c0-1.452-.94-1.95-2.82-2.158-1.344-.166-1.613-.498-1.613-1.078s.448-.955 1.343-.955c.806 0 1.254.25 1.478.872.045.124.18.207.313.207h.717c.179 0 .313-.125.313-.29v-.042c-.179-.913-.985-1.618-2.015-1.701v-.996c0-.166-.134-.29-.358-.332h-.671c-.18 0-.314.124-.359.332v.954c-1.343.166-2.194.996-2.194 2.034 0 1.369.896 1.908 2.776 2.116 1.254.207 1.657.456 1.657 1.12s-.627 1.12-1.477 1.12c-1.165 0-1.568-.456-1.702-1.078a.32.32 0 0 0-.313-.25h-.762c-.179 0-.313.125-.313.291v.042c.179 1.037.895 1.784 2.373 1.991v.996c0 .166.134.29.358.332h.672c.18 0 .313-.124.358-.332v-.996C12.105 13.465 13 12.593 13 11.473",fill:"#fff",fillOpacity:".98"}),t.jsx("path",{d:"M7.74 16.57c-3.458-1.215-5.23-4.986-3.945-8.324.665-1.821 2.127-3.208 3.944-3.859.178-.086.266-.216.266-.433v-.607c0-.174-.088-.304-.266-.347-.044 0-.133 0-.177.043-4.21 1.3-6.516 5.68-5.186 9.798.798 2.428 2.704 4.292 5.186 5.072.177.087.355 0 .399-.173.044-.043.044-.087.044-.173v-.608c0-.13-.133-.303-.266-.39m4.698-13.527c-.178-.086-.355 0-.4.174-.043.043-.043.086-.043.173v.607c0 .174.133.347.266.434 3.457 1.213 5.23 4.985 3.944 8.323-.664 1.821-2.127 3.209-3.944 3.859-.178.086-.266.216-.266.433v.607c0 .174.088.304.266.347.044 0 .133 0 .177-.043 4.21-1.3 6.515-5.68 5.186-9.798-.798-2.471-2.748-4.335-5.186-5.116",fill:"#fff"})]}),t.jsx("defs",{children:t.jsx("clipPath",{id:"a",children:t.jsx("path",{fill:"#fff",d:"M0 0h20v20H0z"})})})]})},Ul=e=>{let{size:i=20}=e;return t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsxs("g",{clipPath:"url(#clip0_6403_64483)",children:[t.jsx("path",{d:"M10.0245 19.9493C15.5198 19.9493 19.9747 15.4944 19.9747 9.99908C19.9747 4.50371 15.5198 0.0488281 10.0245 0.0488281C4.5291 0.0488281 0.0742188 4.50371 0.0742188 9.99908C0.0742188 15.4944 4.5291 19.9493 10.0245 19.9493Z",fill:"url(#paint0_linear_6403_64483)"}),t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.1553 4.89304C14.2199 4.94541 14.1821 5.04758 14.0989 5.04758H5.95035C5.86716 5.04758 5.82936 4.94541 5.894 4.89304C7.0223 3.97912 8.45953 3.43164 10.0246 3.43164C11.5898 3.43164 13.0269 3.97912 14.1553 4.89304Z",fill:"white"}),t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.47013 11.7869C7.42315 11.7199 7.34748 11.6777 7.26565 11.6777H3.82985C3.75113 11.6777 3.69375 11.7525 3.71563 11.8281C4.5078 14.565 7.0326 16.566 10.0247 16.566C13.017 16.566 15.5417 14.565 16.3339 11.8281C16.3558 11.7525 16.2984 11.6777 16.2197 11.6777H12.7839C12.702 11.6777 12.6264 11.7199 12.5795 11.7869C12.0155 12.5911 11.0815 13.1167 10.0248 13.1167C8.96803 13.1167 8.03406 12.5911 7.47013 11.7869Z",fill:"white"}),t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.3347 7.90519C12.3822 7.95756 12.449 7.9891 12.5196 7.9891H16.1137C16.1952 7.9891 16.253 7.90983 16.2261 7.83301C15.9724 7.10689 15.5948 6.43893 15.1187 5.85447C15.074 5.79961 15.0067 5.76855 14.9358 5.76855H5.11323C5.04247 5.76855 4.97512 5.79961 4.93044 5.85447C4.45429 6.43893 4.0767 7.10689 3.82306 7.83301C3.79622 7.90983 3.85398 7.9891 3.93536 7.9891H7.52952C7.60022 7.9891 7.66694 7.95756 7.71445 7.90519C8.28491 7.2763 9.10861 6.88136 10.0246 6.88136C10.9405 6.88136 11.7643 7.2763 12.3347 7.90519Z",fill:"white"}),t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.1164 10.9586C13.0553 10.9586 13.0118 10.899 13.0284 10.8401C13.1033 10.5722 13.1433 10.2898 13.1433 9.9981C13.1433 9.58758 13.064 9.19556 12.9199 8.83657C12.8954 8.77581 12.9392 8.70801 13.0046 8.70801H16.392C16.4349 8.70801 16.472 8.73831 16.4799 8.78052C16.5538 9.17511 16.5925 9.58216 16.5925 9.9982C16.5925 10.2978 16.5724 10.5926 16.5337 10.8815C16.5277 10.9258 16.4897 10.9586 16.4451 10.9586H13.1164ZM7.02223 10.8401C7.03868 10.899 6.99532 10.9586 6.93421 10.9586H3.60551C3.56084 10.9586 3.52285 10.9258 3.5169 10.8815C3.47807 10.5926 3.45801 10.2978 3.45801 9.9982C3.45801 9.58216 3.4967 9.17511 3.57069 8.78052C3.57859 8.73831 3.61563 8.70801 3.65856 8.70801H7.04593C7.11141 8.70801 7.15516 8.77581 7.13076 8.83657C6.98657 9.19556 6.90722 9.58758 6.90722 9.9981C6.90722 10.2898 6.94728 10.5722 7.02223 10.8401Z",fill:"white"})]}),t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"paint0_linear_6403_64483",x1:"10.0245",y1:"0.0488561",x2:"10.0245",y2:"19.9493",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{stopColor:"#C750FF"}),t.jsx("stop",{offset:"1",stopColor:"#5800E8"})]}),t.jsx("clipPath",{id:"clip0_6403_64483",children:t.jsx("rect",{width:"20",height:"20",fill:"white"})})]})]})},Wl=e=>{let{t:i}=_();return t.jsxs(g,{direction:"column",gap:4,children:[t.jsx(Ql,{...e}),t.jsx(Kl,{...e}),t.jsx(Yl,{...e}),t.jsxs(g,{gap:3,width:"100%",justify:"center",children:[e.showGetTestUSDC&&t.jsx(K,{variant:"outlined",size:"md",onClick:e.onGetTestUSDC,fullWidth:!0,loading:e.gettingTestUSDC,className:"oui-border-primary-light oui-text-primary-light",children:i("trading.faucet.getTestUSDC")}),t.jsx(K,{variant:"outlined",color:"danger",size:"md",onClick:e.onDisconnect,className:e.showGetTestUSDC?"oui-w-full":"oui-w-[50%]",children:i("connector.disconnect")})]})]})},Ql=e=>t.jsxs(g,{width:"100%",justify:"between",children:[t.jsxs(g,{gap:3,children:[t.jsx(ql,{}),t.jsxs(g,{direction:"column",justify:"start",itemAlign:"start",className:"oui-gap-[2px]",children:[t.jsx(p.formatted,{rule:"address",children:e.address}),t.jsx(p.formatted,{size:"2xs",intensity:80,prefix:t.jsx("div",{className:"oui-h-1 oui-w-1 oui-rounded-full oui-bg-success oui-pr-1"}),children:e.chainName})]})]}),t.jsx("button",{className:"oui-cursor-pointer",onClick:()=>{e.onCopyAddress()},children:t.jsx(Fl,{})})]}),Kl=e=>{let{t:i}=_();return t.jsxs(g,{direction:"column",gap:3,r:"lg",p:3,className:"oui-bg-base-6",width:"100%",children:[t.jsx("button",{onClick:e.onClickReferral,className:"oui-cursor-pointer oui-w-full",children:t.jsxs(g,{justify:"between",width:"100%",children:[t.jsx(p,{size:"2xs",children:i("affiliate.referral")}),t.jsx(Ji,{color:"white",opacity:.98,size:16})]})}),e.isAffiliate&&t.jsxs(g,{gradient:"primary",p:4,r:"lg",width:"100%",angle:180,justify:"between",children:[t.jsxs(g,{direction:"column",itemAlign:"start",children:[t.jsx(p,{size:"xs",children:i("common.affiliate")}),t.jsxs(p,{size:"2xs",intensity:54,children:["(",i("affiliate.commission.30d"),")"]})]}),t.jsxs(g,{className:"oui-gap-[6px]",children:[t.jsx(Ii,{}),t.jsx(p.numeral,{dp:2,padding:!1,rm:L.ROUND_DOWN,rule:"price",children:e.affiliateCommission30D??"--"})]})]}),e.isTrader&&t.jsxs(g,{gradient:"success",p:4,r:"lg",width:"100%",angle:180,justify:"between",children:[t.jsxs(g,{direction:"column",itemAlign:"start",children:[t.jsx(p,{size:"xs",children:i("affiliate.trader")}),t.jsxs(p,{size:"2xs",intensity:54,children:["(",i("affiliate.commission.30d"),")"]})]}),t.jsxs(g,{className:"oui-gap-[6px]",children:[t.jsx(Ii,{}),t.jsx(p.numeral,{dp:2,padding:!1,rm:L.ROUND_DOWN,rule:"price",children:e.traderCommission30D??"--"})]})]})]})},Yl=e=>{var r;let{t:i}=_();return t.jsxs(g,{direction:"column",gap:3,r:"lg",p:3,className:"oui-bg-base-6",width:"100%",children:[t.jsx("button",{onClick:e.onClickTradingRewards,className:"oui-cursor-pointer oui-w-full",children:t.jsxs(g,{justify:"between",width:"100%",children:[t.jsxs(g,{gap:1,className:"oui-text-base-contrast oui-text-2xs",children:[t.jsx(p,{children:i("common.tradingRewards")}),t.jsxs(p,{intensity:54,children:["(",t.jsx(p,{children:`${(r=i("tradingRewards.epoch"))==null?void 0:r.toLowerCase()} `}),t.jsx(p,{intensity:98,children:e.curEpochId})," )"]})]}),t.jsx(Ji,{color:"white",opacity:.98,size:16})]})}),t.jsxs(g,{p:4,r:"lg",width:"100%",angle:180,justify:"between",className:"oui-bg-gradient-to-t oui-from-[#2d0061] oui-to-[#bd6bed]",children:[t.jsx(p,{size:"2xs",intensity:80,children:i("tradingRewards.myEstRewards")}),t.jsxs(g,{className:"oui-gap-[6px]",children:[t.jsx(Ul,{}),t.jsx(p.numeral,{dp:2,padding:!1,rm:L.ROUND_DOWN,rule:"price",children:e.estRewards})]})]})]})},Zl=e=>{let{t:i}=_(),[r]=A("orderly_link_device",{}),{account:s,state:o}=ue(),a=s.accountId,n=s.address,{hide:l}=Is(),d=kt(),{connectedChain:c,disconnect:m,namespace:h}=Ui(),x=s.chainId||(c==null?void 0:c.id)||(r==null?void 0:r.chainId),y=u.useMemo(()=>x?(o.status===U.EnableTrading||o.status===U.EnableTradingWithoutConnected)&&Qi(parseInt(x)):!1,[o.status,x]),f=Jl(x),C=d.get("operatorUrl"),j=()=>{navigator.clipboard.writeText(n??""),Z.success(i("common.copy.copied"))},{affiliateCommission30D:w,traderCommission30D:k,isAffiliate:N,isTrader:v,onClickReferral:T}=Xl(e.onClickReferral),{curEpochId:M,estRewards:R,onClickTradingRewards:V}=Gl(e.onClickTradingRewards),X=async()=>{var q;localStorage.removeItem("orderly_link_device"),await m({label:(q=o.connectWallet)==null?void 0:q.name}),await s.disconnect(),l()},[G,{isMutating:Q}]=Wi(`${C}/v1/faucet/usdc`);return{accountId:a,address:n,chainId:x,chainName:f,onCopyAddress:j,affiliateCommission30D:w,onClickReferral:T,isAffiliate:N,isTrader:v,traderCommission30D:k,curEpochId:M,onClickTradingRewards:V,estRewards:R,onDisconnect:X,showGetTestUSDC:y,onGetTestUSDC:()=>{if(o.status<U.EnableTrading&&o.status!==U.EnableTradingWithoutConnected)return;let q=i("trading.faucet.getTestUSDC.success",{quantity:h===Ki.solana?"100":"1,000"});return G({chain_id:x==null?void 0:x.toString(),user_address:o.address,broker_id:d.get("brokerId")}).then(se=>{if(se.success)return W.alert({title:i("trading.faucet.getTestUSDC"),message:q,onOk:()=>Promise.resolve(!0)});se.message&&Z.error(se.message)},se=>{Z.error(se.message)})},gettingTestUSDC:Q}},Xl=e=>{let{data:i,isAffiliate:r,isTrader:s}=Ds(),o=u.useMemo(()=>{if(r)return i==null?void 0:i.referrer_info["30d_referrer_rebate"]},[i]),a=u.useMemo(()=>{if(s)return i==null?void 0:i.referee_info["30d_referee_rebate"]},[i]);return{onClickReferral:()=>{e==null||e()},affiliateCommission30D:o,traderCommission30D:a,isAffiliate:r,isTrader:s}},Gl=e=>{let[i]=As(xi.normal),[r,s]=zs(xi.normal),o=u.useMemo(()=>{var n;return((n=s.curEpochInfo)==null?void 0:n.epoch_id)??"--"},[s]),a=u.useMemo(()=>typeof(i==null?void 0:i.est_r_wallet)>"u"?"--":i==null?void 0:i.est_r_wallet,[i]);return{curEpochId:o,estRewards:a,onClickTradingRewards:()=>{e==null||e()}}};function Jl(e){let[i,{findByChainId:r}]=Rs("mainnet",{pick:"network_infos",filter:s=>{var o,a;return((o=s.network_infos)==null?void 0:o.bridge_enable)||((a=s.network_infos)==null?void 0:a.bridgeless)}});return u.useMemo(()=>{let s=r(parseInt(e),"network_infos");return s?s.name:"Unknown"},[e,r])}var ed=e=>{let i=Zl(e);return t.jsx(Wl,{...i})},td=()=>{let{t:e}=_(),{referral:i,tradingRewards:r,bottomSheetLeading:s}=Le(),{account:o,state:a}=ue();return{onShowAccountSheet:()=>{W.sheet({title:e("common.account"),leading:s,content:t.jsx(ed,{...i,...r})})},address:o.address,state:a}},id=e=>t.jsx(Tt,{buttonProps:{size:"sm"},children:t.jsx(K,{variant:"gradient",size:"sm",className:"oui-max-w-[83px]",onClick:i=>{e.onShowAccountSheet()},children:Ms(e.address,[4,4])})});Os({name:"mobile-account-menu",positions:[Ls.MobileAccountMenu],builder:td,__isInternal:!0})(e=>t.jsx(id,{...e}));var rd=()=>{let{account:e,isMainAccount:i}=ue(),r=sd(),s=od(),o=ut(),{t:a}=_(),[n,l]=u.useState(!1),d=u.useCallback(async()=>e.settle().catch(x=>{if(x.code==-1104)return Z.error(a("settle.settlement.error")),Promise.reject(x);if(x.message.indexOf("Signing off chain messages with Ledger is not yet supported")!==-1)return o.emit("wallet:sign-message-with-ledger-error",{message:x.message,userAddress:e.address}),Promise.reject(x);if((x==null?void 0:x.code)==="ACTION_REJECTED")return Z.error(a("connector.userRejected")),Promise.reject(x)}).then(x=>(Z.success(a("settle.settlement.requested")),Promise.resolve(x))),[e,a]),c=u.useCallback(()=>{W.show(bi,{activeTab:"deposit"})},[]),m=u.useCallback(()=>{W.show(bi,{activeTab:"withdraw"})},[]),h=u.useCallback(()=>{W.show(Bs)},[]);return{...r,...s,onSettlePnL:d,onDeposit:c,onWithdraw:m,showSliderTip:n,setShowSliderTip:l,isMainAccount:i,onTransfer:h}},sd=()=>{let{hideAssets:e,setHideAssets:i}=De(),r=()=>{i(!e)},{totalCollateral:s,freeCollateral:o,totalValue:a,availableBalance:n}=dt({dp:2});return{hideAssets:e,toggleHideAssets:r,totalCollateral:s,freeCollateral:o,totalValue:a,availableBalance:n}},od=()=>{let{t:e}=_(),[{aggregated:i,totalUnrealizedROI:r},s]=ct(),{marginRatio:o,currentLeverage:a,mmr:n}=_t(),l=u.useMemo(()=>Math.min(10,i.notional===0?s.margin_ratio(10):o),[o,i]),{update:d,curLeverage:c,maxLeverage:m,leverageLevers:h}=Zt(),x=u.useMemo(()=>h==null?void 0:h.map(T=>({label:`${T}x`,value:T})),[h]),[y,f]=u.useState(c??0),C=100/(((x==null?void 0:x.length)||0)-1),j=T=>{f(T)},w=async T=>{try{d({leverage:T}).then(()=>{Z.success(e("leverage.updated"))},M=>{Z.error(M.message)})}catch{}},k=u.useCallback(T=>{w(Array.isArray(T)?T[0]:T)},[]),N=Ai(k,500),v=u.useCallback(T=>{let M=Number.parseInt(T.target.value,10),R=Number.isNaN(M)?0:M,V=Math.min(Math.max(R,1),m);f(V),N(V)},[N,m]);return{aggregated:i,totalUnrealizedROI:r,positionsInfo:s,marginRatio:o,marginRatioVal:l,mmr:n,currentLeverage:a,step:C,marks:x,onLeverageChange:j,onLeverageIncrease:()=>{f(T=>(w(T+1),T+1))},onLeverageReduce:()=>{f(T=>(w(T-1),T-1))},onInputChange:v,isReduceDisabled:y<=1,isIncreaseDisabled:y>=m,onValueCommit:k,value:y,maxLeverage:m,onSaveLeverage:w}};function ad(e,i){if(i===null)return{isRed:!1,isYellow:!1,isGreen:!0};let r=i*2,s=e<=r,o=e>r&&e<1,a=e>=1;return{high:s,mid:o,low:a}}var nd=e=>{let{size:i=20,className:r}=e;return t.jsx("div",{className:"oui-flex oui-justify-center oui-items-end",style:{background:"url(/images/riskLevelBg.png)",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center bottom",width:`${i}px`,height:"14px"},children:t.jsx("div",{className:b("oui-relative oui-w-[2px] oui-h-[2px] oui-rounded-full oui-bg-white after:oui-block after:oui-content-[''] after:oui-absolute after:oui-right-0 after:oui-w-[10px] after:oui-h-[2px] after:oui-bg-white/50",r)})})},ld=e=>t.jsxs(g,{direction:"column",gap:4,width:"100%",children:[t.jsx(dd,{...e}),t.jsx(ie,{className:"oui-w-full"}),t.jsx(ud,{...e}),t.jsx(cd,{...e})]}),dd=e=>{let{t:i}=_(),r=u.useCallback(()=>W.confirm({title:i("settle.settlePnl"),content:t.jsx(p,{intensity:54,size:"xs",children:t.jsx(zt,{i18nKey:"settle.settlePnl.description"})}),onCancel:()=>Promise.reject(),onOk:()=>typeof e.onSettlePnL!="function"?Promise.resolve():e.onSettlePnL().catch(o=>{})}),[i]),s=e.totalUnrealizedROI>0?"oui-text-success-darken":"oui-text-danger-darken";return t.jsxs(g,{direction:"column",gap:3,width:"100%",children:[t.jsxs(g,{direction:"column",itemAlign:"start",width:"100%",children:[t.jsx(p.formatted,{size:"2xs",intensity:36,suffix:e.hideAssets?t.jsx(ti,{opacity:1,size:16,className:"oui-text-primary-light"}):t.jsx(ii,{opacity:1,size:16,className:"oui-text-primary-light"}),onClick:()=>{e.toggleHideAssets()},className:"oui-cursor-pointer",children:`${i("common.totalValue")} (USDC)`}),t.jsx(p.numeral,{size:"base",dp:2,padding:!1,visible:!e.hideAssets,children:e.totalValue??"--"})]}),t.jsxs(xe,{cols:2,rows:1,width:"100%",children:[t.jsx(We,{label:`${i("common.unrealizedPnl")} (USDC)`,classNames:{label:"oui-text-2xs oui-text-base-contrast-36"},children:t.jsxs(g,{gap:1,children:[t.jsx(p.numeral,{size:"xs",coloring:!0,dp:2,padding:!1,visible:!e.hideAssets,children:e.aggregated.unrealPnL}),!e.hideAssets&&t.jsx(p.numeral,{size:"xs",dp:2,padding:!1,rule:"percentages",prefix:"(",suffix:")",className:s,children:e.totalUnrealizedROI})]})}),t.jsx(We,{label:`${i("trading.asset.unsettledPnl")} (USDC)`,classNames:{label:"oui-text-2xs oui-text-base-contrast-36"},children:t.jsxs(g,{justify:"between",width:"100%",children:[t.jsx(p.numeral,{size:"xs",coloring:!0,dp:2,padding:!1,visible:!e.hideAssets,children:e.aggregated.unsettledPnL}),t.jsxs("button",{className:"oui-flex oui-gap-1 oui-items-center",onClick:r,children:[t.jsx(bs,{opacity:1,size:12,className:"oui-text-primary-light"}),t.jsx(p,{size:"2xs",color:"primary",children:i("settle.settlePnl")})]})]})})]})]})},ud=e=>{let{t:i}=_(),{high:r,mid:s,low:o}=ad(e.marginRatioVal,e.mmr);return t.jsxs(xe,{cols:2,rows:1,width:"100%",children:[t.jsx(We,{label:i("trading.asset.marginRatio"),classNames:{label:"oui-text-2xs oui-text-base-contrast-36"},children:t.jsxs(g,{gap:2,children:[t.jsx(p.numeral,{size:"xs",rule:"percentages",color:"primary",dp:2,padding:!1,visible:!e.hideAssets,children:e.marginRatioVal}),!e.hideAssets&&t.jsx(nd,{className:o?"oui-rotate-0":s?"oui-rotate-90":r?"oui-rotate-180":""})]})}),t.jsx(We,{label:`${i("trading.asset.free&TotalCollateral")} (USDC)`,classNames:{label:"oui-text-2xs oui-text-base-contrast-36"},children:t.jsxs(g,{justify:"start",width:"100%",gap:1,children:[t.jsx(p.numeral,{size:"xs",dp:2,padding:!1,visible:!e.hideAssets,children:e.freeCollateral}),t.jsx(p,{size:"xs",children:"/"}),t.jsx(p.numeral,{size:"xs",dp:2,padding:!1,visible:!e.hideAssets,children:e.totalCollateral})]})})]})},cd=e=>{let{t:i}=_();return e.isMainAccount?t.jsxs(xe,{cols:2,rows:1,gap:3,className:"oui-grid-row-[1fr,1fr]",width:"100%",pt:2,pb:4,children:[t.jsx(K,{icon:t.jsx(Fi,{color:"white",opacity:.8}),size:"md",fullWidth:!0,className:"oui-bg-base-2 hover:oui-bg-base-2/50",onClick:e.onWithdraw,children:i("common.withdraw")}),t.jsx(K,{icon:t.jsx(nt,{color:"white",opacity:.8}),size:"md",fullWidth:!0,onClick:e.onDeposit,children:i("common.deposit")})]}):t.jsx(K,{fullWidth:!0,color:"secondary",size:"md",onClick:e.onTransfer,"data-testid":"oui-testid-assetView-transfer-button",children:t.jsx(p,{children:i("common.transfer")})})},hd=()=>{let e=rd();return t.jsx(ld,{...e})},md=e=>{let{symbol:i,sharePnLConfig:r}=e,[s,o]=u.useState("Position"),[a,n]=u.useState("Position history"),{t:l}=_(),{onSymbolChange:d}=Le(),c=De(),[m,{cancelAllOrders:h,cancelAllTPSLOrders:x}]=Oe({}),{positionCount:y}=Tr(i),{pendingOrderCount:f,tpSlOrderCount:C}=Pr(i);return{tab:s,setTab:o,subTab:a,setSubTab:n,sharePnLConfig:r,symbol:i,positionCount:y,pendingOrderCount:f,tpSlOrderCount:C,...c,onCloseAll:j=>{let w=j===ne.pending?l("orders.pending.cancelAll"):j===ne.tp_sl?l("orders.tpsl.cancelAll"):"",k=j===ne.pending?l("orders.pending.cancelAll.description"):j===ne.tp_sl?l("orders.tpsl.cancelAll.description"):"";W.confirm({title:w,content:t.jsx(p,{size:"2xs",children:k}),onOk:async()=>{try{return s==="TP/SL"?await x():await h(),Promise.resolve(!0)}catch(N){return(N==null?void 0:N.message)!==void 0&&toast.error(N.message),Promise.resolve(!1)}finally{Promise.resolve()}}})},onSymbolChange:d}},pd=e=>{let{t:i}=_();return t.jsxs(mt,{value:e.tab,onValueChange:r=>e.setTab(r),size:"lg",className:e.className,classNames:{tabsList:"oui-bg-base-9 oui-rounded-t-xl oui-p-2 oui-overflow-x-scroll oui-hide-scrollbar"},children:[t.jsx(ee,{title:`${i("common.positions")} ${(e.positionCount??0)>0?`(${e.positionCount})`:""}`,value:"Position",children:t.jsx(gd,{...e})}),t.jsx(ee,{title:`${i("orders.status.pending")} ${(e.pendingOrderCount??0)>0?`(${e.pendingOrderCount})`:""}`,value:"Pending",children:t.jsx(Wt,{type:ne.pending,ordersStatus:ae.INCOMPLETE,...e})}),t.jsx(ee,{title:`${i("common.tpsl")} ${(e.tpSlOrderCount??0)>0?`(${e.tpSlOrderCount})`:""}`,value:"TP/SL",children:t.jsx(Wt,{type:ne.tp_sl,ordersStatus:ae.INCOMPLETE,...e})}),t.jsx(ee,{title:i("trading.history"),value:"History",children:t.jsx(bd,{...e})}),t.jsx(ee,{title:i("positions.liquidation"),value:"Liquidation",children:t.jsx(Hs,{enableLoadMore:!0,symbol:e.showAllSymbol?void 0:e.symbol,classNames:{cell:"oui-p-2 oui-bg-base-9 oui-rounded-xl"}})})]})},gd=e=>t.jsxs(g,{direction:"column",gap:2,children:[t.jsx(kr,{pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision,symbol:e.showAllSymbol?void 0:e.symbol,unPnlPriceBasis:e.unPnlPriceBasis}),t.jsx(Ks,{symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,sharePnLConfig:e.sharePnLConfig,pnlNotionalDecimalPrecision:e.pnlNotionalDecimalPrecision})]}),Wt=e=>t.jsxs(g,{direction:"column",pb:2,width:"100%",children:[t.jsx(ie,{className:"oui-w-full"}),e.type!==ne.orderHistory&&t.jsx(xd,{...e}),t.jsx(Ys,{symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,type:e.type,ordersStatus:e.ordersStatus,classNames:{root:"oui-w-full oui-hide-scrollbar oui-overflow-y-hidden",content:"!oui-space-y-1",cell:"oui-py-2 oui-bg-base-9 oui-p-2 oui-rounded-xl"},sharePnLConfig:e.sharePnLConfig,showFilter:e.type===ne.orderHistory,filterConfig:{range:{from:void 0,to:void 0}}})]}),xd=e=>{let{t:i}=_();return t.jsxs(g,{px:2,py:2,width:"100%",justify:"between",gap:2,className:"oui-rounded-b-xl oui-bg-base-9",children:[t.jsxs(g,{className:"oui-cursor-pointer oui-gap-[2px]",children:[t.jsx(be,{color:"white",checked:!e.showAllSymbol,onCheckedChange:r=>{e.setShowAllSymbol(!r)}}),t.jsx(p,{size:"2xs",intensity:54,onClick:()=>{e.setShowAllSymbol(!e.showAllSymbol)},children:i("trading.hideOtherSymbols")})]}),t.jsx(K,{variant:"outlined",size:"xs",color:"secondary",onClick:r=>{e.onCloseAll(e.type)},children:i("trading.orders.closeAll")})]})},bd=e=>{let{t:i}=_();return t.jsx("div",{className:"oui-min-h-[300px]",children:t.jsxs(mt,{value:e.subTab,onValueChange:r=>e.setSubTab(r),size:"md",classNames:{tabsList:"oui-bg-base-9 oui-rounded-t-xl oui-p-2"},children:[t.jsx(ee,{title:i("positions.positionHistory"),value:"Position history",children:t.jsx(Zs,{symbol:e.showAllSymbol?void 0:e.symbol,onSymbolChange:e.onSymbolChange,classNames:{cell:"oui-p-2 oui-bg-base-9 oui-rounded-xl"},sharePnLConfig:e.sharePnLConfig})}),t.jsx(ee,{title:i("orders.orderHistory"),value:"Order history",children:t.jsx(Wt,{type:ne.orderHistory,...e})})]})})},fd=e=>{let i=md(e);return t.jsx(pd,{...i,className:e.className})},yd=e=>{let[i,r]=u.useState(0),s=u.useRef(null);return u.useEffect(()=>{let o=s.current;if(!o)return;let a=new ResizeObserver(n=>{for(let l of n)r(l.contentRect.height)});return a.observe(o),()=>{a.unobserve(o)}},[]),t.jsxs("div",{className:b("oui-grid oui-grid-cols-[4fr,6fr] oui-gap-1 oui-mx-1 ",e.className),children:[t.jsx("div",{className:"oui-bg-base-9 oui-rounded-xl",style:{height:`${i+16}px`},children:t.jsx(di,{symbol:e.symbol,height:i?i-44:void 0})}),t.jsx("div",{className:"oui-bg-base-9 oui-rounded-xl oui-p-2",children:t.jsx(dr,{symbol:e.symbol,containerRef:s})})]})},vd=()=>{let{symbol:e}=Le();return{symbol:e}},jd=e=>{let i=vd();return t.jsx(yd,{className:e.className,...i})},Cd=()=>{let[e,i]=u.useState("chart"),{symbol:r}=Le(),[s,o]=u.useState(!0);return{tab:e,setTab:i,symbol:r,toggleContentVisible:()=>{o(a=>!a)},setVisible:o,visible:s}},wd=e=>t.jsx(ai,{symbol:e.symbol,classNames:{root:"oui-px-3 ",list:"oui-min-h-[141px] oui-max-h-[202px] oui-w-full",listHeader:"oui-text-xs oui-text-base-contrast-36",listItem:{left:"oui-text-xs",mid:"oui-text-xs",right:"oui-text-xs"}}}),_d=e=>{var r,s,o,a;let{t:i}=_();return t.jsxs(g,{direction:"column",gap:2,children:[t.jsx(Be,{title:i("common.markPrice"),value:(r=e.ticker)==null?void 0:r.mark_price,dp:e.symbolInfo.quote_dp}),t.jsx(Be,{title:i("common.indexPrice"),value:(s=e.ticker)==null?void 0:s.index_price,dp:e.symbolInfo.quote_dp}),t.jsx(Be,{title:i("markets.column.24hVolume"),value:e.vol_24h,dp:e.symbolInfo.quote_dp,rule:"human",showUSDC:!0}),t.jsx(Be,{title:i("trading.column.24High"),value:(o=e.ticker)==null?void 0:o["24h_high"],dp:e.symbolInfo.quote_dp}),t.jsx(Be,{title:i("trading.column.24Low"),value:(a=e.ticker)==null?void 0:a["24h_low"],dp:e.symbolInfo.quote_dp}),t.jsx(Be,{title:i("markets.openInterest"),value:e.openInterest,dp:e.symbolInfo.quote_dp,rule:"human",showUSDC:!0})]})},Be=e=>{let{title:i,value:r,showUSDC:s,dp:o,rule:a="price"}=e;return t.jsxs(g,{justify:"between",width:"100%",className:"oui-text-xs",children:[t.jsx(p,{intensity:36,children:i}),t.jsxs(g,{gap:1,children:[t.jsx(p.numeral,{rule:a,dp:o,intensity:80,children:r}),s&&t.jsx(p,{intensity:36,children:"USDC"})]})]})},Nd=e=>{let{symbol:i}=e,r=ys(i),{symbolInfo:s}=Le(),o=u.useMemo(()=>{let n=r==null?void 0:r["24h_close"],l=r==null?void 0:r["24h_volume"];if(n&&l&&!isNaN(n)&&!isNaN(l))return new L(n).mul(l).toFixed(s.quote_dp,L.ROUND_DOWN)},[r]),a=u.useMemo(()=>{let n=r==null?void 0:r.mark_price,l=r==null?void 0:r.open_interest;if(n&&l&&!isNaN(n))return new L(n).mul(Number(l)).toFixed(s.quote_dp,L.ROUND_DOWN)},[r]);return{ticker:r,symbolInfo:s,vol_24h:o,openInterest:a}},Sd=e=>{let i=Nd(e);return t.jsx(_d,{...i})},kd=e=>t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("g",{id:"Arrows-expand",children:t.jsx("path",{id:"Vector",d:"M5.9989 1.00708C5.8709 1.00708 5.7369 1.05008 5.6394 1.14758L3.7959 3.00708L4.4989 3.71008L5.4989 2.72607V4.50708C5.4989 4.78308 5.7229 5.00708 5.9989 5.00708C6.2749 5.00708 6.4989 4.78308 6.4989 4.50708V2.72607L7.4989 3.71008L8.2019 3.00708L6.3584 1.14758C6.2604 1.05008 6.1269 1.00708 5.9989 1.00708ZM5.9989 7.00707C5.7229 7.00707 5.4989 7.23107 5.4989 7.50707V9.28808L4.4989 8.30407L3.7959 9.00707L5.6394 10.8666C5.8349 11.0616 6.1629 11.0616 6.3584 10.8666L8.2019 9.00707L7.4989 8.30407L6.4989 9.28808V7.50707C6.4989 7.23107 6.2749 7.00707 5.9989 7.00707Z"})})});function Td(e){var i,r,s;return t.jsxs("div",{className:"oui-pb-1 oui-flex oui-flex-col oui-gap-1",style:{height:e.height},ref:e.boxRef,children:[t.jsx("div",{className:"oui-w-full oui-h-full",children:t.jsx(_r,{symbol:e.symbol,libraryPath:(i=e.tradingViewConfig)==null?void 0:i.library_path,mode:3,scriptSRC:(r=e.tradingViewConfig)==null?void 0:r.scriptSRC,customCssUrl:(s=e.tradingViewConfig)==null?void 0:s.customCssUrl,...e.tradingViewConfig})}),t.jsx("div",{className:"oui-relative oui-w-full",children:t.jsx("div",{ref:e.dragRef,className:b("oui-h-[1px] oui-absolute oui-left-0 oui-right-0 oui-bottom-0 oui-top-0 oui-z-10 oui-mt-[7px] oui-bg-base-contrast-12",e.dragging&&"oui-bg-primary "),children:t.jsx(kd,{className:b("oui-w-3 oui-h-3 oui-absolute oui-left-1/2 -oui-top-[5px] -oui-translate-y-[0.5px] oui-text-base-contrast-12",e.dragging&&" oui-text-primary")})})})]})}var Pd=354,Ri=234,Od="TRADINGVIEW_MOBILE_HEIGHT";function Ld(e){let[i,r]=A(Od,Ri),[s,o]=u.useState(!1),a=u.useRef(null),n=u.useRef(null),[l,d]=u.useState(0),c=u.useRef(0),m=u.useCallback(y=>{if(!n.current)return;o(!0);let f=y.touches[0],C=n.current.getBoundingClientRect();y.stopPropagation(),y.preventDefault();let j=f.clientY-C.bottom;c.current=C.top,d(j)},[]),h=u.useCallback(y=>{if(n.current&&s){y.stopPropagation(),y.preventDefault();let f=y.touches[0].clientY-c.current-l;return r(Math.min(Math.max(Math.round(f),Ri),Pd)),!1}},[s,l]),x=u.useCallback(()=>{o(!1)},[]);return u.useEffect(()=>{let y=a.current;if(y)return y.addEventListener("touchstart",m),()=>{y.removeEventListener("touchstart",m)}},[m]),u.useEffect(()=>(document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("touchend",x),()=>{document.removeEventListener("touchmove",h),document.removeEventListener("touchend",x)}),[s,h,x]),{...e,height:i,dragging:s,dragRef:a,boxRef:n}}function Md(e){let i=Ld(e);return t.jsx(Td,{...i})}var Ed=e=>{let{t:i}=_(),{tradingViewConfig:r}=Le();return t.jsxs(mt,{variant:"contained",value:e.tab,contentVisible:e.visible,onValueChange:s=>{e.setTab(s),e.setVisible(!0)},className:e.className,classNames:{tabsList:"oui-p-2",tabsContent:"oui-min-h-[176px] oui-max-h-[396px]"},style:{marginBottom:e.tab==="chart"?"8px":0},trailing:t.jsx("button",{className:"oui-px-5",onClick:e.toggleContentVisible,children:t.jsx(Id,{className:e.visible?"oui-rotate-0":"oui-rotate-180"})}),children:[t.jsx(ee,{title:i("trading.tabs.chart"),value:"chart",children:t.jsx(Md,{symbol:e.symbol,tradingViewConfig:r})}),t.jsx(ee,{title:i("trading.tabs.trades"),value:"trades",children:t.jsx(wd,{symbol:e.symbol})}),t.jsx(ee,{title:i("trading.tabs.data"),value:"data",children:t.jsx(E,{px:3,children:t.jsx(Sd,{symbol:e.symbol})})})]})},Id=e=>t.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:b("oui-fill-base-contrast-54 hover:oui-fill-base-contrast-80",e.className),children:[t.jsx("path",{d:"M5.721 4.585 2.726 6.578a.51.51 0 0 0-.14.7.51.51 0 0 0 .702.14l2.714-1.806 2.715 1.806c.23.153.549.089.702-.14a.51.51 0 0 0-.14-.7L6.283 4.585a.51.51 0 0 0-.562 0"}),t.jsx("defs",{})]}),Rd=e=>{let i=Cd();return t.jsx(Ed,{className:e.className,...i})},Dd=()=>t.jsx("svg",{width:"8",height:"8",viewBox:"0 0 8 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M6.456 3.48a3.5 3.5 0 0 0 .431-.567 9 9 0 0 0 .361-.654l-.648-.66-.107.185q-.071.12-.142.244a3 3 0 0 1-.27.396 1.4 1.4 0 0 1-.318.29.67.67 0 0 1-.38.114q-.307 0-.666-.194t-.742-.42q-.383-.227-.777-.42a1.7 1.7 0 0 0-.771-.194q-.401.001-.72.154a2.1 2.1 0 0 0-.57.404 2.6 2.6 0 0 0-.43.574 5 5 0 0 0-.307.646l.649.66q.165-.437.464-.833.298-.395.742-.396.347 0 .7.194.354.193.721.42.37.227.763.42.396.195.826.195.374.001.665-.155.29-.151.526-.404m.352 2.941a3.5 3.5 0 0 0 .431-.566q.196-.315.361-.654l-.648-.66-.107.184-.142.244a3 3 0 0 1-.27.396 1.4 1.4 0 0 1-.318.29.67.67 0 0 1-.38.115q-.307 0-.666-.195-.36-.193-.742-.42-.383-.226-.778-.42a1.7 1.7 0 0 0-.77-.194q-.401.001-.72.154a2.1 2.1 0 0 0-.57.405 2.6 2.6 0 0 0-.43.574 5 5 0 0 0-.307.646l.649.66q.165-.437.464-.833.297-.395.742-.396.347 0 .7.194.354.193.721.42.369.226.763.42.396.194.826.194.374.001.665-.154.29-.152.526-.404",fill:"#fff",fillOpacity:".54"})}),Ad=e=>{let{t:i}=_(),r=t.jsxs(E,{intensity:900,px:3,height:54,children:[t.jsx(Gs,{symbol:e.symbol,onSymbol:()=>e.onOpenMarketsSheetChange(!0),trailing:t.jsxs(g,{direction:"column",itemAlign:"end",className:"oui-cursor-pointer oui-text-[11px]",onClick:e.onShowPortfolioSheet,children:[t.jsxs(g,{children:[t.jsx(p,{intensity:54,children:i("common.totalValue")}),t.jsx("button",{onClick:s=>{s.stopPropagation(),s.preventDefault(),e.setHideAssets(!e.hideAssets)},className:"oui-px-1",children:e.hideAssets?t.jsx(ti,{color:"primary",opacity:1,size:16,className:"oui-text-primary-light"}):t.jsx(ii,{color:"primary",opacity:1,size:16,className:"oui-text-primary-light"})}),t.jsx(Dd,{})]}),t.jsx(p.numeral,{suffix:t.jsx(p,{intensity:20,children:"Â USDC"}),dp:2,visible:!e.hideAssets,children:e.canTrade?e.total??"--":"--"})]})}),t.jsx(ps,{open:e.openMarketsSheet,onOpenChange:e.onOpenMarketsSheetChange,classNames:{body:"oui-h-full oui-pb-0",content:"oui-w-[280px] !oui-p-0"},contentProps:{side:"left",closeable:!1},children:t.jsx(Js,{symbol:e.symbol,onSymbolChange:s=>{var o;e.onOpenMarketsSheetChange(!1),(o=e.onSymbolChange)==null||o.call(e,s)}})})]});return t.jsx("div",{className:"oui-relative oui-grid oui-gap-1 oui-bg-base-10",children:t.jsxs("main",{className:"oui-hide-scrollbar oui-space-y-1 oui-overflow-y-auto",children:[r,t.jsx(Rd,{className:"oui-mx-1 oui-rounded-xl oui-bg-base-9"}),t.jsx(jd,{}),t.jsx(fd,{symbol:e.symbol,className:"oui-mx-1 oui-rounded-xl",sharePnLConfig:e.sharePnLConfig})]})})},It=e=>{let{showIndicator:i=!0}=e,[r,s]=u.useState(!1);return t.jsxs(E,{intensity:900,r:"2xl",p:3,width:"100%",className:b("oui-relative",e.className),children:[e.children,t.jsx(Ce,{open:r,onOpenChange:s,side:"left",align:"start",sideOffset:-4,alignOffset:-4,content:t.jsx(g,{direction:"column",gapY:2,children:[$d,Vd,Bd].map((o,a)=>t.jsx(o,{className:b("oui-rounded oui-cursor-pointer hover:oui-bg-base-5",e.index===a&&"oui-bg-base-5"),onClick:()=>{var n;(n=e.onLayout)==null||n.call(e,e.index,a),s(!1)}},a))}),delayDuration:0,className:b("oui-bg-base-9 oui-rounded","oui-border oui-border-line-12","oui-p-1"),arrow:{className:"oui-fill-transparent"},children:i&&t.jsx("div",{className:"oui-absolute oui-right-[1px] oui-top-[18px]",children:t.jsx(zd,{className:b("oui-text-base-contrast-20 hover:oui-text-base-contrast-80","oui-cursor-pointer")})})})]})},zd=e=>t.jsxs("svg",{width:"10",height:"16",viewBox:"0 0 10 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:[t.jsx("rect",{x:"2",y:"2",width:"6",height:"2",rx:"1"}),t.jsx("rect",{x:"2",y:"7",width:"6",height:"2",rx:"1"}),t.jsx("rect",{x:"2",y:"12",width:"6",height:"2",rx:"1"})]}),$d=e=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:[t.jsx("rect",{x:"1.333",y:"2.667",width:"13.333",height:"4",rx:"2",fill:"rgb(var(--oui-color-primary))"}),t.jsx("rect",{x:"2.667",y:"12",width:"10.667",height:"1.333",rx:".667",fill:"#fff",fillOpacity:".2"}),t.jsx("rect",{x:"2.667",y:"8.667",width:"10.667",height:"1.333",rx:".667",fill:"#fff",fillOpacity:".2"})]}),Vd=e=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[t.jsx("rect",{x:"1.333",y:"6",width:"13.333",height:"4",rx:"2",fill:"rgb(var(--oui-color-primary))"}),t.jsx("rect",{x:"2.667",y:"12",width:"10.667",height:"1.333",rx:".667",fill:"#fff",fillOpacity:".2"}),t.jsx("rect",{x:"2.667",y:"2.667",width:"10.667",height:"1.333",rx:".667",fill:"#fff",fillOpacity:".2"})]}),Bd=e=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[t.jsx("rect",{x:"1.333",y:"9.333",width:"13.333",height:"4",rx:"2",fill:"rgb(var(--oui-color-primary))"}),t.jsx("rect",{x:"2.667",y:"6",width:"10.667",height:"1.333",rx:".667",fill:"#fff",fillOpacity:".2"}),t.jsx("rect",{x:"2.667",y:"2.667",width:"10.667",height:"1.333",rx:".667",fill:"#fff",fillOpacity:".2"})]}),Hd=e=>{let{t:i}=_();return t.jsx(qd,{...e,children:t.jsxs(g,{px:3,className:b("oui-rounded-md","oui-h-[28px]","oui-cursor-pointer oui-transition-all","oui-bg-base-6 hover:oui-bg-base-4","oui-text-base-contrast-54 hover:oui-text-base-contrast-80"),gapX:1,ml:3,justify:"center",itemAlign:"center",children:[t.jsx(Fd,{}),t.jsx(p,{size:"2xs",weight:"semibold",children:i("trading.layout")})]})})},qd=e=>{let[i,r]=u.useState(!1),{t:s}=_(),o=n=>t.jsxs(g,{direction:"column",gapY:2,onClick:()=>{var l;(l=e.onLayout)==null||l.call(e,n),r(!1)},className:"oui-group",children:[t.jsx(g,{justify:n==="right"?"end":"start",className:b("oui-w-[148px] oui-h-[100px]","oui-bg-base-10 oui-rounded-[10px]","oui-border-[4px] oui-border-base-5 group-hover:oui-border-primary-light",e.layout===n&&"!oui-border-primary-light"),children:t.jsx(E,{p:1,children:t.jsx(Ud,{})})}),t.jsx(p,{size:"2xs",intensity:54,className:b("oui-text-base-contrast-54 group-hover:oui-text-base-contrast-80",e.layout===n&&"oui-text-base-contrast-80"),children:s(n==="right"?"trading.layout.right":"trading.layout.left")})]}),a=t.jsxs(t.Fragment,{children:[t.jsxs(g,{itemAlign:"center",justify:"between",mt:3,className:"oui-mb-[10px]",children:[t.jsx(p,{size:"base",intensity:98,children:s("trading.layout")}),t.jsx(gs,{size:16,className:"oui-text-base-contrast-80 oui-cursor-pointer",opacity:.98,onClick:()=>{r(!1)}})]}),t.jsx(ie,{}),t.jsxs(g,{gapX:6,mt:5,children:[o("right"),o("left")]})]});return t.jsxs(Ye,{open:i,onOpenChange:r,children:[t.jsx(Ze,{asChild:!0,children:e.children}),t.jsx(ht,{children:t.jsx(Xe,{onCloseAutoFocus:n=>n.preventDefault(),onClick:n=>n.stopPropagation(),align:"end",className:b("oui-bg-base-8 oui-p-5 oui-pt-0 oui-w-[360px] oui-font-semibold"),children:a})})]})},Fd=e=>t.jsx("svg",{width:"17",height:"16",viewBox:"0 0 17 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:t.jsx("path",{d:"M3.832 1.994c-.736 0-1.333.597-1.333 1.333v9.334c0 .737.597 1.333 1.333 1.333H6.5c.737 0 1.333-.596 1.333-1.333V3.327c0-.736-.596-1.333-1.333-1.333zm6.667 0c-.737 0-1.333.597-1.333 1.333v2.667c0 .737.596 1.333 1.333 1.333h2.667c.736 0 1.333-.596 1.333-1.333V3.327c0-.736-.597-1.333-1.333-1.333zm.437 6.679a2.7 2.7 0 0 0-1.033.607.284.284 0 0 0-.061.339c.222.411-.01.851-.512.876a.29.29 0 0 0-.26.217c-.05.207-.07.38-.07.608 0 .19.02.407.06.599a.28.28 0 0 0 .252.217c.506.044.756.429.53.92a.28.28 0 0 0 .06.321c.296.273.635.466 1.034.59a.285.285 0 0 0 .312-.104c.31-.427.757-.428 1.05 0a.28.28 0 0 0 .313.113 2.8 2.8 0 0 0 1.042-.599.28.28 0 0 0 .06-.33c-.23-.466.035-.894.513-.902a.28.28 0 0 0 .269-.209c.048-.199.06-.372.06-.616q0-.316-.069-.616a.276.276 0 0 0-.27-.217c-.469-.001-.732-.463-.502-.868a.27.27 0 0 0-.053-.339 2.8 2.8 0 0 0-1.059-.607.274.274 0 0 0-.312.112c-.268.417-.77.425-1.033.009a.284.284 0 0 0-.321-.121m.842 1.536a1.111 1.111 0 1 1 0 2.222 1.111 1.111 0 0 1 0-2.222"})}),Ud=e=>t.jsxs("svg",{width:"36",height:"84",viewBox:"0 0 36 84",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{width:"36",height:"17",rx:"2",fill:"#181C23"}),t.jsx("rect",{y:"19",width:"36",height:"54",rx:"2",fill:"#181C23"}),t.jsx("rect",{y:"75",width:"36",height:"9",rx:"2",fill:"#181C23"}),t.jsx("rect",{x:"3",y:"79",width:"30",height:"1",rx:"0.5",fill:"url(#paint0_linear_17647_26849)"}),t.jsx("rect",{x:"3",y:"22",width:"14",height:"6",rx:"2",fill:"#008676"}),t.jsx("rect",{x:"19",y:"22",width:"14",height:"6",rx:"2",fill:"#D92D6B"}),t.jsx("rect",{x:"3",y:"11",width:"14",height:"3",rx:"1.5",fill:"#333948"}),t.jsx("rect",{x:"19",y:"11",width:"14",height:"3",rx:"1.5",fill:"#335FFC"}),t.jsx("rect",{x:"3",y:"62",width:"30",height:"8",rx:"2",fill:"#008676"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"paint0_linear_17647_26849",x1:"33",y1:"79.5",x2:"3",y2:"79.5",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{stopColor:"#59B0FE"}),t.jsx("stop",{offset:"1",stopColor:"#26FEFE"})]})})]}),st=(e,i,r)=>[u.useMemo(()=>{let s=localStorage.getItem(e);return s?`${s}%`:i},[e,i,r]),s=>{localStorage.setItem(e,s)}],Wd=()=>{let{state:e}=ue(),{wrongNetwork:i,disabledConnect:r}=pt(),{totalValue:s}=dt({dp:2}),o=i||r||e.status<U.EnableTrading&&e.status!==U.EnableTradingWithoutConnected,{startTime:a,endTime:n}=u.useMemo(()=>{let c=new Date,m=new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59).getTime();return{startTime:m-90*24*60*60*1e3,endTime:m}},[]),[l,{meta:d}]=ms({startTime:a,endTime:n,page:1,pageSize:5,side:pi.DEPOSIT,status:mi.COMPLETED},{shouldUpdateOnWalletChanged:c=>c.side===pi.DEPOSIT&&c.transStatus===mi.COMPLETED});return!o&&s===0&&(d==null?void 0:d.total)===0},Di=6,Qd=48,Kd=29,le=8,ke=54,vt=280,Yd=360,ft=280,Zd=732,Te=464,Re=728,He=320,yt=540,Hr=800,Qt=350,Xd=()=>{let[e,i]=u.useState(!1),r=Le(),{state:s}=ue(),{t:o}=_(),{wrongNetwork:a,disabledConnect:n,restrictedInfo:l,onRouteChange:d}=pt(),{hideAssets:c,setHideAssets:m}=De(),h=Wd(),{totalValue:x}=dt(),y=de(x),f=Fe("(max-width: 1279px)"),C=Fe("(min-width: 1440px)"),j=Fe("(max-width: 1680px)"),[w,k]=A("orderly_order_entry_side_markets_layout","right"),N=u.useMemo(()=>!a&&!n&&(s.status>=U.EnableTrading||s.status===U.EnableTradingWithoutConnected),[s.status,a,n]),v=()=>{N&&W.sheet({title:o("trading.asset&Margin"),leading:r.bottomSheetLeading,content:t.jsx(hd,{})})},T=u.useMemo(()=>C,[C]),M=Jd({canTrade:N,isFirstTimeDeposit:h}),R=Gd({collapsable:C}),V=tu({max2XL:f}),X=R.collapsed?70:280,G=f?1200:600,Q=N?379:277,q=eu({dep:w}),se=ru({orderEntryViewRef:V.orderEntryViewRef,tradindviewMaxHeight:G,dataListMinHeight:Q}),oe={layout:w,onLayout:k,max2XL:f,min3XL:C,max4XL:j,canTrade:N,openMarketsSheet:e,onOpenMarketsSheetChange:i,horizontalDraggable:T,...R,...M,...q,...V,restrictedInfo:l,...se,marketsWidth:X,tradindviewMaxHeight:G,dataListMinHeight:Q,total:y,hideAssets:c,setHideAssets:m,onShowPortfolioSheet:v,navigateToPortfolio:typeof d=="function"?()=>{d({href:"/portfolio",name:o("common.portfolio")})}:void 0,isFirstTimeDeposit:h};return{...r,...oe}};function Gd(e){let{collapsable:i}=e,[r,s]=u.useState(!1),[o,a]=A("orderly_side_markets_collapsed",!0),n=d=>{a(d),s(!0)},l=u.useMemo(()=>i?o:!0,[i,o]);return{collapsable:i,collapsed:l,onCollapse:n,animating:r,setAnimating:s}}function Jd(e){let{canTrade:i,isFirstTimeDeposit:r}=e,[s,o]=A("orderly_assets_orderEntry_margin_positions",[0,1,2]),a=(l,d)=>{let c=[...s];if(l===0&&d===c.length-1){c[d]=s[l];for(let m=0;m<c.length-1;m++)c[m]=s[m+1]}else if(l===c.length-1&&d===0){c[d]=s[l];for(let m=1;m<c.length;m++)c[m]=s[m-1]}else[c[l],c[d]]=[c[d],c[l]];o(c)},n=u.useMemo(()=>i&&!r,[i,r]);return{positions:u.useMemo(()=>n?s:[0,1,2],[n,s]),showPositionIcon:n,updatePositions:a}}function eu(e){let{dep:i}=e,[r,s]=st("orderly_main_split_size",`${vt}px`,i),[o,a]=st("orderly_datalist_split_size",`${Qt}px`),[n,l]=st("orderly_orderbook_split_size","280px",i),[d,c]=st("orderly_datalist_split_height_sm","350px"),[m,h]=st("orderly_orderbook_split_height_sm","280px");return{orderBookSplitSize:n,setOrderbookSplitSize:l,dataListSplitSize:o,setDataListSplitSize:a,mainSplitSize:r,setMainSplitSize:s,dataListSplitHeightSM:d,setDataListSplitHeightSM:c,orderBookSplitHeightSM:m,setOrderbookSplitHeightSM:h}}function tu(e){let{max2XL:i}=e,[r,s]=u.useState(0),o=u.useRef(null);return u.useEffect(()=>{let a=o.current;if(!a||!i)return;let n=new ResizeObserver(l=>{for(let d of l){let c=d.contentRect.height;c&&s(c)}});return n.observe(a),()=>{n.unobserve(a)}},[o,i]),{orderEntryViewRef:o,orderEntryHeight:r}}function iu(e){return e?`${100-Math.min(Number(e),100)}`:""}function ru(e){let{tradindviewMaxHeight:i,dataListMinHeight:r}=e,s=u.useRef(null),o=u.useRef(null),[a,n]=A("orderly_order_entry_extra_height",0),l=22,[d,c]=A("orderly_trading_data_list_height",r);return{max2XLSplitRef:o,tradingviewAndOrderbookSplitRef:s,onTradingviewAndOrderbookDragging:(m,h)=>{var k,N;let x=(k=s==null?void 0:s.current)==null?void 0:k.boxHeight;if(!x)return;let y=x*m/100,f=x*h/100,C=Math.min(Math.max(y,He),i),j=Math.min(Math.max(f,Te),Re),w=((N=e.orderEntryViewRef.current)==null?void 0:N.clientHeight)||0;if(f>=j){let v=f-j;n(Math.max(0,a-v))}else if(C+j<i+Re){let v=C+j+l+ke,T=Math.max(0,v-w);n(a+T)}},onDataListSplitHeightDragging:(m,h)=>{var f;let x=(f=o==null?void 0:o.current)==null?void 0:f.boxHeight;if(!x)return;let y=x*h/100;if(y>=r&&y<=Hr){c(y);let C=y-d;C>0&&n(Math.max(0,a-C))}},extraHeight:a,dataListHeight:d}}var su=e=>{let{collapsable:i,collapsed:r,onCollapse:s,layout:o,onLayout:a,orderBookSplitSize:n,setOrderbookSplitSize:l,dataListSplitSize:d,setDataListSplitSize:c,mainSplitSize:m,setMainSplitSize:h,dataListSplitHeightSM:x,setDataListSplitHeightSM:y,orderBookSplitHeightSM:f,setOrderbookSplitHeightSM:C,max2XL:j,max4XL:w,animating:k,setAnimating:N,positions:v,updatePositions:T,showPositionIcon:M,horizontalDraggable:R,marketsWidth:V,tradindviewMaxHeight:X,dataListMinHeight:G}=e,[Q]=A(Bi,!1),q=u.useMemo(()=>Q?0:ke+Re+Qt+le*4,[Q]),se=Qd+Kd+ke+He+Te+G+le*4,oe=t.jsx(eo,{collapsable:i,collapsed:r,onCollapse:s,symbol:e.symbol,onSymbolChange:e.onSymbolChange}),ce=t.jsx(E,{intensity:900,pt:3,r:"2xl",height:"100%",width:V,style:{minWidth:V},className:"oui-transition-all oui-duration-150",onTransitionEnd:()=>{N(!1)},children:!k&&oe}),we=u.useMemo(()=>t.jsx(Hd,{layout:o,onLayout:a}),[o,a]),he=t.jsx(E,{intensity:900,r:"2xl",px:3,width:"100%",style:{minHeight:ke,height:ke},children:t.jsx(to,{symbol:e.symbol,onSymbolChange:e.onSymbolChange,trailing:we})}),{library_path:me,..._e}=e.tradingViewConfig,Ne=t.jsx(_r,{classNames:{root:b(Q?"!oui-absolute oui-top-0 oui-left-0 oui-right-0 oui-bottom-0 oui-z-[40] oui-bg-base-10":"oui-z-1"),content:b(Q?"oui-top-3 oui-bottom-3 oui-left-3 oui-right-3 oui-bg-base-9 oui-rounded-[16px] oui-overflow-hidden":"")},symbol:e.symbol,..._e,libraryPath:me}),I=t.jsx(E,{width:"100%",height:"100%",intensity:900,r:"2xl",style:{flex:1,minWidth:yt},className:"oui-overflow-hidden",children:Ne}),$=t.jsx(Bl,{symbol:e.symbol}),pe=t.jsx(E,{r:"2xl",height:"100%",style:{minWidth:ft,maxWidth:R?Zd:ft,width:n},className:"oui-overflow-hidden",children:$}),Ae=t.jsx(Un,{current:void 0,symbol:e.symbol,sharePnLConfig:e.sharePnLConfig}),Je=t.jsx(E,{intensity:900,r:"2xl",p:2,style:{height:d,minHeight:Qt},className:"oui-overflow-hidden",children:Ae}),et=[t.jsx(It,{index:v.findIndex(D=>D===0),onLayout:T,showIndicator:M,children:t.jsx(Dl,{})},"margin"),t.jsx(It,{className:"oui-border oui-border-line-12",index:v.findIndex(D=>D===1),onLayout:T,showIndicator:M,children:t.jsxs(t.Fragment,{children:[t.jsx(sl,{isFirstTimeDeposit:e.isFirstTimeDeposit}),t.jsx(Vs,{className:"oui-mt-3 oui-gap-y-2",onClick:e.navigateToPortfolio})]})},"assets"),t.jsx(It,{index:v.findIndex(D=>D===2),onLayout:T,showIndicator:M,children:t.jsx(dr,{symbol:e.symbol,disableFeatures:e.disableFeatures})},"orderEntry")],ye=v.map(D=>et[D]),ze=t.jsx(g,{gapY:2,direction:"column",height:"100%",style:{minWidth:vt,maxWidth:R?Yd:vt,width:m},children:ye}),O=t.jsxs(rt,{style:{flex:1,minHeight:Te},onSizeChange:l,disable:!R,children:[w&&o==="right"?t.jsxs(g,{gap:2,className:"oui-flex-1 oui-overflow-hidden",style:{minWidth:V+yt+le},children:[ce,I]}):I,pe]}),z=()=>w&&o==="left"?t.jsxs(g,{gapX:2,style:{minHeight:Te},height:"100%",children:[O,ce]}):O,te=t.jsxs(g,{direction:"column",className:"oui-flex-1 oui-overflow-hidden",gap:2,style:{minWidth:w?V+yt+ft+le*2:yt+ft+le},children:[he,t.jsxs(rt,{style:{maxHeight:`calc(100% - ${ke}px - ${le}px)`},className:"oui-w-full",mode:"vertical",onSizeChange:c,children:[z(),Je]})]}),P=D=>h(o==="left"?iu(D):D);return j?t.jsxs(rt,{ref:e.max2XLSplitRef,style:{minHeight:se,minWidth:1024-Di},className:b("oui-flex oui-flex-1 ","oui-size-full oui-min-w-[1018px]","oui-px-3 oui-py-2",e.className),onSizeChange:y,onDragging:e.onDataListSplitHeightDragging,mode:"vertical",children:[t.jsxs(g,{gapX:2,itemAlign:"stretch",className:b("oui-flex-1",o==="left"&&"oui-flex-row-reverse"),style:{minHeight:Math.max(ke+He+Te+le*2,e.orderEntryHeight),maxHeight:ke+X+Re+le*2},children:[t.jsxs(g,{height:"100%",className:"oui-flex-1 oui-w-[calc(100%_-_280px_-_12px)]",direction:"column",gapY:2,children:[he,t.jsxs(g,{width:"100%",height:"100%",gapX:2,itemAlign:"stretch",style:{minHeight:He+Te+le,maxHeight:X+Re+le},className:b("oui-flex-1",o==="left"&&"oui-flex-row-reverse"),children:[t.jsx(E,{intensity:900,pt:3,r:"2xl",width:V,style:{minHeight:He+Te+le,maxHeight:X+Re+le},children:oe}),t.jsxs(rt,{ref:e.tradingviewAndOrderbookSplitRef,mode:"vertical",style:{width:`calc(100% - ${V}px)`},className:"oui-flex-1",onSizeChange:C,onDragging:e.onTradingviewAndOrderbookDragging,children:[t.jsx(E,{width:"100%",intensity:900,r:"2xl",style:{minHeight:He,maxHeight:X,height:1200},children:Ne}),t.jsx(E,{r:"2xl",height:"100%",width:"100%",style:{minHeight:Te,maxHeight:Re,height:f},className:"oui-flex-1",children:$})]})]})]}),t.jsxs(g,{ref:e.orderEntryViewRef,gapY:3,direction:"column",style:{width:vt,height:"max-content"},children:[ye,t.jsx(E,{height:e.extraHeight})]})]}),t.jsx(E,{intensity:900,r:"2xl",p:2,style:{height:x,minHeight:Math.max(G,e.dataListHeight),maxHeight:Hr},className:"oui-overflow-hidden",children:Ae})]}):t.jsxs(g,{style:{minHeight:q,minWidth:1440-Di},className:b(e.className,o==="left"&&"oui-flex-row-reverse",Q&&"oui-relative oui-w-screen oui-h-[calc(100vh-80px)] !oui-p-0 oui-overflow-hidden"),width:"100%",p:2,gap:2,children:[!w&&ce,t.jsxs(rt,{className:"oui-flex oui-flex-1 oui-overflow-hidden",onSizeChange:P,disable:!R,children:[o==="left"&&ze,te,o==="right"&&ze]})]})},ou=e=>{let{isMobile:i}=Qe();return i?t.jsx(Ad,{...e}):t.jsx(su,{className:"oui-h-[calc(100vh_-_48px_-_29px)] oui-bg-base-10",...e})},au=()=>{let e=Xd();return t.jsx(ou,{...e})},fu=e=>t.jsx(In,{symbol:e.symbol,tradingViewConfig:e.tradingViewConfig,onSymbolChange:e.onSymbolChange,disableFeatures:e.disableFeatures,overrideFeatures:e.overrideFeatures,referral:e.referral,tradingRewards:e.tradingRewards,bottomSheetLeading:e.bottomSheetLeading,sharePnLConfig:e.sharePnLConfig,children:t.jsx(au,{})});export{De as W,fu as h};
