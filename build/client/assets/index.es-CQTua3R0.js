import{dP as Be,aZ as nr,dQ as ie}from"./index-B1yGdhtz.js";import{j as Qe,k as ge,m as fe,n as Qr,o as en,p as tn,q as rn,r as nn,t as on,u as sn,v as an,x as cn,y as un,z as _e,A as fn,C as wt}from"./walletConnect-BmfqopVd.js";const hn=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,ln=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,dn=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function pn(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){gn(e);return}return t}function gn(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function ye(e,t={}){if(typeof e!="string")return e;if(e[0]==='"'&&e[e.length-1]==='"'&&e.indexOf("\\")===-1)return e.slice(1,-1);const r=e.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!dn.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(hn.test(e)||ln.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,pn)}return JSON.parse(e)}catch(n){if(t.strict)throw n;return e}}var mt=function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))},bn=function(){function e(t,r,n){this.name=t,this.version=r,this.os=n,this.type="browser"}return e}(),wn=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=Be.platform}return e}(),mn=function(){function e(t,r,n,o){this.name=t,this.version=r,this.os=n,this.bot=o,this.type="bot-device"}return e}(),yn=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),vn=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),En=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,xn=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,yt=3,Fn=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",En]],vt=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Oa(e){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new vn:typeof navigator<"u"?An(navigator.userAgent):In()}function Bn(e){return e!==""&&Fn.reduce(function(t,r){var n=r[0],o=r[1];if(t)return t;var i=o.exec(e);return!!i&&[n,i]},!1)}function An(e){var t=Bn(e);if(!t)return null;var r=t[0],n=t[1];if(r==="searchbot")return new yn;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<yt&&(o=mt(mt([],o,!0),On(yt-o.length),!0)):o=[];var i=o.join("."),c=Sn(e),h=xn.exec(e);return h&&h[1]?new mn(r,i,c,h[1]):new bn(r,i,c)}function Sn(e){for(var t=0,r=vt.length;t<r;t++){var n=vt[t],o=n[0],i=n[1],c=i.exec(e);if(c)return o}return null}function In(){var e=typeof Be<"u"&&Be.version;return e?new wn(Be.version.slice(1)):null}function On(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}function Rn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function or(e,...t){if(!Rn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Et(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function _n(e,t){or(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ue=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ne=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);function Cn(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function ir(e){return typeof e=="string"&&(e=Cn(e)),or(e),e}class Pn{clone(){return this._cloneInto()}}function Un(e){const t=n=>e().update(ir(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function sr(e=32){if(ue&&typeof ue.getRandomValues=="function")return ue.getRandomValues(new Uint8Array(e));if(ue&&typeof ue.randomBytes=="function")return ue.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function Ln(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const o=BigInt(32),i=BigInt(4294967295),c=Number(r>>o&i),h=Number(r&i),u=n?4:0,a=n?0:4;e.setUint32(t+u,c,n),e.setUint32(t+a,h,n)}class Tn extends Pn{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ne(this.buffer)}update(t){Et(this);const{view:r,buffer:n,blockLen:o}=this;t=ir(t);const i=t.length;for(let c=0;c<i;){const h=Math.min(o-this.pos,i-c);if(h===o){const u=Ne(t);for(;o<=i-c;c+=o)this.process(u,c);continue}n.set(t.subarray(c,c+h),this.pos),this.pos+=h,c+=h,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Et(this),_n(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:i}=this;let{pos:c}=this;r[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(n,0),c=0);for(let f=c;f<o;f++)r[f]=0;Ln(n,o-8,BigInt(this.length*8),i),this.process(n,0);const h=Ne(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const a=u/4,s=this.get();if(a>s.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<a;f++)h.setUint32(4*f,s[f],i)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:i,destroyed:c,pos:h}=this;return t.length=o,t.pos=h,t.finished=i,t.destroyed=c,o%r&&t.buffer.set(n),t}}const ve=BigInt(2**32-1),qe=BigInt(32);function ar(e,t=!1){return t?{h:Number(e&ve),l:Number(e>>qe&ve)}:{h:Number(e>>qe&ve)|0,l:Number(e&ve)|0}}function Nn(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let o=0;o<e.length;o++){const{h:i,l:c}=ar(e[o],t);[r[o],n[o]]=[i,c]}return[r,n]}const Dn=(e,t)=>BigInt(e>>>0)<<qe|BigInt(t>>>0),Mn=(e,t,r)=>e>>>r,jn=(e,t,r)=>e<<32-r|t>>>r,Wn=(e,t,r)=>e>>>r|t<<32-r,kn=(e,t,r)=>e<<32-r|t>>>r,zn=(e,t,r)=>e<<64-r|t>>>r-32,$n=(e,t,r)=>e>>>r-32|t<<64-r,Kn=(e,t)=>t,Hn=(e,t)=>e,Vn=(e,t,r)=>e<<r|t>>>32-r,qn=(e,t,r)=>t<<r|e>>>32-r,Gn=(e,t,r)=>t<<r-32|e>>>64-r,Jn=(e,t,r)=>e<<r-32|t>>>64-r;function Zn(e,t,r,n){const o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}const Yn=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Xn=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Qn=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),eo=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,to=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ro=(e,t,r,n,o,i)=>t+r+n+o+i+(e/2**32|0)|0,E={fromBig:ar,split:Nn,toBig:Dn,shrSH:Mn,shrSL:jn,rotrSH:Wn,rotrSL:kn,rotrBH:zn,rotrBL:$n,rotr32H:Kn,rotr32L:Hn,rotlSH:Vn,rotlSL:qn,rotlBH:Gn,rotlBL:Jn,add:Zn,add3L:Yn,add3H:Xn,add4L:Qn,add4H:eo,add5H:ro,add5L:to},[no,oo]=E.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ee=new Uint32Array(80),te=new Uint32Array(80);class io extends Tn{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:r,Bh:n,Bl:o,Ch:i,Cl:c,Dh:h,Dl:u,Eh:a,El:s,Fh:f,Fl:l,Gh:g,Gl:d,Hh:w,Hl:A}=this;return[t,r,n,o,i,c,h,u,a,s,f,l,g,d,w,A]}set(t,r,n,o,i,c,h,u,a,s,f,l,g,d,w,A){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=c|0,this.Dh=h|0,this.Dl=u|0,this.Eh=a|0,this.El=s|0,this.Fh=f|0,this.Fl=l|0,this.Gh=g|0,this.Gl=d|0,this.Hh=w|0,this.Hl=A|0}process(t,r){for(let b=0;b<16;b++,r+=4)ee[b]=t.getUint32(r),te[b]=t.getUint32(r+=4);for(let b=16;b<80;b++){const S=ee[b-15]|0,_=te[b-15]|0,W=E.rotrSH(S,_,1)^E.rotrSH(S,_,8)^E.shrSH(S,_,7),D=E.rotrSL(S,_,1)^E.rotrSL(S,_,8)^E.shrSL(S,_,7),C=ee[b-2]|0,T=te[b-2]|0,ae=E.rotrSH(C,T,19)^E.rotrBH(C,T,61)^E.shrSH(C,T,6),re=E.rotrSL(C,T,19)^E.rotrBL(C,T,61)^E.shrSL(C,T,6),ce=E.add4L(D,re,te[b-7],te[b-16]),le=E.add4H(ce,W,ae,ee[b-7],ee[b-16]);ee[b]=le|0,te[b]=ce|0}let{Ah:n,Al:o,Bh:i,Bl:c,Ch:h,Cl:u,Dh:a,Dl:s,Eh:f,El:l,Fh:g,Fl:d,Gh:w,Gl:A,Hh:x,Hl:R}=this;for(let b=0;b<80;b++){const S=E.rotrSH(f,l,14)^E.rotrSH(f,l,18)^E.rotrBH(f,l,41),_=E.rotrSL(f,l,14)^E.rotrSL(f,l,18)^E.rotrBL(f,l,41),W=f&g^~f&w,D=l&d^~l&A,C=E.add5L(R,_,D,oo[b],te[b]),T=E.add5H(C,x,S,W,no[b],ee[b]),ae=C|0,re=E.rotrSH(n,o,28)^E.rotrBH(n,o,34)^E.rotrBH(n,o,39),ce=E.rotrSL(n,o,28)^E.rotrBL(n,o,34)^E.rotrBL(n,o,39),le=n&i^n&h^i&h,Le=o&c^o&u^c&u;x=w|0,R=A|0,w=g|0,A=d|0,g=f|0,d=l|0,{h:f,l}=E.add(a|0,s|0,T|0,ae|0),a=h|0,s=u|0,h=i|0,u=c|0,i=n|0,c=o|0;const y=E.add3L(ae,ce,Le);n=E.add3H(y,T,re,le),o=y|0}({h:n,l:o}=E.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:c}=E.add(this.Bh|0,this.Bl|0,i|0,c|0),{h,l:u}=E.add(this.Ch|0,this.Cl|0,h|0,u|0),{h:a,l:s}=E.add(this.Dh|0,this.Dl|0,a|0,s|0),{h:f,l}=E.add(this.Eh|0,this.El|0,f|0,l|0),{h:g,l:d}=E.add(this.Fh|0,this.Fl|0,g|0,d|0),{h:w,l:A}=E.add(this.Gh|0,this.Gl|0,w|0,A|0),{h:x,l:R}=E.add(this.Hh|0,this.Hl|0,x|0,R|0),this.set(n,o,i,c,h,u,a,s,f,l,g,d,w,A,x,R)}roundClean(){ee.fill(0),te.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const so=Un(()=>new io);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const et=BigInt(0),cr=BigInt(1),ao=BigInt(2);function tt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function rt(e){if(!tt(e))throw new Error("Uint8Array expected")}function De(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}const co=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function nt(e){rt(e);let t="";for(let r=0;r<e.length;r++)t+=co[e[r]];return t}function ur(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?et:BigInt("0x"+e)}const Y={_0:48,_9:57,A:65,F:70,a:97,f:102};function xt(e){if(e>=Y._0&&e<=Y._9)return e-Y._0;if(e>=Y.A&&e<=Y.F)return e-(Y.A-10);if(e>=Y.a&&e<=Y.f)return e-(Y.a-10)}function fr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,i=0;o<r;o++,i+=2){const c=xt(e.charCodeAt(i)),h=xt(e.charCodeAt(i+1));if(c===void 0||h===void 0){const u=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+i)}n[o]=c*16+h}return n}function uo(e){return ur(nt(e))}function Ae(e){return rt(e),ur(nt(Uint8Array.from(e).reverse()))}function hr(e,t){return fr(e.toString(16).padStart(t*2,"0"))}function Ge(e,t){return hr(e,t).reverse()}function X(e,t,r){let n;if(typeof t=="string")try{n=fr(t)}catch(i){throw new Error(e+" must be hex string or Uint8Array, cause: "+i)}else if(tt(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const o=n.length;if(typeof r=="number"&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}function Ft(...e){let t=0;for(let n=0;n<e.length;n++){const o=e[n];rt(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){const i=e[n];r.set(i,o),o+=i.length}return r}const Me=e=>typeof e=="bigint"&&et<=e;function fo(e,t,r){return Me(e)&&Me(t)&&Me(r)&&t<=e&&e<r}function de(e,t,r,n){if(!fo(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function ho(e){let t;for(t=0;e>et;e>>=cr,t+=1);return t}const lo=e=>(ao<<BigInt(e-1))-cr,po={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||tt(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function ot(e,t,r={}){const n=(o,i,c)=>{const h=po[i];if(typeof h!="function")throw new Error("invalid validator function");const u=e[o];if(!(c&&u===void 0)&&!h(u,e))throw new Error("param "+String(o)+" is invalid. Expected "+i+", got "+u)};for(const[o,i]of Object.entries(t))n(o,i,!1);for(const[o,i]of Object.entries(r))n(o,i,!0);return e}function Bt(e){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(o!==void 0)return o;const i=e(r,...n);return t.set(r,i),i}}const j=BigInt(0),L=BigInt(1),oe=BigInt(2),go=BigInt(3),Je=BigInt(4),At=BigInt(5),St=BigInt(8);function N(e,t){const r=e%t;return r>=j?r:t+r}function bo(e,t,r){if(t<j)throw new Error("invalid exponent, negatives unsupported");if(r<=j)throw new Error("invalid modulus");if(r===L)return j;let n=L;for(;t>j;)t&L&&(n=n*e%r),e=e*e%r,t>>=L;return n}function G(e,t,r){let n=e;for(;t-- >j;)n*=n,n%=r;return n}function It(e,t){if(e===j)throw new Error("invert: expected non-zero number");if(t<=j)throw new Error("invert: expected positive modulus, got "+t);let r=N(e,t),n=t,o=j,i=L;for(;r!==j;){const c=n/r,h=n%r,u=o-i*c;n=r,r=h,o=i,i=u}if(n!==L)throw new Error("invert: does not exist");return N(o,t)}function wo(e){const t=(e-L)/oe;let r,n,o;for(r=e-L,n=0;r%oe===j;r/=oe,n++);for(o=oe;o<e&&bo(o,t,e)!==e-L;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const c=(e+L)/Je;return function(h,u){const a=h.pow(u,c);if(!h.eql(h.sqr(a),u))throw new Error("Cannot find square root");return a}}const i=(r+L)/oe;return function(c,h){if(c.pow(h,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=n,a=c.pow(c.mul(c.ONE,o),r),s=c.pow(h,i),f=c.pow(h,r);for(;!c.eql(f,c.ONE);){if(c.eql(f,c.ZERO))return c.ZERO;let l=1;for(let d=c.sqr(f);l<u&&!c.eql(d,c.ONE);l++)d=c.sqr(d);const g=c.pow(a,L<<BigInt(u-l-1));a=c.sqr(g),s=c.mul(s,g),f=c.mul(f,a),u=l}return s}}function mo(e){if(e%Je===go){const t=(e+L)/Je;return function(r,n){const o=r.pow(n,t);if(!r.eql(r.sqr(o),n))throw new Error("Cannot find square root");return o}}if(e%St===At){const t=(e-At)/St;return function(r,n){const o=r.mul(n,oe),i=r.pow(o,t),c=r.mul(n,i),h=r.mul(r.mul(c,oe),i),u=r.mul(c,r.sub(h,r.ONE));if(!r.eql(r.sqr(u),n))throw new Error("Cannot find square root");return u}}return wo(e)}const yo=(e,t)=>(N(e,t)&L)===L,vo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Eo(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=vo.reduce((n,o)=>(n[o]="function",n),t);return ot(e,r)}function xo(e,t,r){if(r<j)throw new Error("invalid exponent, negatives unsupported");if(r===j)return e.ONE;if(r===L)return t;let n=e.ONE,o=t;for(;r>j;)r&L&&(n=e.mul(n,o)),o=e.sqr(o),r>>=L;return n}function Fo(e,t){const r=new Array(t.length),n=t.reduce((i,c,h)=>e.is0(c)?i:(r[h]=i,e.mul(i,c)),e.ONE),o=e.inv(n);return t.reduceRight((i,c,h)=>e.is0(c)?i:(r[h]=e.mul(i,r[h]),e.mul(i,c)),o),r}function lr(e,t){const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function dr(e,t,r=!1,n={}){if(e<=j)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:o,nByteLength:i}=lr(e,t);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const h=Object.freeze({ORDER:e,isLE:r,BITS:o,BYTES:i,MASK:lo(o),ZERO:j,ONE:L,create:u=>N(u,e),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return j<=u&&u<e},is0:u=>u===j,isOdd:u=>(u&L)===L,neg:u=>N(-u,e),eql:(u,a)=>u===a,sqr:u=>N(u*u,e),add:(u,a)=>N(u+a,e),sub:(u,a)=>N(u-a,e),mul:(u,a)=>N(u*a,e),pow:(u,a)=>xo(h,u,a),div:(u,a)=>N(u*It(a,e),e),sqrN:u=>u*u,addN:(u,a)=>u+a,subN:(u,a)=>u-a,mulN:(u,a)=>u*a,inv:u=>It(u,e),sqrt:n.sqrt||(u=>(c||(c=mo(e)),c(h,u))),invertBatch:u=>Fo(h,u),cmov:(u,a,s)=>s?a:u,toBytes:u=>r?Ge(u,i):hr(u,i),fromBytes:u=>{if(u.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+u.length);return r?Ae(u):uo(u)}});return Object.freeze(h)}const Ot=BigInt(0),Ee=BigInt(1);function je(e,t){const r=t.negate();return e?r:t}function pr(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function We(e,t){pr(e,t);const r=Math.ceil(t/e)+1,n=2**(e-1);return{windows:r,windowSize:n}}function Bo(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Ao(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const ke=new WeakMap,gr=new WeakMap;function ze(e){return gr.get(e)||1}function So(e,t){return{constTimeNegate:je,hasPrecomputes(r){return ze(r)!==1},unsafeLadder(r,n,o=e.ZERO){let i=r;for(;n>Ot;)n&Ee&&(o=o.add(i)),i=i.double(),n>>=Ee;return o},precomputeWindow(r,n){const{windows:o,windowSize:i}=We(n,t),c=[];let h=r,u=h;for(let a=0;a<o;a++){u=h,c.push(u);for(let s=1;s<i;s++)u=u.add(h),c.push(u);h=u.double()}return c},wNAF(r,n,o){const{windows:i,windowSize:c}=We(r,t);let h=e.ZERO,u=e.BASE;const a=BigInt(2**r-1),s=2**r,f=BigInt(r);for(let l=0;l<i;l++){const g=l*c;let d=Number(o&a);o>>=f,d>c&&(d-=s,o+=Ee);const w=g,A=g+Math.abs(d)-1,x=l%2!==0,R=d<0;d===0?u=u.add(je(x,n[w])):h=h.add(je(R,n[A]))}return{p:h,f:u}},wNAFUnsafe(r,n,o,i=e.ZERO){const{windows:c,windowSize:h}=We(r,t),u=BigInt(2**r-1),a=2**r,s=BigInt(r);for(let f=0;f<c;f++){const l=f*h;if(o===Ot)break;let g=Number(o&u);if(o>>=s,g>h&&(g-=a,o+=Ee),g===0)continue;let d=n[l+Math.abs(g)-1];g<0&&(d=d.negate()),i=i.add(d)}return i},getPrecomputes(r,n,o){let i=ke.get(n);return i||(i=this.precomputeWindow(n,r),r!==1&&ke.set(n,o(i))),i},wNAFCached(r,n,o){const i=ze(r);return this.wNAF(i,this.getPrecomputes(i,r,o),n)},wNAFCachedUnsafe(r,n,o,i){const c=ze(r);return c===1?this.unsafeLadder(r,n,i):this.wNAFUnsafe(c,this.getPrecomputes(c,r,o),n,i)},setWindowSize(r,n){pr(n,t),gr.set(r,n),ke.delete(r)}}}function Io(e,t,r,n){if(Bo(r,e),Ao(n,t),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,i=ho(BigInt(r.length)),c=i>12?i-3:i>4?i-2:i?2:1,h=(1<<c)-1,u=new Array(h+1).fill(o),a=Math.floor((t.BITS-1)/c)*c;let s=o;for(let f=a;f>=0;f-=c){u.fill(o);for(let g=0;g<n.length;g++){const d=n[g],w=Number(d>>BigInt(f)&BigInt(h));u[w]=u[w].add(r[g])}let l=o;for(let g=u.length-1,d=o;g>0;g--)d=d.add(u[g]),l=l.add(d);if(s=s.add(l),f!==0)for(let g=0;g<c;g++)s=s.double()}return s}function Oo(e){return Eo(e.Fp),ot(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const q=BigInt(0),K=BigInt(1),xe=BigInt(2),Ro=BigInt(8),_o={zip215:!0};function Co(e){const t=Oo(e);return ot(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Po(e){const t=Co(e),{Fp:r,n,prehash:o,hash:i,randomBytes:c,nByteLength:h,h:u}=t,a=xe<<BigInt(h*8)-K,s=r.create,f=dr(t.n,t.nBitLength),l=t.uvRatio||((y,p)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(p))}}catch{return{isValid:!1,value:q}}}),g=t.adjustScalarBytes||(y=>y),d=t.domain||((y,p,m)=>{if(De("phflag",m),p.length||m)throw new Error("Contexts/pre-hash are not supported");return y});function w(y,p){de("coordinate "+y,p,q,a)}function A(y){if(!(y instanceof b))throw new Error("ExtendedPoint expected")}const x=Bt((y,p)=>{const{ex:m,ey:v,ez:F}=y,B=y.is0();p==null&&(p=B?Ro:r.inv(F));const I=s(m*p),P=s(v*p),O=s(F*p);if(B)return{x:q,y:K};if(O!==K)throw new Error("invZ was invalid");return{x:I,y:P}}),R=Bt(y=>{const{a:p,d:m}=t;if(y.is0())throw new Error("bad point: ZERO");const{ex:v,ey:F,ez:B,et:I}=y,P=s(v*v),O=s(F*F),U=s(B*B),k=s(U*U),$=s(P*p),J=s(U*s($+O)),Z=s(k+s(m*s(P*O)));if(J!==Z)throw new Error("bad point: equation left != right (1)");const V=s(v*F),Q=s(B*I);if(V!==Q)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(p,m,v,F){this.ex=p,this.ey=m,this.ez=v,this.et=F,w("x",p),w("y",m),w("z",v),w("t",F),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(p){if(p instanceof b)throw new Error("extended point not allowed");const{x:m,y:v}=p||{};return w("x",m),w("y",v),new b(m,v,K,s(m*v))}static normalizeZ(p){const m=r.invertBatch(p.map(v=>v.ez));return p.map((v,F)=>v.toAffine(m[F])).map(b.fromAffine)}static msm(p,m){return Io(b,f,p,m)}_setWindowSize(p){W.setWindowSize(this,p)}assertValidity(){R(this)}equals(p){A(p);const{ex:m,ey:v,ez:F}=this,{ex:B,ey:I,ez:P}=p,O=s(m*P),U=s(B*F),k=s(v*P),$=s(I*F);return O===U&&k===$}is0(){return this.equals(b.ZERO)}negate(){return new b(s(-this.ex),this.ey,this.ez,s(-this.et))}double(){const{a:p}=t,{ex:m,ey:v,ez:F}=this,B=s(m*m),I=s(v*v),P=s(xe*s(F*F)),O=s(p*B),U=m+v,k=s(s(U*U)-B-I),$=O+I,J=$-P,Z=O-I,V=s(k*J),Q=s($*Z),ne=s(k*Z),me=s(J*$);return new b(V,Q,me,ne)}add(p){A(p);const{a:m,d:v}=t,{ex:F,ey:B,ez:I,et:P}=this,{ex:O,ey:U,ez:k,et:$}=p;if(m===BigInt(-1)){const ft=s((B-F)*(U+O)),ht=s((B+F)*(U-O)),Te=s(ht-ft);if(Te===q)return this.double();const lt=s(I*xe*$),dt=s(P*xe*k),pt=dt+lt,gt=ht+ft,bt=dt-lt,Jr=s(pt*Te),Zr=s(gt*bt),Yr=s(pt*bt),Xr=s(Te*gt);return new b(Jr,Zr,Xr,Yr)}const J=s(F*O),Z=s(B*U),V=s(P*v*$),Q=s(I*k),ne=s((F+B)*(O+U)-J-Z),me=Q-V,ct=Q+V,ut=s(Z-m*J),Hr=s(ne*me),Vr=s(ct*ut),qr=s(ne*ut),Gr=s(me*ct);return new b(Hr,Vr,Gr,qr)}subtract(p){return this.add(p.negate())}wNAF(p){return W.wNAFCached(this,p,b.normalizeZ)}multiply(p){const m=p;de("scalar",m,K,n);const{p:v,f:F}=this.wNAF(m);return b.normalizeZ([v,F])[0]}multiplyUnsafe(p,m=b.ZERO){const v=p;return de("scalar",v,q,n),v===q?_:this.is0()||v===K?this:W.wNAFCachedUnsafe(this,v,b.normalizeZ,m)}isSmallOrder(){return this.multiplyUnsafe(u).is0()}isTorsionFree(){return W.unsafeLadder(this,n).is0()}toAffine(p){return x(this,p)}clearCofactor(){const{h:p}=t;return p===K?this:this.multiplyUnsafe(p)}static fromHex(p,m=!1){const{d:v,a:F}=t,B=r.BYTES;p=X("pointHex",p,B),De("zip215",m);const I=p.slice(),P=p[B-1];I[B-1]=P&-129;const O=Ae(I),U=m?a:r.ORDER;de("pointHex.y",O,q,U);const k=s(O*O),$=s(k-K),J=s(v*k-F);let{isValid:Z,value:V}=l($,J);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const Q=(V&K)===K,ne=(P&128)!==0;if(!m&&V===q&&ne)throw new Error("Point.fromHex: x=0 and x_0=1");return ne!==Q&&(V=s(-V)),b.fromAffine({x:V,y:O})}static fromPrivateKey(p){return T(p).point}toRawBytes(){const{x:p,y:m}=this.toAffine(),v=Ge(m,r.BYTES);return v[v.length-1]|=p&K?128:0,v}toHex(){return nt(this.toRawBytes())}}b.BASE=new b(t.Gx,t.Gy,K,s(t.Gx*t.Gy)),b.ZERO=new b(q,K,K,q);const{BASE:S,ZERO:_}=b,W=So(b,h*8);function D(y){return N(y,n)}function C(y){return D(Ae(y))}function T(y){const p=r.BYTES;y=X("private key",y,p);const m=X("hashed private key",i(y),2*p),v=g(m.slice(0,p)),F=m.slice(p,2*p),B=C(v),I=S.multiply(B),P=I.toRawBytes();return{head:v,prefix:F,scalar:B,point:I,pointBytes:P}}function ae(y){return T(y).pointBytes}function re(y=new Uint8Array,...p){const m=Ft(...p);return C(i(d(m,X("context",y),!!o)))}function ce(y,p,m={}){y=X("message",y),o&&(y=o(y));const{prefix:v,scalar:F,pointBytes:B}=T(p),I=re(m.context,v,y),P=S.multiply(I).toRawBytes(),O=re(m.context,P,B,y),U=D(I+O*F);de("signature.s",U,q,n);const k=Ft(P,Ge(U,r.BYTES));return X("result",k,r.BYTES*2)}const le=_o;function Le(y,p,m,v=le){const{context:F,zip215:B}=v,I=r.BYTES;y=X("signature",y,2*I),p=X("message",p),m=X("publicKey",m,I),B!==void 0&&De("zip215",B),o&&(p=o(p));const P=Ae(y.slice(I,2*I));let O,U,k;try{O=b.fromHex(m,B),U=b.fromHex(y.slice(0,I),B),k=S.multiplyUnsafe(P)}catch{return!1}if(!B&&O.isSmallOrder())return!1;const $=re(F,U.toRawBytes(),O.toRawBytes(),p);return U.add(O.multiplyUnsafe($)).subtract(k).clearCofactor().equals(b.ZERO)}return S._setWindowSize(8),{CURVE:t,getPublicKey:ae,sign:ce,verify:Le,ExtendedPoint:b,utils:{getExtendedPublicKey:T,randomPrivateKey:()=>c(r.BYTES),precompute(y=8,p=b.BASE){return p._setWindowSize(y),p.multiply(BigInt(3)),p}}}}BigInt(0),BigInt(1);const it=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Rt=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Uo=BigInt(1),_t=BigInt(2);BigInt(3);const Lo=BigInt(5),To=BigInt(8);function No(e){const t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),i=it,c=e*e%i*e%i,h=G(c,_t,i)*c%i,u=G(h,Uo,i)*e%i,a=G(u,Lo,i)*u%i,s=G(a,t,i)*a%i,f=G(s,r,i)*s%i,l=G(f,n,i)*f%i,g=G(l,o,i)*l%i,d=G(g,o,i)*l%i,w=G(d,t,i)*a%i;return{pow_p_5_8:G(w,_t,i)*e%i,b2:c}}function Do(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Mo(e,t){const r=it,n=N(t*t*t,r),o=N(n*n*t,r),i=No(e*o).pow_p_5_8;let c=N(e*n*i,r);const h=N(t*c*c,r),u=c,a=N(c*Rt,r),s=h===e,f=h===N(-e,r),l=h===N(-e*Rt,r);return s&&(c=u),(f||l)&&(c=a),yo(c,r)&&(c=N(-c,r)),{isValid:s||f,value:c}}const jo=dr(it,void 0,!0),Wo={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:jo,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:To,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:so,randomBytes:sr,adjustScalarBytes:Do,uvRatio:Mo},br=Po(Wo),ko="EdDSA",zo="JWT",Oe=".",Ce="base64url",wr="utf8",mr="utf8",$o=":",Ko="did",Ho="key",Ct="base58btc",Vo="z",qo="K36",Go=32;function st(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function yr(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?st(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function vr(e,t){t||(t=e.reduce((o,i)=>o+i.length,0));const r=yr(t);let n=0;for(const o of e)r.set(o,n),n+=o.length;return st(r)}function Jo(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),c=i.charCodeAt(0);if(r[c]!==255)throw new TypeError(i+" is ambiguous");r[c]=o}var h=e.length,u=e.charAt(0),a=Math.log(h)/Math.log(256),s=Math.log(256)/Math.log(h);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var w=0,A=0,x=0,R=d.length;x!==R&&d[x]===0;)x++,w++;for(var b=(R-x)*s+1>>>0,S=new Uint8Array(b);x!==R;){for(var _=d[x],W=0,D=b-1;(_!==0||W<A)&&D!==-1;D--,W++)_+=256*S[D]>>>0,S[D]=_%h>>>0,_=_/h>>>0;if(_!==0)throw new Error("Non-zero carry");A=W,x++}for(var C=b-A;C!==b&&S[C]===0;)C++;for(var T=u.repeat(w);C<b;++C)T+=e.charAt(S[C]);return T}function l(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var w=0;if(d[w]!==" "){for(var A=0,x=0;d[w]===u;)A++,w++;for(var R=(d.length-w)*a+1>>>0,b=new Uint8Array(R);d[w];){var S=r[d.charCodeAt(w)];if(S===255)return;for(var _=0,W=R-1;(S!==0||_<x)&&W!==-1;W--,_++)S+=h*b[W]>>>0,b[W]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");x=_,w++}if(d[w]!==" "){for(var D=R-x;D!==R&&b[D]===0;)D++;for(var C=new Uint8Array(A+(R-D)),T=A;D!==R;)C[T++]=b[D++];return C}}}function g(d){var w=l(d);if(w)return w;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:l,decode:g}}var Zo=Jo,Yo=Zo;const Er=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Xo=e=>new TextEncoder().encode(e),Qo=e=>new TextDecoder().decode(e);class ei{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class ti{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return xr(this,t)}}class ri{constructor(t){this.decoders=t}or(t){return xr(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const xr=(e,t)=>new ri({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ni{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new ei(t,r,n),this.decoder=new ti(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Pe=({name:e,prefix:t,encode:r,decode:n})=>new ni(e,t,r,n),be=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:o}=Yo(r,t);return Pe({prefix:e,name:t,encode:n,decode:i=>Er(o(i))})},oi=(e,t,r,n)=>{const o={};for(let s=0;s<t.length;++s)o[t[s]]=s;let i=e.length;for(;e[i-1]==="=";)--i;const c=new Uint8Array(i*r/8|0);let h=0,u=0,a=0;for(let s=0;s<i;++s){const f=o[e[s]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);u=u<<r|f,h+=r,h>=8&&(h-=8,c[a++]=255&u>>h)}if(h>=r||255&u<<8-h)throw new SyntaxError("Unexpected end of data");return c},ii=(e,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let i="",c=0,h=0;for(let u=0;u<e.length;++u)for(h=h<<8|e[u],c+=8;c>r;)c-=r,i+=t[o&h>>c];if(c&&(i+=t[o&h<<r-c]),n)for(;i.length*r&7;)i+="=";return i},z=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Pe({prefix:t,name:e,encode(o){return ii(o,n,r)},decode(o){return oi(o,n,r,e)}}),si=Pe({prefix:"\0",name:"identity",encode:e=>Qo(e),decode:e=>Xo(e)});var ai=Object.freeze({__proto__:null,identity:si});const ci=z({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ui=Object.freeze({__proto__:null,base2:ci});const fi=z({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var hi=Object.freeze({__proto__:null,base8:fi});const li=be({prefix:"9",name:"base10",alphabet:"0123456789"});var di=Object.freeze({__proto__:null,base10:li});const pi=z({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gi=z({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var bi=Object.freeze({__proto__:null,base16:pi,base16upper:gi});const wi=z({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mi=z({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yi=z({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vi=z({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ei=z({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xi=z({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Fi=z({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bi=z({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ai=z({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Si=Object.freeze({__proto__:null,base32:wi,base32upper:mi,base32pad:yi,base32padupper:vi,base32hex:Ei,base32hexupper:xi,base32hexpad:Fi,base32hexpadupper:Bi,base32z:Ai});const Ii=be({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Oi=be({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ri=Object.freeze({__proto__:null,base36:Ii,base36upper:Oi});const _i=be({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ci=be({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Pi=Object.freeze({__proto__:null,base58btc:_i,base58flickr:Ci});const Ui=z({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Li=z({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ti=z({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ni=z({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Di=Object.freeze({__proto__:null,base64:Ui,base64pad:Li,base64url:Ti,base64urlpad:Ni});const Fr=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Mi=Fr.reduce((e,t,r)=>(e[r]=t,e),[]),ji=Fr.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function Wi(e){return e.reduce((t,r)=>(t+=Mi[r],t),"")}function ki(e){const t=[];for(const r of e){const n=ji[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const zi=Pe({prefix:"🚀",name:"base256emoji",encode:Wi,decode:ki});var $i=Object.freeze({__proto__:null,base256emoji:zi}),Ki=Br,Pt=128,Hi=-128,Vi=Math.pow(2,31);function Br(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Vi;)t[r++]=e&255|Pt,e/=128;for(;e&Hi;)t[r++]=e&255|Pt,e>>>=7;return t[r]=e|0,Br.bytes=r-n+1,t}var qi=Ze,Gi=128,Ut=127;function Ze(e,n){var r=0,n=n||0,o=0,i=n,c,h=e.length;do{if(i>=h)throw Ze.bytes=0,new RangeError("Could not decode varint");c=e[i++],r+=o<28?(c&Ut)<<o:(c&Ut)*Math.pow(2,o),o+=7}while(c>=Gi);return Ze.bytes=i-n,r}var Ji=Math.pow(2,7),Zi=Math.pow(2,14),Yi=Math.pow(2,21),Xi=Math.pow(2,28),Qi=Math.pow(2,35),es=Math.pow(2,42),ts=Math.pow(2,49),rs=Math.pow(2,56),ns=Math.pow(2,63),os=function(e){return e<Ji?1:e<Zi?2:e<Yi?3:e<Xi?4:e<Qi?5:e<es?6:e<ts?7:e<rs?8:e<ns?9:10},is={encode:Ki,decode:qi,encodingLength:os},Ar=is;const Lt=(e,t,r=0)=>(Ar.encode(e,t,r),t),Tt=e=>Ar.encodingLength(e),Ye=(e,t)=>{const r=t.byteLength,n=Tt(e),o=n+Tt(r),i=new Uint8Array(o+r);return Lt(e,i,0),Lt(r,i,n),i.set(t,o),new ss(e,r,t,i)};class ss{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const Sr=({name:e,code:t,encode:r})=>new as(e,t,r);class as{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Ye(this.code,r):r.then(n=>Ye(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Ir=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),cs=Sr({name:"sha2-256",code:18,encode:Ir("SHA-256")}),us=Sr({name:"sha2-512",code:19,encode:Ir("SHA-512")});var fs=Object.freeze({__proto__:null,sha256:cs,sha512:us});const Or=0,hs="identity",Rr=Er,ls=e=>Ye(Or,Rr(e)),ds={code:Or,name:hs,encode:Rr,digest:ls};var ps=Object.freeze({__proto__:null,identity:ds});new TextEncoder,new TextDecoder;const Nt={...ai,...ui,...hi,...di,...bi,...Si,...Ri,...Pi,...Di,...$i};({...fs,...ps});function _r(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Dt=_r("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),$e=_r("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=yr(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Cr={utf8:Dt,"utf-8":Dt,hex:Nt.base16,latin1:$e,ascii:$e,binary:$e,...Nt};function Ue(e,t="utf8"){const r=Cr[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}function he(e,t="utf8"){const r=Cr[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?st(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}function Mt(e){return ge(Ue(he(e,Ce),wr))}function Re(e){return Ue(he(fe(e),wr),Ce)}function gs(e){const t=he(qo,Ct),r=Vo+Ue(vr([t,e]),Ct);return[Ko,Ho,r].join($o)}function bs(e){return Ue(e,Ce)}function ws(e){return he(e,Ce)}function ms(e){return he([Re(e.header),Re(e.payload)].join(Oe),mr)}function ys(e){return[Re(e.header),Re(e.payload),bs(e.signature)].join(Oe)}function Ra(e){const t=e.split(Oe),r=Mt(t[0]),n=Mt(t[1]),o=ws(t[2]),i=he(t.slice(0,2).join(Oe),mr);return{header:r,payload:n,signature:o,data:i}}function _a(e=sr(Go)){const t=br.getPublicKey(e);return{secretKey:vr([e,t]),publicKey:t}}async function Ca(e,t,r,n,o=Qe.fromMiliseconds(Date.now())){const i={alg:ko,typ:zo},c=gs(n.publicKey),h=o+r,u={iss:c,sub:e,aud:t,iat:o,exp:h},a=ms({header:i,payload:u}),s=br.sign(a,n.secretKey.slice(0,32));return ys({header:i,payload:u,signature:s})}function Pr(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function Pa(e,t){t||(t=e.reduce((o,i)=>o+i.length,0));const r=Pr(t);let n=0;for(const o of e)r.set(o,n),n+=o.length;return r}const jt={...un,...cn,...an,...sn,...on,...nn,...rn,...tn,...en,...Qr};function Ur(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Wt=Ur("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Ke=Ur("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=Pr(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Lr={utf8:Wt,"utf-8":Wt,hex:jt.base16,latin1:Ke,ascii:Ke,binary:Ke,...jt};function Ua(e,t="utf8"){const r=Lr[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e,"utf8"):r.decoder.decode(`${r.prefix}${e}`)}function La(e,t="utf8"){const r=Lr[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}const Ta={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};class vs{}let Es=class extends vs{constructor(t){super()}};const kt=Qe.FIVE_SECONDS,xs={pulse:"heartbeat_pulse"};class Tr extends Es{constructor(t){super(t),this.events=new _e.EventEmitter,this.interval=kt,this.interval=(t==null?void 0:t.interval)||kt}static async init(t){const r=new Tr(t);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),Qe.toMiliseconds(this.interval))}pulse(){this.events.emit(xs.pulse)}}function Fs(e){return!e||typeof e.then!="function"?Promise.resolve(e):e}function M(e,...t){try{return Fs(e(...t))}catch(r){return Promise.reject(r)}}function Bs(e){const t=typeof e;return e===null||t!=="object"&&t!=="function"}function As(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}function Se(e){if(Bs(e))return String(e);if(As(e)||Array.isArray(e))return JSON.stringify(e);if(typeof e.toJSON=="function")return Se(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Xe="base64:";function Ss(e){return typeof e=="string"?e:Xe+Rs(e)}function Is(e){return typeof e!="string"||!e.startsWith(Xe)?e:Os(e.slice(Xe.length))}function Os(e){return globalThis.Buffer?nr.from(e,"base64"):Uint8Array.from(globalThis.atob(e),t=>t.codePointAt(0))}function Rs(e){return globalThis.Buffer?nr.from(e).toString("base64"):globalThis.btoa(String.fromCodePoint(...e))}function H(e){var t;return e&&((t=e.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function _s(...e){return H(e.join(":"))}function Fe(e){return e=H(e),e?e+":":""}function Cs(e,t){if(t===void 0)return!0;let r=0,n=e.indexOf(":");for(;n>-1;)r++,n=e.indexOf(":",n+1);return r<=t}function Ps(e,t){return t?e.startsWith(t)&&e[e.length-1]!=="$":e[e.length-1]!=="$"}const Us="memory",Ls=()=>{const e=new Map;return{name:Us,getInstance:()=>e,hasItem(t){return e.has(t)},getItem(t){return e.get(t)??null},getItemRaw(t){return e.get(t)??null},setItem(t,r){e.set(t,r)},setItemRaw(t,r){e.set(t,r)},removeItem(t){e.delete(t)},getKeys(){return[...e.keys()]},clear(){e.clear()},dispose(){e.clear()}}};function Ts(e={}){const t={mounts:{"":e.driver||Ls()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=a=>{for(const s of t.mountpoints)if(a.startsWith(s))return{base:s,relativeKey:a.slice(s.length),driver:t.mounts[s]};return{base:"",relativeKey:a,driver:t.mounts[""]}},n=(a,s)=>t.mountpoints.filter(f=>f.startsWith(a)||s&&a.startsWith(f)).map(f=>({relativeBase:a.length>f.length?a.slice(f.length):void 0,mountpoint:f,driver:t.mounts[f]})),o=(a,s)=>{if(t.watching){s=H(s);for(const f of t.watchListeners)f(a,s)}},i=async()=>{if(!t.watching){t.watching=!0;for(const a in t.mounts)t.unwatch[a]=await zt(t.mounts[a],o,a)}},c=async()=>{if(t.watching){for(const a in t.unwatch)await t.unwatch[a]();t.unwatch={},t.watching=!1}},h=(a,s,f)=>{const l=new Map,g=d=>{let w=l.get(d.base);return w||(w={driver:d.driver,base:d.base,items:[]},l.set(d.base,w)),w};for(const d of a){const w=typeof d=="string",A=H(w?d:d.key),x=w?void 0:d.value,R=w||!d.options?s:{...s,...d.options},b=r(A);g(b).items.push({key:A,value:x,relativeKey:b.relativeKey,options:R})}return Promise.all([...l.values()].map(d=>f(d))).then(d=>d.flat())},u={hasItem(a,s={}){a=H(a);const{relativeKey:f,driver:l}=r(a);return M(l.hasItem,f,s)},getItem(a,s={}){a=H(a);const{relativeKey:f,driver:l}=r(a);return M(l.getItem,f,s).then(g=>ye(g))},getItems(a,s={}){return h(a,s,f=>f.driver.getItems?M(f.driver.getItems,f.items.map(l=>({key:l.relativeKey,options:l.options})),s).then(l=>l.map(g=>({key:_s(f.base,g.key),value:ye(g.value)}))):Promise.all(f.items.map(l=>M(f.driver.getItem,l.relativeKey,l.options).then(g=>({key:l.key,value:ye(g)})))))},getItemRaw(a,s={}){a=H(a);const{relativeKey:f,driver:l}=r(a);return l.getItemRaw?M(l.getItemRaw,f,s):M(l.getItem,f,s).then(g=>Is(g))},async setItem(a,s,f={}){if(s===void 0)return u.removeItem(a);a=H(a);const{relativeKey:l,driver:g}=r(a);g.setItem&&(await M(g.setItem,l,Se(s),f),g.watch||o("update",a))},async setItems(a,s){await h(a,s,async f=>{if(f.driver.setItems)return M(f.driver.setItems,f.items.map(l=>({key:l.relativeKey,value:Se(l.value),options:l.options})),s);f.driver.setItem&&await Promise.all(f.items.map(l=>M(f.driver.setItem,l.relativeKey,Se(l.value),l.options)))})},async setItemRaw(a,s,f={}){if(s===void 0)return u.removeItem(a,f);a=H(a);const{relativeKey:l,driver:g}=r(a);if(g.setItemRaw)await M(g.setItemRaw,l,s,f);else if(g.setItem)await M(g.setItem,l,Ss(s),f);else return;g.watch||o("update",a)},async removeItem(a,s={}){typeof s=="boolean"&&(s={removeMeta:s}),a=H(a);const{relativeKey:f,driver:l}=r(a);l.removeItem&&(await M(l.removeItem,f,s),(s.removeMeta||s.removeMata)&&await M(l.removeItem,f+"$",s),l.watch||o("remove",a))},async getMeta(a,s={}){typeof s=="boolean"&&(s={nativeOnly:s}),a=H(a);const{relativeKey:f,driver:l}=r(a),g=Object.create(null);if(l.getMeta&&Object.assign(g,await M(l.getMeta,f,s)),!s.nativeOnly){const d=await M(l.getItem,f+"$",s).then(w=>ye(w));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(g,d))}return g},setMeta(a,s,f={}){return this.setItem(a+"$",s,f)},removeMeta(a,s={}){return this.removeItem(a+"$",s)},async getKeys(a,s={}){var A;a=Fe(a);const f=n(a,!0);let l=[];const g=[];let d=!0;for(const x of f){(A=x.driver.flags)!=null&&A.maxDepth||(d=!1);const R=await M(x.driver.getKeys,x.relativeBase,s);for(const b of R){const S=x.mountpoint+H(b);l.some(_=>S.startsWith(_))||g.push(S)}l=[x.mountpoint,...l.filter(b=>!b.startsWith(x.mountpoint))]}const w=s.maxDepth!==void 0&&!d;return g.filter(x=>(!w||Cs(x,s.maxDepth))&&Ps(x,a))},async clear(a,s={}){a=Fe(a),await Promise.all(n(a,!1).map(async f=>{if(f.driver.clear)return M(f.driver.clear,f.relativeBase,s);if(f.driver.removeItem){const l=await f.driver.getKeys(f.relativeBase||"",s);return Promise.all(l.map(g=>f.driver.removeItem(g,s)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(a=>$t(a)))},async watch(a){return await i(),t.watchListeners.push(a),async()=>{t.watchListeners=t.watchListeners.filter(s=>s!==a),t.watchListeners.length===0&&await c()}},async unwatch(){t.watchListeners=[],await c()},mount(a,s){if(a=Fe(a),a&&t.mounts[a])throw new Error(`already mounted at ${a}`);return a&&(t.mountpoints.push(a),t.mountpoints.sort((f,l)=>l.length-f.length)),t.mounts[a]=s,t.watching&&Promise.resolve(zt(s,o,a)).then(f=>{t.unwatch[a]=f}).catch(console.error),u},async unmount(a,s=!0){var f,l;a=Fe(a),!(!a||!t.mounts[a])&&(t.watching&&a in t.unwatch&&((l=(f=t.unwatch)[a])==null||l.call(f),delete t.unwatch[a]),s&&await $t(t.mounts[a]),t.mountpoints=t.mountpoints.filter(g=>g!==a),delete t.mounts[a])},getMount(a=""){a=H(a)+":";const s=r(a);return{driver:s.driver,base:s.base}},getMounts(a="",s={}){return a=H(a),n(a,s.parents).map(l=>({driver:l.driver,base:l.mountpoint}))},keys:(a,s={})=>u.getKeys(a,s),get:(a,s={})=>u.getItem(a,s),set:(a,s,f={})=>u.setItem(a,s,f),has:(a,s={})=>u.hasItem(a,s),del:(a,s={})=>u.removeItem(a,s),remove:(a,s={})=>u.removeItem(a,s)};return u}function zt(e,t,r){return e.watch?e.watch((n,o)=>t(n,r+o)):()=>{}}async function $t(e){typeof e.dispose=="function"&&await M(e.dispose)}function se(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function Nr(e,t){let r;const n=()=>{if(r)return r;const o=indexedDB.open(e);return o.onupgradeneeded=()=>o.result.createObjectStore(t),r=se(o),r.then(i=>{i.onclose=()=>r=void 0},()=>{}),r};return(o,i)=>n().then(c=>i(c.transaction(t,o).objectStore(t)))}let He;function we(){return He||(He=Nr("keyval-store","keyval")),He}function Kt(e,t=we()){return t("readonly",r=>se(r.get(e)))}function Ns(e,t,r=we()){return r("readwrite",n=>(n.put(t,e),se(n.transaction)))}function Ds(e,t=we()){return t("readwrite",r=>(r.delete(e),se(r.transaction)))}function Ms(e=we()){return e("readwrite",t=>(t.clear(),se(t.transaction)))}function js(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},se(e.transaction)}function Ws(e=we()){return e("readonly",t=>{if(t.getAllKeys)return se(t.getAllKeys());const r=[];return js(t,n=>r.push(n.key)).then(()=>r)})}const ks="idb-keyval";var zs=(e={})=>{const t=e.base&&e.base.length>0?`${e.base}:`:"",r=o=>t+o;let n;return e.dbName&&e.storeName&&(n=Nr(e.dbName,e.storeName)),{name:ks,options:e,async hasItem(o){return!(typeof await Kt(r(o),n)>"u")},async getItem(o){return await Kt(r(o),n)??null},setItem(o,i){return Ns(r(o),i,n)},removeItem(o){return Ds(r(o),n)},getKeys(){return Ws(n)},clear(){return Ms(n)}}};const $s="WALLET_CONNECT_V2_INDEXED_DB",Ks="keyvaluestorage";class Hs{constructor(){this.indexedDb=Ts({driver:zs({dbName:$s,storeName:Ks})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,fe(r))}async removeItem(t){await this.indexedDb.removeItem(t)}}var Ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ie<"u"?ie:typeof self<"u"?self:{},Ie={exports:{}};(function(){let e;function t(){}e=t,e.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},e.prototype.setItem=function(r,n){this[r]=String(n)},e.prototype.removeItem=function(r){delete this[r]},e.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},e.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ve<"u"&&Ve.localStorage?Ie.exports=Ve.localStorage:typeof window<"u"&&window.localStorage?Ie.exports=window.localStorage:Ie.exports=new t})();function Vs(e){var t;return[e[0],ge((t=e[1])!=null?t:"")]}class qs{constructor(){this.localStorage=Ie.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Vs)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return ge(r)}async setItem(t,r){this.localStorage.setItem(t,fe(r))}async removeItem(t){this.localStorage.removeItem(t)}}const Gs="wc_storage_version",Ht=1,Js=async(e,t,r)=>{const n=Gs,o=await t.getItem(n);if(o&&o>=Ht){r(t);return}const i=await e.getKeys();if(!i.length){r(t);return}const c=[];for(;i.length;){const h=i.shift();if(!h)continue;const u=h.toLowerCase();if(u.includes("wc@")||u.includes("walletconnect")||u.includes("wc_")||u.includes("wallet_connect")){const a=await e.getItem(h);await t.setItem(h,a),c.push(h)}}await t.setItem(n,Ht),r(t),Zs(e,c)},Zs=async(e,t)=>{t.length&&t.forEach(async r=>{await e.removeItem(r)})};let Da=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new qs;this.storage=t;try{const r=new Hs;Js(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};const Ys="PARSE_ERROR",Xs="INVALID_REQUEST",Qs="METHOD_NOT_FOUND",ea="INVALID_PARAMS",Dr="INTERNAL_ERROR",at="SERVER_ERROR",ta=[-32700,-32600,-32601,-32602,-32603],pe={[Ys]:{code:-32700,message:"Parse error"},[Xs]:{code:-32600,message:"Invalid Request"},[Qs]:{code:-32601,message:"Method not found"},[ea]:{code:-32602,message:"Invalid params"},[Dr]:{code:-32603,message:"Internal error"},[at]:{code:-32e3,message:"Server error"}},Mr=at;function ra(e){return ta.includes(e)}function Vt(e){return Object.keys(pe).includes(e)?pe[e]:pe[Mr]}function na(e){const t=Object.values(pe).find(r=>r.code===e);return t||pe[Mr]}function jr(e,t,r){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):e}function Wr(e=3){const t=Date.now()*Math.pow(10,e),r=Math.floor(Math.random()*Math.pow(10,e));return t+r}function oa(e=6){return BigInt(Wr(e))}function ia(e,t,r){return{id:r||Wr(),jsonrpc:"2.0",method:e,params:t}}function ja(e,t){return{id:e,jsonrpc:"2.0",result:t}}function kr(e,t,r){return{id:e,jsonrpc:"2.0",error:sa(t)}}function sa(e,t){return typeof e>"u"?Vt(Dr):(typeof e=="string"&&(e=Object.assign(Object.assign({},Vt(at)),{message:e})),ra(e.code)&&(e=na(e.code)),e)}class aa{}class ca extends aa{constructor(){super()}}class ua extends ca{constructor(t){super()}}const fa="^https?:",ha="^wss?:";function la(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function zr(e,t){const r=la(e);return typeof r>"u"?!1:new RegExp(t).test(r)}function qt(e){return zr(e,fa)}function Gt(e){return zr(e,ha)}function da(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}function $r(e){return typeof e=="object"&&"id"in e&&"jsonrpc"in e&&e.jsonrpc==="2.0"}function Wa(e){return $r(e)&&"method"in e}function pa(e){return $r(e)&&(ga(e)||Kr(e))}function ga(e){return"result"in e}function Kr(e){return"error"in e}class ka extends ua{constructor(t){super(t),this.events=new _e.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(ia(t.method,t.params||[],t.id||oa().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(i){o(i)}this.events.on(`${t.id}`,i=>{Kr(i)?o(i.error):n(i.result)});try{await this.connection.send(t,r)}catch(i){o(i)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),pa(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const ba=()=>typeof WebSocket<"u"?WebSocket:typeof ie<"u"&&typeof ie.WebSocket<"u"?ie.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),wa=()=>typeof WebSocket<"u"||typeof ie<"u"&&typeof ie.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Jt=e=>e.split("?")[0],Zt=10,ma=ba();let za=class{constructor(t){if(this.url=t,this.events=new _e.EventEmitter,this.registering=!1,!Gt(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(fe(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Gt(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),o(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=fn.isReactNative()?void 0:{rejectUnauthorized:!da(t)},i=new ma(t,[],o);wa()?i.onerror=c=>{const h=c;n(this.emitError(h.error))}:i.on("error",c=>{n(this.emitError(c))}),i.onopen=()=>{this.onOpen(i),r(i)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ge(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),i=kr(t,o);this.events.emit("payload",i)}parseError(t,r=this.url){return jr(t,Jt(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Zt&&this.events.setMaxListeners(Zt)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Jt(this.url)}`));return this.events.emit("register_error",r),r}};var ya=Object.defineProperty,va=Object.defineProperties,Ea=Object.getOwnPropertyDescriptors,Yt=Object.getOwnPropertySymbols,xa=Object.prototype.hasOwnProperty,Fa=Object.prototype.propertyIsEnumerable,Xt=(e,t,r)=>t in e?ya(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Qt=(e,t)=>{for(var r in t||(t={}))xa.call(t,r)&&Xt(e,r,t[r]);if(Yt)for(var r of Yt(t))Fa.call(t,r)&&Xt(e,r,t[r]);return e},er=(e,t)=>va(e,Ea(t));const Ba={Accept:"application/json","Content-Type":"application/json"},Aa="POST",tr={headers:Ba,method:Aa},rr=10;class Ka{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new _e.EventEmitter,this.isAvailable=!1,this.registering=!1,!qt(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=fe(t),n=await(await wt(this.url,er(Qt({},tr),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!qt(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),o(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=fe({id:1,jsonrpc:"2.0",method:"test",params:[]});await wt(t,er(Qt({},tr),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?ge(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),i=kr(t,o);this.events.emit("payload",i)}parseError(t,r=this.url){return jr(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>rr&&this.events.setMaxListeners(rr)}}export{Ta as C,vs as I,_a as P,gs as Q,ia as a,za as b,Pa as c,Oa as d,Wa as e,Ua as f,pa as g,Da as h,Tr as i,ja as j,Ca as k,oa as l,kr as m,ga as n,ka as o,Kr as p,Wr as q,xs as r,Ra as s,La as t,Ka as u,jt as v,ye as w};
